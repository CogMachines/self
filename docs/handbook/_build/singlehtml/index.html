<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Self Handbook for Self 2017.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'for Self 2017.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-self-handbook">
<h1>The Self Handbook<a class="headerlink" href="#the-self-handbook" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Release:</th><td class="field-body">for Self 2017.1</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">May 16, 2017</td>
</tr>
</tbody>
</table>
<p>Edited by Russell Allen.</p>
<p>Authors (in alphabetical order): Ole Agesen, Lars Bak, Craig Chambers, Bay-Wei Chang, Urs Hölzle, John Maloney, Tobias Pape, Randall B. Smith, David Ungar and Mario Wolczko.</p>
<p>Thanks to Ganesh R for his transcription services.</p>
<div class="toctree-wrapper compound">
<span id="document-intro"></span><div class="section" id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><p id="index-3">Self is a prototype-based dynamic object-oriented programming language, environment, and virtual machine centered around the principles of simplicity, uniformity, concreteness, and liveness.</p>
<p>Self includes a programming language, a collection of objects defined in the Self language, and a programming environment built in Self for writing Self programs. The language and environment attempt to present objects to the programmer and user in as direct and physical a way as possible. The system uses the prototype-based style of object construction.</p>
<p>Self is available for Solaris, Linux and natively on MacOS X under a BSD-like licence; we would be very interested in anyone prepared to make a Windows port.</p>
<div class="section" id="history">
<h3>1.1. History<a class="headerlink" href="#history" title="Permalink to this headline">¶</a></h3>
<p>The first version of the Self language was designed in 1986 by David Ungar and Randall B. Smith at Xerox PARC. A series of Self implementations and a graphical programming environment were built at Stanford University by Craig Chambers, Urs Hölzle, Ole Agesen, Elgin Lee, Bay-Wei Chang, and David Ungar. The project continued at Sun MIcrosystems Laboratories, where it benefited from the efforts of Randall B. Smith, Mario Wolczko, John Maloney, and Lars Bak. Smith and Ungar jointly led it there. Work on the project officially ceased in 1995</p>
<p>Release 4.0 contained an entirely new user interface and programming environment designed for “serious” programming, enabling the programmer to create and modify objects entirely within the environment, and then save the object into files for distribution purposes. The metaphor used to present an object to the user is that of an outliner, allowing the user to view varying levels of detail. Also included in the environment is a graphical debugger, and tools for navigation through the system.</p>
<p>Release 4.4 was the first release for Linux x86.</p>
</div>
<div class="section" id="system-overview">
<h3>1.2. System Overview<a class="headerlink" href="#system-overview" title="Permalink to this headline">¶</a></h3>
<p>This section contains an overview of the system and its implementation; it can be skipped if you wish to get started as quickly as possible.</p>
<p>Although Self runs as a single UNIX <a class="footnote-reference" href="#f1" id="id1"><sup>1</sup></a> process, or a single Macintosh application, it really has two parts: the <em>virtual machine</em> (VM) and the <em>Self world</em>, the collection of Self objects that are the Self prototypes and programs:</p>
<div class="figure" id="id2">
<a class="reference internal image-reference" href="_images/Chapter_1_Figure_1.png"><img alt="_images/Chapter_1_Figure_1.png" src="_images/Chapter_1_Figure_1.png" style="width: 178.2px; height: 53.4px;" /></a>
<p class="caption"><span class="caption-number">Fig. 1.1 </span><span class="caption-text">The Self system</span></p>
</div>
<p>The VM executes Self programs specified by objects in the Self world and provides a set of <em>primitives</em> (which are methods written in C++) that can be invoked by Self methods to carry out basic operations like integer arithmetic, object copying, and I/O. The Self world distributed with the VM is a collection of Self objects implementing various <em>traits</em> and <em>prototypes</em> like cloning traits and dictionaries. These objects can be used (or changed) to implement your own programs.</p>
<div class="figure" id="id3">
<span id="fighowselfprogcompiled"></span><img alt="_images/Chapter_1_Figure_2.png" src="_images/Chapter_1_Figure_2.png" />
<p class="caption"><span class="caption-number">Fig. 1.2 </span><span class="caption-text">How Self programs are compiled.</span></p>
</div>
<span class="target" id="index-4"></span><span class="target" id="index-5"></span><p id="index-6">Self programs are translated to machine code in a two-stage process (see <a class="reference internal" href="#fighowselfprogcompiled"><span class="std std-numref">Fig. 1.2</span></a>). Code typed in at the prompt, through the user interface, or read in from a file is parsed into Self objects. Some of these objects are data objects; others are methods. Methods have their own behavior which they represent with <em>bytecodes</em>. The bytecodes are the instructions for a very simple virtual processor that understands instructions like “push receiver” or “send the ‘x’ message.” In fact, Self bytecodes correspond much more closely to source code than, say, Smalltalk-80 bytecodes. (See <a class="reference internal" href="index.html#citations"><span class="std std-ref">[CUL89]</span></a> for a list of the Self byte codes.) The <em>raison d’être</em> of the virtual machine is to pretend that these bytecodes are directly executed by the computer; the programmer can explore the Self world down to the bytecode level, but no further. This pretense ensures that the behavior of a Self program can be understood by looking only at the Self source code.</p>
<p>The second stage of translation is the actual <em>compilation</em> of the bytecodes to machine code. This is how the “execution” of bytecodes is implemented—it is totally invisible on the Self level except for side effects like execution speed and memory usage. The compilation takes place the first time a message is actually sent; thus, the first execution of a program will be slower than subsequent executions.</p>
<p>Actually, this explanation is not entirely accurate: the compiled method is specialized on the type of the receiver. If the same message is later sent to a receiver of different type (e.g., a float instead of an integer), a new compilation takes place. This technique is called <em>customization</em>; see <a class="reference internal" href="index.html#citations"><span class="std std-ref">[CU89]</span></a> for details. Also, the compiled methods are placed into a cache from which they can be flushed for various reasons; therefore, they might be recompiled from time to time. Furthermore, the current version of the compiler will recompile and reoptimize frequently used code, using information gathered at run-time as to how the code is being used; see <a class="reference internal" href="index.html#citations"><span class="std std-ref">[HCU91]</span></a> for details.</p>
<p>Don’t be misled by the term “compiled method” if you are familiar with Smalltalk: in Smalltalk terminology it denotes a method in its bytecode form, but in Self it denotes the native machine code form. In Smalltalk there is only one compiled method per source method, but in Self there may be several different compiled methods for the same source method (because of customization).</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>UNIX is a trademark of AT&amp;T Bell Laboratories.</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-gettingstarted"></span><div class="section" id="getting-started">
<h2>2. Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Last updated 5 January 2014 for Self 4.5.0</div></blockquote>
<div class="section" id="downloading-prebuilt-vm-and-snapshot">
<h3>2.1. Downloading Prebuilt VM and snapshot<a class="headerlink" href="#downloading-prebuilt-vm-and-snapshot" title="Permalink to this headline">¶</a></h3>
<p>The easiest way to get started with Self is to download a prebuild VM and a snapshot of the default Self world from the <span class="target" id="self-website">Self website</span>.</p>
<p>For OS X, this means a DMG file which will mount when double clicked. On Linux this means a <code class="docutils literal"><span class="pre">.tar.gz</span></code> file.</p>
</div>
<div class="section" id="running-on-os-x">
<h3>2.2. Running on OS X<a class="headerlink" href="#running-on-os-x" title="Permalink to this headline">¶</a></h3>
<p>Once the DMG has been mounted, find it in Finder and drag the &#8216;<code class="docutils literal"><span class="pre">Self</span> <span class="pre">Control.app</span></code>&#8216; to your Applications folder, and the &#8216;<code class="docutils literal"><span class="pre">Clean.snap</span></code>&#8216; file somewhere convenient. This file is a snapshot of the default Self world.</p>
</div>
<div class="section" id="running-on-linux">
<h3>2.3. Running on Linux<a class="headerlink" href="#running-on-linux" title="Permalink to this headline">¶</a></h3>
<p>Untar the downloaded <code class="docutils literal"><span class="pre">.tar.gz</span></code> file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="n">zxvf</span> <span class="n">Self</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>This should give you at least two files, a binary &#8216;<code class="docutils literal"><span class="pre">Self</span></code>&#8216; which is the VM, and the file &#8216;<code class="docutils literal"><span class="pre">Clean.snap</span></code>&#8216; which is a snapshot of the default Self world. Make sure the VM is executable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="n">u</span><span class="o">+</span><span class="n">x</span> <span class="n">Self</span>
</pre></div>
</div>
<p>and run the VM, passing the snapshot as an argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Self</span> <span class="o">-</span><span class="n">s</span> <span class="n">Clean</span><span class="o">.</span><span class="n">self</span>
</pre></div>
</div>
</div>
<div class="section" id="building-your-own-system">
<h3>2.4. Building your own system<a class="headerlink" href="#building-your-own-system" title="Permalink to this headline">¶</a></h3>
<p>It is relatively easy to biuld the two key components of Self, the Self World and the Self Virtual Machine. They both start from downloading the Self sources from the GitHub repository by the following git command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">russellallen</span><span class="o">/</span><span class="bp">self</span><span class="o">/</span>
</pre></div>
</div>
<p>and then follow chapters <a class="reference internal" href="index.html#building-a-vm"><span class="std std-ref">8.1</span></a> <a class="reference internal" href="index.html#document-buildvm"><span class="doc">Instructions on how to build the VM</span></a> and <a class="reference internal" href="index.html#building-a-world"><span class="std std-ref">4.13</span></a> <a class="reference internal" href="index.html#document-buildworld"><span class="doc">Instructions on how to build a Self World</span></a>.</p>
</div>
</div>
<span id="document-langref"></span><div class="section" id="language-reference">
<h2>3. Language Reference<a class="headerlink" href="#language-reference" title="Permalink to this headline">¶</a></h2>
<p>This chapter specifies Self’s syntax and semantics. An early version of the syntax was presented
in the original Self paper by Ungar and Smith <a class="reference internal" href="index.html#citations"><span class="std std-ref">[US87]</span></a> ; this chapter incorporates subsequent
changes to the language. The presentation assumes a basic understanding of object-oriented concepts.</p>
<p>The syntax is described using Extended Backus-Naur Form (EBNF). Terminal symbols appear in
Courier and are enclosed in single quotes; they should appear in code as written (not including
the single quotes). Non-terminal symbols are italicized. The following table describes the metasymbols:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="14%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>META-SYMBOL</td>
<td>FUNCTION</td>
<td>DESCRIPTION</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">(</span></code> and <code class="docutils literal"><span class="pre">)</span></code></td>
<td>grouping</td>
<td>used to group syntactic constructions</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[</span></code> and <code class="docutils literal"><span class="pre">]</span></code></td>
<td>option</td>
<td>encloses an optional construction</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">{</span></code> and <code class="docutils literal"><span class="pre">}</span></code></td>
<td>repetition</td>
<td>encloses a construction that may be repeated zero or more times</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">\</span></code></td>
<td>alternative</td>
<td>separates alternative constructions</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">→</span></code></td>
<td>production</td>
<td>separates the left and right hand sides of a production</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>A glossary of terms used in this document can be found in <a class="reference internal" href="index.html#document-glossary"><span class="doc">Appendix A</span></a>.</p>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><div class="section" id="objects">
<span id="index-2"></span><h3>3.1. Objects<a class="headerlink" href="#objects" title="Permalink to this headline">¶</a></h3>
<p><em>Objects</em> are the fundamental entities in Self; every entity in a Self program is represented by one
or more objects. Even control is handled by objects: <em>blocks</em> (<a class="reference internal" href="#pp-langref-blocks"><span class="std std-ref">§3.1.7</span></a>) are Self closures used to implement
user-defined control structures. An object is composed of a (possibly empty) set of <em>slots</em>
and, optionally, <em>code</em> (<a class="reference internal" href="#pp-langref-code"><span class="std std-ref">§3.1.5</span></a>). A slot is a name-value pair; slots contain references to other objects.
When a slot is found during a <em>message lookup</em> (<a class="reference internal" href="#pp-langref-message-lookup"><span class="std std-ref">§3.3.6</span></a>) the object in the slot is evaluated.</p>
<p>Although everything is an object in Self, not all objects serve the same purpose; certain kinds of
objects occur frequently enough in specialized roles to merit distinct terminology and syntax. This
chapter introduces two kinds of objects, namely data objects (“plain” objects) and the two kinds of
objects with code, ordinary methods and block methods.</p>
<div class="section" id="syntax">
<span id="index-3"></span><h4>3.1.1. Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h4>
<p><em>Object literals</em> are delimited by parentheses. Within the parentheses, an object description consists
of a list of slots delimited by vertical bars (‘<code class="docutils literal"><span class="pre">|</span></code>’), followed by the code to be executed when the object
is evaluated. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>( | slot1. slot2 | ’here is some code’ printLine )
</pre></div>
</div>
<p>Both the slot list and code are optional: ‘<code class="docutils literal"><span class="pre">(|</span> <span class="pre">|)</span></code>’ and ‘<code class="docutils literal"><span class="pre">()</span></code>’ each denote an empty object <a class="footnote-reference" href="#f1" id="id1"><sup>1</sup></a>.</p>
<p><em>Block objects</em> are written like other objects, except that square brackets (‘<code class="docutils literal"><span class="pre">[</span></code>’ and ‘<code class="docutils literal"><span class="pre">]</span></code>’) are used in
place of parentheses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>[ | slot1. slot2 | ’here is some code in a block’ printLine ]
</pre></div>
</div>
<p>A <em>slot list</em> consists of a (possibly empty) sequence of <em>slot descriptors</em> (<a class="reference internal" href="#pp-langref-slot-descriptors"><span class="std std-ref">§3.2</span></a>) separated by periods.
A period at the end of the slot list is optional <a class="footnote-reference" href="#f2" id="id2"><sup>2</sup></a>.</p>
<p>The code for an object is a sequence of <em>expressions</em> (<a class="reference internal" href="#pp-langref-expressions"><span class="std std-ref">§3.3</span></a>) separated by periods. A trailing period
is optional. Each expression consists of a series of <em>message sends</em> and <em>literals</em>. The last expression
in the code for an object may be preceded by the ‘<code class="docutils literal"><span class="pre">^</span></code>’ operator (<a class="reference internal" href="#pp-langref-returns"><span class="std std-ref">§3.1.8</span></a>).</p>
<span class="target" id="index-4"></span></div>
<div class="section" id="data-objects">
<span id="index-5"></span><h4>3.1.2. Data objects<a class="headerlink" href="#data-objects" title="Permalink to this headline">¶</a></h4>
<p><em>Data objects</em> are objects without code. Data objects can have any number of slots. For example, the
object <code class="docutils literal"><span class="pre">()</span></code> has no slots (i.e., it’s empty) while the object <code class="docutils literal"><span class="pre">(</span> <span class="pre">|</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">17.</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">18</span> <span class="pre">|</span> <span class="pre">)</span></code> has two slots,
<code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code>.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Chapter_2_Image_1.png"><img alt="_images/Chapter_2_Image_1.png" src="_images/Chapter_2_Image_1.png" style="width: 385.6px; height: 87.2px;" /></a>
</div>
<p>A data object returns itself when evaluated.</p>
<span class="target" id="index-6"></span><span class="target" id="index-7"></span><span class="target" id="index-8"></span><span class="target" id="index-9"></span></div>
<div class="section" id="the-assignment-primitive">
<span id="index-10"></span><h4>3.1.3. The assignment primitive<a class="headerlink" href="#the-assignment-primitive" title="Permalink to this headline">¶</a></h4>
<p>A slot containing the assignment primitive is called an <em>assignment slot</em> (<a class="reference internal" href="#pp-read-write-slots"><span class="std std-ref">§3.2.2</span></a>). When an assignment
slot is evaluated, the argument to the message is stored in the corresponding <em>data slot</em> (<a class="reference internal" href="#pp-langref-slot-descriptors"><span class="std std-ref">§3.2</span></a>)
in the same object (the slot whose name is the assignment slot’s name minus the trailing colon),
and the <em>receiver</em> (<a class="reference internal" href="#pp-implicit-receiver"><span class="std std-ref">§3.3.4</span></a>) is returned as the result. (Note: this means that the value of an assignment
statement is the left-hand side of the assignment statement, not the right-hand side as it is in Smalltalk,
C, and many other languages. This is a potential source of confusion for new Self programmers.)</p>
<span class="target" id="index-11"></span><span class="target" id="index-12"></span><span class="target" id="index-13"></span><span class="target" id="index-14"></span><span class="target" id="index-15"></span><span class="target" id="index-16"></span><span class="target" id="index-17"></span></div>
<div class="section" id="objects-with-code">
<span id="index-18"></span><h4>3.1.4. Objects with code<a class="headerlink" href="#objects-with-code" title="Permalink to this headline">¶</a></h4>
<p>The feature that distinguishes a <em>method object</em> from a data object is that it has <em>code</em>, whereas a data
object does not. Evaluating a method object does not simply return the object itself, as with simple
data objects; rather, its code is executed and the resulting value is returned.</p>
</div>
<div class="section" id="code">
<span id="pp-langref-code"></span><h4>3.1.5. Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h4>
<p><em>Code</em> is a sequence of <em>expressions</em> (<a class="reference internal" href="#pp-langref-expressions"><span class="std std-ref">§3.3</span></a>). These expressions are evaluated in order, and the resulting
values are discarded except for that of the final expression, whose value determines the result
of evaluating the code.</p>
<p>The actual arguments in a message send are evaluated from left to right before the message is sent.
For instance, in the expression:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="n">to</span><span class="p">:</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">i</span> <span class="n">By</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="n">Do</span><span class="p">:</span> <span class="p">[</span><span class="o">|</span> <span class="p">:</span><span class="n">k</span> <span class="o">|</span> <span class="n">k</span> <span class="nb">print</span> <span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">1</span></code> is evaluated first, then <code class="docutils literal"><span class="pre">5</span> <span class="pre">*</span> <span class="pre">i</span></code>, then <code class="docutils literal"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">j</span></code>, and then <code class="docutils literal"><span class="pre">[|</span> <span class="pre">:k</span> <span class="pre">|</span> <span class="pre">k</span> <span class="pre">print]</span></code>. Finally, the <code class="docutils literal"><span class="pre">to:By:Do:</span></code>
message is sent. The associativity and precedence of messages is discussed in section <a class="reference internal" href="#langref-expressions"><span class="std std-ref">3.3</span></a>.</p>
</div>
<div class="section" id="methods">
<span id="pp-methods"></span><span id="index-19"></span><h4>3.1.6. Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h4>
<p><em>Ordinary methods</em> (or simply “methods”) are methods that are not embedded in other code. A
method can have <em>argument slots</em> (<a class="reference internal" href="#pp-argument-slots"><span class="std std-ref">§3.2.3</span></a>) and/or local slots. An ordinary method always has an implicit
<em>parent</em> (<a class="reference internal" href="#pp-parent-slots"><span class="std std-ref">§3.2.4</span></a>) argument slot named <code class="docutils literal"><span class="pre">self</span></code>. Ordinary methods are Self’s equivalent of
Smalltalk’s methods.</p>
<p>If a slot contains a method, the following steps are performed when the slot is evaluated as the result
of a message send:</p>
<blockquote>
<div><ul class="simple">
<li>The method object is <em>cloned</em>, creating a new <em>method activation object</em> containing slots for the method’s arguments and locals.</li>
<li>The clone’s self parent slot is initialized to the receiver of the message.</li>
<li>The clone’s argument slots, if any, are initialized to the values of the corresponding actual arguments.</li>
<li>The code of the method is executed in the context of this new activation object.</li>
</ul>
</div></blockquote>
<p>For example, consider the method <code class="docutils literal"><span class="pre">(|</span> <span class="pre">:arg</span> <span class="pre">|</span> <span class="pre">arg</span> <span class="pre">*</span> <span class="pre">arg</span> <span class="pre">)</span></code>:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Chapter_2_Image_2.png"><img alt="_images/Chapter_2_Image_2.png" src="_images/Chapter_2_Image_2.png" style="width: 392.8px; height: 138.4px;" /></a>
</div>
<p>This method has an argument slot <code class="docutils literal"><span class="pre">arg</span></code> and returns the square of its argument.</p>
<span class="target" id="index-20"></span><span class="target" id="index-21"></span><span class="target" id="index-22"></span><span class="target" id="index-23"></span><span class="target" id="index-24"></span><span class="target" id="index-25"></span></div>
<div class="section" id="blocks">
<span id="pp-langref-blocks"></span><span id="index-26"></span><h4>3.1.7. Blocks<a class="headerlink" href="#blocks" title="Permalink to this headline">¶</a></h4>
<p><em>Blocks</em> are Self closures; they are used to implement user-defined control structures. A block literal
(delimited by square brackets) defines two objects: the <em>block method object</em>, containing the
block’s code, and an enclosing <em>block data object</em>. The block data object contains a parent pointer
(pointing to the object containing the shared behavior for block objects) and a slot containing the
block method object. Unlike an ordinary method object, the block method object does not contain
a self slot. Instead, it has an anonymous parent slot that is initialized to point to the activation object
for the lexically enclosing block or method. As a result, <em>implicit-receiver messages</em> (<a class="reference internal" href="#pp-implicit-receiver"><span class="std std-ref">§3.3.4</span></a>)
sent within a block method are lexically scoped. The block method object’s anonymous parent slot
is invisible at the Self level and cannot be accessed explicitly.</p>
<p>For example, the block <code class="docutils literal"><span class="pre">[</span> <span class="pre">3</span> <span class="pre">+</span> <span class="pre">4</span> <span class="pre">]</span></code> looks like <a class="footnote-reference" href="#f3" id="id3"><sup>3</sup></a>:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Chapter_2_Image_3.png"><img alt="_images/Chapter_2_Image_3.png" src="_images/Chapter_2_Image_3.png" style="width: 563.2px; height: 256.0px;" /></a>
</div>
<p>The block method’s selector is based on the number of arguments. If the block takes no arguments,
the selector is <code class="docutils literal"><span class="pre">value</span></code>. If it takes one argument, the selector is <code class="docutils literal"><span class="pre">value:</span></code>. If it takes two arguments,
the selector is <code class="docutils literal"><span class="pre">value:With:</span></code>, for three the selector is <code class="docutils literal"><span class="pre">value:With:With:</span></code>, and for more the selector
is just extended by enough <code class="docutils literal"><span class="pre">With:’s</span></code> to match the number of block arguments.</p>
<p>Block evaluation has two phases. In the first phase, a block object is created because the block is
evaluated (e.g., it is used as an argument to a message send). The block is cloned and given a
pointer to the activation record for its lexically enclosing scope, the current activation record. In the
second phase, the block’s method is evaluated as a result of sending the block the appropriate variant
of the <code class="docutils literal"><span class="pre">value</span></code> message. The block method is then cloned, the argument slots of the clone are
filled in, the anonymous parent slot of the clone is initialized using the scope pointer determined in
phase one, and, finally, the block’s code is executed.</p>
<p>It is an error to evaluate a block method after the activation record for its lexically enclosing scope
has returned. Such a block is called a <em>non-lifo</em> block because returning from it would violate the
last-in, first-out semantics of activation object invocation.</p>
<p>This restriction is made primarily to allow activation records to be allocated from a stack. A future
release of Self may relax this restriction, at least for blocks that do not access variables in
enclosing scopes.</p>
</div>
<div class="section" id="returns">
<span id="pp-langref-returns"></span><span id="index-27"></span><h4>3.1.8. Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h4>
<p>A <em>return</em> is denoted by preceding an expression by the ‘<code class="docutils literal"><span class="pre">^</span></code>’ operator. A return causes the value of the given expression to be returned as the result of evaluating the method or block. Only the last ex­pression in an object may be a return.</p>
<p>The presence or absence of the ‘<code class="docutils literal"><span class="pre">^</span></code>’ operator does not effect the behavior of ordinary methods, since an ordinary method always returns the value of its final expression anyway. In a block, however, a return causes control to be returned from the ordinary method containing that block, immediately terminating that method’s activation, the block’s activation, and all activations in between. Such a return is called a <em>non-local return</em>, since it may “return through” a number of activations. The result of the ordinary method’s evaluation is the value returned by the <em>non-local return</em>. For example, in the following method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>assertPositive: x = (
                x &gt; 0 ifTrue: [ ^ ’ok’ ].
                error: ’non-positive x’ )
</pre></div>
</div>
<p>the <code class="docutils literal"><span class="pre">error:</span></code> message will not be sent if <code class="docutils literal"><span class="pre">x</span></code> is positive because the non-local return of <code class="docutils literal"><span class="pre">’ok’</span></code> causes the <code class="docutils literal"><span class="pre">assertPositive:</span></code> method to return immediately.</p>
</div>
<div class="section" id="construction-of-object-literals">
<span id="index-28"></span><h4>3.1.9. Construction of object literals<a class="headerlink" href="#construction-of-object-literals" title="Permalink to this headline">¶</a></h4>
<p>Object literals are constructed during parsing — the parser converts objects in textual form into real Self objects.
An object literal is constructed as follows:</p>
<blockquote>
<div><ul class="simple">
<li>First, the slot initializers of every slot are evaluated from left to right. If a slot initializer contains
another object literal, this literal is constructed before the initializer containing it is evaluated.
If the initializer is an expression, it is evaluated in the context of the lobby.</li>
<li>Second, the object is created, and its slots are initialized with the results of the evaluations performed
in the first step.</li>
</ul>
</div></blockquote>
<p>Slot initializers are <em>not</em> evaluated in the lexical context, since none exists at parse time; they are evaluated
in the context of an object known as the <code class="docutils literal"><span class="pre">lobby</span></code>. That is, the initializers are evaluated as if they were the code
of a method in a slot of the <code class="docutils literal"><span class="pre">lobby</span></code>. This two-phase object construction pro­cess implies that slot initializers may
not refer to any other slots within the constructed object (as with Scheme’s <code class="docutils literal"><span class="pre">let*</span></code> and <code class="docutils literal"><span class="pre">letrec</span></code> forms) and, more generally,
that a slot initializer may not refer to any textually enclosing object literal.</p>
<span class="target" id="index-29"></span><span class="target" id="index-30"></span><span class="target" id="index-31"></span><span class="target" id="index-32"></span></div>
</div>
<div class="section" id="slot-descriptors">
<span id="pp-langref-slot-descriptors"></span><span id="index-33"></span><h3>3.2. Slot descriptors<a class="headerlink" href="#slot-descriptors" title="Permalink to this headline">¶</a></h3>
<p>An object can have any number of slots. Slots can contain data (<em>data slots</em>) or methods. Some slots have special roles: <em>argument slots</em> are filled in with the actual arguments during a message (<a class="reference internal" href="#pp-mesage-send"><span class="std std-ref">§3.3.7</span></a>), and <em>parent slots</em> specify inheritance relationships (<a class="reference internal" href="#pp-lookup-algorithm"><span class="std std-ref">§3.3.8</span></a>).</p>
<p>A <em>slot descriptor</em> consists of an optional privacy specification, followed by the slot name and an optional initializer.</p>
<div class="section" id="read-only-slots">
<h4>3.2.1. Read-only slots<a class="headerlink" href="#read-only-slots" title="Permalink to this headline">¶</a></h4>
<p>A slot name followed by an equals sign (‘<code class="docutils literal"><span class="pre">=</span></code>’) and an expression represents a <em>read-only slot</em> initialized to the result of evaluating the expression in the root context.</p>
<p>For example, a constant point might be defined as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="o">|</span>   <span class="n">parent</span><span class="o">*</span> <span class="o">=</span> <span class="n">traits</span> <span class="n">point</span><span class="o">.</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mf">4.</span>
      <span class="n">y</span> <span class="o">=</span> <span class="mf">5.</span>
<span class="o">|</span> <span class="p">)</span>
</pre></div>
</div>
<p>The resulting point contains three initialized read-only slots:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Chapter_2_Image_4.png"><img alt="_images/Chapter_2_Image_4.png" src="_images/Chapter_2_Image_4.png" style="width: 320.8px; height: 173.6px;" /></a>
</div>
<span class="target" id="index-34"></span><span class="target" id="index-35"></span><span class="target" id="index-36"></span></div>
<div class="section" id="read-write-slots">
<span id="pp-read-write-slots"></span><span id="index-37"></span><h4>3.2.2. Read/write slots<a class="headerlink" href="#read-write-slots" title="Permalink to this headline">¶</a></h4>
<p>There is no separate assignment operation in Self. Instead, assignments to data slots are message sends that invoke the assignment primitive. For example, a data slot <code class="docutils literal"><span class="pre">x</span></code> is assignable if and only if there is a slot in the same object with the same name appended with a colon (in this case, <code class="docutils literal"><span class="pre">x:</span></code>), containing the assignment primitive. Therefore, assigning <code class="docutils literal"><span class="pre">17</span></code> to slot <code class="docutils literal"><span class="pre">x</span></code> consists of sending the message <code class="docutils literal"><span class="pre">x:</span> <span class="pre">17</span></code>. Since this is indistinguishable from a message send that invokes a method, clients do not need to know if <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">x:</span></code> comprise data slot accesses or method invocations.</p>
<p>An identifier followed by a left arrow (the characters ‘<code class="docutils literal"><span class="pre">&lt;</span></code>’ and ‘<code class="docutils literal"><span class="pre">-</span></code>’ concatenated to form ‘<code class="docutils literal"><span class="pre">&lt;-</span></code>’) and an expression represents an initialized <em>read/write variable</em> (assignable data slot). The object will contain both a data slot of that name and a corresponding assignment slot whose name is obtained by appending a colon to the data slot name. The initializing expression is evaluated in the root context and the result stored into the data slot at parse time.</p>
<p>For example, an initialized mutable point might be defined as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="o">|</span>   <span class="n">parent</span><span class="o">*</span> <span class="o">=</span> <span class="n">traits</span> <span class="n">point</span><span class="o">.</span>
      <span class="n">x</span> <span class="o">&lt;-</span> <span class="mi">3</span> <span class="o">+</span> <span class="mf">4.</span>
      <span class="n">y</span> <span class="o">&lt;-</span> <span class="mf">5.</span>
<span class="o">|</span> <span class="p">)</span>
</pre></div>
</div>
<p>producing an object with two data slots (<code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code>) and two assignment slots (<code class="docutils literal"><span class="pre">x:</span></code> and <code class="docutils literal"><span class="pre">y:</span></code>) containing the assignment primitive (depicted with <code class="docutils literal"><span class="pre">←</span></code>) <a class="footnote-reference" href="#f4" id="id4"><sup>4</sup></a>:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Chapter_2_Image_5.png"><img alt="_images/Chapter_2_Image_5.png" src="_images/Chapter_2_Image_5.png" style="width: 342.4px; height: 235.2px;" /></a>
</div>
<p>An identifier by itself specifies an assignable data slot initialized to <em>nil</em> <a class="footnote-reference" href="#f5" id="id5"><sup>5</sup></a>. Thus, the slot declaration <code class="docutils literal"><span class="pre">x</span></code> is a shorthand notation for <code class="docutils literal"><span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">nil</span></code>.</p>
<p>For example, a simple mutable point might be defined as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="o">|</span> <span class="n">x</span><span class="o">.</span> <span class="n">y</span><span class="o">.</span> <span class="o">|</span> <span class="p">)</span>
</pre></div>
</div>
<p>producing:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Chapter_2_Image_6.png"><img alt="_images/Chapter_2_Image_6.png" src="_images/Chapter_2_Image_6.png" style="width: 399.2px; height: 158.4px;" /></a>
</div>
<span class="target" id="index-38"></span></div>
<div class="section" id="slots-containing-methods">
<span id="pp-argument-slots"></span><span id="index-39"></span><h4>3.2.3. Slots containing methods<a class="headerlink" href="#slots-containing-methods" title="Permalink to this headline">¶</a></h4>
<p>If the initializing expression is an object literal with code, that object is stored into the slot <em>without evaluating the code</em>. This allows a slot to be initialized to a method by storing the method itself, rather than its result, in the slot <a class="footnote-reference" href="#f6" id="id6"><sup>6</sup></a>. Methods may only be stored in read-only slots. A method automatically receives a parent argument slot named <code class="docutils literal"><span class="pre">self</span></code>. For example, a point addition method can be written as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="o">|</span>
      <span class="o">+</span> <span class="o">=</span> <span class="p">(</span> <span class="o">|</span> <span class="p">:</span><span class="n">arg</span> <span class="o">|</span> <span class="p">(</span><span class="n">clone</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">arg</span> <span class="n">x</span><span class="p">)</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">arg</span> <span class="n">y</span> <span class="p">)</span><span class="o">.</span>
<span class="o">|</span> <span class="p">)</span>
</pre></div>
</div>
<p>producing:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Chapter_2_Image_7.png"><img alt="_images/Chapter_2_Image_7.png" src="_images/Chapter_2_Image_7.png" style="width: 522.4px; height: 154.4px;" /></a>
</div>
<p>A slot name beginning with a colon indicates an <em>argument</em> slot. The prefixed colon is not part of the slot name and is ignored when matching the name against a message. Argument slots are always read-only, and no initializer may be specified for them. As a syntactic convenience, the argument name may also be written immediately after the slot name (without the prefixed colon), thereby implicitly declaring the argument slot. Thus, the following yields exactly the same object as above:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="o">|</span>
      <span class="o">+</span> <span class="n">arg</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">clone</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">arg</span> <span class="n">x</span><span class="p">)</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="n">arg</span> <span class="n">y</span> <span class="p">)</span><span class="o">.</span>
<span class="o">|</span> <span class="p">)</span>
</pre></div>
</div>
<p>The + slot above is a <em>binary slot</em> (<a class="reference internal" href="#pp-binary-messages"><span class="std std-ref">§3.3.2</span></a>), taking one argument and having a name that consists of operator symbols. Slots like x or y in a point object are <em>unary slots</em> (<a class="reference internal" href="#pp-unary-messages"><span class="std std-ref">§3.3.1</span></a>), which take no arguments and have simple identifiers for names. In addition, there are <em>keyword slots</em> (<a class="reference internal" href="#pp-keyword-messages"><span class="std std-ref">§3.3.3</span></a>), which handle messages that require one or more arguments. A keyword slot name is a sequence of identifiers, each followed by a colon.</p>
<p>The arguments in keyword methods are handled analogously to those in binary methods: each colon-terminated identifier in a keyword slot name requires a corresponding argument slot in the keyword method object, and the argument slots may be specified either all in the method or all interspersed with the selector parts.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="o">|</span>
      <span class="n">ifTrue</span><span class="p">:</span> <span class="kc">False</span><span class="p">:</span> <span class="o">=</span> <span class="p">(</span> <span class="o">|</span> <span class="p">:</span><span class="n">trueBlock</span><span class="o">.</span> <span class="p">:</span><span class="n">falseBlock</span> <span class="o">|</span>
              <span class="n">trueBlock</span> <span class="n">value</span> <span class="p">)</span><span class="o">.</span>
<span class="o">|</span> <span class="p">)</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="o">|</span>
      <span class="n">ifTrue</span><span class="p">:</span> <span class="n">trueBlock</span> <span class="kc">False</span><span class="p">:</span> <span class="n">falseBlock</span> <span class="o">=</span>
              <span class="p">(</span> <span class="n">trueBlock</span> <span class="n">value</span> <span class="p">)</span><span class="o">.</span>
<span class="o">|</span> <span class="p">)</span>
</pre></div>
</div>
<p>produce identical objects.</p>
</div>
<div class="section" id="parent-slots">
<span id="pp-parent-slots"></span><span id="index-40"></span><h4>3.2.4. Parent slots<a class="headerlink" href="#parent-slots" title="Permalink to this headline">¶</a></h4>
<p>A unary slot name followed by an asterisk denotes a <em>parent slot</em>. The trailing asterisk is not part of the slot name and is ignored when matching the name against a message. Except for their special meaning during the message lookup process (<a class="reference internal" href="#pp-lookup-algorithm"><span class="std std-ref">§3.3.8</span></a>), parent slots are exactly like normal unary slots; in particular, they may be assignable, allowing <em>dynamic inheritance</em>. Argument slots cannot be parent slots.</p>
<span class="target" id="index-41"></span></div>
<div class="section" id="annotations">
<span id="index-42"></span><h4>3.2.5. Annotations<a class="headerlink" href="#annotations" title="Permalink to this headline">¶</a></h4>
<p>In order to provide extra information for the programming environment, Self supports annotations on either whole objects or individual slots. Although any object can be an annotation, the Self syntax only supports the textual definition of string annotations. In order to annotate an object, use this syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>( | {} = ’this object has one slot’ snort = 17. | ) }
</pre></div>
</div>
<p>In order to annotate a group of slots, surround them with braces and insert the annotation after the opening brace:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>( |
      { ’Category: accessing’
            getOne = (...).
            getAnother = (...).
      }
      anUnannotatedSlot.
| )
</pre></div>
</div>
<p>Annotations may nest; if so the Virtual Machine concatenates the annotations strings and inserts a separator character (16r7f) <a class="footnote-reference" href="#f7" id="id7"><sup>7</sup></a>.</p>
</div>
</div>
<div class="section" id="expressions">
<span id="pp-langref-expressions"></span><span id="langref-expressions"></span><h3>3.3. Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h3>
<p><em>Expressions</em> in Self are <em>messages</em> sent to some object, the <em>receiver</em>. Self message syntax is similar to Smalltalk’s. Self provides three basic kinds of messages: unary messages, binary messages, and keyword messages. Each has its own syntax, associativity, and precedence. Each type of message can be sent either to an explicit or implicit receiver.</p>
<p>Productions <a class="footnote-reference" href="#f8" id="id8"><sup>8</sup></a>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="1%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>expression</td>
<td>→</td>
<td>constant | unary-message | binary-message | keyword-message | ‘(’ expression ‘)’</td>
</tr>
<tr class="row-even"><td>constant</td>
<td>→</td>
<td>self | number | string | object</td>
</tr>
<tr class="row-odd"><td>unary-message</td>
<td>→</td>
<td>receiver unary-send | resend ‘.’ unary-send</td>
</tr>
<tr class="row-even"><td>unary-send</td>
<td>→</td>
<td>identifier</td>
</tr>
<tr class="row-odd"><td>binary-message</td>
<td>→</td>
<td>receiver binary-send | resend ‘.’ binary-send</td>
</tr>
<tr class="row-even"><td>binary-send</td>
<td>→</td>
<td>operator expression</td>
</tr>
<tr class="row-odd"><td>keyword-message</td>
<td>→</td>
<td>receiver keyword-send | resend ‘.’ keyword-send</td>
</tr>
<tr class="row-even"><td>keyword-send</td>
<td>→</td>
<td>small-keyword expression { cap-keyword expression }</td>
</tr>
<tr class="row-odd"><td>receiver</td>
<td>→</td>
<td>[ expression ]</td>
</tr>
<tr class="row-even"><td>resend</td>
<td>→</td>
<td>resend | identifier</td>
</tr>
</tbody>
</table>
<p>The table below summarizes Self’s message syntax rules:</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="9%" />
<col width="9%" />
<col width="24%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">MESSAGE</th>
<th class="head">ARGUMENTS</th>
<th class="head">PRECEDENCE</th>
<th class="head">ASSOCIATIVITY</th>
<th class="head">SYNTAX</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Unary</td>
<td>0</td>
<td>highest</td>
<td>none</td>
<td>[receiver] identifier</td>
</tr>
<tr class="row-odd"><td>Binary</td>
<td>1</td>
<td>medium</td>
<td>none or left-to-right <a class="footnote-reference" href="#f14" id="id9"><sup>14</sup></a></td>
<td>[receiver] operator expression</td>
</tr>
<tr class="row-even"><td>Keyword</td>
<td>&gt;= 1</td>
<td>lowest</td>
<td>right-to-left</td>
<td>[receiver] small-keyword expression { cap-keyword expression }</td>
</tr>
</tbody>
</table>
<p>Parentheses can be used to explicitly specify order of evaluation.</p>
<span class="target" id="index-43"></span><div class="section" id="unary-messages">
<span id="pp-unary-messages"></span><span id="index-44"></span><h4>3.3.1. Unary messages<a class="headerlink" href="#unary-messages" title="Permalink to this headline">¶</a></h4>
<p>A <em>unary message</em> does not specify any arguments. It is written as an identifier following the receiver.</p>
<p>Examples of unary messages sent to explicit receivers:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">17</span> <span class="nb">print</span>
<span class="mi">5</span> <span class="n">factorial</span>
</pre></div>
</div>
<p><em>Associativity</em>. Unary messages compose from left to right. An expression to print 5 factorial, for example, is written:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">5</span> <span class="n">factorial</span> <span class="nb">print</span>
</pre></div>
</div>
<p>and interpreted as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">5</span> <span class="n">factorial</span><span class="p">)</span> <span class="nb">print</span>
</pre></div>
</div>
<p><em>Precedence</em>. Unary messages have higher precedence than binary messages and keyword messages.</p>
<span class="target" id="index-45"></span><span class="target" id="index-46"></span></div>
<div class="section" id="binary-messages">
<span id="pp-binary-messages"></span><span id="index-47"></span><h4>3.3.2. Binary messages<a class="headerlink" href="#binary-messages" title="Permalink to this headline">¶</a></h4>
<p>A <em>binary message</em> has a receiver and a single argument, separated by a binary operator. Examples of binary messages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span>
<span class="mi">7</span> <span class="o">&lt;-&gt;</span> <span class="mi">8</span>
</pre></div>
</div>
<p><em>Associativity</em>. Binary messages have no associativity, except between identical operators (which associate from left to right). For example,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">7</span>
</pre></div>
</div>
<p>is interpreted as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">7</span>
</pre></div>
</div>
<p>But</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">7</span>
</pre></div>
</div>
<p>is illegal: the associativity must be made explicit by writing either</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span> <span class="ow">or</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p><em>Precedence</em>. The precedence of binary messages is lower than unary messages but higher than keyword messages. All binary messages have the same precedence. For example,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="n">factorial</span> <span class="o">+</span> <span class="n">pi</span> <span class="n">sine</span>
</pre></div>
</div>
<p>is interpreted as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span> <span class="n">factorial</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">pi</span> <span class="n">sine</span><span class="p">)</span>
</pre></div>
</div>
<span class="target" id="index-48"></span><span class="target" id="index-49"></span></div>
<div class="section" id="keyword-messages">
<span id="pp-keyword-messages"></span><span id="index-50"></span><h4>3.3.3. Keyword messages<a class="headerlink" href="#keyword-messages" title="Permalink to this headline">¶</a></h4>
<p>A <em>keyword message</em> has a receiver and one or more arguments. It is written as a receiver followed by a sequence of one or more keyword-argument pairs. The first keyword must begin with a lower case letter or underscore (‘<code class="docutils literal"><span class="pre">_</span></code>’); subsequent keywords must be capitalized. An initial underscore denotes that the operation is a <em>primitive</em>. A keyword message consists of the longest possible sequence of such keyword-argument pairs; the message selector is the concatenation of the keywords forming the message. Message selectors beginning with an underscore are reserved for <em>primitives</em> (<a class="reference internal" href="index.html#pp-primitives"><span class="std std-ref">10.8</span></a>).</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">5</span> <span class="nb">min</span><span class="p">:</span> <span class="mi">4</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">7</span>
</pre></div>
</div>
<p>is the single message <code class="docutils literal"><span class="pre">min:Max:</span></code> sent to <code class="docutils literal"><span class="pre">5</span></code> with arguments <code class="docutils literal"><span class="pre">4</span></code> and <code class="docutils literal"><span class="pre">7</span></code>, whereas</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">5</span> <span class="nb">min</span><span class="p">:</span> <span class="mi">4</span> <span class="nb">max</span><span class="p">:</span> <span class="mi">7</span>
</pre></div>
</div>
<p>involves two messages: first the message <code class="docutils literal"><span class="pre">max:</span></code> sent to <code class="docutils literal"><span class="pre">4</span></code> and taking <code class="docutils literal"><span class="pre">7</span></code> as its argument, and then the message <code class="docutils literal"><span class="pre">min:</span></code> sent to <code class="docutils literal"><span class="pre">5</span></code>, taking the result of (<code class="docutils literal"><span class="pre">4</span> <span class="pre">max:</span> <span class="pre">7</span></code>) as its argument.</p>
<p><em>Associativity</em>. Keyword messages associate from right to left, so</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">5</span> <span class="nb">min</span><span class="p">:</span> <span class="mi">6</span> <span class="nb">min</span><span class="p">:</span> <span class="mi">7</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">8</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">9</span> <span class="nb">min</span><span class="p">:</span> <span class="mi">10</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">11</span>
</pre></div>
</div>
<p>is interpreted as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">5</span> <span class="nb">min</span><span class="p">:</span> <span class="p">(</span><span class="mi">6</span> <span class="nb">min</span><span class="p">:</span> <span class="mi">7</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">8</span> <span class="n">Max</span><span class="p">:</span> <span class="p">(</span><span class="mi">9</span> <span class="nb">min</span><span class="p">:</span> <span class="mi">10</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">11</span><span class="p">))</span>
</pre></div>
</div>
<p>The association order and capitalization requirements are intended to reduce the number of parentheses necessary in Self code. For example, taking the minimum of two slots <code class="docutils literal"><span class="pre">m</span></code> and <code class="docutils literal"><span class="pre">n</span></code> and storing the result into a data slot i may be written as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">i</span><span class="p">:</span> <span class="n">m</span> <span class="nb">min</span><span class="p">:</span> <span class="n">n</span>
</pre></div>
</div>
<p><em>Precedence</em>. Keyword messages have the lowest precedence. For example,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">i</span><span class="p">:</span> <span class="mi">5</span> <span class="n">factorial</span> <span class="o">+</span> <span class="n">pi</span> <span class="n">sine</span>
</pre></div>
</div>
<p>is interpreted as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">i</span><span class="p">:</span> <span class="p">((</span><span class="mi">5</span> <span class="n">factorial</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">pi</span> <span class="n">sine</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="implicit-receiver-messages">
<span id="pp-implicit-receiver"></span><span id="index-51"></span><h4>3.3.4. Implicit-receiver messages<a class="headerlink" href="#implicit-receiver-messages" title="Permalink to this headline">¶</a></h4>
<p>Unary, binary, and keyword messages are frequently written without an explicit receiver. Such messages use the current receiver (<code class="docutils literal"><span class="pre">self</span></code>) as the implied receiver. The method lookup, however, begins at the current activation object rather than the current receiver (see <a class="reference internal" href="#pp-methods"><span class="std std-ref">§3.1.6</span></a> for details on activation objects). Thus, a message sent explicitly to <code class="docutils literal"><span class="pre">self</span></code> is <em>not</em> equivalent to an implicit-receiver send because the former won’t search local slots before searching the receiver. Explicitly sending messages to <code class="docutils literal"><span class="pre">self</span></code> is considered bad style.</p>
<p>Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">factorial</span>        <span class="p">(</span><span class="n">implicit</span><span class="o">-</span><span class="n">receiver</span> <span class="n">unary</span> <span class="n">message</span><span class="p">)</span>
<span class="o">+</span> <span class="mi">3</span>              <span class="p">(</span><span class="n">implicit</span><span class="o">-</span><span class="n">receiver</span> <span class="n">binary</span> <span class="n">message</span><span class="p">)</span>
<span class="nb">max</span><span class="p">:</span> <span class="mi">5</span>           <span class="p">(</span><span class="n">implicit</span><span class="o">-</span><span class="n">receiver</span> <span class="n">keyword</span> <span class="n">message</span><span class="p">)</span>
<span class="mi">1</span> <span class="o">+</span> <span class="n">power</span><span class="p">:</span> <span class="mi">3</span>     <span class="p">(</span><span class="n">parsed</span> <span class="k">as</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">power</span><span class="p">:</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>Accesses to slots of the receiver (local or inherited) are also achieved by implicit message sends to <code class="docutils literal"><span class="pre">self</span></code>. For an assignable data slot named <code class="docutils literal"><span class="pre">t</span></code>, the message <code class="docutils literal"><span class="pre">t</span></code> returns the contents, and <code class="docutils literal"><span class="pre">t:</span> <span class="pre">17</span></code> puts <code class="docutils literal"><span class="pre">17</span></code> into the slot.</p>
<span class="target" id="index-52"></span></div>
<div class="section" id="resending-messages">
<span id="index-53"></span><h4>3.3.5. Resending messages<a class="headerlink" href="#resending-messages" title="Permalink to this headline">¶</a></h4>
<p>A <em>resend</em> allows an overridding method to invoke the overridden method. Directed resends allow ambiguities among overridden methods to be resolved by constraining the lookup to search a single parent slot. Both resends and directed resends may change the name of the message being sent from the name of the current method, and may pass different arguments than the arguments passed to the current method. The receiver of a resend or a directed resend must be the implicit receiver.</p>
<p>Intuitively, resend is similar to Smalltalk’s <code class="docutils literal"><span class="pre">super</span></code> send and CLOS’ <code class="docutils literal"><span class="pre">call-next-method</span></code>.</p>
<p>A resend is written as an implicit-receiver message with the reserved word <code class="docutils literal"><span class="pre">resend</span></code>, a period, and the message name. No whitespace may separate <code class="docutils literal"><span class="pre">resend</span></code>, the period, and the message name.</p>
<p>Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">resend</span><span class="o">.</span><span class="n">display</span>
<span class="n">resend</span><span class="o">.+</span> <span class="mi">5</span>
<span class="n">resend</span><span class="o">.</span><span class="n">min</span><span class="p">:</span> <span class="mi">17</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">23</span>
</pre></div>
</div>
<p>A <em>directed resend</em> constrains the resend through a specified parent. It is written similar to a normal resend, but replaces <code class="docutils literal"><span class="pre">resend</span></code> with the name of the parent slot through which the resend is directed.</p>
<p>Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">listParent</span><span class="o">.</span><span class="n">height</span>
<span class="n">intParent</span><span class="o">.</span><span class="n">min</span><span class="p">:</span> <span class="mi">17</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">23</span>
</pre></div>
</div>
<p>Only implicit-receiver messages may be delegated via a resend or a directed resend <a class="footnote-reference" href="#f9" id="id10"><sup>9</sup></a>.</p>
</div>
<div class="section" id="message-lookup-semantics">
<span id="pp-langref-message-lookup"></span><span id="index-54"></span><h4>3.3.6. Message lookup semantics<a class="headerlink" href="#message-lookup-semantics" title="Permalink to this headline">¶</a></h4>
<p>This section describes the semantics of message lookups in Self. In addition to an informal textual description, the lookup semantics are presented in pseudo-code using the following notation:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>s.name</td>
<td>The name of slot s.</td>
</tr>
<tr class="row-even"><td>s.contents</td>
<td>The object contained in slot s.</td>
</tr>
<tr class="row-odd"><td>s.isParent</td>
<td>True iff s is a parent slot.</td>
</tr>
<tr class="row-even"><td>{s ε obj | pred(s)}</td>
<td>The set of all slots of object obj that satisfy predicate pred.</td>
</tr>
<tr class="row-odd"><td>| S |</td>
<td>The cardinality of set S.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The message sending semantics are decomposed into the following functions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>send(rec, sel, args)</td>
<td>The message send function (<a class="reference internal" href="#pp-mesage-send"><span class="std std-ref">§3.3.7</span></a>).</td>
</tr>
<tr class="row-even"><td>lookup(obj, rec, sel, V)</td>
<td>The lookup algorithm (<a class="reference internal" href="#pp-lookup-algorithm"><span class="std std-ref">§3.3.8</span></a>).</td>
</tr>
<tr class="row-odd"><td>undirected_resend(...)</td>
<td>The undirected message resend function (<a class="reference internal" href="#pp-undirected-resend"><span class="std std-ref">§3.3.9</span></a>).</td>
</tr>
<tr class="row-even"><td>directed_resend(...)</td>
<td>The directed message resend function (<a class="reference internal" href="#pp-directed-resend"><span class="std std-ref">§3.3.10</span></a>).</td>
</tr>
<tr class="row-odd"><td>eval(rec, M, args)</td>
<td>The slot evaluation function as described informally throughout <a class="reference internal" href="#pp-langref-code"><span class="std std-ref">§3.1.5</span></a>.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="message-send">
<span id="pp-mesage-send"></span><h4>3.3.7. Message send<a class="headerlink" href="#message-send" title="Permalink to this headline">¶</a></h4>
<p>There are two kinds of message sends: a <em>primitive send</em> has a selector beginning with an underscore (‘<code class="docutils literal"><span class="pre">_</span></code>’) and calls the corresponding primitive operation. Primitives are predefined functions provided by the implementation. A <em>normal send</em> does a lookup to obtain the target slot; if the lookup was successful, the slot is subsequently evaluated. If the slot contains a data object, then the data object is simply returned. If the slot contains the assignment primitive, the argument of the message is stored in the corresponding data slot. Finally, if the slot contains a method, an activation is created and run as described in <a class="reference internal" href="#pp-methods"><span class="std std-ref">§3.1.6</span></a>.</p>
<p>If the lookup fails, the lookup error is handled in an implementation-defined manner; typically, a message indicating the type of error is sent to the object which could not handle the message.</p>
<p>The function <em>send(rec, sel, args)</em> is defined as follows:</p>
<dl class="docutils">
<dt><strong>Input</strong>:</dt>
<dd><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">rec</span></code>, the receiver of the message</div>
<div class="line"><code class="docutils literal"><span class="pre">sel</span></code>, the message selector</div>
<div class="line"><code class="docutils literal"><span class="pre">args</span></code>, the actual arguments</div>
</div>
</dd>
<dt><strong>Output</strong>:</dt>
<dd><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">res</span></code>, the result object</div>
</div>
</dd>
</dl>
<p><strong>Algorithm</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>if begins_with_underscore(sel)
then invoke_primitive(rec, sel, args)               “primitive call”
else M ← lookup(rec, sel, Ø)                        “do the lookup”
    case
        | M | = 0: error: message not understood
        | M | = 1: res ← eval(rec, M, args)         “see §2.1”
        | M | &gt; 1: error: ambiguous message send
    end
end
return res
</pre></div>
</div>
</div>
<div class="section" id="the-lookup-algorithm">
<span id="pp-lookup-algorithm"></span><span id="index-55"></span><h4>3.3.8. The lookup algorithm<a class="headerlink" href="#the-lookup-algorithm" title="Permalink to this headline">¶</a></h4>
<p>The lookup algorithm recursively traverses the inheritance graph, which can be an arbitrary graph (including cyclic graphs). No object is searched twice along any single path. The search begins in the object itself and then continues to search every parent. Parent slots are not evaluated during the lookup. That is, if a parent slot contains an object with code, the code will not be executed; the object will merely be searched for matching slots.</p>
<p>The function <em>lookup(obj, sel, V)</em> is defined as follows:</p>
<dl class="docutils">
<dt><strong>Input</strong>:</dt>
<dd><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">obj</span></code>, the object being searched for matching slots</div>
<div class="line"><code class="docutils literal"><span class="pre">sel</span></code>, the message selector</div>
<div class="line"><code class="docutils literal"><span class="pre">V</span></code>, the set of objects already visited along this path</div>
</div>
</dd>
<dt><strong>Output</strong>:</dt>
<dd><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">M</span></code>, the set of matching slots</div>
</div>
</dd>
</dl>
<p><strong>Algorithm</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>if obj ε V
then M ← Ø                                                  “cycle detection”
else M ← {s ε obj | s.name = sel}                           “try local slots”
    if M = Ø then M ← parent_lookup(obj, sel, V) end        “try parent slots”
end
return M
</pre></div>
</div>
<p>Where <em>parent_lookup(obj, sel, V)</em> is defined as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>P ← {s ε obj | s.isParent}                  “all parents”
M ← υ lookup(s.contents, sel, V υ {obj})    “recursively search parents”
   sεP
return M
</pre></div>
</div>
</div>
<div class="section" id="undirected-resend">
<span id="pp-undirected-resend"></span><h4>3.3.9. Undirected Resend<a class="headerlink" href="#undirected-resend" title="Permalink to this headline">¶</a></h4>
<p>An undirected resend ignores the sending method holder (the object containing the currently running method) and continues with its parents.</p>
<p>The function <em>undirected_resend(rec, smh, sel, args)</em> is defined as follows:</p>
<dl class="docutils">
<dt><strong>Input</strong>:</dt>
<dd><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">rec</span></code>, the receiver of the message</div>
<div class="line"><code class="docutils literal"><span class="pre">smh</span></code>, the sending method holder</div>
<div class="line"><code class="docutils literal"><span class="pre">sel</span></code>, the message selector</div>
<div class="line"><code class="docutils literal"><span class="pre">args</span></code>, the actual arguments</div>
</div>
</dd>
<dt><strong>Output</strong>:</dt>
<dd><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">res</span></code>, the result object</div>
</div>
</dd>
</dl>
<p><strong>Algorithm</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>M ← parent_lookup(smh, sel, Ø)                    “do the lookup”
case
    | M | = 0: error: message not understood
    | M | = 1: res ← eval(rec, M, args)           “see §2.1”
    | M | &gt; 1: error: ambiguous message send
end
return res
</pre></div>
</div>
</div>
<div class="section" id="directed-resend">
<span id="pp-directed-resend"></span><h4>3.3.10. Directed Resend<a class="headerlink" href="#directed-resend" title="Permalink to this headline">¶</a></h4>
<p>A directed resend looks only in one slot in the sending method holder.</p>
<p>The function <em>directed_resend(rec, smh, del, sel, args)</em> is defined as follows:</p>
<dl class="docutils">
<dt><strong>Input</strong>:</dt>
<dd><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">rec</span></code>, the receiver of the message</div>
<div class="line"><code class="docutils literal"><span class="pre">smh</span></code>, the sending method holder</div>
<div class="line"><code class="docutils literal"><span class="pre">del</span></code>, the name of the delegatee</div>
<div class="line"><code class="docutils literal"><span class="pre">sel</span></code>, the message selector</div>
<div class="line"><code class="docutils literal"><span class="pre">args</span></code>, the actual arguments</div>
</div>
</dd>
<dt><strong>Output</strong>:</dt>
<dd><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">res</span></code>, the result object</div>
</div>
</dd>
</dl>
<p><strong>Algorithm</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>D ← {s ε smh | s.name = del}                     “find delegatee”
if | D | = 0 then error: missing delegatee       “one or none”
M ← lookup(smh.del, sel, Ø)                      “do the lookup”
case
    | M | = 0: error: message not understood
    | M | = 1: res ← eval(rec, M, args)          “see §2.1”
    | M | &gt; 1: error: ambiguous message send
end
return res
</pre></div>
</div>
</div>
</div>
<div class="section" id="lexical-elements">
<h3>3.4. Lexical elements<a class="headerlink" href="#lexical-elements" title="Permalink to this headline">¶</a></h3>
<p>This chapter describes the lexical structure of Self programs — how sequences of characters in Self source code are grouped into lexical tokens. In contrast to syntactic elements described by productions in the rest of this document, the elements of lexical EBNF productions may not be separated by whitespace, i.e. there may not be whitespace within a lexical token. Tokens are formed from the longest sequence of characters possible. Whitespace may separate any two tokens and must separate tokens that would be treated as one token otherwise.</p>
<div class="section" id="character-set">
<span id="index-56"></span><h4>3.4.1. Character set<a class="headerlink" href="#character-set" title="Permalink to this headline">¶</a></h4>
<p>Self programs are written using the following characters:</p>
<ul>
<li><p class="first"><em>Letters</em>. The fifty-two upper and lower case letters:</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz</span></code></p>
</div></blockquote>
</li>
<li><p class="first"><em>Digits</em>. The ten numeric digits:</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">0123456789</span></code></p>
</div></blockquote>
</li>
<li><p class="first"><em>Whitespace</em>. The formatting characters: space, horizontal tab (ASCII HT), newline (NL), carriage return (CR), vertical tab (VT), backspace (BS), and form feed (FF). (Comments are also treated as whitespace.)</p>
</li>
<li><p class="first"><em>Graphic characters</em>. The 32 non-alphanumeric characters:</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">!&#64;#$%^&amp;*()_-+=|\~‘{}[]:;&quot;’&lt;&gt;,.?/</span></code></p>
</div></blockquote>
</li>
</ul>
<span class="target" id="index-57"></span><span class="target" id="index-58"></span><span class="target" id="index-59"></span></div>
<div class="section" id="index-60">
<span id="identifiers"></span><h4>3.4.2. Identifiers<a class="headerlink" href="#index-60" title="Permalink to this headline">¶</a></h4>
<p>An <em>identifier</em> is a sequence of letters, digits, and underscores (‘_’) beginning with a lowercase letter or an underscore. Case is significant: <code class="docutils literal"><span class="pre">apoint</span></code> is not the same as <code class="docutils literal"><span class="pre">aPoint</span></code>.</p>
<p>Productions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="7%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>small-letter</td>
<td>→</td>
<td>‘a’ | ‘b’ | ... | ‘z’</td>
</tr>
<tr class="row-even"><td>cap-letter</td>
<td>→</td>
<td>‘A’ | ‘B’ | ... | ‘Z’</td>
</tr>
<tr class="row-odd"><td>letter</td>
<td>→</td>
<td>small-letter | cap-letter</td>
</tr>
<tr class="row-even"><td>identifier</td>
<td>→</td>
<td>(small-letter | ‘_’) {letter | digit | ‘_’}</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Examples:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">i</span> <span class="pre">_IntAdd</span> <span class="pre">cloud9</span> <span class="pre">m</span> <span class="pre">a_point</span></code></div></blockquote>
<p>The two identifiers <code class="docutils literal"><span class="pre">self</span></code> and <code class="docutils literal"><span class="pre">resend</span></code> are reserved. Identifiers beginning with underscores are reserved for primitives.</p>
</div>
<div class="section" id="keywords">
<span id="pp-keywords"></span><span id="index-61"></span><h4>3.4.3. Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h4>
<p>Keywords are used as slot names and as message names. They consist of an identifier or a capitalized identifier followed by a colon (‘:’).</p>
<p>Productions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="8%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>small-keyword</td>
<td>→</td>
<td>identifier ‘:’</td>
</tr>
<tr class="row-even"><td>cap-keyword</td>
<td>→</td>
<td>cap-letter {letter | digit | ‘_’} ‘:’</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Examples:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">at:</span> <span class="pre">Put:</span> <span class="pre">_IntAdd:</span></code></div></blockquote>
</div>
<div class="section" id="arguments">
<span id="index-62"></span><h4>3.4.4. Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h4>
<p>A colon followed by an identifier denotes an <em>argument</em> slot name.</p>
<p>Productions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="10%" />
<col width="55%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>arg-name</td>
<td>→</td>
<td>‘:’ identifier</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Example:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">:name</span></code></div>
</div>
</div></blockquote>
</div>
<div class="section" id="operators">
<span id="index-63"></span><h4>3.4.5. Operators<a class="headerlink" href="#operators" title="Permalink to this headline">¶</a></h4>
<p>An <em>operator</em> consists of a sequence of one or more of the following characters:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">!</span> <span class="pre">&#64;</span> <span class="pre">#</span> <span class="pre">$</span> <span class="pre">%</span> <span class="pre">^</span> <span class="pre">&amp;</span> <span class="pre">*</span> <span class="pre">-</span> <span class="pre">+</span> <span class="pre">=</span> <span class="pre">~</span> <span class="pre">/</span> <span class="pre">?</span> <span class="pre">&lt;</span> <span class="pre">&gt;</span> <span class="pre">,</span> <span class="pre">;</span> <span class="pre">|</span> <span class="pre">‘</span> <span class="pre">\</span></code></div>
</div>
</div></blockquote>
<p>Two sequences are reserved and are not operators:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">|</span> <span class="pre">^</span></code></div>
</div>
</div></blockquote>
<p>Productions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="2%" />
<col width="92%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>op-char</td>
<td>→</td>
<td>‘!’ | ‘&#64;’ | ‘#’ | ‘$’ | ‘%’ | ‘^’ | ‘&amp;’ | ‘*’ | ‘-’ | ‘+’ | ‘=’ | ‘~’ | ‘/’ | ‘?’ | ‘&lt;’ | ‘&gt;’ | ‘,’ | ‘;’ | ‘|’ | ‘‘’ | ‘\’</td>
</tr>
<tr class="row-even"><td>operator</td>
<td>→</td>
<td>op-char {op-char}</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Examples:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">+</span> <span class="pre">-</span> <span class="pre">&amp;&amp;</span> <span class="pre">\|\|</span> <span class="pre">&lt;-&gt;</span> <span class="pre">%</span> <span class="pre">#</span> <span class="pre">&#64;</span> <span class="pre">^</span></code></div>
</div>
</div></blockquote>
<span class="target" id="index-64"></span></div>
<div class="section" id="numbers">
<span id="index-65"></span><h4>3.4.6. Numbers<a class="headerlink" href="#numbers" title="Permalink to this headline">¶</a></h4>
<p>Integer literals are written as a sequence of digits, optionally prefixed with a minus sign and/or a
base <a class="footnote-reference" href="#f10" id="id11"><sup>10</sup></a>. No whitespace is allowed between a minus sign and the digit sequence <a class="footnote-reference" href="#f11" id="id12"><sup>11</sup></a>. Real constants may
be either written in fixed-point or exponential form.</p>
<p>Integers may be written using bases from 2 to 36. For bases greater than ten, the characters ‘<em>a</em>’
through ‘<em>z</em>’ (case insensitive) represent digit values 10 through 35. The default base is decimal. A
non-decimal number is prefixed by its base value, specified as a decimal number followed by either
‘<em>r</em>’ or ‘<em>R</em>’.</p>
<p>Real numbers may be written in decimal only. The exponent of a floating-point format number indicates
multiplication of the mantissa by 10 raised to the exponent power; i.e.,</p>
<blockquote>
<div>nnnnEddd = nnnn × 10 <sup>ddd</sup></div></blockquote>
<p>A number with a digit that is not appropriate for the base will cause a lexical error, as will an integer
constant that is too large to be represented. If the absolute value of a real constant is too large
or too small to be represented, the value of the constant will be ± infinity or zero, respectively.</p>
<p>Productions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="9%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>number</td>
<td>→</td>
<td>[ ‘-’ ] (integer | real)</td>
</tr>
<tr class="row-even"><td>integer</td>
<td>→</td>
<td>[base] general-digit {general-digit}</td>
</tr>
<tr class="row-odd"><td>real</td>
<td>→</td>
<td>fixed-point | float</td>
</tr>
<tr class="row-even"><td>fixed-point</td>
<td>→</td>
<td>decimal ‘.’ decimal</td>
</tr>
<tr class="row-odd"><td>float</td>
<td>→</td>
<td>decimal [ ‘.’ decimal ] (‘e’ | ‘E’) [ ‘+’ | ‘-’ ] decimal</td>
</tr>
<tr class="row-even"><td>general-digit</td>
<td>→</td>
<td>digit | letter</td>
</tr>
<tr class="row-odd"><td>decimal</td>
<td>→</td>
<td>digit {digit}</td>
</tr>
<tr class="row-even"><td>base</td>
<td>→</td>
<td>decimal (‘r’ | ‘R’)</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Examples:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">123</span> <span class="pre">16r27fe</span> <span class="pre">1272.34e+15</span> <span class="pre">1e10</span></code></div></blockquote>
<span class="target" id="index-66"></span><span class="target" id="index-67"></span></div>
<div class="section" id="strings">
<span id="index-68"></span><h4>3.4.7. Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h4>
<p>String constants are enclosed in single quotes (‘’’). With the exception of single quotes and escape
sequences introduced by a backslash (‘\’), all characters (including formatting characters like
newline and carriage return) lying between the delimiting single quotes are included in the string <a class="footnote-reference" href="#f12" id="id13"><sup>12</sup></a>.</p>
<p>To allow single quotes to appear in a string and to allow non-printing control characters in a string
to be indicated more visibly, Self provides C-like escape sequences:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="21%" />
<col width="10%" />
<col width="25%" />
<col width="13%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>\t</td>
<td>tab</td>
<td>\b</td>
<td>backspace</td>
<td>\n</td>
<td>newline</td>
</tr>
<tr class="row-even"><td>\f</td>
<td>form feed</td>
<td>\r</td>
<td>carriage return</td>
<td>\v</td>
<td>vertical tab</td>
</tr>
<tr class="row-odd"><td>\a</td>
<td>alert (bell)</td>
<td>\0</td>
<td>null character</td>
<td>\ \</td>
<td>backslash</td>
</tr>
<tr class="row-even"><td>\’</td>
<td>single quote</td>
<td>\&#8221;</td>
<td>double quote</td>
<td>\?</td>
<td>question mark</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>A backslash followed by an ‘x’, ‘d’, or ‘o’ specifies the character with the corresponding numeric
encoding in the ASCII character set:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>\xnn</td>
<td>hexadecimal escape</td>
</tr>
<tr class="row-even"><td>\dnnn</td>
<td>decimal escape</td>
</tr>
<tr class="row-odd"><td>\onnn</td>
<td>octal escape</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>There must be exactly two hexadecimal digits for hexadecimal character escapes, and exactly three
digits for decimal and octal character escapes. Illegal hexadecimal, decimal, and octal numbers, as
well as character escapes specifying ASCII values greater than 255 will cause a lexical error.</p>
<p>For example, the following characters all denote the carriage return character (ASCII code 13):</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="26%" />
<col width="26%" />
<col width="29%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>\r</td>
<td>\x0d</td>
<td>\d013</td>
<td>\o015</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>A long string may be broken into multiple lines by preceding each newline with a backslash. Such
escaped newlines are ignored during formation of the string constant.</p>
<p>A backslash followed by any other character than those listed above will cause a lexical error.</p>
<p>Productions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="3%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>string</td>
<td>→</td>
<td>‘’’ { normal-char | escape-char } ‘’’</td>
</tr>
<tr class="row-even"><td>normal-char</td>
<td>→</td>
<td>any character except ‘\’ and ‘’’</td>
</tr>
<tr class="row-odd"><td>escape-char</td>
<td>→</td>
<td>‘\t’ | ‘\b’ | ‘\n’ | ‘\f’ | ‘\r’ | ‘\v’ | ‘\a’ | ‘\0’ | ‘\ \’ | ‘\’’ | ‘\&#8221;’ | ‘\?’ | numeric-escape</td>
</tr>
<tr class="row-even"><td>numeric-escape</td>
<td>→</td>
<td>‘\x’ general-digit general-digit | ( ‘\d’ | ‘\o’ ) digit digit digit</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="comments">
<h4>3.4.8. Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h4>
<p>Comments are delimited by double quotes (‘&#8221;’). Double quotes may not themselves be embedded
in the body of a comment. All characters (including formatting characters like newline and carriage
return) are part of the body of a comment.</p>
<p>Productions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="11%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>comment</td>
<td>→</td>
<td>‘&#8221;’ { comment-char } ‘&#8221;’</td>
</tr>
<tr class="row-even"><td>comment-char</td>
<td>→</td>
<td>any character except ‘&#8221;’</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Example:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">&quot;this</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">comment&quot;</span></code></div></blockquote>
<span class="target" id="index-69"></span><span class="target" id="index-70"></span><span class="target" id="index-71"></span><span class="target" id="index-72"></span><span class="target" id="index-73"></span><span class="target" id="index-74"></span><span class="target" id="index-75"></span><span class="target" id="index-76"></span><span class="target" id="index-77"></span><span class="target" id="index-78"></span><span class="target" id="index-79"></span><span class="target" id="index-80"></span><span class="target" id="index-81"></span><span class="target" id="index-82"></span><span class="target" id="index-83"></span><span class="target" id="index-84"></span><span class="target" id="index-85"></span><span class="target" id="index-86"></span><span class="target" id="index-87"></span><span class="target" id="index-88"></span><span class="target" id="index-89"></span><span class="target" id="index-90"></span><span class="target" id="index-91"></span><span class="target" id="index-92"></span><span class="target" id="index-93"></span><span class="target" id="index-94"></span><span class="target" id="index-95"></span><span class="target" id="index-96"></span><span class="target" id="index-97"></span><span class="target" id="index-98"></span><span class="target" id="index-99"></span><span class="target" id="index-100"></span><span class="target" id="index-101"></span><span class="target" id="index-102"></span><p class="rubric" id="index-103">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>If you wish to use the empty vertical bar notation to create an empty object, note that the parser currently requires a space between the vertical bars.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>But in that case make sure you put a space after the period, otherwise you will get an obscure error message from the parser.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>All block objects have the same parent, an object containing the shared behavior for blocks</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>In the user interface a read/write slot is depicted as a single slot with a colon labelling the button used to access the value of the slot; the assignment slot is not shown, to save screen space. In contrast, a read-only slot has an equals sign on the button.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><code class="docutils literal"><span class="pre">nil</span></code> is a predefined object provided by the implementation. It is intended to indicate “not a useful object.”</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td>Although a block may be assigned to a slot at any time, it is often not useful to do so: evaluating the slot may result in an error because the activation record for the block’s lexically enclosing scope will have returned; see <a class="reference internal" href="#pp-langref-blocks"><span class="std std-ref">§3.1.7</span></a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[7]</a></td><td>The current programming environment expects a slot annotation to start with one of a number of keywords, including <code class="docutils literal"><span class="pre">Category:</span></code>, <code class="docutils literal"><span class="pre">Comment:</span></code>, and <code class="docutils literal"><span class="pre">ModuleInfo:</span></code>. See the programming environment manual for more details.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[8]</a></td><td>In order to simplify the presentation, this grammar is ambiguous; precedence and associativity rules are used to resolve the ambiguities.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[9]</a></td><td>General delegation for explicit receiver messages is supported through primitives in the implementation (see Appendix 9.8).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[10]</a></td><td>Unlike Smalltalk, integer literals are limited in range to smallInts.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[11]</a></td><td>In situations where parsing the minus sign as part of the number would cause a parse error (for example, in the expression a-1), the minus is interpreted as a binary message (a - 1).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[12]</a></td><td>When typing strings in, the graphical user interface accepts multi-line strings, but the character-based read-evalprint loop does not.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[13]</td><td>In order to simplify the presentation, this grammar is ambiguous; precedence and associativity rules are used to resolve the ambiguities.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[14]</a></td><td>Heterogeneous binary messages have no associativity; homogeneous binary messages associate left-to-right.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-selfwrld"></span><div class="section" id="the-self-world">
<h2>4. The Self World<a class="headerlink" href="#the-self-world" title="Permalink to this headline">¶</a></h2>
<p>The default Self world is a set of useful objects, including objects that can be used in application
programs (e.g., integers, strings, and collections), objects that support the programming environment
(e.g., the debugger), and objects that simply are used to organize the other objects. This document
describes how this world is organized, focusing primarily on those objects meant for use in
Self programs. It does not discuss the objects used to implement system facilities—for example,
there is no discussion of the objects used to implement the graphical user interface—nor does it
discuss how to use programming support objects such as the command history object; such tools
are described in The Self User’s Manual.</p>
<p>The reader is assumed to be acquainted with the Self language, the use of multiple inheritance,
the use of traits objects and prototype objects, and the organizing principles of the Self world as
discussed in <a class="reference internal" href="index.html#citations"><span class="std std-ref">[UCC91]</span></a>.</p>
<div class="toctree-wrapper compound">
<span id="document-worldorg"></span><div class="section" id="world-organization">
<h3>4.1. World Organization<a class="headerlink" href="#world-organization" title="Permalink to this headline">¶</a></h3>
<div class="section" id="the-lobby">
<h4>4.1.1. The Lobby<a class="headerlink" href="#the-lobby" title="Permalink to this headline">¶</a></h4>
<p>The lobby object is thus named because it is where objects enter the Self world. For example,
when a script that creates a new object is read into the system, all expressions in that script are evaluated
in the context of the lobby. That is, the lobby is the receiver of all messages sent to “self” by
expressions in the script. To refer to some existing object in a script, the object must be accessible
by sending a message to the lobby. For example, the expression:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">_AddSlots</span><span class="p">:</span> <span class="p">(</span> <span class="o">|</span> <span class="n">newObject</span> <span class="o">=</span> <span class="p">(</span> <span class="o">|</span> <span class="n">entries</span> <span class="o">&lt;-</span> <span class="nb">list</span> <span class="n">copy</span> <span class="o">...</span> <span class="o">|</span> <span class="p">)</span> <span class="o">|</span> <span class="p">)</span>
</pre></div>
</div>
<p>requires that the message <code class="docutils literal"><span class="pre">list</span></code> be understood by the lobby (the implicit receiver of the message)
so that the <code class="docutils literal"><span class="pre">entries</span></code> slot of the new object can be initialized. The lobby slots <code class="docutils literal"><span class="pre">traits</span></code>, <code class="docutils literal"><span class="pre">globals</span></code>,
and <code class="docutils literal"><span class="pre">mixins</span></code> are the roots of the object namespaces accessible from the lobby. The organization of
these namespaces is described in the next section. The slot <code class="docutils literal"><span class="pre">lobby</span></code> allows the lobby itself to be referred
by name.</p>
<p>The lobby also has a number of other functions: it is the location of the default behavior inherited
by most objects in the system (slot <code class="docutils literal"><span class="pre">defaultBehavior</span></code>).</p>
</div>
<div class="section" id="names-and-paths">
<h4>4.1.2. Names and Paths<a class="headerlink" href="#names-and-paths" title="Permalink to this headline">¶</a></h4>
<p>For convenience, the lobby’s namespace is broken into three pieces, implemented as separate objects
rooted at the lobby:</p>
<blockquote>
<div><dl class="docutils">
<dt>traits</dt>
<dd>objects that encapsulate shared behavior. Typically, each prototype object has an associated traits object of the same name that describes the shared part of its behavior.</dd>
<dt>globals</dt>
<dd>prototypical objects and one-of-a-kind objects (“oddballs”)</dd>
<dt>mixins</dt>
<dd>small, parentless bundles of behavior designed to be “mixed into” some other object</dd>
</dl>
</div></blockquote>
<p>Each of these namespace objects is categorized to aid navigation.</p>
<p>For example, to find the parent of the prototype list object, one could start with the <code class="docutils literal"><span class="pre">globals</span></code> slot
of the lobby, then get the <code class="docutils literal"><span class="pre">list</span></code> slot of that object, and then the <code class="docutils literal"><span class="pre">parent</span></code> slot of the list. The sequence
of slot names, <code class="docutils literal"><span class="pre">globals</span> <span class="pre">list</span> <span class="pre">parent</span></code> is called a <em>path</em> and constitutes the list parent’s
<em>full name</em>. Parent slots can be omitted from an object’s full name, since the slots in a parent are visible
in the child via inheritance. A path with parent slots omitted forms the <em>short name</em> for an object.
For example, the short name for the list parent is simply <code class="docutils literal"><span class="pre">list</span> <span class="pre">parent</span></code>.</p>
<p>Non-parent slots are used when it is desirable to keep a part of the name space distinct. For example,
the <code class="docutils literal"><span class="pre">traits</span></code> slot of the lobby is not a parent slot. This allows a convention that gives prototypes
and their associated traits objects similar names: a prototype and its associated traits object have
the same local name, but the prototype is placed in a slot in the <code class="docutils literal"><span class="pre">globals</span></code> object, whereas the traits
of the prototype is placed in a slot in the <code class="docutils literal"><span class="pre">traits</span></code> object. Since the <code class="docutils literal"><span class="pre">traits</span></code> slot of the lobby is not
a parent slot, the name of the traits object must start with the prefix <code class="docutils literal"><span class="pre">traits</span></code>. The <code class="docutils literal"><span class="pre">globals</span></code> slot,
on the other hand, is a parent slot, so the name of a prototype object needs no prefix. Thus, <code class="docutils literal"><span class="pre">list</span></code>
refers to the prototype list while <code class="docutils literal"><span class="pre">traits</span> <span class="pre">list</span></code> refers to its traits object for lists.</p>
<p>As a matter of style, programs should refer to objects by the shortest possible name. This makes it
easier to re-organize the global namespace as the system evolves. (If programs used full path
names, then many more names would have to be updated to reflect changes to the namespace organization,
a tedious chore.)</p>
</div>
</div>
<span id="document-roots"></span><div class="section" id="the-roots-of-behavior">
<h3>4.2. The Roots of Behavior<a class="headerlink" href="#the-roots-of-behavior" title="Permalink to this headline">¶</a></h3>
<div class="section" id="default-behavior">
<h4>4.2.1. Default Behavior<a class="headerlink" href="#default-behavior" title="Permalink to this headline">¶</a></h4>
<p>Certain common behavior is shared by nearly all objects in the Self world. This basic behavior is
defined in the <code class="docutils literal"><span class="pre">defaultBehavior</span></code> slot of the lobby and includes:</p>
<blockquote>
<div><ul class="simple">
<li>identity comparisons (== and !==)</li>
<li>inequality (!=)</li>
<li>default behavior for printing (reimplement <code class="docutils literal"><span class="pre">printString</span></code> in descendants)</li>
<li>mirror creation (<code class="docutils literal"><span class="pre">reflect:</span></code>)</li>
<li>support for point, and list construction (&#64; and &amp;)</li>
<li>behavior that allows blocks to ignore extra arguments</li>
<li>behavior that allows an object to behave like a block that evaluates to that object (this permits a non-block object to be passed to a method that expects a block)</li>
<li>behavior that allows an object to be its own key in a collection (key)</li>
<li>default behavior for doubly-dispatched messages</li>
<li>behavior for printing error messages and stack dumps (<code class="docutils literal"><span class="pre">error:</span></code> and <code class="docutils literal"><span class="pre">halt</span></code>)</li>
</ul>
</div></blockquote>
<p>It is important to note that not all objects in the system inherit this default behavior. It is entirely
permissible to construct objects that do not inherit from the lobby, and the Self world contains
quite a few such objects. For example, the objects used to break a namespace into separate categories
typically do not inherit from the lobby. Any program intended to operate on arbitrary objects,
such as a debugger, must therefore assume that the objects it manipulates do not understand even
the messages in <code class="docutils literal"><span class="pre">defaultBehavior</span></code>.</p>
<p>Modules: defaultBehavior, errorHandling</p>
</div>
<div class="section" id="the-root-traits-traits-clonable-and-traits-oddball">
<h4>4.2.2. The Root Traits: Traits Clonable and Traits Oddball<a class="headerlink" href="#the-root-traits-traits-clonable-and-traits-oddball" title="Permalink to this headline">¶</a></h4>
<p>Most concrete objects in the Self world are descendants of one of two top-level traits objects:
<code class="docutils literal"><span class="pre">traits</span> <span class="pre">clonable</span></code> and <code class="docutils literal"><span class="pre">traits</span> <span class="pre">oddball</span></code>. The distinction between the two is based on whether
or not the object is <em>unique</em>. For example, <code class="docutils literal"><span class="pre">true</span></code> is a unique object. There is only one <code class="docutils literal"><span class="pre">true</span></code> object in
the entire system, although there are many references to it. On the other hand, a list object is not
unique. There may be many lists in the system, each containing different elements. A unique object
responds to the message <code class="docutils literal"><span class="pre">copy</span></code> by returning itself and uses identity to test for equality. The general
rule is:</p>
<blockquote>
<div><ul class="simple">
<li>unique objects usually inherit from <code class="docutils literal"><span class="pre">traits</span> <span class="pre">oddball</span></code></li>
<li>non-unique objects usually inherit from <code class="docutils literal"><span class="pre">traits</span> <span class="pre">clonable</span></code></li>
</ul>
</div></blockquote>
<p>Module: rootTraits</p>
</div>
<div class="section" id="mixins">
<h4>4.2.3. Mixins<a class="headerlink" href="#mixins" title="Permalink to this headline">¶</a></h4>
<p>Like traits objects, mixin objects encapsulate a bundle of shared behavior. Unlike traits objects,
however, mixin objects are generally parentless to allow their behavior to be added to an object
without necessarily also adding unwanted behavior (such as access to the lobby namespace). Mixins
are generally used in objects that also have other parents. An example is <code class="docutils literal"><span class="pre">mixins</span> <span class="pre">identity</span></code>.</p>
</div>
<div class="section" id="the-identity-mixin">
<h4>4.2.4. The Identity Mixin<a class="headerlink" href="#the-identity-mixin" title="Permalink to this headline">¶</a></h4>
<p>Two objects are usually tested for equality based on whether they have “the same value” within a
common domain. For example, <code class="docutils literal"><span class="pre">3.0</span> <span class="pre">=</span> <span class="pre">3</span></code> within the domain of numbers, even though they are not
the same object or even the same kind of object. In some domains, however, two objects are equal
if and only if they are the exact same object. For example, even two process objects with the same
state are not considered equal unless they are identical. In such cases, identity comparison is used
to implement equality tests, and <code class="docutils literal"><span class="pre">mixins</span> <span class="pre">identity</span></code> can be mixed in to get the desired behavior.</p>
<p>Module: rootTraits</p>
</div>
</div>
<span id="document-blocks"></span><div class="section" id="blocks-booleans-and-control-structures">
<h3>4.3. Blocks, Booleans, and Control Structures<a class="headerlink" href="#blocks-booleans-and-control-structures" title="Permalink to this headline">¶</a></h3>
<p>A <em>block</em> is a special kind of object containing a sequence of statements. When a block is evaluated
by being sent an acceptable <code class="docutils literal"><span class="pre">value</span></code> message, its statements are executed in the context of the current
activation of the method in which the block is declared. This allows the statements in the block
to access variables local to the block’s enclosing method and any enclosing blocks in that method.
(This set of variables comprises the lexical scope of the block.) It also means that within the block,
<code class="docutils literal"><span class="pre">self</span></code> refers to the receiver of the message that activated the method, not to the block object itself.
A return statement in a block causes a return from the block’s enclosing method. (See chapter <span class="xref std std-ref">pp-langref</span>
- <a class="reference internal" href="index.html#document-langref"><span class="doc">Language Reference</span></a> for a more thorough discussion of block semantics.)</p>
<p>A block can take an arbitrary number of arguments and can have its own local variables, as well as
having access to the local variables of its enclosing method. The statements in the block are executed
when the block is sent a message of the form <code class="docutils literal"><span class="pre">“value[:{With:}]”</span></code>, where the number of colons
in the message is at least the same as the number of arguments the block takes (extra
arguments are ignored, but it is an error to provide too few). For example, the following block takes
two arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">|</span> <span class="p">:</span><span class="n">arg1</span><span class="o">.</span> <span class="p">:</span><span class="n">arg2</span> <span class="o">|</span> <span class="n">arg1</span> <span class="o">+</span> <span class="n">arg2</span> <span class="p">]</span>
</pre></div>
</div>
<p>and can be evaluated by sending it the message <code class="docutils literal"><span class="pre">value:With:</span></code> to produce the sum of its arguments.
Blocks are used to implement all control structures in Self and allow the programmer to
easily extend the system with customized control structures. In fact, all control stuctures in Self
except message sends, returns, and VM error handling are implemented using blocks.</p>
<div class="section" id="booleans-and-conditionals">
<h4>4.3.1. Booleans and Conditionals<a class="headerlink" href="#booleans-and-conditionals" title="Permalink to this headline">¶</a></h4>
<p>The fundamental control structure is the conditional. In Self, the behavior of conditionals is defined
by two unique boolean objects, <code class="docutils literal"><span class="pre">true</span></code> and <code class="docutils literal"><span class="pre">false</span></code>. Boolean objects respond to the messages
<code class="docutils literal"><span class="pre">ifTrue:</span></code>, <code class="docutils literal"><span class="pre">ifFalse:</span></code>, <code class="docutils literal"><span class="pre">ifTrue:False:</span></code>, and <code class="docutils literal"><span class="pre">ifFalse:True:</span></code> by evaluating the appropriate argument
block. For example, <code class="docutils literal"><span class="pre">true</span></code> implements <code class="docutils literal"><span class="pre">ifTrue:False:</span></code> as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ifTrue</span><span class="p">:</span> <span class="n">b1</span> <span class="kc">False</span><span class="p">:</span> <span class="n">b2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">b1</span> <span class="n">value</span> <span class="p">)</span>
</pre></div>
</div>
<p>That is, when <code class="docutils literal"><span class="pre">true</span></code> is sent <code class="docutils literal"><span class="pre">ifTrue:False:</span></code>, it evaluates the first block and ignores the second.
For example, the following expression evaluates to the absolute value of x:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="p">[</span> <span class="n">x</span> <span class="n">negate</span> <span class="p">]</span> <span class="kc">False</span><span class="p">:</span> <span class="p">[</span> <span class="n">x</span> <span class="p">]</span>
</pre></div>
</div>
<p>The booleans also define behavior for the logical operations <code class="docutils literal"><span class="pre">AND</span> <span class="pre">(&amp;&amp;),</span> <span class="pre">OR</span> <span class="pre">(||),</span> <span class="pre">EXCLUSIVE-OR</span>
<span class="pre">(^^)</span></code>, and <code class="docutils literal"><span class="pre">NOT</span> <span class="pre">(not)</span></code>. Because the binary boolean operators all send value to their argument when
necessary, they can also be used for “short-circuit” evaluation by supplying a block, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">maxByte</span> <span class="n">pred</span><span class="p">]</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span>
</pre></div>
</div>
<p>Module: boolean</p>
</div>
<div class="section" id="loops">
<h4>4.3.2. Loops<a class="headerlink" href="#loops" title="Permalink to this headline">¶</a></h4>
<p>The various idioms for constructing loops in Self are best illustrated by example.
Here is an endless loop:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="o">...</span> <span class="p">]</span> <span class="n">loop</span>
</pre></div>
</div>
<p>Here are two loops that test for their termination condition at the beginning of the loop:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="n">proceed</span> <span class="p">]</span> <span class="n">whileTrue</span><span class="p">:</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span>
<span class="p">[</span> <span class="n">quit</span> <span class="p">]</span> <span class="n">whileFalse</span><span class="p">:</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span>
</pre></div>
</div>
<p>In each case, the block that receives the message repeatedly evaluates itself and, if the termination
condition is not yet met, evaluates the argument block. The value returned by both loop expressions
is <code class="docutils literal"><span class="pre">nil</span></code>.</p>
<p>It is also possible to put the termination test at the end of the loop, ensuring that the loop body is
executed at least once:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="o">...</span> <span class="p">]</span> <span class="n">untilTrue</span><span class="p">:</span> <span class="p">[</span> <span class="n">quit</span> <span class="p">]</span>
<span class="p">[</span> <span class="o">...</span> <span class="p">]</span> <span class="n">untilFalse</span><span class="p">:</span> <span class="p">[</span> <span class="n">proceed</span> <span class="p">]</span>
</pre></div>
</div>
<p>Here is a loop that exits from the middle when quit becomes true:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">|</span> <span class="p">:</span><span class="n">exit</span> <span class="o">|</span> <span class="o">...</span> <span class="n">quit</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="n">exit</span> <span class="o">...</span> <span class="p">]</span> <span class="n">loopExit</span>
</pre></div>
</div>
<p>For the incurably curious: the parameter to the user’s block, supplied by the <code class="docutils literal"><span class="pre">loopExit</span></code> method, is simply a block that
does a return from the <code class="docutils literal"><span class="pre">loopExit</span></code> method. Thus, the loop terminates when <code class="docutils literal"><span class="pre">exit</span> <span class="pre">value</span></code> is evaluated. The constructs
<code class="docutils literal"><span class="pre">loopExitValue</span></code>, <code class="docutils literal"><span class="pre">exit</span></code>, and <code class="docutils literal"><span class="pre">exitValue</span></code> are implemented in a similar manner.</p>
<p>The value returned by the overall <code class="docutils literal"><span class="pre">[...]</span> <span class="pre">loopExit</span></code> expression is <code class="docutils literal"><span class="pre">nil</span></code>. Here is a loop expression
that exits and evaluates to a value determined by the programmer when quit becomes true:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">|</span> <span class="p">:</span><span class="n">exit</span> <span class="o">|</span> <span class="o">...</span> <span class="n">quit</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="p">[</span> <span class="n">exit</span> <span class="n">value</span><span class="p">:</span> <span class="n">expr</span> <span class="p">]</span> <span class="p">]</span> <span class="n">loopExitValue</span>
</pre></div>
</div>
<p>Module: block</p>
</div>
<div class="section" id="block-exits">
<h4>4.3.3. Block Exits<a class="headerlink" href="#block-exits" title="Permalink to this headline">¶</a></h4>
<p>It is sometimes convenient to exit a block early, without executing its remaining statements. The
following constructs support this behavior:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">|</span> <span class="p">:</span><span class="n">exit</span> <span class="o">|</span> <span class="o">...</span> <span class="n">quit</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="n">exit</span> <span class="o">...</span> <span class="p">]</span> <span class="n">exit</span>
<span class="p">[</span><span class="o">|</span> <span class="p">:</span><span class="n">exit</span> <span class="o">|</span> <span class="o">...</span> <span class="n">quit</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="p">[</span> <span class="n">exit</span> <span class="n">value</span><span class="p">:</span> <span class="n">expr</span> <span class="p">]</span> <span class="o">...</span> <span class="p">]</span> <span class="n">exitValue</span>
</pre></div>
</div>
<p>The first expression evaluates to nil if the block exits early; the second allows the programmer to
define the expression’s value when the block exits early. Note: These constructs should not be confused
with their looping counterparts <code class="docutils literal"><span class="pre">loopExit</span></code> and <code class="docutils literal"><span class="pre">loopExitValue</span></code>.</p>
<p>Module: block</p>
</div>
<div class="section" id="other-block-behavior">
<h4>4.3.4. Other Block Behavior<a class="headerlink" href="#other-block-behavior" title="Permalink to this headline">¶</a></h4>
<p>Blocks have some other useful behavior:</p>
<blockquote>
<div><ul class="simple">
<li>One can determine the time in milliseconds required to execute a block using various ways of measuring time using the messages <code class="docutils literal"><span class="pre">userTime</span></code>, <code class="docutils literal"><span class="pre">systemTime</span></code>, <code class="docutils literal"><span class="pre">cpuTime</span></code>, and <code class="docutils literal"><span class="pre">realTime</span></code>.</li>
<li>One can profile the execution of a block using the messages <code class="docutils literal"><span class="pre">profile</span></code> and <code class="docutils literal"><span class="pre">flatProfile</span></code>. <code class="docutils literal"><span class="pre">profile</span></code> prints out the source level call graph annotated with call site and timing information   whereas <code class="docutils literal"><span class="pre">flatProfile</span></code> prints out a flat profile sorted by module.</li>
<li>The message <code class="docutils literal"><span class="pre">countSends</span></code> will collect lookup statistics during a block execution.</li>
</ul>
</div></blockquote>
<p>Any object that inherits from the lobby can be passed to a method that expects a block; behavior in <code class="docutils literal"><span class="pre">defaultBehavior</span></code> makes the object behave like a block that evaluates to that object.</p>
<p>Module: block</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td></td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-numbers"></span><div class="section" id="numbers-and-time">
<h3>4.4. Numbers and Time<a class="headerlink" href="#numbers-and-time" title="Permalink to this headline">¶</a></h3>
<p>The SELF number traits form the hierarchy shown below. (In this and subsequent hierarchy descriptions,
indentation indicates that one traits object is a child of another. The prefix “traits” is
omitted since these hierarchy descriptions always describe the interrelationship between traits objects.
In most cases, leaf traits are concrete and have an associated prototype with the same name.)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">orderedOddball</span>
    <span class="n">number</span>
        <span class="nb">float</span>
        <span class="n">integer</span>
            <span class="n">smallInt</span>
            <span class="n">bigInt</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">traits</span> <span class="pre">number</span></code> defines behavior common to all numbers, such as <code class="docutils literal"><span class="pre">successor</span></code>, <code class="docutils literal"><span class="pre">succ</span></code>, <code class="docutils literal"><span class="pre">predecessor</span></code>,
<code class="docutils literal"><span class="pre">pred</span></code>, <code class="docutils literal"><span class="pre">absoluteValue</span></code>, <code class="docutils literal"><span class="pre">negate</span></code>, <code class="docutils literal"><span class="pre">double</span></code>, <code class="docutils literal"><span class="pre">half</span></code>, <code class="docutils literal"><span class="pre">max:</span></code>, and <code class="docutils literal"><span class="pre">min:</span></code>. <code class="docutils literal"><span class="pre">traits</span> <span class="pre">number</span></code>
inherits from <code class="docutils literal"><span class="pre">traits</span> <span class="pre">orderedOddball</span></code>, so sending <code class="docutils literal"><span class="pre">copy</span></code> or <code class="docutils literal"><span class="pre">clone</span></code> to a number returns the
number itself. <code class="docutils literal"><span class="pre">traits</span> <span class="pre">integer</span></code> defines behavior common to all integers such as <code class="docutils literal"><span class="pre">even</span></code>, <code class="docutils literal"><span class="pre">odd</span></code>, and
<code class="docutils literal"><span class="pre">factorial</span></code>. There are four division operators for integers that allow the programmer to control
how the result is truncated or rounded. Integers also include behavior for iterating through a subrange,
including:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">to</span><span class="p">:</span><span class="n">Do</span><span class="p">:</span>
<span class="n">to</span><span class="p">:</span><span class="n">By</span><span class="p">:</span><span class="n">Do</span><span class="p">:</span>
<span class="n">to</span><span class="p">:</span><span class="n">ByNegative</span><span class="p">:</span><span class="n">Do</span><span class="p">:</span>
<span class="n">upTo</span><span class="p">:</span><span class="n">Do</span><span class="p">:</span>
<span class="n">upTo</span><span class="p">:</span><span class="n">By</span><span class="p">:</span><span class="n">Do</span><span class="p">:</span>
<span class="n">downTo</span><span class="p">:</span><span class="n">Do</span><span class="p">:</span>
<span class="n">downTo</span><span class="p">:</span><span class="n">By</span><span class="p">:</span><span class="n">Do</span><span class="p">:</span>
</pre></div>
</div>
<p>Relevant oddballs:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">infinity</span></code> IEEE floating-point infinity</li>
<li><code class="docutils literal"><span class="pre">minSmallInt</span></code> smallest <code class="docutils literal"><span class="pre">smallInt</span></code> in this implementation</li>
<li><code class="docutils literal"><span class="pre">maxSmallInt</span></code> biggest <code class="docutils literal"><span class="pre">smallInt</span></code> in this implementation</li>
</ul>
</div></blockquote>
<p>Modules: number, float, integer, smallInt, bigInt</p>
<div class="section" id="random-numbers">
<h4>4.4.1. Random Numbers<a class="headerlink" href="#random-numbers" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">clonable</span>
    <span class="n">random</span>
        <span class="n">randomLC</span>
            <span class="n">prototypes</span> <span class="n">random</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">traits</span> <span class="pre">random</span></code> defines the abstract behavior of random number generators. A random number
generator can be used to generate random booleans, integers, floats, characters or strings. <code class="docutils literal"><span class="pre">traits</span>
<span class="pre">randomLC</span></code> defines a concrete specialization based on a simple linear congruence algorithm. For
convenience, the prototype for <code class="docutils literal"><span class="pre">randomLC</span></code> is “<code class="docutils literal"><span class="pre">random</span></code>,” not “<code class="docutils literal"><span class="pre">randomLC</span></code>”.</p>
<p>Modules: random</p>
</div>
<div class="section" id="time">
<h4>4.4.2. Time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">clonable</span>
    <span class="n">time</span>
</pre></div>
</div>
<p>A time object represents a date and time (to the nearest millisecond) since midnight GMT on January
1, 1970. The message <code class="docutils literal"><span class="pre">current</span></code> returns a new time object containing the current time. Two
times can be compared using the standard comparison operators. One time can be subtracted from
another to produce a value in milliseconds. An offset in milliseconds can be added or subtracted
from a time object to produce a new time object. However, it is an error to add two time objects
together.</p>
<p>Modules: time</p>
</div>
</div>
<span id="document-collections"></span><div class="section" id="collections">
<h3>4.5. Collections<a class="headerlink" href="#collections" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">clonable</span>
    <span class="n">collection</span>
        <span class="o">...</span> <span class="n">collection</span> <span class="n">hierarchy</span> <span class="o">...</span>
</pre></div>
</div>
<p>Collections are containers that hold zero or more other objects. In Self, collections behave as if
they have a key associated with each value in the collection. Collections without an obvious key,
such as lists, use each element as both key and value. Iterations over collections always pass both
the value and the key of each element (in that order) to the iteration block. Since Self blocks ignore
extra arguments, this allows applications that don’t care about keys to simply provide a block
that takes only one argument.</p>
<p>Collections have a rich protocol. Additions are made with <code class="docutils literal"><span class="pre">at:Put:</span></code>, or with <code class="docutils literal"><span class="pre">add:</span></code> or <code class="docutils literal"><span class="pre">addAll:</span></code> for
implicitly keyed collections. Iteration can be done with <code class="docutils literal"><span class="pre">do:</span></code> or with variations that allow the programmer
to specify special handling of the first and/or last element. <code class="docutils literal"><span class="pre">with:Do:</span></code> allows pairwise iteration
through two collections. The <code class="docutils literal"><span class="pre">includes:</span></code>, <code class="docutils literal"><span class="pre">occurrencesOf:</span></code>, and <code class="docutils literal"><span class="pre">findFirst:</span></code>
<code class="docutils literal"><span class="pre">IfPresent:IfAbsent:</span></code> messages test for the presence of particular values in the collection.
<code class="docutils literal"><span class="pre">filterBy:Into:</span></code> creates a new collection including only those elements that satisfy a predicate
block, while <code class="docutils literal"><span class="pre">mapBy:Into:</span></code> creates a new collection whose elements are the result of applying the
argument block to each element of the original collection.</p>
<p>Abstract collection behavior is defined in <code class="docutils literal"><span class="pre">traits</span> <span class="pre">collection</span></code>. Only a small handful of operations need
be implemented to create a new type of collection; the rest can be inherited from <code class="docutils literal"><span class="pre">traits</span> <span class="pre">collection</span></code>.
(See the <code class="docutils literal"><span class="pre">descendantResponsibility</span></code> slot of <code class="docutils literal"><span class="pre">traits</span> <span class="pre">collection</span></code>.) The following
sections discuss various kinds of collection in more detail.</p>
<p>Modules: collection (abstract collection behavior)</p>
<div class="section" id="indexable-collections">
<h4>4.5.1. Indexable Collections<a class="headerlink" href="#indexable-collections" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">collection</span>
    <span class="n">indexable</span>
        <span class="n">mutableIndexable</span>
            <span class="n">byteVector</span>
                <span class="o">...</span><span class="n">the</span> <span class="n">string</span> <span class="n">hierarchy</span>
            <span class="n">sequence</span>
                <span class="n">sortedSequence</span>
            <span class="n">vector</span>
</pre></div>
</div>
<p>Indexable collections allow random access to their elements via keys that are integers. All sequences
and vectors are indexable. The message <code class="docutils literal"><span class="pre">at:</span></code> is used to retrieve an element of an indexable collection
while <code class="docutils literal"><span class="pre">at:Put:</span></code> is used to update an element of a <code class="docutils literal"><span class="pre">mutableIndexable</span></code> collection (other
than a <code class="docutils literal"><span class="pre">sortedSequence</span></code>).</p>
<p>Modules: indexable, abstractString, vector, sequence, sortedSequence</p>
</div>
<div class="section" id="strings-characters-and-paragraphs">
<h4>4.5.2. Strings, Characters, and Paragraphs<a class="headerlink" href="#strings-characters-and-paragraphs" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">collection</span>
    <span class="o">...</span>
    <span class="n">byteVector</span>
        <span class="n">string</span>
            <span class="n">mutableString</span>
            <span class="n">immutableString</span>
                <span class="n">canonicalString</span>
</pre></div>
</div>
<p>A string is a vector whose elements are character objects. There are three kinds of concrete string:
immutable strings, mutable strings and canonical strings. <code class="docutils literal"><span class="pre">traits</span> <span class="pre">string</span></code> defines the behavior
shared by all strings. A character is a string of length one that references itself in its sole indexable
slot.</p>
<p>Mutable strings can be changed using the message <code class="docutils literal"><span class="pre">at:Put:</span></code>, which takes a character argument, or
<code class="docutils literal"><span class="pre">at:PutByte:</span></code>, which takes an integer argument. An immutable string cannot be modified, but
sending it the <code class="docutils literal"><span class="pre">copyMutable</span></code> message returns a mutable string containing the same characters.</p>
<p>Canonical strings are registered in an table inside the virtual machine, like Symbol objects in
Smalltalk or atoms in LISP. The VM guarantees that there is at most one canonical string for any
given sequence of bytes, so two canonical strings are equal (have the same contents) if and only if
they are identical (are the same object). This allows efficient equality checks between canonical
strings. All message selectors and string literals are canonical strings, and some primitives require
canonical strings as arguments. Sending <code class="docutils literal"><span class="pre">canonicalize</span></code> to any string returns the corresponding
canonical string.</p>
<p>Character objects behave like immutable strings of length one. There are 256 well-known character
objects in the Self universe. They are stored in a 256-element vector named <code class="docutils literal"><span class="pre">ascii</span></code>, with each
character stored at the location corresponding to its ASCII value. Characters respond to the message
<code class="docutils literal"><span class="pre">asByte</span></code> by returning their ASCII value (that is, their index in <code class="docutils literal"><span class="pre">ascii</span></code>). The inverse of <code class="docutils literal"><span class="pre">asByte</span></code>,
<code class="docutils literal"><span class="pre">asCharacter</span></code>, can be sent to an integer between 0 and 255 to obtain the corresponding
character object.</p>
<p>Module: string</p>
</div>
<div class="section" id="unordered-sets-and-dictionaries">
<h4>4.5.3. Unordered Sets and Dictionaries<a class="headerlink" href="#unordered-sets-and-dictionaries" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">collection</span>
    <span class="n">setOrDictionary</span>
        <span class="nb">set</span>
            <span class="n">sharedSet</span>
        <span class="n">dictionary</span>
            <span class="n">sharedDictionary</span>
</pre></div>
</div>
<p>There are two implementations of sets and dictionaries in the system. The one described in this
section is based on hash tables. The one discussed in the following section is based on sorted binary
trees. The hash table implementation has better performance over a wide range of conditions.
(An unfortunate ordering of element addtions can cause the unbalanced trees used in the tree version
to degenerate into an ordered lists, resulting in linear access times.)</p>
<p>A set behaves like a mathematical set. It contains elements without duplication in no particular order.
A dictionary implements a mapping from keys to values, where both keys and values are arbitrary
objects. Dictionaries implement the usual collection behavior plus keyed access using <code class="docutils literal"><span class="pre">at:</span></code>
and <code class="docutils literal"><span class="pre">at:Put:</span></code> and the dictionary-specific operations <code class="docutils literal"><span class="pre">includesKey:</span></code> and <code class="docutils literal"><span class="pre">removeKey:</span></code>. In order
to store an object in a set or use it as a dictionary key, the object must understand the messages
<code class="docutils literal"><span class="pre">hash</span></code> and <code class="docutils literal"><span class="pre">=</span></code>, the latter applying to any pair of items in the collection. This is because sets and dictionaries
are implemented as hash tables.</p>
<p>Derived from set and dictionary are <code class="docutils literal"><span class="pre">sharedSet</span></code> and <code class="docutils literal"><span class="pre">sharedDictionary</span></code>. These provide locking
to maintain internal consistency in the presence of concurrency.</p>
<p>Modules: setAndDictionary, sharedSetAndDictionary</p>
</div>
<div class="section" id="tree-based-sets-and-dictionaries">
<h4>4.5.4. Tree-Based Sets and Dictionaries<a class="headerlink" href="#tree-based-sets-and-dictionaries" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">collection</span>
    <span class="n">tree</span>
        <span class="n">treeNodes</span> <span class="n">abstract</span>
            <span class="n">treeNodes</span> <span class="n">bag</span>
            <span class="n">treeNodes</span> <span class="nb">set</span>
        <span class="n">emptyTrees</span> <span class="n">abstract</span>
            <span class="n">emptyTrees</span> <span class="n">bag</span>
            <span class="n">emptyTrees</span> <span class="nb">set</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">treeSet</span></code> and <code class="docutils literal"><span class="pre">treeBag</span></code> implement sorted collections using binary trees. The set variant ignores
duplicates, while the bag variant does not. Tree sets and bags allow both explicit and implicit keys
(that is, adding elements can be done with either <code class="docutils literal"><span class="pre">at:Put:</span></code> or <code class="docutils literal"><span class="pre">add:</span></code>), where a tree set that uses
explicit keys behaves like a dictionary. Sorting is done on explicit keys if present, values otherwise,
and the objects sorted must be mutually comparable. Comparisons between keys are made using
<code class="docutils literal"><span class="pre">compare:IfLess:Equal:Greater:</span></code>.</p>
<p>The implementation of trees uses dynamic inheritance to distinguish the differing behavior of empty
and non-empty subtrees. The prototype <code class="docutils literal"><span class="pre">treeSet</span></code> represents an empty (sub)tree; when an element
is added to it, its parent is switched from <code class="docutils literal"><span class="pre">traits</span> <span class="pre">emptyTrees</span> <span class="pre">set</span></code>, which holds behavior
for empty (sub)trees, to a new copy of <code class="docutils literal"><span class="pre">treeSetNode</span></code>, which represents a tree node holding an element.
Thus, the <code class="docutils literal"><span class="pre">treeSet</span></code> object now behaves as a <code class="docutils literal"><span class="pre">treeSetNode</span></code> object, with right and left subtrees
(initially copies of the empty subtree <code class="docutils literal"><span class="pre">treeSet</span></code>). Dynamic inheritance allows one object to
behave modally without using clumsy if-tests throughout every method.</p>
<p>One caveat: since these trees are not balanced, they can degenerate into lists if their elements are
added in sorted order. However, a more complex tree data structure might obscure the main point
of this implementation: to provide a canonical example of the use of dynamic inheritance.</p>
<p>Modules: tree</p>
</div>
<div class="section" id="lists-and-priorityqueues">
<h4>4.5.5. Lists and PriorityQueues<a class="headerlink" href="#lists-and-priorityqueues" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">collection</span>
    <span class="nb">list</span>
    <span class="n">priorityQueue</span>
</pre></div>
</div>
<p>A list is an unkeyed, circular, doubly-linked list of objects. Additions and removals at either end
are efficient, but removing an object in the middle is less so, as a linear search is involved.</p>
<p>A priorityQueue is an unkeyed, unordered collection with the property that the element with the
highest priority is always at the front of the queue. Priority queues are useful for sorting (heapsort)
and scheduling. The default comparison uses &lt;, but this can be changed.</p>
<p>Modules: list. priorityQueue</p>
</div>
<div class="section" id="constructing-and-concatenating-collections">
<h4>4.5.6. Constructing and Concatenating Collections<a class="headerlink" href="#constructing-and-concatenating-collections" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">clonable</span>
    <span class="n">collector</span>
</pre></div>
</div>
<p>Two kinds of objects play supporting roles for collections. A <code class="docutils literal"><span class="pre">collector</span></code> object is created using
the &amp; operator (inherited from <code class="docutils literal"><span class="pre">defaultBehavior</span></code>), and represents a collection under construction.
The &amp; operator provides a concise syntax for constructing small collections. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>(1 &amp; ’abc’ &amp; x) asList
</pre></div>
</div>
<p>constructs a list containing an integer, a string, and the object x. A <code class="docutils literal"><span class="pre">collector</span></code> object is not itself
a collection; it is converted into one using a conversion message such as <code class="docutils literal"><span class="pre">asList</span></code>, <code class="docutils literal"><span class="pre">asVector</span></code>, or
<code class="docutils literal"><span class="pre">asString</span></code>.</p>
<p>Modules: collector</p>
</div>
</div>
<span id="document-pairs"></span><div class="section" id="pairs">
<h3>4.6. Pairs<a class="headerlink" href="#pairs" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pair</span>
    <span class="n">point</span>
    <span class="n">rectangle</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">traits</span> <span class="pre">pair</span></code> describes the general behavior for pairs of arithmetic quantities. A point is a pair of
numbers representing a location on the cartesian plane. A rectangle is a pair of points representing
the opposing corners of a rectangle whose sides are parallel with the x and y axes.</p>
<p>Modules: pair, point, rectangle</p>
</div>
<span id="document-mirrors"></span><div class="section" id="mirrors">
<h3>4.7. Mirrors<a class="headerlink" href="#mirrors" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">collection</span>
    <span class="n">mirror</span>
        <span class="n">mirrors</span> <span class="n">smallInt</span>
        <span class="n">mirrors</span> <span class="nb">float</span>
        <span class="n">mirrors</span> <span class="n">vectorish</span>
            <span class="n">mirrors</span> <span class="n">vector</span>
            <span class="n">mirrors</span> <span class="n">byteVector</span>
                <span class="n">mirrors</span> <span class="n">canonicalString</span>
                <span class="n">mirrors</span> <span class="n">mirror</span>
        <span class="n">mirrors</span> <span class="n">block</span>
        <span class="n">mirrors</span> <span class="n">method</span>
        <span class="n">mirrors</span> <span class="n">blockMethod</span>
            <span class="n">mirrors</span> <span class="n">activation</span> <span class="n">liveOnes</span>
                <span class="n">mirrors</span> <span class="n">activation</span>
                    <span class="n">mirrors</span> <span class="n">deadActivation</span>
                    <span class="n">mirrors</span> <span class="n">methodActivation</span>
                    <span class="n">mirrors</span> <span class="n">blockMethodActivation</span>
        <span class="n">mirrors</span> <span class="n">process</span>
        <span class="n">mirrors</span> <span class="n">assignment</span>
        <span class="n">mirrors</span> <span class="n">slots</span>
        <span class="n">mirrors</span> <span class="n">profiler</span>
</pre></div>
</div>
<p>Mirrors allow programs to examine and manipulate objects. (Mirrors get their name from the fact
that a program can use a mirror to examine—that is, reflect upon—itself.) A mirror on an object x
is obtained by sending the message <code class="docutils literal"><span class="pre">reflect:</span></code> x to any object that inherits <code class="docutils literal"><span class="pre">defaultBehavior</span></code>.
The object x is called the mirror’s <em>reflectee</em>. A mirror behaves like a keyed collection whose keys
are slot names and whose values are mirrors on the contents of slots of the reflectee. A mirror can
be queried to discover the number and names of the slots in its reflectee, and which slots are parent
slots. A mirror can be used to add and remove slots of its reflectee. Iterating through a mirror enumerates
objects representing slots of the reflected object (such facets are called “fake” slots). For
example, a method mirror includes fake slots for the method’s byte code and literal vectors and elements
of vectors and byteVectors.</p>
<p>There is one kind of mirror for each kind of object known to the virtual machine: small integers,
floats, canonical strings, object and byte vectors, mirrors, blocks, ordinary and block methods, ordinary
and block method activations, processes, profilers, the assignment primitive, and ordinary
objects (called “slots” because an ordinary object is just a set of slots). The prototypes for these
mirrors are part of the initial Self world that exists before reading in any script files. The file
<code class="docutils literal"><span class="pre">init.self</span></code> moves these prototypes to the <code class="docutils literal"><span class="pre">mirrors</span></code> subcategory of the <code class="docutils literal"><span class="pre">prototypes</span></code> category of
the <code class="docutils literal"><span class="pre">lobby</span></code> namespace. Because <code class="docutils literal"><span class="pre">mirrors</span></code> is not a parent slot, the names of the mirror prototypes
always include the <code class="docutils literal"><span class="pre">“mirrors”</span></code> prefix.</p>
<p>Modules: mirror, slot, init</p>
</div>
<span id="document-messages"></span><div class="section" id="messages">
<h3>4.8. Messages<a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h3>
<p>Self allows messages to be manipulated as objects when convenient. For example, if an object
fails to understand a message, the object is notified of the problem via a message whose arguments
include the selector of the message that was not understood. While most objects inherit default
behavior for handling this situation (by halting with an error), it is sometimes convenient for an object
to handle the situation itself, perhaps by resending the message to some other object. Objects
that do this are called transparent forwarders. An example is given in <code class="docutils literal"><span class="pre">interceptor</span></code>.</p>
<p>A string has the basic ability to use itself as a message selector using the messages <code class="docutils literal"><span class="pre">sendTo</span></code>: (normal
message sends), <code class="docutils literal"><span class="pre">resendTo</span></code>: (resends), or <code class="docutils literal"><span class="pre">sendTo:DelegatingTo:</span></code> (delegated sends).
Each of these messages has a number of variations based on the number of arguments the message
has. For example, one would used <code class="docutils literal"><span class="pre">sendTo:With:With:</span></code> to send a message with <code class="docutils literal"><span class="pre">at:Put:</span></code> as the
selector and two arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s1">&#39;at:Put:&#39;</span> <span class="n">sendTo</span><span class="p">:</span> <span class="n">aDict</span> <span class="n">With</span><span class="p">:</span> <span class="n">k</span> <span class="n">With</span><span class="p">:</span> <span class="n">v</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Primitives such as <code class="docutils literal"><span class="pre">_Print</span></code> cannot be sent in the current system.</p>
</div>
<p>A selector, receiver, delegatee, methodHolder, and arguments can be bundled together in a <code class="docutils literal"><span class="pre">message</span></code>
object. The message gets <code class="docutils literal"><span class="pre">sent</span></code> when the message object receives the send message. Message
objects are used to describe delayed actions, such as the actions that should occur just before or after
a snapshot is read. They are also used as an argument to new process creation (you can create a
new process to execute the message by sending it <code class="docutils literal"><span class="pre">fork</span></code>).</p>
<p>Modules: sending, message, selector, interceptor</p>
</div>
<span id="document-processes"></span><div class="section" id="processes-and-the-prompt">
<h3>4.9. Processes and the Prompt<a class="headerlink" href="#processes-and-the-prompt" title="Permalink to this headline">¶</a></h3>
<p>Self processes are managed by a simple preemptive round-robin scheduler. Processes can be
stepped, suspended, resumed, terminated, or put to sleep for a specified amount of time. Also, the
stack of a suspended process can be examined and the CPU use of a process can be determined. A
process can be created by sending <code class="docutils literal"><span class="pre">fork</span></code> to a <code class="docutils literal"><span class="pre">message</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">prompt</span></code> object takes input from <code class="docutils literal"><span class="pre">stdin</span></code> and spawns a process to evaluate the message. Input
to the prompt is kept in a history list so that past input can be replayed, similar to the history mechanism
in many Unix shells.</p>
<p>Modules: process, scheduler, semaphore, prompt, history</p>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span></div>
<span id="document-foreign"></span><div class="section" id="foreign-objects">
<h3>4.10. Foreign Objects<a class="headerlink" href="#foreign-objects" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">clonable</span>
    <span class="n">proxy</span>
        <span class="n">fctProxy</span>
            <span class="n">foreignFct</span>
    <span class="n">foreignCode</span>
</pre></div>
</div>
<p>The low level aspects of interfacing with code written in other languages (via C or C++ glue code)
are described in <a class="reference internal" href="index.html#document-vmref"><span class="doc">Virtual Machine Reference</span></a> (<a class="reference internal" href="index.html#document-vmref"><span class="doc">chapter</span></a> <a class="reference internal" href="index.html#pp-vmref"><span class="std std-ref">8</span></a>). A number of objects in the Self
world are used to interface to foreign data objects and functions. These objects are found in the name spaces
<code class="docutils literal"><span class="pre">traits</span></code> <code class="docutils literal"><span class="pre">foreign</span></code>, and <code class="docutils literal"><span class="pre">globals</span> <span class="pre">foreign</span></code>.</p>
<p>One difficulty in interfacing between Self and external data and functions is that references to foreign
data and functions from within Self can become obsolete when the Self world is saved as
a snapshot and then read in later, possibly on some other workstation. Using an obsolete reference
(i.e., memory address) would be disastrous. Thus, Self encapsulates such references within the
special objects <code class="docutils literal"><span class="pre">proxy</span></code> (for data references) and <code class="docutils literal"><span class="pre">fctProxy</span></code> (for function references). Such objects
are known collectively as <em>proxies</em>. A proxy object bundles some extra information along with the
memory address of the referenced object and uses this extra information to detect (with high probability)
any attempt to use an obsolete proxy. An obsolete proxy is called a <em>dead proxy</em>.</p>
<p>To make it possible to rapidly develop foreign code, the virtual machine supports dynamic linking
of this code. This makes it unnecessary to rebuild the virtual machine each time a small change is
made to the foreign code. Dynamic linking facilities vary from platform to platform, but the Self
interface to the linking facilities is largely system independent. The SunOS/Solaris dynamic link
interface is defined in the <code class="docutils literal"><span class="pre">sunLinker</span></code> object. However, clients should always refer to the dynamic
linking facilities by the name <code class="docutils literal"><span class="pre">linker</span></code>, which will be initialized to point to the dynamic linker interface
appropriate for the current platform.</p>
<p>The <code class="docutils literal"><span class="pre">linker</span></code>, <code class="docutils literal"><span class="pre">proxy</span></code> and <code class="docutils literal"><span class="pre">fctProxy</span></code> objects are rather low level and have only limited functionality.
For example, a fctProxy does not know which code file it is dependent on. The objects
<code class="docutils literal"><span class="pre">foreignFct</span></code> and <code class="docutils literal"><span class="pre">foreignCode</span></code> establish a higher level and easier to use interface. <code class="docutils literal"><span class="pre">A</span> <span class="pre">foreign-Code</span></code>
object represents an “object file” (a file with executable code). It defines methods for loading
and unloading the object file it represents. A <code class="docutils literal"><span class="pre">foreignFct</span></code> object represents a foreign routine. It
understands messages for calling the foreign routine and has associated with it a <code class="docutils literal"><span class="pre">foreignCode</span></code>
object. The <code class="docutils literal"><span class="pre">foreignFct</span></code> and <code class="docutils literal"><span class="pre">foreignCode</span></code> objects cooperate with the linker, to ensure that
object files are transparently loaded when necessary and that <code class="docutils literal"><span class="pre">fctProxies</span></code> depending on an object
file are killed when the object file is unloaded, etc.</p>
<p>The <code class="docutils literal"><span class="pre">foreignCodeDB</span></code> object ensures that <code class="docutils literal"><span class="pre">foreignCode</span></code> objects are unique, given a path. It also
allows for specifying initializers and finalizers on <code class="docutils literal"><span class="pre">foreignCode</span></code> objects. An initializer is a foreign
routine that is called whenever the object file is loaded. Initializers take no arguments and do not
return values. Typically, they initialize global data structures. Finalizers are called when an object
file is unloaded. When debugging foreign routines, <code class="docutils literal"><span class="pre">foreignCodeDB</span> <span class="pre">printStatus</span></code> outputs a
useful overview.</p>
<p>Normal use of a foreign routine simply involves cloning a <code class="docutils literal"><span class="pre">foreignFct</span></code> object to represent the foreign
routine. When cloning it, the name of the function and the path of the object file is specified.
It is then not necessary to worry about <code class="docutils literal"><span class="pre">proxy</span></code>, <code class="docutils literal"><span class="pre">fctProxy</span></code> and <code class="docutils literal"><span class="pre">linker</span></code> objects, etc. In fact, it is
recommended <em>not</em> to send messages directly to these objects, since this may break the higher level
invariants that <code class="docutils literal"><span class="pre">foreignFct</span></code> objects rely on.</p>
<p>Relevant oddballs:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>linker</td>
<td>Dynamic linker for current platform.</td>
</tr>
<tr class="row-even"><td>sunLinker</td>
<td>Dynamic linker implementation for SunOS/Solaris.</td>
</tr>
<tr class="row-odd"><td>foreignCodeDB</td>
<td>Registry for foreignCode objects.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Modules: foreign</p>
</div>
<span id="document-unix"></span><div class="section" id="i-o-and-unix">
<h3>4.11. I/O and Unix<a class="headerlink" href="#i-o-and-unix" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">oddball</span>
    <span class="n">unix</span>
<span class="n">clonable</span>
    <span class="n">proxy</span>
        <span class="n">unixFile</span> <span class="p">(</span><span class="n">mixes</span> <span class="ow">in</span> <span class="n">traits</span> <span class="n">unixFile</span> <span class="n">currentOsVariant</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>This page is out of date for Self 4.5.</p>
<p class="last">Start looking at the object <code class="docutils literal"><span class="pre">os</span></code> instead of <code class="docutils literal"><span class="pre">unix</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If reading from <code class="docutils literal"><span class="pre">stdin</span></code>, the <code class="docutils literal"><span class="pre">prompt</span></code> object may interfere with your
code by stealing input from you.  To avoid this, wrap calls in
<code class="docutils literal"><span class="pre">prompt</span> <span class="pre">suspendWhile:</span> <span class="pre">[</span> <span class="pre">]</span></code>, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">prompt</span> <span class="n">suspendWhile</span><span class="p">:</span> <span class="p">[</span> <span class="n">stdin</span> <span class="n">readLine</span> <span class="n">printLine</span> <span class="p">]</span>
</pre></div>
</div>
<p class="last">which will read a line from the stdin and echo it to stdout.</p>
</div>
<p>The oddball object <code class="docutils literal"><span class="pre">unix</span></code> provides access to selected Unix system calls. The most common calls
are the file operations: <code class="docutils literal"><span class="pre">creat()</span></code>, <code class="docutils literal"><span class="pre">open()</span></code>, <code class="docutils literal"><span class="pre">close()</span></code>, <code class="docutils literal"><span class="pre">read()</span></code>, <code class="docutils literal"><span class="pre">write()</span></code>, <code class="docutils literal"><span class="pre">lseek()</span></code> and <code class="docutils literal"><span class="pre">unlink()</span></code>.
<code class="docutils literal"><span class="pre">tcpConnectToHost:Port:IfFail:</span></code> opens a TCP connection. The <code class="docutils literal"><span class="pre">select()</span></code> call
and the indirect system call are also supported (taking a variable number of integer, float or byte
vector arguments, the latter being passed as C pointers). <code class="docutils literal"><span class="pre">unixFile</span></code> provides a higher level interface
to the Unix file operations. The oddball object <code class="docutils literal"><span class="pre">tty</span></code> implements terminal control facilities such
as cursor positioning and highlighting.</p>
<p>Relevant oddballs:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>stdin, stdout, stderr</td>
<td>standard Unix streams</td>
</tr>
<tr class="row-even"><td>tty</td>
<td>console terminal capabilities</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Modules: unix, stdin, tty, ttySupport, termcap</p>
</div>
<span id="document-oddball"></span><div class="section" id="other-objects">
<h3>4.12. Other Objects<a class="headerlink" href="#other-objects" title="Permalink to this headline">¶</a></h3>
<p>Here are some interesting oddball objects not discussed elsewhere:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>comparator</td>
<td>An object that can compute “diffs” between sequences.</td>
</tr>
<tr class="row-even"><td>compilerProfiling</td>
<td>Compiler profiling.</td>
</tr>
<tr class="row-odd"><td>desktop</td>
<td>The controlling object for the graphical user interface.</td>
</tr>
<tr class="row-even"><td>history</td>
<td>A history of commands typed at the prompt, and their results.</td>
</tr>
<tr class="row-odd"><td>memory</td>
<td>Memory system interface (GC, snapshot, low space, etc.).</td>
</tr>
<tr class="row-even"><td>monitor</td>
<td>System monitor (spy) control.</td>
</tr>
<tr class="row-odd"><td>nil</td>
<td>Indicates an uninitialized value.</td>
</tr>
<tr class="row-even"><td>platforms</td>
<td>Possible hardware platforms.</td>
</tr>
<tr class="row-odd"><td>preferences</td>
<td>User configuration preferences.</td>
</tr>
<tr class="row-even"><td>profiling, flatProfiling</td>
<td>Controls Self code profiling.</td>
</tr>
<tr class="row-odd"><td>prompt</td>
<td>Interactive read-eval-print loop.</td>
</tr>
<tr class="row-even"><td>scheduler</td>
<td>Self process scheduler.</td>
</tr>
<tr class="row-odd"><td>snapshotAction</td>
<td>Actions to do before/after a snapshot.</td>
</tr>
<tr class="row-even"><td>thisHost</td>
<td>Describes the current host platform.</td>
</tr>
<tr class="row-odd"><td>times</td>
<td>Reports user, system, cpu, or real time.</td>
</tr>
<tr class="row-even"><td>typeSizes</td>
<td>Bit/byte sizes for primitive types.</td>
</tr>
<tr class="row-odd"><td>vmProfiling</td>
<td>Virtual machine profiling.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<span id="document-buildworld"></span><div class="section" id="how-to-build-the-world">
<span id="building-a-world"></span><h3>4.13. How to build the world<a class="headerlink" href="#how-to-build-the-world" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Last updated 2 February 2016 for Self 4.6.0</div></blockquote>
<p>Should you need to reconstruct a world from the source files, here’s how to do it. This section describes
how to create a default object world by reading in the Self source code distributed through the <a class="reference external" href="https://github.com/russellallen/self">GitHub repository</a>. You can also do this after writing the world out using the transporter (<code class="docutils literal"><span class="pre">transporter</span> <span class="pre">fileOut</span> <span class="pre">fileOutAll</span></code>).</p>
<div class="section" id="from-within-the-main-self-tree">
<h4>4.13.1. From within the main Self tree<a class="headerlink" href="#from-within-the-main-self-tree" title="Permalink to this headline">¶</a></h4>
<p>To create the default object world, change your current working directory to the <code class="docutils literal"><span class="pre">objects</span></code> subdirectory of the Self source release and follow these steps:</p>
<ol class="arabic">
<li><p class="first">Start the Self VM:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Self</span>
<span class="n">Self</span> <span class="n">Virtual</span> <span class="n">Machine</span> <span class="n">Version</span> <span class="mf">4.1</span><span class="o">.</span><span class="mi">13</span><span class="p">,</span> <span class="n">Sat</span> <span class="mi">04</span> <span class="n">Jan</span> <span class="mi">14</span> <span class="mi">12</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">X</span> <span class="n">i386</span> <span class="p">(</span><span class="mf">4.4</span><span class="o">-</span><span class="mi">268</span><span class="o">-</span><span class="n">g58a0717</span><span class="p">)</span>
<span class="n">Copyright</span> <span class="mi">1989</span><span class="o">-</span><span class="mi">2003</span><span class="p">:</span> <span class="n">The</span> <span class="n">Self</span> <span class="n">Group</span> <span class="p">(</span><span class="nb">type</span> <span class="n">_Credits</span> <span class="k">for</span> <span class="n">credits</span><span class="p">)</span>

<span class="n">VM</span><span class="c1">#</span>
</pre></div>
</div>
</li>
<li><p class="first">(Optional, but recommended.) Start the spy so you can watch the world fill up with objects:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">VM</span><span class="c1"># _Spy: true</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must use the primitive to do this because the world is empty.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Read in the default world. To do this, ask Self to read expressions from a file:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">VM</span><span class="c1"># &#39;worldBuilder.self&#39; _RunScript</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="from-outside-the-main-tree">
<h4>4.13.2. From outside the main tree<a class="headerlink" href="#from-outside-the-main-tree" title="Permalink to this headline">¶</a></h4>
<p>When developing applications which aren&#8217;t part of the main Self distribution, it is often convenient to build a Self world from a directory other than the default directory. You can specify on the command line where the main Self distribution is and the options. For example the below builds the world with morphic and also ui1. Use <code class="docutils literal"><span class="pre">-o</span> <span class="pre">none</span></code> to build without any graphics.</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Self</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">Self</span><span class="o">/</span><span class="n">objects</span><span class="o">/</span><span class="n">worldBuilder</span><span class="o">.</span><span class="n">self</span>   \
       <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">Self</span><span class="o">/</span><span class="n">objects</span>                     \
       <span class="o">-</span><span class="n">o</span> <span class="n">morphic</span><span class="p">,</span><span class="n">ui1</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="finishing-the-build">
<h4>4.13.3. Finishing the build<a class="headerlink" href="#finishing-the-build" title="Permalink to this headline">¶</a></h4>
<p>Once you have started the <code class="docutils literal"><span class="pre">worldBuilder.self</span></code> script, you will be given options as to which features you would like in your new world.</p>
<ol class="arabic simple">
<li>Unless you have asked Self not to print script names, you should see something like:</li>
</ol>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Reading</span> <span class="n">worldBuilder</span><span class="o">.</span><span class="n">self</span><span class="o">...</span>
<span class="n">reading</span> <span class="o">./</span><span class="n">core</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">self</span><span class="o">...</span>
<span class="n">reading</span> <span class="o">./</span><span class="n">core</span><span class="o">/</span><span class="n">allCore</span><span class="o">.</span><span class="n">self</span><span class="o">...</span>
<span class="n">reading</span> <span class="o">./</span><span class="n">core</span><span class="o">/</span><span class="n">systemStructure</span><span class="o">.</span><span class="n">self</span><span class="o">...</span>
<span class="o">.</span> <span class="o">.</span> <span class="o">.</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Unless you have specified the options on the command line, then at various places, you will be asked if you wish to add optional additions to the base system, such as the morphic user interface (UI2) or the earlier UI1 (which requires X11 to run):</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>Load UI2 (Morphic)? (y/N)
&gt; y
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">After all the files have been read in, Self will start the process scheduler, initialize its module cache, and print:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>“Self 0”
</pre></div>
</div>
<p>That last line is the Self prompt indicating that the system is ready to read and evaluate expressions.</p>
</div></blockquote>
</li>
<li><p class="first">If you have loaded Morphic, you may wish to open up a window:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;Self 0&quot;</span> <span class="n">desktop</span> <span class="nb">open</span>
<span class="n">Adjusting</span> <span class="n">VM</span> <span class="k">for</span> <span class="n">better</span> <span class="n">UI2</span> <span class="n">performance</span><span class="p">:</span>
<span class="n">_MaxPICSize</span><span class="p">:</span> <span class="mi">25</span>
<span class="n">_Flush</span>

<span class="n">The</span> <span class="n">ui2</span> <span class="n">desktop</span> <span class="ow">is</span> <span class="n">now</span> <span class="n">running</span><span class="o">.</span> <span class="n">Type</span><span class="p">:</span>
<span class="s2">&quot;desktop stop&quot;</span>  <span class="n">to</span> <span class="n">suspend</span> <span class="n">it</span><span class="p">,</span>
<span class="s2">&quot;desktop go&quot;</span>    <span class="n">to</span> <span class="n">resume</span> <span class="n">it</span> <span class="n">after</span> <span class="n">stopping</span><span class="p">,</span> <span class="ow">and</span>
<span class="s2">&quot;desktop close&quot;</span> <span class="n">to</span> <span class="n">close</span> <span class="n">it</span><span class="o">.</span>

<span class="n">desktop</span>
<span class="s2">&quot;Self 1&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
</div>
<span id="document-lowlevel"></span><div class="section" id="how-to-use-the-low-level-interrupt-facilities">
<h3>4.14. How to use the low-level interrupt facilities<a class="headerlink" href="#how-to-use-the-low-level-interrupt-facilities" title="Permalink to this headline">¶</a></h3>
<p>There are two low-level ways to interrupt a running Self program <a class="footnote-reference" href="#f1" id="id1"><sup>1</sup></a> , Control-C and Control-\. The
second way works even if the Self process scheduler is not running.
In response to the interrupt, you will see one of two things. If the Self scheduler is not running,
you will be returned directly to the <code class="docutils literal"><span class="pre">VM#</span></code> prompt. If the scheduler is running, you will be presented
with a list of Self processes (the process menu):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Self</span> <span class="mi">9</span><span class="o">&gt;</span> <span class="mi">100000</span> <span class="o">*</span> <span class="mi">100000</span> <span class="n">do</span><span class="p">:</span> <span class="p">[]</span>
<span class="o">^</span><span class="n">C</span>
    <span class="o">----------------</span><span class="n">Interrupt</span><span class="o">-----------------</span>
    <span class="n">Ready</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="mi">25</span><span class="o">&gt;</span> <span class="n">scheduling</span> <span class="n">process</span> <span class="mi">100000</span> <span class="o">*</span> <span class="mi">100000</span> <span class="n">do</span><span class="p">:</span> <span class="p">[]</span>
    <span class="o">------------------------------------------</span>
    <span class="n">Select</span> <span class="n">a</span> <span class="n">process</span> <span class="p">(</span><span class="ow">or</span> <span class="n">q</span> <span class="n">to</span> <span class="n">quit</span> <span class="n">scheduler</span><span class="p">):</span> <span class="mi">25</span>
    <span class="n">Select</span> <span class="o">&lt;</span><span class="k">return</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">no</span> <span class="n">action</span>
        <span class="n">p</span> <span class="n">to</span> <span class="nb">print</span> <span class="n">the</span> <span class="n">stack</span>
        <span class="n">k</span> <span class="n">to</span> <span class="n">kill</span> <span class="n">the</span> <span class="n">process</span>
        <span class="n">b</span> <span class="n">to</span> <span class="n">resume</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">background</span>
        <span class="n">s</span> <span class="n">to</span> <span class="n">suspend</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">process</span>
    <span class="k">for</span> <span class="n">process</span> <span class="mi">25</span><span class="p">:</span> <span class="n">k</span>
    <span class="n">Process</span> <span class="mi">25</span> <span class="n">killed</span><span class="o">.</span>
    <span class="o">------------------------------------------</span>
<span class="n">Self</span> <span class="mi">10</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In this example, the loop was interrupted by typing Control-C, and the process menu was used to
abort the process. If the user had typed “q” to quit the scheduler, all current processes would have
been aborted along with the scheduler itself:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="o">...</span>
    <span class="o">------------------------------------------</span>
    <span class="n">Select</span> <span class="n">a</span> <span class="n">process</span> <span class="p">(</span><span class="ow">or</span> <span class="n">q</span> <span class="n">to</span> <span class="n">quit</span> <span class="n">scheduler</span><span class="p">):</span> <span class="n">q</span>
    <span class="n">Scheduler</span> <span class="n">shut</span> <span class="n">down</span><span class="o">.</span>
    <span class="o">------------------------------------------</span>
<span class="n">prompt</span>
<span class="n">VM</span><span class="c1">#</span>
</pre></div>
</div>
<p>The scheduler has been stopped, returning the user to the VM# prompt. The command prompt
start restarts the scheduler:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">VM</span><span class="c1"># prompt start</span>
<span class="n">Self</span> <span class="mi">11</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Although the VM# prompt can be used to evaluate expressions directly, the scheduler supports
much nicer error messages and debugging, so it is usually best to run the scheduler. (The scheduler
is started automatically when the default world is created.)</p>
<p>Certain virtual machine operations like garbage collection, reading a snapshot, and compilation
cannot be interrupted; interrupts during these operations will be deferred until the operation is
complete. As a last resort (e.g., if the system appears to be “hung”), you can force an abort by
pressing Control-\ five times in a row.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Normally, you would use debugging facilities provided in the programming environment.</td></tr>
</tbody>
</table>
</div>
<span id="document-textdebug"></span><div class="section" id="using-the-textual-debugger">
<h3>4.15. Using the textual debugger<a class="headerlink" href="#using-the-textual-debugger" title="Permalink to this headline">¶</a></h3>
<p>If you are modifying the core of the programming environment or working without the environment
you may need to use the textual debugger. After attaching the aborted process to the debugger
using the shell command attach, these commands are available:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Command</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>attach: n</td>
<td>attach the process with object reference number n</td>
</tr>
<tr class="row-odd"><td>detach</td>
<td>detach the debugged process</td>
</tr>
<tr class="row-even"><td>step[:n]</td>
<td>execute (n) non trivial bytecodes <sup>*</sup></td>
</tr>
<tr class="row-odd"><td>stepi[:n]</td>
<td>execute (n) bytecodes</td>
</tr>
<tr class="row-even"><td>next[:n]</td>
<td>execute (n) non trivial bytecodes in the current activation</td>
</tr>
<tr class="row-odd"><td>nexti[:n]</td>
<td>execute (n) bytecodes in the current activation</td>
</tr>
<tr class="row-even"><td>finish</td>
<td>finish executing the current activation</td>
</tr>
<tr class="row-odd"><td>cont</td>
<td>continue execution</td>
</tr>
<tr class="row-even"><td>trace</td>
<td>print out a stack trace of the process</td>
</tr>
<tr class="row-odd"><td>show</td>
<td>display the current activation</td>
</tr>
<tr class="row-even"><td>show: n</td>
<td>go to and display the nth activation on the stack</td>
</tr>
<tr class="row-odd"><td>status</td>
<td>display the status of the debugged process</td>
</tr>
<tr class="row-even"><td>up[: n]</td>
<td>go up (n) activation(s)</td>
</tr>
<tr class="row-odd"><td>upLex</td>
<td>go up to the lexical enclosing scope of this activation</td>
</tr>
<tr class="row-even"><td>down[: n]</td>
<td>go down (n) activation(s)</td>
</tr>
<tr class="row-odd"><td>lookup: &lt;name&gt;</td>
<td>lookup the given name in the context of the current activation</td>
</tr>
</tbody>
</table>
<p>* A bytecode is trivial if it is a push of a literal or a send to a slot residing in
the lexical scope of the current activation.</p>
</div></blockquote>
</div>
<span id="document-logging"></span><div class="section" id="logging">
<h3>4.16. Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">log</span></code> is a useful system-wide logging mechanism. You can find it in the <code class="docutils literal"><span class="pre">system</span></code> category of <code class="docutils literal"><span class="pre">globals</span></code>.</p>
<div class="section" id="how-to-log">
<h4>4.16.1. How to log<a class="headerlink" href="#how-to-log" title="Permalink to this headline">¶</a></h4>
<p>There are a number of useful messages in the <code class="docutils literal"><span class="pre">logging</span></code> category of <code class="docutils literal"><span class="pre">log</span></code> which allow you to simply and cleanly log messages. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="n">warn</span><span class="p">:</span> <span class="s1">&#39;This is a warning.&#39;</span>
</pre></div>
</div>
<p>You can log with one of five levels found at <code class="docutils literal"><span class="pre">log</span> <span class="pre">levels</span></code>. These are, in order of severity, <code class="docutils literal"><span class="pre">debug</span></code>, <code class="docutils literal"><span class="pre">info</span></code>, <code class="docutils literal"><span class="pre">warn</span></code>, <code class="docutils literal"><span class="pre">error</span></code>, <code class="docutils literal"><span class="pre">fatal</span></code>.</p>
<p>You can also tag log entries, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="n">fatal</span><span class="p">:</span> <span class="s1">&#39;The server has caught fire&#39;</span> <span class="n">For</span><span class="p">:</span> <span class="s1">&#39;webserver&#39;</span>
</pre></div>
</div>
<p>By default, entries of either error or fatal severity which aren&#8217;t tagged are logged to stderr in the form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>[Thu Oct 23 16:25:07 2014] error -- Something went wrong!
</pre></div>
</div>
</div>
<div class="section" id="how-logging-works">
<h4>4.16.2. How logging works<a class="headerlink" href="#how-logging-works" title="Permalink to this headline">¶</a></h4>
<p>The helper methods shown above constuct a <code class="docutils literal"><span class="pre">log</span> <span class="pre">entry</span></code> and hand it to the <code class="docutils literal"><span class="pre">log</span> <span class="pre">dispatcher</span></code>. The dispatcher has a number of handlers, each is given a chance to handle the log entry. The handlers can choose which entries to act on. Example handlers are in <code class="docutils literal"><span class="pre">log</span> <span class="pre">prototypeHandlers</span></code>.</p>
<p>When making a handler, please keep in mind that the log entry&#8217;s <code class="docutils literal"><span class="pre">message</span></code> is expected to be something which understands <code class="docutils literal"><span class="pre">value</span></code>, returning an object (or itself) which understands <code class="docutils literal"><span class="pre">asString</span></code>. If you do not need to resolve the message by sending it <code class="docutils literal"><span class="pre">value</span></code> please don&#8217;t; that way logs can be sent blocks which are only resolved if necessary; eg:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="n">debug</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;We have reached: &#39;</span><span class="p">,</span> <span class="n">somethingComplicatedToCalculate</span><span class="p">]</span>
</pre></div>
</div>
<p>will not slow down your code if no log handler is interested in handling debuggers.</p>
<p>If your handler breaks the logging process you can restart it by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="n">dispatcher</span> <span class="n">hup</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-progguid"></span><div class="section" id="a-guide-to-programming-style">
<h2>5. A Guide to Programming Style<a class="headerlink" href="#a-guide-to-programming-style" title="Permalink to this headline">¶</a></h2>
<p>This section discusses some programming idioms and stylistic conventions that have evolved in the
Self group. Rather than simply presenting a set of rules, an attempt has been made to explain the
reasons for each stylistic convention. While these conventions have proven useful to the Self
group, they should be taken as guidelines, not commandments. Self is still a young language, and
it is likely that its users will continue to discover new and better ways to use it effectively.</p>
<div class="section" id="behaviorism-versus-reflection">
<h3>5.1. Behaviorism versus Reflection<a class="headerlink" href="#behaviorism-versus-reflection" title="Permalink to this headline">¶</a></h3>
<p>One of the central principles of Self is that an object is completely defined by its behavior: that
is, how it responds to messages. This idea, which is sometimes called <em>behaviorism</em>, allows one object
to be substituted for another without ill effect—provided, of course, that the new object’s behavior
is similar enough to the old object’s behavior. For example, a program that plots points in a
plane should not care whether the points being plotted are represented internally in cartesian or polar
coordinates as long as their external behavior is the same. Another example arises in program
animation. One way to animate a sorting algorithm is to replace the collection being sorted with an
object that behaves like the original collection but, as a side effect, updates a picture of itself on the
screen each time two elements are swapped. behaviorism makes it easier to extend and reuse programs,
perhaps even in ways that were not anticipated by the program’s author.</p>
<p>It is possible, however, to write non-behavioral programs in Self. For example, a program that examines
and manipulates the slots of an object <em>directly</em>, rather than via messages, is not behavioral
since it is sensitive to the internal representation of the object. Such programs are called <em>reflective</em>,
because they are reflecting on the objects and using them as data, rather than using the objects to
represent something else in the world. Reflection is used to talk about an object rather that talking
to it. In Self, this is done with objects called <em>mirrors</em>. There are times when reflection is unavoidable.
For example, the Self programming environment is reflective, since its purpose is to let the
programmer examine the structure of objects, an inherently reflective activity. Whenever possible,,
however, reflective techniques should be avoided as a matter of style, since a reflective program
may fail if the internal structure of its objects changes. This places constraints on the situations in
which the reflective program can be reused, limiting opportunities for reuse and making program
evolution more difficult. Furthermore, reflective programs are not as amenable to automatic analysis
tools such as application extractors or type inferencers.</p>
<p>Programs that depend on object <em>identity</em> are also reflective, although this may not be entirely obvious.
For example, a program that tests to see if an object is identical to the object <code class="docutils literal"><span class="pre">true</span></code> may not
behave as expected if the system is later extended to include fuzzy logic objects. Thus, like reflection,
it is best to avoid using object identity. One exception to this guideline is worth mentioning.
When testing to see if two collections are equal, observing that the collections are actually the
same object can save a tedious element-by-element comparison. This trick is used in several places
in the Self world. Note, however, that object identity is used only as a hint; the correct result will
still be computed, albeit more slowly, if the collections are equal but not identical.</p>
<p>Sometimes the implementation of a program requires reflection. Suppose one wanted to write a
program to count the number of unique objects in an arbitrary collection. The collection could, in
general, contain objects of different, possibly incomparable, types. In Smalltalk, one would use an
IdentitySet to ensure that each object was counted exactly once. IdentitySets are reflective, since
they use identity comparisons. In Self, the preferred way to solve this problem is to make the reflection
explicit by using mirrors. Rather than adding objects to an IdentitySet, mirrors on the objects
would be added to an ordinary set. This substitution works because two mirrors are equal if
and only if their reflectees are identical.</p>
<p>In short, to maximize the opportunities for code reuse, the programmer should:</p>
<blockquote>
<div><ul class="simple">
<li>avoid reflection when possible,</li>
<li>avoid depending on object identity except as a hint, and</li>
<li>use mirrors to make reflection explicit when it is necessary.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="objects-have-many-roles">
<h3>5.2. Objects Have Many Roles<a class="headerlink" href="#objects-have-many-roles" title="Permalink to this headline">¶</a></h3>
<p>Objects in Self have many roles. Primarily, of course, they are the elements of data and behavior
in programs. But objects are also used to factor out shared behavior, to represent unique objects, to
organize objects and behavior, and to implement elegant control structures. Each of these uses are
described below.</p>
<div class="section" id="shared-behavior">
<h4>5.2.1. Shared Behavior<a class="headerlink" href="#shared-behavior" title="Permalink to this headline">¶</a></h4>
<p>Sometimes a set of objects should have the same behavior for a set of messages. The slots defining
this <em>shared behavior</em> could be replicated in each object but this makes it difficult to ensure the objects
continue to share the behavior as the program evolves, since the programmer must remember
to apply the same changes to all the objects sharing the behavior. Factoring out the shared behavior
into a separate object allows the programmer to change the behavior of the entire set of objects simply
by changing the one object that implements the shared behavior. The objects that share the
behavior inherit it via parent slots containing (references to) the shared behavior object.</p>
<p>By convention, two kinds of objects are used to hold shared behavior: <em>traits</em> and <em>mixins</em>. A traits
object typically has a chain of ancestors rooted in the lobby. A mixin object typically has no parents,
and is meant to be used as an additional parent for some object that already inherits from the
lobby.</p>
</div>
<div class="section" id="one-of-a-kind-objects-oddballs">
<h4>5.2.2. One-of-a-kind Objects (Oddballs)<a class="headerlink" href="#one-of-a-kind-objects-oddballs" title="Permalink to this headline">¶</a></h4>
<p>Some objects, such as the object <code class="docutils literal"><span class="pre">true</span></code>, are unique; it is only necessary to have one of them in the
system. (It may even be important that the system contain <em>exactly</em> one of some kind of object.) Objects
playing the role of unique objects are called <em>oddballs</em>. Because there is no need to share the
behavior of an oddball among many instances, there is no need for an oddball to have separate
traits and prototype objects. Many oddballs inherit a <code class="docutils literal"><span class="pre">copy</span></code> method from <code class="docutils literal"><span class="pre">traits</span> <span class="pre">oddball</span></code> that
returns the object itself rather than a new copy, and most oddballs inherit the global namespace and
default behavior from the lobby.</p>
</div>
<div class="section" id="inline-objects">
<h4>5.2.3. Inline Objects<a class="headerlink" href="#inline-objects" title="Permalink to this headline">¶</a></h4>
<p>An inline object is an object that is nested in the code of a method object. The inline object is usually
intended for localized use within a program. For example, in a finite state machine implementation,
the state of the machine might be encoded in a selector that would be sent to an inline object
to select the behavior for the next state transition:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="n">sendTo</span><span class="p">:</span> <span class="p">(</span><span class="o">|</span>
        <span class="n">inComment</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="p">[</span><span class="n">state</span><span class="p">:</span> <span class="s1">&#39;inCode&#39;</span><span class="p">]</span><span class="o">.</span> <span class="bp">self</span> <span class="p">)</span><span class="o">.</span>
        <span class="n">inCode</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="p">[</span><span class="n">state</span><span class="p">:</span> <span class="s1">&#39;inComment&#39;</span><span class="p">]</span>
                <span class="kc">False</span><span class="p">:</span> <span class="o">...</span> <span class="p">)</span>
    <span class="o">|</span><span class="p">)</span>
    <span class="n">With</span><span class="p">:</span> <span class="n">nextChar</span>
</pre></div>
</div>
<p>In this case, the inline object is playing the role of a case statement.</p>
<p>Another use of inline objects is to return multiple values from a method, as discussed in section
<a class="reference internal" href="#how-to-return-multiple-values"><span class="std std-ref">5.4</span></a> <a class="reference internal" href="#id2">How to Return Multiple Values</a>. Yet another use of inline objects
is to parameterize the behavior of some other object. For example, the predicate used to order objects
in a <em>priorityQueue</em> can be specified using an inline object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">queue</span><span class="p">:</span> <span class="n">priorityQueue</span> <span class="n">copyRemoveAll</span><span class="o">.</span>
<span class="n">queue</span> <span class="n">sorter</span><span class="p">:</span> <span class="p">(</span><span class="o">|</span> <span class="n">element</span><span class="p">:</span> <span class="n">e1</span> <span class="n">Precedes</span><span class="p">:</span> <span class="n">e2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">e1</span> <span class="o">&gt;</span> <span class="n">e2</span> <span class="p">)</span> <span class="o">|</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>(A block cannot be used here because the current implementation of Self does not support non-
LIFO blocks, and the sorter object may outlive the method that creates it). There are undoubtedly
other uses of inline objects. Inline objects do not generally inherit from the lobby.</p>
</div>
</div>
<div class="section" id="naming-and-printing">
<h3>5.3. Naming and Printing<a class="headerlink" href="#naming-and-printing" title="Permalink to this headline">¶</a></h3>
<p>When debugging or exploring in the Self world, one often wants to answer the question: “what is
that object?” The Self environment provides two ways to answer that question. First, many objects
respond to the <code class="docutils literal"><span class="pre">printString</span></code> message with a textual description of themselves. This string
is called the object’s <em>printString</em>. An object’s printString can be quite detailed; standard protocol
allows the desired amount of detail to be specified by the requestor. For example, the printString
for a collection might include the printStrings of all elements or just the first few. Not all objects
have printStrings, only those that satisfy the criteria discussed in section <a class="reference internal" href="#how-to-make-an-object-print"><span class="std std-ref">5.3.2</span></a>
<a class="reference internal" href="#id1">How to make an object print</a> below.</p>
<p>The second way to describe an object is to give its <em>path name</em>. A path name is a sequence of unary
selectors that describes a path from the lobby to the object. For example, the full path name of the
prototype list is “globals list.” A path name is also an expression that can be evaluated (in the context
of the lobby) to produce the object. Because “globals” is a parent slots, it can be omitted from
this path name expression. Doing this yields the short path name “list.” Not all objects have path
names, only those that can be reached from the lobby. Such objects are called <em>well-known</em>.</p>
<div class="section" id="how-objects-are-printed">
<h4>5.3.1. How objects are printed<a class="headerlink" href="#how-objects-are-printed" title="Permalink to this headline">¶</a></h4>
<p>When an expression is typed at the prompt, it is evaluated to produce a result object. The prompt
then creates a mirror on this result object and asks the mirror to produce a name for the object. (A
mirror is used because naming is reflective.) The object’s creator path annotation provides a hint
about the path from the lobby to either the object itself or its prototype. If the object is a clone “a”
or “an” is prepended to its prototype’s creator path. In addition to its path, the mirror also tries to
compute a <code class="docutils literal"><span class="pre">printString</span></code> for the object if it is annotated as <code class="docutils literal"><span class="pre">isComplete</span></code>. Then, the two pieces of
information are merged. For example, the name of the prototype list is “list” but the name of <code class="docutils literal"><span class="pre">list</span> <span class="pre">copy</span> <span class="pre">add:</span> <span class="pre">17</span></code>
is “a list(17).” See the naming category in mirror traits for the details of this process.</p>
</div>
<div class="section" id="how-to-make-an-object-print">
<span id="id1"></span><h4>5.3.2. How to make an object print<a class="headerlink" href="#how-to-make-an-object-print" title="Permalink to this headline">¶</a></h4>
<p>The distinction between objects that hold shared behavior (traits and mixin objects) and concrete
objects (prototypes, copies of prototypes, and oddballs) is purely a matter of convention; the Self
language makes no such distinction. While this property (not having special kinds of objects) gives
Self great flexibility and expressive power, it leads to an interesting problem: the inability to distinguish
behavior that is ready for immediate use from that which is defined only for the benefit of
descendant objects. Put another way: Self cannot distinguish those objects playing the role of
classes from those playing the role of instances.</p>
<p>The most prominent manifestation of this problem crops up in object printing. Suppose one wishes
to provide the following printString method for all point objects:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>printString = ( x printString, ’@’, y printString )
</pre></div>
</div>
<p>Like other behavior that applies to all points, the method should be put in point traits. But what
happens if <code class="docutils literal"><span class="pre">printString</span></code> is sent to the object <code class="docutils literal"><span class="pre">traits</span> <span class="pre">point</span></code>? The <code class="docutils literal"><span class="pre">printString</span></code> method is
found but it fails when it attempts to send x and y to itself because these slots are only defined in
point objects (not the <code class="docutils literal"><span class="pre">traits</span> <span class="pre">point</span></code> object). Of course there are many other messages defined in
<code class="docutils literal"><span class="pre">traits</span> <span class="pre">point</span></code> that would also fail if they were sent to <code class="docutils literal"><span class="pre">traits</span> <span class="pre">point</span></code> rather than to a point
object. The reason printing is a bigger problem is that it is useful to have a general object printing
facility to be used during debugging and system exploration. To be as robust as possible, this printing
facility should not send <code class="docutils literal"><span class="pre">printString</span></code> when it will fail. Unfortunately, it is difficult to tell
when <code class="docutils literal"><span class="pre">printString</span></code> is likely to fail. Using reflection, the facility can avoid sending
<code class="docutils literal"><span class="pre">printString</span></code> to objects that do not define <code class="docutils literal"><span class="pre">printString</span></code>. But that is not the case with <code class="docutils literal"><span class="pre">traits</span> <span class="pre">point</span></code>.
The solution taken in this version of the system is to mark printable objects with a special
annotation. The printing facility sends <code class="docutils literal"><span class="pre">printString</span></code> to the object only if the object contains an
annotation <code class="docutils literal"><span class="pre">isComplete</span></code>.</p>
<p>The existence of an <code class="docutils literal"><span class="pre">isComplete</span></code> annotation in an object means that the object is prepared to print
itself. The object agrees to provide behavior for a variety of messages; see the programming environment
manual for more details.</p>
</div>
</div>
<div class="section" id="how-to-return-multiple-values">
<span id="id2"></span><h3>5.4. How to Return Multiple Values<a class="headerlink" href="#how-to-return-multiple-values" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is natural to think of a method as returning several values, even though Self only
allows a method to return a single object. There are two ways to simulate methods that return
multiple values. The first way is to use an inlined object. For example, the object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">|</span> <span class="n">p</span><span class="o">*</span> <span class="o">=</span> <span class="n">lobby</span><span class="o">.</span> <span class="n">lines</span><span class="o">.</span> <span class="n">words</span><span class="o">.</span> <span class="n">characters</span> <span class="o">|</span><span class="p">)</span>
</pre></div>
</div>
<p>could be used to package the results of a text processing method into a single result object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">|</span> <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="o">|</span> <span class="n">p</span><span class="o">*</span> <span class="o">=</span> <span class="n">lobby</span><span class="o">.</span> <span class="n">lines</span><span class="o">.</span> <span class="n">words</span><span class="o">.</span> <span class="n">characters</span> <span class="o">|</span><span class="p">)</span> <span class="o">...</span> <span class="o">|</span>
    <span class="o">...</span>
    <span class="n">r</span><span class="p">:</span> <span class="n">r</span> <span class="n">copy</span><span class="o">.</span>
    <span class="n">r</span> <span class="n">lines</span><span class="p">:</span> <span class="n">lCount</span><span class="o">.</span> <span class="n">r</span> <span class="n">words</span><span class="p">:</span> <span class="n">wCount</span><span class="o">.</span> <span class="n">r</span> <span class="n">characters</span><span class="p">:</span> <span class="n">cCount</span><span class="o">.</span>
    <span class="n">r</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">that the inline object prototype inherits copy from the lobby. If one omitted its parent slot <code class="docutils literal"><span class="pre">p</span></code>, one would have to
send it the <code class="docutils literal"><span class="pre">_Clone</span></code> primitive to copy it. It is considered bad style, however, to send a primitive directly,
rather than calling the primitive’s wrapper method.</p>
</div>
<p>The sender can extract the various return values from the result object by name.</p>
<p>The second way is to pass in one block for each value to be returned. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">countLines</span><span class="p">:[</span><span class="o">|</span> <span class="p">:</span><span class="n">n</span> <span class="o">|</span> <span class="n">lines</span><span class="p">:</span> <span class="n">n</span> <span class="p">]</span>
    <span class="n">Words</span><span class="p">:[</span><span class="o">|</span> <span class="p">:</span><span class="n">n</span> <span class="o">|</span> <span class="n">words</span><span class="p">:</span> <span class="n">n</span> <span class="p">]</span>
    <span class="n">Characters</span><span class="p">:[</span><span class="o">|</span> <span class="p">:</span><span class="n">n</span> <span class="o">|</span> <span class="n">characters</span><span class="p">:</span> <span class="n">n</span> <span class="p">]</span>
</pre></div>
</div>
<p>Each block simply stores its argument into the a local variable for later use. The
<code class="docutils literal"><span class="pre">countLines:Words:Characters:</span></code> method would evaluate each block with the appropriate
value to be returned:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">countLines</span><span class="p">:</span> <span class="n">lb</span> <span class="n">Words</span><span class="p">:</span> <span class="n">wb</span> <span class="n">Characters</span><span class="p">:</span> <span class="n">cb</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span>
    <span class="n">lb</span> <span class="n">value</span><span class="p">:</span> <span class="n">lineCount</span><span class="o">.</span>
    <span class="n">wb</span> <span class="n">value</span><span class="p">:</span> <span class="n">wordCount</span><span class="o">.</span>
    <span class="n">cb</span> <span class="n">value</span><span class="p">:</span> <span class="n">charCount</span><span class="o">.</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="substituting-values-for-blocks">
<h3>5.5. Substituting Values for Blocks<a class="headerlink" href="#substituting-values-for-blocks" title="Permalink to this headline">¶</a></h3>
<p>The lobby includes behavior for the block evaluation messages. Thus, any object that inherits from
the lobby can be passed as a parameter to a method that expects a block — the object behaves like
a block that evaluates that object. For example, one may write:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="n">x</span> <span class="kc">False</span><span class="p">:</span> <span class="n">x</span> <span class="n">negate</span>
</pre></div>
</div>
<p>rather than:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="p">[</span> <span class="n">x</span> <span class="p">]</span> <span class="kc">False</span><span class="p">:</span> <span class="p">[</span> <span class="n">x</span> <span class="n">negate</span> <span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">however, that Self evaluates all arguments before sending a message. Thus, in the first case
<code class="docutils literal"><span class="pre">x</span> <span class="pre">negate</span></code> will be evaluated regardless of the value of <code class="docutils literal"><span class="pre">x</span></code>, even though that argument will not be
used if <code class="docutils literal"><span class="pre">x</span></code> is nonnegative. In this case, it doesn’t matter, but if <code class="docutils literal"><span class="pre">x</span> <span class="pre">negate</span></code> had side effects,
or if it were very expensive, it would be better to use the second form.</p>
</div>
<p>In a similar vein, blocks inherit default behavior that allows one to provide a block taking fewer
arguments than expected. For example, the collection iteration message <code class="docutils literal"><span class="pre">do:</span></code> expects a block taking
two arguments: a collection element and the key at which that element is stored. If one is only
interested in the elements, not the keys, one can provide a block taking only one argument and the
second block argument will simply be ignored. That is, you can write:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myCollection</span> <span class="n">do</span><span class="p">:</span> <span class="p">[</span><span class="o">|</span> <span class="p">:</span><span class="n">el</span> <span class="o">|</span> <span class="n">el</span> <span class="n">printLine</span><span class="p">]</span>
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myCollection</span> <span class="n">do</span><span class="p">:</span> <span class="p">[</span><span class="o">|</span> <span class="p">:</span><span class="n">el</span><span class="o">.</span> <span class="p">:</span><span class="n">key</span> <span class="o">|</span> <span class="n">el</span> <span class="n">printLine</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="nil-considered-naughty">
<h3>5.6. <code class="docutils literal"><span class="pre">nil</span></code> Considered Naughty<a class="headerlink" href="#nil-considered-naughty" title="Permalink to this headline">¶</a></h3>
<p>As in Lisp, Self has an object called <code class="docutils literal"><span class="pre">nil</span></code>, which denotes an undefined value. The virtual machine
initializes any uninitialized slots to this value. In Lisp, many programs test for <code class="docutils literal"><span class="pre">nil</span></code> to find the end
of a list, or an empty slot in a hash table, or any other undefined value. There is a better way in
Self. Instead of testing an object’s identity against <code class="docutils literal"><span class="pre">nil</span></code>, define a new object with the appropriate
behavior and simply send messages to this object; Self’s dynamic binding will do the rest. For example,
in a graphical user interface, the following object might be used instead of <code class="docutils literal"><span class="pre">nil</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nullGlyph</span> <span class="o">=</span> <span class="p">(</span><span class="o">|</span>
        <span class="n">display</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">)</span><span class="o">.</span>
        <span class="n">boundingBox</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="nd">@0</span><span class="p">)</span> <span class="c1"># (0@0).</span>
        <span class="n">mouseSensitive</span> <span class="o">=</span> <span class="n">false</span><span class="o">.</span>
<span class="o">|</span><span class="p">)</span>
</pre></div>
</div>
<p>To make it easier to avoid <code class="docutils literal"><span class="pre">nil</span></code>, the methods that create new vectors allow you to supply an alternative
to <code class="docutils literal"><span class="pre">nil</span></code> as the initial value for the new vector’s elements (e.g., <code class="docutils literal"><span class="pre">copySize:FillingWith:</span></code>).</p>
</div>
<div class="section" id="hash-and">
<h3>5.7. Hash and =<a class="headerlink" href="#hash-and" title="Permalink to this headline">¶</a></h3>
<p>Sets and dictionaries are implemented using hash tables. In order for an object to be eligible for inclusion
in a set or used as a key in a dictionary, it must implement both <code class="docutils literal"><span class="pre">=</span></code> and <code class="docutils literal"><span class="pre">hash</span></code>. (<code class="docutils literal"><span class="pre">hash</span></code> maps
an object to a <code class="docutils literal"><span class="pre">smallInt</span></code>.) Further, <code class="docutils literal"><span class="pre">hash</span></code> must be implemented in such a way that for objects <code class="docutils literal"><span class="pre">a</span></code> and
<code class="docutils literal"><span class="pre">b</span></code>, (<code class="docutils literal"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">b</span></code>) implies (<code class="docutils literal"><span class="pre">a</span> <span class="pre">hash</span> <span class="pre">=</span> <span class="pre">b</span> <span class="pre">hash</span></code>). The behavior that sets disallow duplicates and
dictionaries disallow multiple entries with the same key is dependent upon the correct implementation
of hash for their elements and keys. Finally, the implementation of sets (and dictionaries)
will only work if the hash value of the objects in the set do not change while the objects are in the
set (dictionary). This may complicate managing sets of mutable objects, since if the hash value
depends on the mutable state, the objects can not be allowed to mutate while in the set.</p>
<p>Of course, a trivial hash function would simply return a constant regardless of the contents of the
object. However, for good hash table performance, the hash function should map different objects
to different values, ideally distributing possible object values as uniformly as possible across the
range of small integers.</p>
</div>
<div class="section" id="equality-identity-and-indistinguishability">
<h3>5.8. Equality, Identity, and Indistinguishability<a class="headerlink" href="#equality-identity-and-indistinguishability" title="Permalink to this headline">¶</a></h3>
<p><em>Equality</em>, <em>identity</em>, and <em>indistinguishability</em> are three related concepts that are often confused. Two
objects are <em>equal</em> if they “mean the same thing”. For example, <code class="docutils literal"><span class="pre">3</span> <span class="pre">=</span> <span class="pre">3.0</span></code> even though they are different
objects and have different representations. Two objects are <em>identical</em> if and only if they are
the same object. (Or, more precisely, two references are identical if they refer to the same object.)
The primitive <code class="docutils literal"><span class="pre">_Eq:</span></code> tests if two objects are identical. Finally, two objects are <em>indistinguishable</em> if
they have exactly the same behavior for every possible sequence of non-reflective messages. The
binary operator “==” tests for indistinguishability. Identity implies indistinguishability which implies
equality.</p>
<p>It is actually not possible to guarantee that two different objects are indistinguishable, since reflection
could be used to modify one of the objects to behave differently after the indistinguisability
test was made. Thus, == is defined to mean identity by default. Mirrors, however, override this default
behavior; (<code class="docutils literal"><span class="pre">m1</span> <span class="pre">==</span> <span class="pre">m2</span></code>) if (<code class="docutils literal"><span class="pre">m1</span> <span class="pre">reflectee</span> <span class="pre">_Eq:</span> <span class="pre">m2</span> <span class="pre">reflectee</span></code>). This makes it appear
that there is at most one mirror object for each object in the system. This illusion would break
down, however, if one added mutable state to mirror objects.</p>
</div>
</div>
<span id="document-howtoprg"></span><div class="section" id="how-to-program-in-self">
<h2>6. How to Program in Self<a class="headerlink" href="#how-to-program-in-self" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>6.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>The Self programming environment provides facilities for writing programs, and the transporter
provides a way to save them as source files. Of all the parts of Self, the programming environment
probably has the least research ambition in it. We simply needed to concentrate the innovation in
other areas: language design, compiler technology, user interface. The Self programming environment
strives to meet the high standard set by Smalltalk’s, but with a more concrete feels. The transporter,
on the other hand, is somewhere in-between completely innovative research and dull
development. It attempts to pull off a novel feat—programming live objects instead of text—and
partially succeeds. Its novelty lies in its view of programs as collections of slots, not objects or
classes, and its extraction of the programmer&#8217;s intentions from a web of live objects.</p>
<p>On the Macintosh, Self uses option-click for a middle-mouse click, and uses command- (the apple
key) click for the right button click. So wherever the text says “left-button-click” just click with the
mouse, where it says “middle-button click” hold down the option key and click with the mouse,
and where it says “right button click” hold down the command key and click with the mouse.
These mappings are defined in Self, so you can change them by editing the <code class="docutils literal"><span class="pre">whichButton:</span></code> method in the <code class="docutils literal"><span class="pre">initialization</span></code>
category in traits <code class="docutils literal"><span class="pre">ui2MacEvent</span></code>.</p>
</div>
<div class="section" id="browsing-concepts">
<h3>6.2. Browsing Concepts<a class="headerlink" href="#browsing-concepts" title="Permalink to this headline">¶</a></h3>
<div class="section" id="introducing-the-outliner">
<h4>6.2.1. Introducing the Outliner<a class="headerlink" href="#introducing-the-outliner" title="Permalink to this headline">¶</a></h4>
<p>Objects in the Self environment are represented as <em>outliners</em>, which can expand to show increasing
levels of detail. One of these objects has been designed to provide a convenient context
for typed-in commands, and so it is called the shell. If the shell is not already present on your
screen, you can summon it by pressing the middle mouse button on the background and selecting
<code class="docutils literal"><span class="pre">shell</span></code>.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image1.png"><img alt="_images/Pgm_Env_Image1.png" src="_images/Pgm_Env_Image1.png" style="width: 174.4px; height: 60.8px;" /></a>
</div>
<p>Outliners sport three small buttons in the top-right-hand corner labeled “/\”, “E”,
and “X”. These buttons summon the object’s parents, add an evaluator text region to the bottom of
the outliner, and dismiss the outliner. Press the “E” button to get an evaluator.</p>
<p>Type <code class="docutils literal"><span class="pre">anExampleObject</span></code> into the evaluator (it will already be selected) and hit the <em>Get it</em> button
(or type metareturn on UNIX, or command-return on MacOS X):</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image2.png"><img alt="_images/Pgm_Env_Image2.png" src="_images/Pgm_Env_Image2.png" style="width: 273.6px; height: 164.0px;" /></a>
</div>
<p>The result object appears in your “hand” raised above the screen as if you were dragging it with the
left button.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If this returns an error, it may be that you don&#8217;t have <code class="docutils literal"><span class="pre">anExampleObject</span></code> in your Self world. You can always load it from the file <code class="docutils literal"><span class="pre">objects/misc/programmingExamples.self</span></code> as follows:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="s1">&#39;path/to/objects/misc/programmingExamples.self&#39;</span> <span class="n">runScript</span>
</pre></div>
</div>
</div>
<p>Click the button to set it down.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image3.png"><img alt="_images/Pgm_Env_Image3.png" src="_images/Pgm_Env_Image3.png" style="width: 280.0px; height: 56.0px;" /></a>
</div>
<p>As with most other things on the Self screen, the left button picks it up and moves it. (For buttons
and other things that use left-button for other purposes, you can grab them with marquee selection
(really the <em>carpet morph</em> in Self) or with the “Grab” item on the right-button menu.)</p>
<div class="section" id="expand-and-collapse">
<h5>6.2.1.1. Expand and Collapse<a class="headerlink" href="#expand-and-collapse" title="Permalink to this headline">¶</a></h5>
<p>Left-click on the triangle <a class="footnote-reference" href="#f1" id="id1"><sup>1</sup></a> to expand the object and see more information:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image4.png"><img alt="_images/Pgm_Env_Image4.png" src="_images/Pgm_Env_Image4.png" style="width: 524.8px; height: 193.6px;" /></a>
</div>
<p>Now it shows a summary of modules containing the slots in this object (just <code class="docutils literal"><span class="pre">programmingExamples</span></code>
here), four slots, and a category containing more slots, although those slots are not shown
yet.</p>
</div>
<div class="section" id="categories">
<h5>6.2.1.2. Categories<a class="headerlink" href="#categories" title="Permalink to this headline">¶</a></h5>
<p>Clicking the top triangle now would collapse this object outliner, but instead look inside the category
by clicking its triangle:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image5.png"><img alt="_images/Pgm_Env_Image5.png" src="_images/Pgm_Env_Image5.png" style="width: 520.8px; height: 286.4px;" /></a>
</div>
<p>And, one more click expands the subcategory:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image6.png"><img alt="_images/Pgm_Env_Image6.png" src="_images/Pgm_Env_Image6.png" style="width: 528.0px; height: 315.2px;" /></a>
</div>
</div>
<div class="section" id="slots">
<h5>6.2.1.3. Slots<a class="headerlink" href="#slots" title="Permalink to this headline">¶</a></h5>
<p>The little icons on the right edges of the slots reveal the type of slot: <img alt="methodslot" src="_images/methodslot.png" /> for a method slot (a slot
containing a method), <img alt="constantslot" src="_images/constantslot.png" /> for a constant slot (a slot containing a data object), and <img alt="assignableslot" src="_images/assignableslot.png" /> for an assignable
slot (a pair of slots containing a data object and the assignment primitive). In order to save
space, the data slot and its corresponding assignment slot are lumped together. (In other words in
addition to the visible slot named <code class="docutils literal"><span class="pre">aCategorizedVariable</span></code> containing 17, there is another, <em>invisible</em>
slot named <code class="docutils literal"><span class="pre">aCategorizedVariable</span></code>: containing the assignment primitive.)</p>
<p>To look at the object contained in a data (constant or assignable) slot, just click on its icon. But if
the slot is a method, clicking its icon opens up a text editor on its source. For example, clicking on
the icon at the right of the <code class="docutils literal"><span class="pre">whoAmI</span></code> box opens a text editor displaying its source (and typing control-L
widens the object to show all the text in the selected window):</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image7.png"><img alt="_images/Pgm_Env_Image7.png" src="_images/Pgm_Env_Image7.png" style="width: 494.2px; height: 347.2px;" /></a>
</div>
</div>
<div class="section" id="text-editors">
<h5>6.2.1.4. Text Editors<a class="headerlink" href="#text-editors" title="Permalink to this headline">¶</a></h5>
<p>The background of the editor is lighter than the outliner as a whole, and this difference indicates
that this editor is the current typing focus: no matter where the mouse is you can type into this editor.
A left-click on another editor will select that one as the typing focus, and to indicate that it is
no longer the focus, this editor’s background will change to match the outliner:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image8.png"><img alt="_images/Pgm_Env_Image8.png" src="_images/Pgm_Env_Image8.png" style="width: 544.0px; height: 333.6px;" /></a>
</div>
<p>The white triangle in the lower-right corner of the editor (which can barely be seen in the printout
of this document) can be dragged to resize the editor.</p>
<p>Someone has done a poor job of indenting this method, so fix it by clicking to the left of the capital–
I and deleting two spaces:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image9.png"><img alt="_images/Pgm_Env_Image9.png" src="_images/Pgm_Env_Image9.png" style="width: 596.8px; height: 158.4px;" /></a>
</div>
<p>The red and green buttons that just appeared indicate the text has been changed; it no longer reflects
the source code of the real method. Hitting the red button will cancel the changes, while hitting
the green button will accept them and change the method:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image10.png"><img alt="_images/Pgm_Env_Image10.png" src="_images/Pgm_Env_Image10.png" style="width: 568.8px; height: 179.2px;" /></a>
</div>
<p>Self text editors will honor the cursor arrow keys, the copy, paste, and cut Sun keys, and
many emacs-style control characters:</p>
<table border="1" class="docutils" id="id11">
<caption><span class="caption-number">Table 6.1 </span><span class="caption-text">Partial list of control characters in Self text editors</span><a class="headerlink" href="#id11" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Character</th>
<th class="head">Effect</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>control-a</td>
<td>Move to start of line.</td>
</tr>
<tr class="row-odd"><td>control-b</td>
<td>Back one character.</td>
</tr>
<tr class="row-even"><td>control-d</td>
<td>Delete next character.</td>
</tr>
<tr class="row-odd"><td>control-e</td>
<td>Go to end of line.</td>
</tr>
<tr class="row-even"><td>control-f</td>
<td>Forward one character.</td>
</tr>
<tr class="row-odd"><td>control-k</td>
<td>Kill to end of line.</td>
</tr>
<tr class="row-even"><td>control-l</td>
<td>Expand the text editor to show the whole text.</td>
</tr>
<tr class="row-odd"><td>control-n</td>
<td>Go to next line.</td>
</tr>
<tr class="row-even"><td>control-o</td>
<td>Open a new line after the cursor.</td>
</tr>
<tr class="row-odd"><td>control-p</td>
<td>Go to previous line.</td>
</tr>
<tr class="row-even"><td>control-t</td>
<td>Transpose characters.</td>
</tr>
<tr class="row-odd"><td>control-w</td>
<td>Erase previous word.</td>
</tr>
<tr class="row-even"><td>control-y</td>
<td>Yank text from past-buffer to editor.</td>
</tr>
<tr class="row-odd"><td>delete, backspace, or control-h</td>
<td>Erase last character.</td>
</tr>
<tr class="row-even"><td>meta-return (command-return on Mac)</td>
<td>Accept.</td>
</tr>
<tr class="row-odd"><td>escape (also command-period on Mac)</td>
<td>Cancel.</td>
</tr>
<tr class="row-even"><td>meta-s (command-s on Mac)</td>
<td>Save a snapshot.</td>
</tr>
<tr class="row-odd"><td>meta-x (command-x on Mac)</td>
<td>Cut.</td>
</tr>
<tr class="row-even"><td>meta-c (command-c on Mac)</td>
<td>Copy.</td>
</tr>
<tr class="row-odd"><td>meta-v (command-v on Mac)</td>
<td>Paste.</td>
</tr>
<tr class="row-even"><td>meta-d (command-d on Mac)</td>
<td>Dismiss morph containing typing focus.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dismissing-objects">
<h5>6.2.1.5. Dismissing Objects<a class="headerlink" href="#dismissing-objects" title="Permalink to this headline">¶</a></h5>
<p>There are four separate ways of dismissing an outliner (or for that matter, anything) from the Self
desktop:</p>
<ul class="simple">
<li>Object outliners: Push the “X” button at the top-right-hand corner.</li>
<li>Drag it to the trash: left-drag on the outliner till the mouse is over the trash can, <img alt="trashcan" class="align-middle" src="_images/trashcan.png" /> then release the mouse-button.</li>
<li>Dismiss it via the right-button menu: hold down the right button over the outliner, move to the <em>Dismiss</em> button, then release.</li>
<li>The Carpet Morph: start above (or below) and to the left (or to the right) of the outliner, over the background. Hold down the left button and sweep out an area that completely contains the outliner, then release the left button. The outliner should now be surrounded by a rectangle. Use the middle mouse button inside the rectangle to select <em>Dismiss</em>.</li>
</ul>
<p>The last two methods, dismissing from the right-button menu, and marquee selection with the carpet
morph, come in especially handy with things like buttons and menus because such morphs cannot
be grabbed with the left-button.</p>
</div>
</div>
<div class="section" id="menus-in-the-outliner">
<h4>6.2.2. Menus in the Outliner<a class="headerlink" href="#menus-in-the-outliner" title="Permalink to this headline">¶</a></h4>
<p>Many other operations are available on the outliner by using the middle-button menu on the part of
the outliner to be affected. For example anExampleObject has many regions and here are some
of them:</p>
<div class="figure">
<img alt="_images/Pgm_Env_Image11.png" src="_images/Pgm_Env_Image11.png" />
</div>
<p>Click on the desired part of the object, be it object, category, slot, text editor, or annotation (annotations
will be explained later).</p>
<div class="section" id="the-evaluator">
<h5>6.2.2.1. The Evaluator<a class="headerlink" href="#the-evaluator" title="Permalink to this headline">¶</a></h5>
<p>Try out the <code class="docutils literal"><span class="pre">whoAmI</span></code> method. Push the “E” button in the top-right of the outliner:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image12.png"><img alt="_images/Pgm_Env_Image12.png" src="_images/Pgm_Env_Image12.png" style="width: 374.0px; height: 323.95px;" /></a>
</div>
<p>The receiver of any messages sent from an evaluator, or indeed any text editor (via <em>Do It</em> and <em>Get It</em>
in the editor’s middle-button menu) in an object outliner is the object itself. <a class="footnote-reference" href="#f2" id="id2"><sup>2</sup></a> Type <code class="docutils literal"><span class="pre">whoAmI</span></code> into
the evaluator and hit the Get it button (or select the <em>Get It</em> from the text editor menu), to send
the message and get back the result:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image13.png"><img alt="_images/Pgm_Env_Image13.png" src="_images/Pgm_Env_Image13.png" style="width: 374.0px; height: 338.25px;" /></a>
</div>
<p>Move the result <a class="footnote-reference" href="#f3" id="id3"><sup>3</sup></a> out of the way and left-click to set it down.</p>
</div>
<div class="section" id="adding-a-slot">
<h5>6.2.2.2. Adding a slot<a class="headerlink" href="#adding-a-slot" title="Permalink to this headline">¶</a></h5>
<p>Try one more change: adding a slot to the category “<code class="docutils literal"><span class="pre">a</span> <span class="pre">category</span> <span class="pre">of</span> <span class="pre">slots</span></code>.” Hold the cursor
over the words a <code class="docutils literal"><span class="pre">category</span> <span class="pre">of</span> <span class="pre">slots</span></code> and select <code class="docutils literal"><span class="pre">Add</span> <span class="pre">Slot</span></code> from the middle-button menu.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image14.png"><img alt="_images/Pgm_Env_Image14.png" src="_images/Pgm_Env_Image14.png" style="width: 544.0px; height: 449.6px;" /></a>
</div>
<p>After selecting Add Slot a space for a new slot will appear in the object:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image15.png"><img alt="_images/Pgm_Env_Image15.png" src="_images/Pgm_Env_Image15.png" style="width: 467.2px; height: 508.0px;" /></a>
</div>
<p>Each line shows the syntax for a different kind of slot. Create a simple variable by typing
<code class="docutils literal"><span class="pre">me&lt;-’Gumby’</span></code> <a class="footnote-reference" href="#f4" id="id4"><sup>4</sup></a> and hitting the green button to accept the change:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image16.png"><img alt="_images/Pgm_Env_Image16.png" src="_images/Pgm_Env_Image16.png" style="width: 466.4px; height: 506.4px;" /></a>
</div>
<p>After releasing the green button, it stays down to let you know that it is still working. After a few
seconds the slot appears: <a class="footnote-reference" href="#f5" id="id5"><sup>5</sup></a></p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image17.png"><img alt="_images/Pgm_Env_Image17.png" src="_images/Pgm_Env_Image17.png" style="width: 460.0px; height: 423.2px;" /></a>
</div>
</div>
</div>
<div class="section" id="debugger">
<h4>6.2.3. Debugger<a class="headerlink" href="#debugger" title="Permalink to this headline">¶</a></h4>
<p>Explore the Self debugger. Start by scrambling the send to <code class="docutils literal"><span class="pre">environmentVariable:IfFail:</span></code> as
if you had misspelled it.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image18.png"><img alt="_images/Pgm_Env_Image18.png" src="_images/Pgm_Env_Image18.png" style="width: 460.0px; height: 192.0px;" /></a>
</div>
<p>Press the green button to accept the change, then hit the <em>Get it</em> button. This should break something!
In fact, instead of the result of the message, a Self debugger will materialize:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image19.png"><img alt="_images/Pgm_Env_Image19.png" src="_images/Pgm_Env_Image19.png" style="width: 482.4px; height: 228.0px;" /></a>
</div>
<p>The debugger has a label to indicate which process ran aground, a status indication shown in blue,
some buttons for controlling the process, and a collapsed outliner for the stack. Expand the stack:</p>
<div class="figure" id="id12">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image20.png"><img alt="_images/Pgm_Env_Image20.png" src="_images/Pgm_Env_Image20.png" style="width: 431.2px; height: 202.4px;" /></a>
<p class="caption"><span class="caption-number">Fig. 6.1 </span><span class="caption-text">Expanded stack.</span></p>
</div>
<p>The stack filters out uninteresting frames by default <a class="footnote-reference" href="#f6" id="id6"><sup>6</sup></a>. The debugger assumes that the first method
you want to see is the one based on the text in the evaluator, and since the stack grows upwards this
oldest frame appears at the bottom. It has no method name, and contains the code <code class="docutils literal"><span class="pre">whoAmI</span></code>. That
method called <code class="docutils literal"><span class="pre">whoAmI</span></code>, whose code is too long to show next to the slot button, and that method
called <code class="docutils literal"><span class="pre">evnironmentAt:IfFail:</span></code> because we just sabotaged it! Of course there is no such method,
but Self creates one dynamically to handle the error.</p>
<p>The little boxes represent the receiver and arguments of the methods on the stack. Get the receiver
of the evnironment... message. Click on the box to the left of the word <code class="docutils literal"><span class="pre">evnironmentVariable:</span></code>
(the one labelled “<code class="docutils literal"><span class="pre">...bals</span> <span class="pre">os</span></code>” if you are running on the Macintosh):</p>
<div class="figure" id="id14">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image21.png"><img alt="_images/Pgm_Env_Image21.png" src="_images/Pgm_Env_Image21.png" style="width: 233.6px; height: 42.4px;" /></a>
<p class="caption"><span class="caption-number">Fig. 6.3 </span><span class="caption-text">Outliner with interface to the Macintosh.</span></p>
</div>
<p>This object represents the interface to the Macintosh operating system. The little button with the
apostrophe in the top-left-hand corner indicates that this object has a comment. Push the button to
show (or hide) the comment:</p>
<div class="figure">
<img alt="_images/Pgm_Env_Image22.png" src="_images/Pgm_Env_Image22.png" />
</div>
<p>(To automatically resize the outliner to show all the text, press control-L.) To see one of Self’s
scroll bars, grab the comment’s resize triangle (with the left-button) and move it up a bit:</p>
<div class="figure">
<img alt="_images/Pgm_Env_Image23.png" src="_images/Pgm_Env_Image23.png" />
</div>
<p>The affordance that appears on the right of the text is the scroll bar, and you can either drag on the
little black line or just click in the bar to scroll the text up or down.</p>
<p>Push the little apostrophe button again to hide the comment. Now, you could expand this object to
find the correct spelling of the “<em>evnironment...</em>” message. But instead, pretend that all you remember
is that it has the word “Variable” in it somewhere. So, use a facility called <em>Find Slot</em> that takes
a pattern and an object, and finds any matching slots in that object or its parents. Use the middlebutton
on the outliner’s title (<code class="docutils literal"><span class="pre">macOSGlobals</span> <span class="pre">os</span></code>) to get the object menu and select <em>Find slot</em>:</p>
<div class="figure">
<img alt="_images/Pgm_Env_Image24.png" src="_images/Pgm_Env_Image24.png" />
</div>
<p>Double-click on the word “foo*” to select that field for editing. (The same trick works on slot
names)</p>
<div class="figure">
<img alt="_images/Pgm_Env_Image25.png" src="_images/Pgm_Env_Image25.png" />
</div>
<p>Since we are searching for a method with “Variable” in its name, backspace (the delete key on the
Mac) three times <a class="footnote-reference" href="#f7" id="id7"><sup>7</sup></a> to erase the “foo” type in “*Variable*“, hit the green button, and then hit the
triangle to start the search (if you make a typing mistake, you can double click the text to make it
editable again). The triangle will blink a bit while it is searching (one could do other things in the
meantime during a long search), then the enumerator will show the match(es):</p>
<div class="figure">
<img alt="_images/Pgm_Env_Image26.png" src="_images/Pgm_Env_Image26.png" />
</div>
<p>Clicking on the little square button(s) would show the exact method(s). But, for our purposes, just
knowing the name is enough and now you have to fix it. So back to the debugger and click on the
method button on the right in the <code class="docutils literal"><span class="pre">whoAmI</span></code> slot to expand the stack frame for the <code class="docutils literal"><span class="pre">whoAmI</span></code> method:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image27.png"><img alt="_images/Pgm_Env_Image27.png" src="_images/Pgm_Env_Image27.png" style="width: 441.6px; height: 275.2px;" /></a>
</div>
<p>Now the debugger shows the source of the method, with the actual message being sent highlighted.
(In this case it is just the whole thing.) One of the conveniences in the Self programming environment
is that you do not have to go back to the original method to fix it, but can just fix it here (following
the grand tradition of Lisp and Smalltalk programming environments). So use the left
button to select the “vn” and type “nv” instead, then hit the green button to accept the change. The
green button will stay in a bit longer because when a method is changed from the debugger, every
slot pointing to that same method is made to feel the change—the method is changed in place (see
the figure below). This feature lets you change a method in a clone and simultaneously affect the</p>
<img alt="_images/Pgm_Env_Image28.png" class="align-center" id="figprototype" src="_images/Pgm_Env_Image28.png" />
<p>prototype, if you are putting your methods in prototypes instead of traits. Changing a method in an
ordinary outliner would just affect that one object, even if other objects had been cloned from it.
This rule avoids unintentional changes. The more global kind of change performed by the debugger
takes a little longer. When it is accomplished, the red and green buttons will disappear:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image29.png"><img alt="_images/Pgm_Env_Image29.png" src="_images/Pgm_Env_Image29.png" style="width: 428.8px; height: 231.2px;" /></a>
</div>
<p>Now <code class="docutils literal"><span class="pre">os</span></code> is highlighted to show that the process is about to send “os” to implicit-self. Try the <code class="docutils literal"><span class="pre">Step</span></code>
button, which performs a single message send. After hitting the <code class="docutils literal"><span class="pre">Step</span></code> button twice (and a control-
L to widen the debugger), the process will have entered the <code class="docutils literal"><span class="pre">environmentVariable:IfFail:</span></code> method:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image30.png"><img alt="_images/Pgm_Env_Image30.png" src="_images/Pgm_Env_Image30.png" style="width: 446.4px; height: 304.0px;" /></a>
</div>
<p>This method is not too interesting (especially on the Macintosh), so leave the debugger by hitting
<code class="docutils literal"><span class="pre">Continue</span></code> and letting the process finish.</p>
<p>Congratulations on making through the interactive tutorial. In the remainder of this manual, we
will dive deeper into the programming environment for readers who want to write real programs in
Self.</p>
<p>Here is more information on the debugger for future reference:</p>
<table border="1" class="docutils" id="id15">
<caption><span class="caption-number">Table 6.2 </span><span class="caption-text">The Debugger Buttons</span><a class="headerlink" href="#id15" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">What it says</th>
<th class="head">What it does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Continue</td>
<td>Resumes running the process</td>
</tr>
<tr class="row-odd"><td>Step</td>
<td>Perform one message send (skipping over trivial accesses and assignments); Steps into the called method.</td>
</tr>
<tr class="row-even"><td>Step Lexical</td>
<td>Execute messages until control returns to the same lexical method, or until this method exits. Very useful for methods with blocks.</td>
</tr>
<tr class="row-odd"><td>Next</td>
<td>Performs a message send and any messages in the called method; Steps over the called method.</td>
</tr>
<tr class="row-even"><td>Finish Frame</td>
<td>Finishes running the topmost method.</td>
</tr>
<tr class="row-odd"><td>Abort</td>
<td>Kills off the process and dismisses the debugger.</td>
</tr>
</tbody>
</table>
<p>In addition to the buttons, each frame in the debugger has some items to control the process in its
middle-button menu:</p>
<table border="1" class="docutils" id="id16">
<caption><span class="caption-number">Table 6.3 </span><span class="caption-text">Process control items in the activation middle-button menu</span><a class="headerlink" href="#id16" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">What it says</th>
<th class="head">What it does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Step</td>
<td>Top frame: same as step button, not top frame: Finish any called methods.</td>
</tr>
<tr class="row-odd"><td>Next</td>
<td>Same as next button.</td>
</tr>
<tr class="row-even"><td>Retry</td>
<td>Cut back the stack to this frame, then continue the process.</td>
</tr>
<tr class="row-odd"><td>Revert</td>
<td>Cut back the stack to this frame.</td>
</tr>
<tr class="row-even"><td>Finish</td>
<td>Finish this frame.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="enumerators">
<h4>6.2.4. Enumerators<a class="headerlink" href="#enumerators" title="Permalink to this headline">¶</a></h4>
<p>In addition to the <em>Find Slot</em> enumerator, Self has other ways to find things:</p>
<table border="1" class="docutils" id="id17">
<caption><span class="caption-number">Table 6.4 </span><span class="caption-text">Enumerators</span><a class="headerlink" href="#id17" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Function</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Implementors</td>
<td>Finds all the slots with a given name.</td>
</tr>
<tr class="row-odd"><td>Implementors of :</td>
<td>Finds all the slots with the given name that take an argument (for read/write slots only).</td>
</tr>
<tr class="row-even"><td>Senders</td>
<td>Finds all the methods that send a message with a given name.</td>
</tr>
<tr class="row-odd"><td>Senders of :</td>
<td>Finds all the methods that send the corresponding assignment message (read/write slots only).</td>
</tr>
<tr class="row-even"><td>Senders in family (Senders of : in family)</td>
<td>Finds all the methods in this object, its ancestors, and descendants that send a message with a given name (or the corresponding assignment message).</td>
</tr>
<tr class="row-odd"><td>Find Slot</td>
<td>Starting from a designated object, finds all slots in that object and its ancestors whose name matches a given pattern. Case is ignored, “?” matches any character, “*” matches any series of zero or more characters. Also comes in “of :” and “in family” flavors.</td>
</tr>
<tr class="row-even"><td>Methods Containing</td>
<td>Finds methods containing the specified string. Similar to grep without wildcards.</td>
</tr>
<tr class="row-odd"><td>Copied-down Children</td>
<td>Finds objects copied-down (see below) from this one.</td>
</tr>
<tr class="row-even"><td>References</td>
<td>Finds slots that contain references to the selected object.</td>
</tr>
<tr class="row-odd"><td>Slots in Module</td>
<td>On the module menu (see below); shows all slots in a given module.</td>
</tr>
<tr class="row-even"><td>Added or Changed Slots in Module</td>
<td>On the module menu (see below); shows all slots added or changed in the module since it was filed out.</td>
</tr>
<tr class="row-odd"><td>Removed Slots in Module</td>
<td>On the module menu (see below); shows the names of the slots removed from the module since it was last filed out.</td>
</tr>
<tr class="row-even"><td>Expatriate Slots</td>
<td>On the changed module menu (see below); shows all slots in filed-out objects that do not themselves specify a module. These slots will not be filed out.</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">copy-down</span></code> and <code class="docutils literal"><span class="pre">module</span></code> enumerators will be covered later.</p>
<p>The other enumerators can be summoned from several places: the outliner menu, the slot menu,
and the text editor menu. As a shortcut, selecting a whole expression in the text editor and then asking
for an enumerator will bring up the enumerator to search for the outermost message send in the
expression. So if you select the following expression: <code class="docutils literal"><span class="pre">aSet</span></code> <code class="docutils literal"><span class="pre">findFirst:</span></code> <code class="docutils literal"><span class="pre">elem</span> <span class="pre">IfPresent:</span></code>
<code class="docutils literal"><span class="pre">[snort]</span></code> <code class="docutils literal"><span class="pre">IfAbsent:</span></code> <code class="docutils literal"><span class="pre">[sludge]</span></code> and choose implementors from the text editor menu, you will
get an Implementors enumerator ready to search for <code class="docutils literal"><span class="pre">findFirst:IfPresent:IfAbsent:</span></code>. Of
course, you can always change the search target by double-clicking and editing the text. The text
editors also implement a host of handy double-clicking shortcuts.</p>
<p>Finally there is one last detail about enumerations: many contain a check-box to choose <em>Wellknown
only</em>. This is always checked by default to speed things up. When checked, only wellknown
(i.e. filed-out, see below) objects are searched, which is much faster.</p>
</div>
</div>
<div class="section" id="hacking-objects">
<h3>6.3. Hacking Objects<a class="headerlink" href="#hacking-objects" title="Permalink to this headline">¶</a></h3>
<p><em>Hacking&#8212;the discipline of making fine furniture from trees using an axe.</em></p>
<p>In going through this document, you have already added a slot and edited methods in both object
outliners and debuggers. In addition Self has many other ways to change an object:</p>
<table border="1" class="docutils" id="id18">
<caption><span class="caption-number">Table 6.5 </span><span class="caption-text">Ways to change an object</span><a class="headerlink" href="#id18" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="11%" />
<col width="46%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ways to change an object</th>
<th class="head">How</th>
<th class="head">Why</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td><strong>Removing, Moving, Copying Categories</strong></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Removing a category.</td>
<td>“Move” in category middle menu, then drag the category to the background or the trash can.</td>
<td>Removing a category.</td>
</tr>
<tr class="row-even"><td>Add slot or category to object or category.</td>
<td>“Add Category” in object or category middle menu, then type in the new category name, then hit green button to accept.</td>
<td>Adding a new category.</td>
</tr>
<tr class="row-odd"><td>Moving a category.</td>
<td>“Move” in category middle menu, then drag to another object.</td>
<td>Copying a category.</td>
</tr>
<tr class="row-even"><td>Copying a category.</td>
<td>“Copy” in category or category middle menu, then drag the category to another object.</td>
<td>Copying a category.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="46%" />
<col width="43%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#160;</td>
<td><strong>Removing, Adding, Moving, Copying Slots</strong></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Removing a slot.</td>
<td>“Move” in slot middle menu, then drag the slot to the background or the trash can.</td>
<td>Removing a slot.</td>
</tr>
<tr class="row-odd"><td>Add slot to object or category.</td>
<td>“Add Slot” in object or category middle menu, then type in the new slot name, “=” or “&lt;-”, and contents of slot (or just name alone for variable slot containing nil), then hit green button to accept.</td>
<td>Adding adding a new.</td>
</tr>
<tr class="row-even"><td>Moving a slot.</td>
<td>“Move” in slot middle menu, then drag to another object.</td>
<td>Moving a slot.</td>
</tr>
<tr class="row-odd"><td>Copying a slot.</td>
<td>“Copy” in slot or category middle menu, then drag the slot to another object.</td>
<td>Copying a slot.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="46%" />
<col width="43%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#160;</td>
<td><strong>Adding a Comment</strong></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Add a comment to an object or slot.</td>
<td>“Show Comment” in the object or slot middle menu to open up a comment text editor, then typing in the comment, then hit the green button to accept it. If an object or slot already has a comment, it can be shown/hidden by hitting the
small button labeled with a single quote.</td>
<td>To amuse and intrigue those who follow.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="46%" />
<col width="43%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#160;</td>
<td><strong>Changing a slot</strong></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Edit a slot.</td>
<td>“Edit” on a slot middle-button menu, then make any changes in the text editor, then hit green button to accept changes.</td>
<td>To change the contents of a constant data slot, or to change contents and set initial value at same time, or to change a slot from data to method or from constant to variable.</td>
</tr>
<tr class="row-odd"><td>Edit slot name or its argument names.</td>
<td>Double-click on the name of the slot, wait for red and green buttons to appear on the right of the name, edit the name, then hit the green button.</td>
<td>To change a slot’s name or the names of its arguments.</td>
</tr>
<tr class="row-even"><td>Change a method in a slot.</td>
<td>Click on the method icon button on the right of the slot to open a text editor on the method. Make the changes, then click on the green button to accept them.</td>
<td>To fix a bug in a method.</td>
</tr>
<tr class="row-odd"><td>Change the visibility of a slot.</td>
<td>On the slot’s middle menu choose “Make Public,” “Make Private,” or “Make Undeclared.”</td>
<td>The Self interface uses bold, normal, and sans-serif fonts to indicate public, private, and unspecified slots.This distinction carries no semantics, but serves to record the programmer’s intentions.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="46%" />
<col width="43%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#160;</td>
<td><strong>Annotating an Object</strong></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Change creator annotation of an object.</td>
<td>“Show Annotation” in object middle menu to expose object annotation information, then click on creator path field and typing in desired creator path, then hit green button to accept annotation.</td>
<td>Setting creator path tells transporter which slot “owns” this object, and tells environment what to name the object.</td>
</tr>
<tr class="row-odd"><td>Set creator of contents of a slot to that slot.</td>
<td>“Set Creator” in slot middle menu.</td>
<td>See above.</td>
</tr>
<tr class="row-even"><td>Change copy-down information.</td>
<td>“Show Annotation” in object middle menu to expose object annotation information, then click on copy-down-parent field and type in desired copy-down-path, copy-down selector and slots to omit) then hit green button to accept annotation.</td>
<td>Simulates subclassing by allowing an object to contain copies of the slots in another object. When copy-down-parent has slots added/ changed/removed, the change propagates to the copied-down children.</td>
</tr>
<tr class="row-odd"><td>Change the object’s “isComplete” flag.</td>
<td>“Show Annotation” in object middle menu to expose object annotation information, then push one of the isComplete radio buttons, then hit green button to accept the annotation change.</td>
<td>After building a new prototype, set isComplete to get the environment to show its printString, and to get the transporter to use its storeString.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="46%" />
<col width="43%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#160;</td>
<td><strong>Annotate a slot</strong></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Set the module membership of a slot, the slots in a
category, or the slots in an object.</td>
<td>Select “Set Module” from the middle menu of a slot, category, or object, then (for object or category) indicate which slots you want to change by choosing which module they currently belong to, finally select a
new module to put the slots in.</td>
<td>To ensure that slots are filled out in the correct source file.</td>
</tr>
<tr class="row-odd"><td>Type in or examine the module for a single slot.</td>
<td>“Show Annotation” on the slot middle menu to expose the annotation, then click on the module editor, type in the module name, then click the green accept button.</td>
<td>Save as above.</td>
</tr>
<tr class="row-even"><td>Change slot initial contents.</td>
<td>“Show Annotation” on the slot middle menu to expose the annotation, then click on the “Follow Slot” button, or type the desired initial value expression into the ”Initial Contents” editor, then hit the green accept button.</td>
<td>To have the transporter record the current contents of a slot, choose “Follow Slot.” To have it ignore the current value and just record a given expression for the slot’s initial value use the “Initial Contents” option.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-transporter">
<h3>6.4. The Transporter<a class="headerlink" href="#the-transporter" title="Permalink to this headline">¶</a></h3>
<p>The transporter has been built in order to move programs from one world of objects to another. You can
ignore it as long as you work with just one snapshot. However, if you want to give your
program to someone else, or save it as source, or read it in to a newer snapshot, you will need to
learn about the transporter.</p>
<div class="section" id="the-traditional-schism-between-program-and-data">
<h4>6.4.1. The Traditional Schism between Program and Data<a class="headerlink" href="#the-traditional-schism-between-program-and-data" title="Permalink to this headline">¶</a></h4>
<p>What is a program? In most systems it is a piece of text, although in more advanced environments
it may have structure. It is a description that can be used to create an activity, a running program,
that can then operate on data. In the conventional view:</p>
<table border="1" class="docutils" id="id19">
<caption><span class="caption-number">Table 6.6 </span><span class="caption-text">The Schism between Program and Data</span><a class="headerlink" href="#id19" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="29%" />
<col width="35%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">Program</th>
<th class="head">Data</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Who can change it</td>
<td>The programmer</td>
<td>The user</td>
</tr>
<tr class="row-odd"><td>When can it change</td>
<td>At programming time</td>
<td>At execution time</td>
</tr>
<tr class="row-even"><td>How is it changed</td>
<td>With a text editor</td>
<td>By running a program</td>
</tr>
</tbody>
</table>
<p>This model grew up in an era where computers were too small to host both compilers and applications
at the same time. Although it has some virtues it makes other operations very hard: it is hard
to include data, such as hand-drawn icons, directly into a program, and it is hard to write applications
whose data domain is really programs.</p>
</div>
<div class="section" id="data-program">
<h4>6.4.2. Data = Program<a class="headerlink" href="#data-program" title="Permalink to this headline">¶</a></h4>
<p>For Self, we have gone a different way, following in the footsteps of Smalltalk and Lisp:</p>
<blockquote>
<div><em>A Self program consists of live objects.</em></div></blockquote>
<p>Self has no edit/run mode. To change an object, you do not retreat to a source file, or even to a class,
you just change the object itself. This immediacy and concreteness lessens the cognitive burden on
the programmer, smooths the learning curve, and hastens gratification.</p>
<p>However, this stance creates a big problem the moment you need to move a program from one
world of objects to another; it is very hard to pin down what to do. For example, suppose an object
contains a slot with 1024 in it. Should that value be copied literally? Perhaps it is the result of some
computation (such as the width of the current screen) and should be recomputed instead. There
simply is not enough information in a Self object to extract programs from Snapshots.</p>
</div>
<div class="section" id="changes-vs-pieces">
<h4>6.4.3. Changes vs. Pieces<a class="headerlink" href="#changes-vs-pieces" title="Permalink to this headline">¶</a></h4>
<p>Earlier in the project we considered constructing a calculus of changes that could be used to represent
programs, and then moving programs by reapplying the changes to the new snapshot. But, we
had enough on our plate and rejected this approach as too ambitious to tackle without a dedicated
graduate student.</p>
<p>Instead, we decided to represent programs as pieces that could be filed out of a snapshot and filed
in to another. To allow us to merge changes to the same program, we decided to represent its pieces
as Unix source files amenable to RCS. The Self Transporter was built to save programs as source
files.</p>
</div>
<div class="section" id="objects-vs-slots">
<h4>6.4.4. Objects vs. Slots<a class="headerlink" href="#objects-vs-slots" title="Permalink to this headline">¶</a></h4>
<p>But what is a program? Although a new program frequently involves creating new objects, it also
can mean added slots to existing objects. For example, a program to find palindromes might add a
slot to <code class="docutils literal"><span class="pre">traits</span> <span class="pre">string</span></code> called <code class="docutils literal"><span class="pre">isPalindrome</span></code>. So we decided to refine the granularity of the
Transporter to the slot level; each slot has an annotation <a class="footnote-reference" href="#f8" id="id8"><sup>8</sup></a> (its module) which gives the name of the
source file containing that slot. This hair- or rather object-splitting implies that one object may be
built incrementally as the result of reading several files, and so the transporter endeavors to keep
the order that the files are read in as independent as possible. Since each object can possess slots
in different modules, the outliner shows a summary of the modules of an object, sorted by frequency.</p>
<p>Turned around, a module can be viewed as a collection of slots, plus some other information: each
module also includes a directory, a list of submodules to be read in whenever it is read, and
<em>postFileIn</em> method to be run whenever the module is read. These data allow modules to be organized
hierarchically by subsystem, for example the <code class="docutils literal"><span class="pre">allUI2</span></code> module includes all the modules in the <code class="docutils literal"><span class="pre">ui2</span></code>
system.</p>
<p>Now here comes the nice part: the Self environment incrementally maintains a mapping from modules
to slots, and a list of changed modules, which can be obtained from the background menu.
When you make a change the appropriate module will be added to the list, and can be written as a
source file by clicking its &#8216;<em>W</em>‘ button. The middle-button menu on the changed modules and individual
modules contains a host of useful entries for understanding what has been changed.</p>
</div>
<div class="section" id="what-to-save-for-the-contents-of-a-slot">
<h4>6.4.5. What to Save for the Contents of a Slot<a class="headerlink" href="#what-to-save-for-the-contents-of-a-slot" title="Permalink to this headline">¶</a></h4>
<p>At this point, the reader may be thinking <em>“So modules know which slots they include, but how do
they know which objects to include?”</em> After all, when the transporter saves a slot in a file what can
it put for the contents of the slot? Here is where the transporter runs smack into the problem of not
enough information, and a variety of means have to be used. As shown in the flowchart below:</p>
<div class="figure">
<img alt="_images/Pgm_Env_Image31.png" src="_images/Pgm_Env_Image31.png" />
</div>
<ul class="simple">
<li>Sometimes the programmer does not want to store the actual contents of a slot, but instead
wants to store an initialization expression. This intention is captured with another annotation
on a slot: each slot can either be annotated <em>Follow Slot</em> or <em>Initialize To Expression</em>
In the latter case, an initializer is also supplied.</li>
<li>Even though the transporter is supposed to follow the slot, it may contain an object that is created
by another slot. For example, the <code class="docutils literal"><span class="pre">parent</span></code> slot in a point should just refer to <code class="docutils literal"><span class="pre">traits</span> <span class="pre">point</span></code>
rather than recreating the traits object. This information is captured by a <code class="docutils literal"><span class="pre">Creator</span></code> annotation
on each object that gives the path from the <code class="docutils literal"><span class="pre">lobby</span></code> to the slot intended to create the object.
In this case, the transporter just files out a reference to the object’s creator, cleverly
enough so that the actual creator slot does not need to have been already filed in. On the other
hand, if an object is immutable, its identity is not important. If an object is annotated as
<code class="docutils literal"><span class="pre">isComplete</span></code> <a class="footnote-reference" href="#f9" id="id9"><sup>9</sup></a> the transporter sends it <code class="docutils literal"><span class="pre">isImmutableForFilingOut</span></code> and if that message returns
<code class="docutils literal"><span class="pre">true</span></code>, the transporter never files out a reference. For example, integers would answer
<code class="docutils literal"><span class="pre">true</span></code> to this message.</li>
<li>If the contents of the slot is a simple (usually immutable) object like <code class="docutils literal"><span class="pre">17</span></code>, <code class="docutils literal"><span class="pre">3&#64;4</span></code>, or ‘<code class="docutils literal"><span class="pre">foo</span></code>’ (the
string) the transporter should just ask the object for a string to store. It does this by checking to
see if the object is annotated as <code class="docutils literal"><span class="pre">isComplete</span></code> to see if it is safe to send the object messages,
checks to see if this object is itself needed for the string (it would be a mistake to file out the
prototypical point as <code class="docutils literal"><span class="pre">0&#64;0</span></code>, because the <code class="docutils literal"><span class="pre">x</span></code> slot would never be defined), then asks the object for a
store string.To see if the object must itself be filed out, it sends <code class="docutils literal"><span class="pre">storeStringNeeds</span></code> and if
this message does not return the object itself it sends <code class="docutils literal"><span class="pre">storeStringIfFail</span></code>:. If this succeeds,
the transporter can save a data-type specific string for the object. This fairly elaborate mechanism
allows programmers to add new kinds of objects that transport out with type-specific creation
strings.</li>
<li>Finally, if it can do nothing else, the transporter creates a new object for the contents of the
slot. The object is created in a clever way so that a file that adds slots to an object can be read
before the file that officially creates the object without loss of information.</li>
</ul>
<p>Filing out objects is too complicated, and over the past two years we have repeatedly tried simpler
schemes. However, all of the capabilities in the current scheme seem to be essential in some case.
This issue remains as a question for future work.</p>
</div>
<div class="section" id="copy-down">
<h4>6.4.6. Copy Down<a class="headerlink" href="#copy-down" title="Permalink to this headline">¶</a></h4>
<p>Because Self eschews classes and because the current compiler cannot optimize dynamic inheritance,
it is necessary to copy-down slots when refining an object. For example, the prototypical
morph object contains many slots that every morph should have, and some mechanism is needed
to ensure that their presence is propagated down to more specialized morphs like the <code class="docutils literal"><span class="pre">circleMorph</span></code>.
In a class-based language, this need is met by a rule ensuring that subclasses include any instance
variables defined in their superclasses. In Self, this inheritance of structure is separated from the
inheritance of information performed by the normal hierarchy of parent slots. Instead of including
a facility for inheriting structure in the language, Self implements a facility in the environment,
called “copy-down.” An object’s annotation can contain a copy-down parent, copy-down selector,
and set of slots to omit. The copy-down parent is sent the message given by the copy-down selector,
and (except for the slots-to-omit), the slots in the result are added to the object. Copied-down
slots are shown in pink in the outliner. For example, here are the prototypical morph and the prototypical
<code class="docutils literal"><span class="pre">circleMorph</span></code>:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Pgm_Env_Image32.png"><img alt="_images/Pgm_Env_Image32.png" src="_images/Pgm_Env_Image32.png" style="width: 444.8px; height: 386.4px;" /></a>
</div>
<p>The <em>Basic Morph State</em> category of slots has been copied from those in morph by first copying
the morph and removing all its submorphs (i.e. by sending it <code class="docutils literal"><span class="pre">copyRemoveAllMorphs</span></code>) and then
copying the resultant slots, omitting <code class="docutils literal"><span class="pre">parent</span></code>, <code class="docutils literal"><span class="pre">prototype</span></code>, <code class="docutils literal"><span class="pre">rawBox</span></code> and <code class="docutils literal"><span class="pre">rawColor</span></code>. The first
three of these slots were omitted because their contents had to be different; copied-down slots are
copied, they cannot be specially initialized in Self. The omitted slot <code class="docutils literal"><span class="pre">rawBox</span></code> is more interesting;
circle morphs do not need this slot at all and so omit it. Most other object-oriented programming
systems would not allow a subclass to avoid inheriting an instance variable.</p>
<p>The Self programming environment uses the copy-down information to allow the programmer
to use a class-based style when appropriate. For example, if the programmer adds a slot to morph
the environment will offer to add it to <code class="docutils literal"><span class="pre">circleMorph</span></code>, too. If the programmer should use a text editor
to edit the definition of morph, the <code class="docutils literal"><span class="pre">circleMorph</span></code> object will be changed after rereading both object’s
text files. The least convenient aspect of using copy-downs is that to do the moral equivalent
of creating a subclass, the programmer has to create two objects: a new traits object, and a new prototype,
and then set the object annotation of the new prototype. Perhaps someday there will be a
button to do this, or perhaps other styles of programming will emerge.</p>
</div>
<div class="section" id="trees">
<h4>6.4.7. Trees<a class="headerlink" href="#trees" title="Permalink to this headline">¶</a></h4>
<p>By default, the tranporter writes out Self modules out to a tree rooted in the current working directory, or the &#8216;objects&#8217; subdirectory of the directory given to the VM in the shell environment variable <code class="docutils literal"><span class="pre">SELFWORKING_DIR</span></code>.</p>
<p>Howevever Self modules have a slot &#8216;tree&#8217; which can take a name of a tree. If the name of the tree is not an empty string, then the module writer will look up a directory in the dictionary found at <code class="docutils literal"><span class="pre">modules</span> <span class="pre">init</span> <span class="pre">treeDictionary</span></code>.</p>
<p>This allows the developer to maintain several separate trees. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">modules</span> <span class="n">init</span>
  <span class="n">registerTree</span><span class="p">:</span> <span class="s1">&#39;org_selflanguage_webserver&#39;</span>
            <span class="n">At</span><span class="p">:</span> <span class="s1">&#39;path/to/parent-folder&#39;</span><span class="o">.</span>

<span class="n">bootstrap</span> <span class="n">read</span><span class="p">:</span> <span class="s1">&#39;webserver&#39;</span>
        <span class="n">InTree</span><span class="p">:</span> <span class="s1">&#39;org_selflanguage_webserver&#39;</span><span class="o">.</span>
</pre></div>
</div>
<p>Important considerations: module names are globally unique (that is, two modules called &#8216;webserver&#8217; in different trees are considered the same module and will overwrite each other). The tree name itself should also be globally unique - that is it is not possible to have two trees with the same name in a single Self world.</p>
<p>The advantages of this over a simple symbolic link to a separate filesystem tree is we can do overlays - if you want special string behaviour, then put it in your tree in <code class="docutils literal"><span class="pre">my_tree/core/string.self</span></code> and it will override as expected.</p>
<p>Modules that import subparts will import them from the same tree by default.</p>
</div>
<div class="section" id="versioning">
<h4>6.4.8. Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h4>
<p>Each transporter module has a slot named <code class="docutils literal"><span class="pre">revision</span></code> containing a string version number. It is recommended that you use Semantic Versioning <a class="footnote-reference" href="#f10" id="id10"><sup>10</sup></a> so that the version of a module can be tested as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">modules</span> <span class="n">string</span> <span class="n">version</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">modules</span> <span class="n">init</span> <span class="n">moduleVersion</span> <span class="n">copyOn</span><span class="p">:</span> <span class="s1">&#39;1.0.0&#39;</span><span class="p">)</span>
  <span class="n">ifFalse</span><span class="p">:</span> <span class="p">[</span><span class="n">log</span> <span class="n">warning</span><span class="p">:</span> <span class="s1">&#39;Old string version&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This test could be placed in the <code class="docutils literal"><span class="pre">preFileIn</span></code> slot of your module to ensure a sane file in environment before the rest of the file is read.</p>
<p>This concludes a brief tour of the Self programming environment. Although we strove for simplicity
in the design of Self, its programming environment includes a fair amount of functionality
which may take a while to learn. We hope that you find the investment worth the reward.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Double-clicking on the triangle will expand (or contract) all levels instead of just a single level.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>However, in a stack frame in the debugger (described below), the receiver of a message is the same as the receiver for the stack frame.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>I am revising this for Self 4.1 on my trusty Mac, and Self does not implement environment variables here.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>Since all that stuff in the text editor was initially selected, your typing conveniently replaced it all.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td>If you examine the slot’s annotation (available via the slot menu) it will show that the system has guessed that the new slot (named “me”) should be saved in the “programmingExamples” module, and that instead of saving its actual contents, the slot should just be initialized to the string ‘Gumby’.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td>Since the Self compiler inlines calls automatically, Self code tends to be written in a highly-factored, deeply-nested style. Thus, the debugger filters out stack frames that seem to be unimportant. If it ever filters out the frame you need to see, there is a “Don’t filter frames” entry in the stack’s middle-button menu.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[7]</a></td><td>One rough edge remaining in the Self user interface is the existence of two test editors, and this one does not implement multi-character selection, sigh. Or, you could type control-A to go the start, and control-K to delete the whole field, sigh.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[8]</a></td><td>The Self Virtual Machine provides for annotations on slots or whole objects. While the annotations do not influence program execution, they can be accessed and modified by Self’s reflective facility, mirrors. Annotations are used to hold many things, including comments on objects and slots.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[9]</a></td><td><code class="docutils literal"><span class="pre">isComplete</span></code> is used by the environment to decide when it is safe to send messages like <code class="docutils literal"><span class="pre">printString</span></code>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[10]</a></td><td>See <a class="reference external" href="http://semver.org">http://semver.org</a> for a specification. In essence, versions are of the form &#8220;3.2.1-alpha6&#8221;.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-morphic"></span><div class="section" id="morphic-the-self-user-interface-framework">
<h2>7. Morphic: The Self User Interface Framework<a class="headerlink" href="#morphic-the-self-user-interface-framework" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>7.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>Morphic is a user interface framework that supports composable graphical objects, along with the machinery required to display and animate these objects, handle user inputs, and manage underlying system resources such as X displays, fonts, and color maps. A primary goal of morphic is to make it easy to construct and edit interactive graphical objects, both by direct manipulation and from within programs.</p>
<p>A Morphic window shows just one portion of a large, two-dimensional world. The window can be panned around in this world, allowing different areas to be used for different activities. Multiple users can be active in this world simultaneously, working either in the same area (for collaborative work) or in disjoint areas (for independent work). Every user can see the screen boundaries, cursors, and actions of the other users. The sharing is implemented via the X protocol, so the other users can be physically remote as long as there is sufficient network bandwidth to support the X traffic. (Preliminary tests suggest that 30-50 KBytes/sec is required between the host machine and each remote user. The system has been tested with up to five users active simultaneously.) A given user can have several Morphic windows open, either on the same world or on different worlds, and can drag objects among these windows (assuming they all belong to the same Self Unix process).</p>
<div class="figure" id="id3">
<img alt="_images/Figure1.png" src="_images/Figure1.png" />
<p class="caption"><span class="caption-number">Fig. 7.1 </span><span class="caption-text">Three users working in the same space. Two of the other users are collaborating, so they have made their windows overlap (right). The third user is working independently in a separate area (left). The <code class="docutils literal"><span class="pre">radarView</span></code> in the third user&#8217;s area shows the surrounding vicinity in miniature, allowing offscreen objects and the screen boundaries of other users to be seen. The <code class="docutils literal"><span class="pre">radarView</span></code> is updated open enough to see where activity is occurring.</span></p>
</div>
<p>The central abstraction of morphic is the graphical object or <em>morph</em> (from the Greek for &#8220;shape&#8221; or &#8220;form&#8221;). A morph has a visual representation that can be picked up and moved. In addition, a morph may:</p>
<blockquote>
<div><ol class="arabic simple">
<li>perform actions in response to user inputs,</li>
<li>perform an action when a morph is dropped onto it or when it is dropped onto another morph,</li>
<li>perform an action at regular intervals, and</li>
<li>control the placement and size of its submorphs.</li>
</ol>
</div></blockquote>
<p>Any morph can have component morphs (called <em>submorphs</em>). A morph with submorphs is called a <em>composite</em> morph. A composite morph is treated as a unit; moving, copying, or deleting a composite morph causes all its submorphs to be moved, copied, or deleted as well. By convention, all morphs are visible; morphic does not use invisible structural morphs for aggregation. This means that if a composite morph is disassembled, all its component morphs can be seen and manipulated.</p>
<p>The remainder of this document discusses the graphics interface that morphs use to draw themselves, the structure of composite morphs, how to create new kinds of morphs, and how to change a morph&#8217;s behavior with respect to user inputs, drag-and-drop, and animation.</p>
</div>
<div class="section" id="composite-morphs">
<h3>7.2. Composite Morphs<a class="headerlink" href="#composite-morphs" title="Permalink to this headline">¶</a></h3>
<p>A <em>composite</em> morph is a morph that contains other morphs known as <em>submorphs</em>. Note that the terms &#8220;composite&#8221; and &#8220;submorph&#8221; refer to roles that can be played by any morph. Submorphs can be added to any kind of morph-even morphs such as <code class="docutils literal"><span class="pre">circleMorphs</span></code> or <code class="docutils literal"><span class="pre">labelMorphs</span></code> that are atomic in some other systems. Copying, deleting, moving, drawing, and layout operations are applied to the composite morph as a whole.</p>
<p>The structure of a composite morph forms a tree. When morph B is a submorph of morph A, B&#8217;s <em>owner</em> is A and B appears in A&#8217;s <em>submorphs</em> list. A morph can only be a submorph of at most one morph at a time, so its owner is a single value, not a collection. A window containing a collection of morphs is itself just a morph known as a <code class="docutils literal"><span class="pre">worldMorph</span></code>. Each user&#8217;s cursor is represented by a <code class="docutils literal"><span class="pre">handMorph</span></code>. Grabbing a morph with the mouse is implemented by removing the target morph from the <code class="docutils literal"><span class="pre">worldMorph</span></code> and adding it to the <code class="docutils literal"><span class="pre">handMorph</span></code>. Dropping a morph when the mouse is released is implemented by reversing this process. A <code class="docutils literal"><span class="pre">handMorph</span></code> is itself a submorph of its world. The message <code class="docutils literal"><span class="pre">root</span></code> can be sent to a morph to get the top-most owner of a composite morph (stopping just short of the <code class="docutils literal"><span class="pre">worldMorph</span></code> or <code class="docutils literal"><span class="pre">handMorph</span></code> that contains it). If a morph is not a submorph of any morph, its owner is <code class="docutils literal"><span class="pre">nil</span></code>.</p>
<div class="figure" id="id4">
<a class="reference internal image-reference" href="_images/Figure2.png"><img alt="_images/Figure2.png" src="_images/Figure2.png" style="width: 408.0px; height: 181.6px;" /></a>
<p class="caption"><span class="caption-number">Fig. 7.2 </span><span class="caption-text">A composite morph consisting of a row with two buttons. Each button has submorph to indicate its function; one is a piece of text, the other is an icon consisting of two concentric circles. The diagram on the right shows its submorph structure.</span></p>
</div>
<p>A morph can be made a submorph of some other morph using the <code class="docutils literal"><span class="pre">addMorph:</span></code> operation. This operation updates both the owner slot of the submorph and the submorphs list of the owner to reflect the desired configuration. For example, adding morph B to morph A adds B to A submorph list, removes B from its old owner (if any), and sets B&#8217;s owner to A. The <code class="docutils literal"><span class="pre">addMorph:</span></code> operation also updates the layout of both B&#8217;s old and new owners. The global position of a morph is held invariant by <code class="docutils literal"><span class="pre">addMorph:</span></code> (although some morphs may perform an automatic layout as a side-effect of <code class="docutils literal"><span class="pre">addMorph:</span></code>, immediately changing the position of the newly-added morph).</p>
<div class="figure" id="id5">
<img alt="_images/Figure3.png" src="_images/Figure3.png" />
<p class="caption"><span class="caption-number">Fig. 7.3 </span><span class="caption-text">Using the core sampler to probe the submorphs at the point below its cross-hairs.</span></p>
</div>
<p>The programming environment includes a tool called the <em>core sampler</em> (available via the right-button menu of any morph) that can be used to explore the submorph structure of a composite morph. The core sampler shows the set of submorphs below a given point, the way a core sample of rock allows geologists to study the strata of rock at a given point. The core sampler allows one to use the middle button menu to operate on morphs below the surface and can be used to insert or remove morphs from a composite morph. Holding the left mouse button over the squares along the left side of the core sampler highlights the associated morph. As a shortcut, holding down the shift key while pressing the left mouse button over one of these squares will extract the associated submorph (and all its submorphs) from the composite morph. Holding the shift key while dropping a morph onto one of these squares will insert the morph as a submorph of the associated morph. The iconic buttons on the right show the current resizing attributes of the associated morph, and allow them to be changed. (Resizing attributes are discussed in section <a class="reference internal" href="#resize-attribute-summary"><span class="std std-ref">7.7.5</span></a>.)</p>
</div>
<div class="section" id="morph-traits-and-prototypes">
<h3>7.3. Morph Traits and Prototypes<a class="headerlink" href="#morph-traits-and-prototypes" title="Permalink to this headline">¶</a></h3>
<p>Morphic organizes morphs into a hierarchy much like a class hierarchy. The behavior for all &#8220;instances&#8221; of a given morph &#8220;class&#8221; is defined in a shared traits object which is a parent of all the instances. The structure of an instance is defined by the slots of its prototype. The root of the morph hierarchy is <code class="docutils literal"><span class="pre">traits</span> <span class="pre">morph</span></code>. All morphs inherit from <code class="docutils literal"><span class="pre">traits</span> <span class="pre">morph</span></code>, either directly or via one or more intermediate traits objects.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To see the entire morph hierarchy, invoke the <em>&#8220;Show Traits Family&#8221;</em> menu command on an outliner on <code class="docutils literal"><span class="pre">traits</span> <span class="pre">morph</span></code> in the user interface. Be patient; the morph hierarchy is quite large.</p>
</div>
<p>Usually, the prototype of a given morph contains all the slots of the morph from which it is derived (the &#8220;instance variable of its superclass&#8221; in a class-based system) plus, possibly, a few additions. To simplify the life of the programmer, the programming environment supports an idiom known as &#8220;copying down.&#8221; The derived prototype is described differentially. That is, it is &#8220;just like its copy-down parent except with particular slots added, deleted, or changed.&#8221; Typical class-based languages also describe the structure of subclasses differentially: a subclass may extend its superclass with additional instance variables. However, the copy-down idiom also allows the derived prototype to selectively omit slots of its copy-down parent or change their contents. For example, the <code class="docutils literal"><span class="pre">circleMorph</span></code> prototype is derived from the morph prototype, but it replaces the &#8220;<code class="docutils literal"><span class="pre">rawBox</span></code>&#8221; slot of the morph prototype with the slots &#8220;<code class="docutils literal"><span class="pre">radius</span></code>&#8221; and &#8220;<code class="docutils literal"><span class="pre">center</span></code>&#8221;. This would not be possible in most class-based languages.</p>
<p>Note that the class-like organization of the morph hierarchy — with its parallel traits and prototype hierarchies and its use of the copy-down mechanism to propagate slot information down the prototype hierarchy — is only one way that Self programs can be organized. Other parts of the system, such as the world-wide-web browser, are organized differently.</p>
<div class="section" id="implementing-a-new-kind-of-morph">
<h4>7.3.1. Implementing a New Kind of Morph<a class="headerlink" href="#implementing-a-new-kind-of-morph" title="Permalink to this headline">¶</a></h4>
<p>It is easy to make a new kind of morph. One typically starts with a copy of some existing morph and adds or overrides state and behavior to create the new morph. Often, the most appropriate starting point is a copy of <em>morph</em>, the root of the morph object hierarchy. Morph has default behavior for everything from drawing to handling user inputs; one thus starts with a working morph and modifies its behavior incrementally to create the new type of morph.</p>
<p>The programming aspect of creating a new morph is straightforward. However, four other things must be done to make the new morph into a first-class citizen. First, its behavior should be factored into a shared parent (called a traits object) to allow the behavior of all instances to be changed by changing the shared parent. Second, the shared traits object and a prototypical instance of the new morph should be embedded in the global namespace. Third, the copy-down parent of the prototype should be set so that changes to the structure of the parent are propagated correctly. Finally, the new prototype and traits objects should be assigned to a module to allow the code for the new morph to be saved in a file.</p>
<p>Of course, if one just wants to do a quick experiment, none of these housekeeping chores are necessary. However, sometimes one decides to make an experimental morph into a first-class morph (the bottom-up approach). In other cases, one sets out from the beginning to create a new first-class morph (the top-down approach). The next two sections will describe how to create a new kind of first-class morph using each of these approaches.</p>
</div>
<div class="section" id="morph-creation-the-bottom-up-approach">
<h4>7.3.2. Morph Creation: The Bottom-up Approach<a class="headerlink" href="#morph-creation-the-bottom-up-approach" title="Permalink to this headline">¶</a></h4>
<p>In the bottom-up approach, one is initially interested in getting a morph with the desired behavior as quickly as possible. Thus, an appropriate morph is copied and modified by adding slots directly to the morph itself. Suppose one wished to create a morph that displayed as an oval and that toggled between two colors when the middle mouse button was pressed. To get a morph to modify, evaluate:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">morph</span> <span class="n">copy</span>
</pre></div>
</div>
<p>This will make an outliner on a new morph. Use the <em>&#8220;Show Morph&#8221;</em> command on this outliner&#8217;s middle-button menu to make the graphic representation of the copy appear.</p>
<p>The <em>&#8220;Add Slot&#8221;</em> command on the outliner&#8217;s middle-button menu can be used to add a data slot to hold the alternate color. Enter the following expression and accept it by clicking on the green (top) button:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">otherColor</span> <span class="o">&lt;-</span> <span class="n">paint</span> <span class="n">named</span><span class="p">:</span> <span class="s1">&#39;leaf&#39;</span>
</pre></div>
</div>
<p>The morph&#8217;s drawing behavior can be customized by adding the method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">baseDrawOn</span><span class="p">:</span> <span class="n">aCanvas</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">aCanvas</span> <span class="n">fillArcWithin</span><span class="p">:</span> <span class="n">baseBounds</span>
        <span class="n">From</span><span class="p">:</span> <span class="mi">0</span>
        <span class="n">Spanning</span><span class="p">:</span> <span class="mi">360</span>
        <span class="n">Color</span><span class="p">:</span> <span class="n">color</span><span class="o">.</span>
    <span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Morphic optimizes shadow drawing for rectangular morphs such as prototypical morph, which draws as simple rectangle. However, this morph is not rectangular. To make its shadow reflect its true shape, the <code class="docutils literal"><span class="pre">isRectangular</span></code> behavior must be overridden by adding the constant slot:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">isRectangular</span> <span class="o">=</span> <span class="n">false</span>
</pre></div>
</div>
<div class="figure" id="id6">
<img alt="_images/Figure4.png" src="_images/Figure4.png" />
<p class="caption"><span class="caption-number">Fig. 7.4 </span><span class="caption-text">A new kind of morph has been created by modifying a copy of the standard morph. The slots <code class="docutils literal"><span class="pre">baseDrawOn:</span></code>, <code class="docutils literal"><span class="pre">isRectangular</span></code>, <code class="docutils literal"><span class="pre">middleMouseDown:</span></code>, and <code class="docutils literal"><span class="pre">otherColor</span></code> have been added to the morph to obtain the new behavior. The morph itself appears on the left; an outliner showing its slots appears on the right.</span></p>
</div>
<p>The new morph&#8217;s input behavior can be customized by adding the method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">middleMouseDown</span><span class="p">:</span> <span class="n">evt</span> <span class="o">=</span> <span class="p">(</span><span class="o">|</span> <span class="n">tmp</span> <span class="o">|</span>
    <span class="n">tmp</span><span class="p">:</span> <span class="n">color</span><span class="o">.</span>
    <span class="n">color</span><span class="p">:</span> <span class="n">otherColor</span><span class="o">.</span>
    <span class="n">otherColor</span><span class="p">:</span> <span class="n">tmp</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>The morph now draws itself as a filled oval. Clicking the middle mouse button on it causes its color to toggle between its original color and leaf-green. This new morph can used as a prototype; any copies will get the state and behavior of the prototype at the time of copying. However, later changes to the prototype will not be reflected in the copies. For example, even if the prototype&#8217;s middle-mouse behavior were changed to cycle through three colors, copies made before this change would still only toggle between two colors.</p>
<p>To allow the behavior of all copies to be changed at once, one can move shared behavior and state into a shared traits object. Self&#8217;s object literal syntax can be used to create a new object to be used as the shared traits. As a shortcut, rather than creating an empty traits object and then adding a parent slot to it, an object containing an initialized parent slot can be created in a single operation. Evaluate the expression in an evaluator on the outliner (use the middle-button menu command <em>&#8220;Evaluator&#8221;</em> to open an evaluator on the outliner if necessary):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">|</span> <span class="n">parent</span><span class="o">*</span> <span class="o">=</span> <span class="n">traits</span> <span class="n">morph</span> <span class="o">|</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates a new object whose parent is traits morph. To make the new morph inherit through the new traits object, invoke the <em>&#8220;Grab pointer&#8221;</em> command by pressing the middle-button menu on the button on the right side of the parent slot of the morph. Drop the end of the pointer onto the new traits object to make the parent slot of the morph point to the new morph. This technique is called &#8220;arrow-dragging&#8221;.</p>
<div class="figure" id="id7">
<img alt="_images/Figure5.png" src="_images/Figure5.png" />
<p class="caption"><span class="caption-number">Fig. 7.5 </span><span class="caption-text">A new traits object has been created to hold behavior to be shared by all instances of the morph. Arrow dragging is being used to make the parent slot of the new morph point to the new traits object.</span></p>
</div>
<p>Now, the behavior to be shared can be moved from the prototype into the new traits object. Invoke the <em>&#8220;Move&#8221;</em> command on the middle-button menu for the <code class="docutils literal"><span class="pre">isRectangular</span></code> slot. This causes the slot to be plucked out of the object. Drop the slot onto the shared traits object. This causes it to be added to the that object. Repeat this process for the <code class="docutils literal"><span class="pre">baseDrawOn:</span></code> and <code class="docutils literal"><span class="pre">middleMouseDown:</span></code> slots.</p>
<p>The Self language uses slot inheritance to share both data (<code class="docutils literal"><span class="pre">isRectangular</span></code>) and behavior (<code class="docutils literal"><span class="pre">baseDrawOn:</span></code> and <code class="docutils literal"><span class="pre">middleMouseDown:</span></code>). The programming environment supports a similar kind of uniformity by allowing any slot to be moved or copied by via drag-and-drop. A entire category can also be copied or moved by dragging.</p>
<p>Note that when moving a slot between an object and its parent there is an interval during which the slot is not in either object. If a message matching the slot name is sent to the object during this interval, the object&#8217;s response is be determined by a slot inherited from a parent higher in the inheritance chain, if any. If it is important to avoid this transient state, one can move the each slot by first copying it from the prototype into the parent and then remove it from the prototype. A slot is removed simply by moving it and dropping it onto the trash can morph (or by dropping it on the background and then dismissing it).</p>
<div class="figure" id="id8">
<img alt="_images/Figure6.png" src="_images/Figure6.png" />
<p class="caption"><span class="caption-number">Fig. 7.6 </span><span class="caption-text">Using slot-dragging to move a slot into the new traits object. Using direct manipulation to move and copy slots makes programming feel like manipulating concrete objects. This narrows the gap between composition of graphical objects (building and modifying composite morphs) and programming.</span></p>
</div>
<p>Now, changing the traits object changes the behavior of all instances. For example, the draw method in the traits can be changed to draw an unfilled oval. To demonstrate the power of shared behavior, first make several copies of the protypical oval using the <em>&#8220;Duplicate&#8221;</em> command on its right-mouse menu. Then modify the baseDrawOn: method in the shared traits as follows (note the change from <code class="docutils literal"><span class="pre">fillArcWithin:</span></code> to just <code class="docutils literal"><span class="pre">arcWithin:</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">baseDrawOn</span><span class="p">:</span> <span class="n">aCanvas</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">aCanvas</span> <span class="n">arcWithin</span><span class="p">:</span> <span class="p">(</span><span class="n">baseBounds</span> <span class="n">indent</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">From</span><span class="p">:</span> <span class="mi">0</span>
        <span class="n">Spanning</span><span class="p">:</span> <span class="mi">360</span>
        <span class="n">Width</span><span class="p">:</span> <span class="mi">3</span>
        <span class="n">Color</span><span class="p">:</span> <span class="n">color</span><span class="o">.</span>
    <span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>The oval is drawn with a pen three-pixels wide. To accommodate the extra width, the rectangle passed to the canvas is indented by three pixels. Note: A morph should never draw outside its <code class="docutils literal"><span class="pre">baseBounds</span></code>. When this method is accepted, all copies of the prototype reflect the change. However, Morphic doesn&#8217;t automatically redraw instances when the draw method is changed. To see the change, drag some large object over the ovals to make them redraw.</p>
<div class="figure" id="id9">
<img alt="_images/Figure7.png" src="_images/Figure7.png" />
<p class="caption"><span class="caption-number">Fig. 7.7 </span><span class="caption-text">Changing the shared traits object changes the behavior of copies of the prototype (instances). In this case, the draw method has been changed to draw unfilled ovals.</span></p>
</div>
<p>At this point, the prototype for a new kind of morph has been created and the behavior common to all its instances has been factored into a separate traits object to facilitate later changes. The next step is to install the prototype and its traits in the global and traits namespace objects. Doing this allows the morph prototype and its traits to be referred to by name.</p>
<p>First, summon outliners for the globals and traits namespace objects by evaluating the expressions <code class="docutils literal"><span class="pre">globals</span></code> and <code class="docutils literal"><span class="pre">traits</span></code> in any text editor. (That is, type the expression, select it, and invoke the <em>&#8220;Get Expression&#8221;</em> command in the middle-button menu of the editor.) Then, open an appropriate category for the new morph or create a new category. Within the chosen category of <code class="docutils literal"><span class="pre">globals</span></code>, create a slot to hold the new morph&#8217;s prototype by invoking the <em>&#8220;Add Slot&#8221;</em> command and accepting the following expression:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ovalMorph</span> <span class="o">=</span> <span class="n">nil</span>
</pre></div>
</div>
<p>Next, invoke the <em>&#8220;Grab pointer&#8221;</em> command by pressing the middle-button menu on the button on the right side of the new ovalMorph slot. Drop the end of the pointer over the new morph prototype and release the mouse. This makes the new slot point to the new morph prototype. Repeat the procedure just described to create an <code class="docutils literal"><span class="pre">ovalMorph</span></code> slot in the traits namespace and point it to the traits object for the new morph.</p>
<div class="figure" id="id10">
<a class="reference internal image-reference" href="_images/Figure8.png"><img alt="_images/Figure8.png" src="_images/Figure8.png" style="width: 378.4px; height: 240.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 7.8 </span><span class="caption-text">Installing the new morph prototype and traits object in the globals and traits namespace objects. In each case, a new constant slot is created in the appropriate category, then arrow-dragging is used to make the new slot point to the desired object.</span></p>
</div>
<p>Finally, invoke the <em>&#8220;Make creator&#8221;</em> middle-button menu command on each new <code class="docutils literal"><span class="pre">ovalMorph</span></code> slot to designate it as that morph&#8217;s creator. This informs the system that the given slot is the given object&#8217;s home in the global namespace. (An object may be reachable via several global slots; setting its creator path distinguishes one of these slots as the object&#8217;s official &#8220;home address.&#8221; This information is used to determine the object&#8217;s name, as well as which the module in which to record information about the object as a whole, such as the object comment.) In a few seconds (if outliner updating is on), the outliner titles of the <code class="docutils literal"><span class="pre">ovalMorph</span></code> prototype and its traits object will be updated to show the new names for these objects.</p>
<p>To allow a composite morph containing <code class="docutils literal"><span class="pre">ovalMorphs</span></code> to be saved in a file, the prototype method in the prototype (not the traits!) must return the prototype <code class="docutils literal"><span class="pre">ovalMorph</span></code>. The <code class="docutils literal"><span class="pre">ovalMorph</span></code> prototype already has a prototype method that was copied from the original morph prototype. Change the body of the prototype method in the &#8220;filing out&#8221; category to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ovalMorph</span>
</pre></div>
</div>
<div class="figure" id="id11">
<img alt="_images/Figure9.png" src="_images/Figure9.png" />
<p class="caption"><span class="caption-number">Fig. 7.9 </span><span class="caption-text">Setting the creator slot of the new traits object. The system uses this information to name objects, among other things. Note that the title of the prototype (on the left) has already been updated to reflect its new name.</span></p>
</div>
<p>Many Smalltalk programming environments allow an instance variable to be added to a class at runtime. The new instance variable is propagated down to all subclasses and added to all existing instances of the class and its subclasses with an initial value of <code class="docutils literal"><span class="pre">nil</span></code>. The Morphic programming environment can provide a similar service for the copied-down slots of prototypes, with two significant differences: (1) changes to the values of a copied down slots are propagated, as well as slot additions and removals and (2) changes are propagated only to objects registered in the global namespace (other prototypes), not to clones of those objects (instances).</p>
<p>The system can be told to maintain the copied-down slots of the <code class="docutils literal"><span class="pre">ovalMorph</span></code> prototype automatically by setting its copy-down parent (<a class="reference internal" href="#figsettingcopydown"><span class="std std-numref">Fig. 7.10</span></a>). Select the <em>&#8220;Show Annotation&#8221;</em> command in the middle-button menu on the title of the <code class="docutils literal"><span class="pre">ovalMorph</span></code>&#8216;s outliner. Set the copy-down parent field to &#8220;morph&#8221;, the copy-down selector to <code class="docutils literal"><span class="pre">copyRemoveAllMorphs</span></code>, and press the green (top) button to accept this change. (The copy-down selector is sent to the copy-down parent to create a fresh copy from which to copy slots.) The system will ask if the slots &#8220;parent&#8221; and &#8220;prototype&#8221; should be omitted from the copy-down operation, since their contents differ from that of that of the copy-down parent. They should be.</p>
<p>Finally, it would be nice to be able to save the prototype and traits for the new <code class="docutils literal"><span class="pre">ovalMorph</span></code> in a file so that it can be archived or read into another Self world. Several steps are required. First, the module itself must be created. The system will create a new module (after getting confirmation from the user) the first time its name is used. Then, the slots in the globals and traits namespace object must be assigned to the new module. Finally, the non-copied-down slots in the prototype and traits objects are assigned to the module. This may sound tedious, but the system provide several shortcuts to accelerate the process.</p>
<p>To set the module for the new morphs home slot, invoke <em>&#8220;Show annotation&#8221;</em> on the <code class="docutils literal"><span class="pre">ovalMorph</span></code> slot in the globals object, type &#8220;ovalMorph&#8221; in the module field, and accept the change (<a class="reference internal" href="#figsettingmodules"><span class="std std-numref">Fig. 7.11</span></a>). Since this is a new module, the system will ask whether a new module should be created (yes), whether it should be a submodule of an existing module (no), and what subdirectory it should be stored into (&#8220;applications&#8221;). Set the module of the <code class="docutils literal"><span class="pre">ovalMorph</span></code> slot in the traits object the same way.</p>
<div class="figure" id="id12">
<span id="figsettingcopydown"></span><a class="reference internal image-reference" href="_images/Figure10.png"><img alt="_images/Figure10.png" src="_images/Figure10.png" style="width: 347.2px; height: 294.4px;" /></a>
<p class="caption"><span class="caption-number">Fig. 7.10 </span><span class="caption-text">Setting the copydown parent for the new prototype.</span></p>
</div>
<div class="figure" id="id13">
<span id="figsettingmodules"></span><img alt="_images/Figure11.png" src="_images/Figure11.png" />
<p class="caption"><span class="caption-number">Fig. 7.11 </span><span class="caption-text">Setting the modules for the namespace slots. The module will be created if it doesn&#8217;t already exist; the system asks the user several questions about where the new module should live and whether it is a submodule of some existing module.</span></p>
</div>
<p>All the slots in an object (or within one category of that object) can be assigned to a module in a single operation. To assign the slots of the new traits object to the new module, invoke the <em>&#8220;Set module...&#8221;</em> command on the header of its outliner (<a class="reference internal" href="#figassigningalltheslots"><span class="std std-numref">Fig. 7.12</span></a>). The system will ask which slots should be assigned to the module (all) and which module to put them into (<code class="docutils literal"><span class="pre">ovalModule</span></code>). After a few seconds, the module summary at the top of the outliner should update to indicate that all slots of the traits object are in <code class="docutils literal"><span class="pre">ovalModule</span></code>. Repeat this procedure to assign all the slots of the <code class="docutils literal"><span class="pre">ovalMorph</span></code> prototype to <code class="docutils literal"><span class="pre">ovalModule</span></code>.</p>
<div class="figure" id="id14">
<span id="figassigningalltheslots"></span><img alt="_images/Figure12.png" src="_images/Figure12.png" />
<p class="caption"><span class="caption-number">Fig. 7.12 </span><span class="caption-text">Assigning all the slots of the new traits object to the new module.</span></p>
</div>
<p>Now that all the slots of the new morph and its prototype have been assigned to the new module, the module can be filed out. Invoke the <em>&#8220;Changed modules...&#8221;</em> command on the background menu to get the changed modules morph. Then press the little button marked &#8220;<code class="docutils literal"><span class="pre">W</span></code>&#8221; (<a class="reference internal" href="#figsavingthecode"><span class="std std-numref">Fig. 7.13</span></a>) to the right of <code class="docutils literal"><span class="pre">ovalModule</span></code>. The system will save the code for the module in a file named &#8220;<code class="docutils literal"><span class="pre">ovalModule.self</span></code>&#8221; in the &#8220;<code class="docutils literal"><span class="pre">applications/</span></code>&#8221; subdirectory of the current working directory. (If this directory doesn&#8217;t exist, the system will complain. Create the directory and try the fileout operation again.) The oval morphs module can later be loaded into a snapshot by evaluating the expression:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bootstrap</span> <span class="n">read</span><span class="p">:</span> <span class="s1">&#39;ovalModule&#39;</span> <span class="n">From</span><span class="p">:</span> <span class="s1">&#39;applications&#39;</span>
</pre></div>
</div>
<div class="figure" id="id15">
<span id="figsavingthecode"></span><img alt="_images/Figure13.png" src="_images/Figure13.png" />
<p class="caption"><span class="caption-number">Fig. 7.13 </span><span class="caption-text">Saving the code for the new morph in a module file.</span></p>
</div>
</div>
<div class="section" id="morph-creation-the-top-down-approach">
<h4>7.3.3. Morph Creation: The Top-down Approach<a class="headerlink" href="#morph-creation-the-top-down-approach" title="Permalink to this headline">¶</a></h4>
<p>The top down approach to creating a new morph is similar to the approach just described, except that one plans to make a first-class citizen from the beginning. Thus, the order of steps is slightly different. Here is a brief outline of the procedure:</p>
<ol class="arabic">
<li><p class="first">Add a slot to the traits namespace object (using <em>&#8220;Add Slot&#8221;</em>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ovalMorph</span> <span class="o">=</span> <span class="p">(</span><span class="o">|</span> <span class="n">parent</span><span class="o">*</span> <span class="o">=</span> <span class="n">traits</span> <span class="n">morph</span> <span class="o">|</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Add a slot to the globals namespace object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ovalMorph</span> <span class="o">=</span> <span class="p">(</span><span class="o">|</span> <span class="n">parent</span><span class="o">*</span> <span class="o">=</span> <span class="n">traits</span> <span class="n">ovalMorph</span> <span class="o">|</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Make each new slot be the creator of its contents (using <em>&#8220;Make creator&#8221;</em>).</p>
</li>
<li><p class="first">Set the copy-down parent of the prototype to morph (via <em>&#8220;Show annotation&#8221;</em> on its outliner).</p>
</li>
<li><p class="first">Set the module of the two namespace slots to <code class="docutils literal"><span class="pre">ovalModule</span></code> (creating the new module in the process).</p>
</li>
<li><p class="first">Assign all slots of the new traits and prototype objects to <code class="docutils literal"><span class="pre">ovalModule</span></code>.</p>
</li>
<li><p class="first">Start programming the new behavior.</p>
</li>
</ol>
<p>This procedure does all the housekeeping chores up front, so the module can be filed out at any time. As the programmer works, the system will deduce that any slots added to <code class="docutils literal"><span class="pre">ovalMorph</span></code>&#8216;s traits or prototype should be placed in the same module as the other slots in that object (<code class="docutils literal"><span class="pre">ovalModule</span></code>). In a future release of the system, the initial housekeeping may be automated. This would make creating a new kind of morph a one-step operation.</p>
</div>
</div>
<div class="section" id="saving-a-composite-morph">
<h3>7.4. Saving a Composite Morph<a class="headerlink" href="#saving-a-composite-morph" title="Permalink to this headline">¶</a></h3>
<p>The system includes an experimental facility for store the structure of a composite morph to a file. This allows a morph constructed by direct manipulation to be saved into a file that can be read later to reconstruct the morph. This is how the &#8220;factory&#8221; was created. The morph saving facility requires that every morph and submorph to be saved supply implementations of the messages <code class="docutils literal"><span class="pre">slotsToNotFileOut</span></code>, <code class="docutils literal"><span class="pre">appendOtherSlotsOnto:</span></code>, <code class="docutils literal"><span class="pre">storeStringNeeds</span></code>, and <code class="docutils literal"><span class="pre">prototype</span></code>. Unfortunately, because morph saving was added later as an experiment, not all morphs have been retro-fitted with implementations of these messages. The enterprising user could easily infer how to add the required support to morphs that do not yet have it.</p>
<p>Suppose one has created a column of useful buttons that one wishes to save. (Fortunately, buttons, columns, rows, frames, and labels are among the morphs that do support saving.) To save this morph, create an outliner for it and then evaluate in that outliner:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">saveMorphInFile</span>
</pre></div>
</div>
<p>The system will prompt for a file name and will give graphical feedback as each component morph is stored. The file can later be read by evaluating:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">worldMorph</span> <span class="n">loadMorphFromFile</span>
</pre></div>
</div>
<p>Again, the system will prompt for the file name. A copy of the morph that was saved will be added to the hand. The return value of the expression will also be added to the hand, which may temporarily hide the new morph. Click any mouse button to put down the two objects, then move the top one out of the way.</p>
</div>
<div class="section" id="handling-user-input">
<h3>7.5. Handling User Input<a class="headerlink" href="#handling-user-input" title="Permalink to this headline">¶</a></h3>
<div class="section" id="handling-events">
<h4>7.5.1. Handling Events<a class="headerlink" href="#handling-events" title="Permalink to this headline">¶</a></h4>
<p>Morphic represents user actions such as pressing a key or mouse button using <code class="docutils literal"><span class="pre">ui2Event</span></code> objects. A <code class="docutils literal"><span class="pre">ui2Event</span></code> actually carries two kinds of information: its <em>type</em>, such as <code class="docutils literal"><span class="pre">leftMouseDown</span></code>, and the state of the mouse buttons and certain keyboard keys when the event occurred. This allows a program to tell, for example, if the shift key was held down when the left mouse button was pressed. As events occur, they are placed into a buffer. Morphic removes and processes events from this buffer in order. Thus, even if a user occasionally gets ahead of the system, the system will eventually catch up.</p>
<p>A morph can handle a given kind of event simply by implementing one of the following messages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">keyDown</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">keyUp</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">mouseMove</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">leftMouseDown</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">leftDoubleClick</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">leftMouseUp</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">middleMouseDown</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">middleDoubleClick</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">middleMouseUp</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">rightMouseDown</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">rightDoubleClick</span><span class="p">:</span> <span class="n">evt</span>
<span class="n">rightMouseUp</span><span class="p">:</span> <span class="n">evt</span>
</pre></div>
</div>
<p>The event is always supplied so that its state can be examined. The default behavior of the <code class="docutils literal"><span class="pre">leftMouseDown:</span></code> message is to pick up the composite morph containing the morph that gets the event. (That is, the left mouse button generally means &#8220;move&#8221;.) The default behavior of the <code class="docutils literal"><span class="pre">rightMouseDown:</span></code> message is to pop up the morph menu (the &#8220;blue&#8221; menu). The default behavior of the other messages is to return the special <code class="docutils literal"><span class="pre">dropThroughMarker</span></code> object, indicating that the event is not processed by this morph.</p>
<p>Submorphs of a morph are displayed in front of their owning morph. By default, submorphs are usually given the first opportunity to handle incoming events. If a submorph does not handle an event, it returns the <code class="docutils literal"><span class="pre">dropThroughMarker</span></code> object, and Morphic gives the submorph behind it a chance to handle the event. Each user generates events at the current location of their cursor. One can visualize an event as &#8220;falling down through&#8221; the submorphs of the composite morph at that location until either the event lands on a submorph that handles it or until all the submorphs of the composite at that point are exhausted. However, events do not fall between top-level morphs. For example, if an outliner is covered by a morph that does not handle <code class="docutils literal"><span class="pre">middleMouseDown</span></code> events, one cannot invoke the middle button menu of the outliner through the intervening morph.</p>
<p>In some cases, a morph may wish to handle certain events before its submorphs. For example, a <code class="docutils literal"><span class="pre">ui2Menu</span></code> morph handles <code class="docutils literal"><span class="pre">leftMouseDown</span></code> events itself rather than letting its component buttons get them in order to highlight the button under the cursor and to pop down the menu when a selection is made. A morph can arrange to handle certain kinds of events before its submorphs by overriding the <code class="docutils literal"><span class="pre">allowSubmorphsToGetEvent:</span></code> message.</p>
<p>There are actually two classes of events. <code class="docutils literal"><span class="pre">keyDown</span></code> events, the three <code class="docutils literal"><span class="pre">mouseDown</span></code> events, and the three <code class="docutils literal"><span class="pre">doubleClick</span></code> events are dispatched using the &#8220;falling through the submorphs&#8221; technique just described. The other events — <code class="docutils literal"><span class="pre">keyUp</span></code>, <code class="docutils literal"><span class="pre">mouseMove</span></code>, and the three <code class="docutils literal"><span class="pre">mouseUp</span></code> events are dispatched only to interested <em>subscribers</em>. The rationale is that some morphs are interested in discrete events, such as <code class="docutils literal"><span class="pre">mouseDown</span></code> transitions, while others need to track the mouse or keyboard over an extended period of time. Dispatching high-frequency events such as <code class="docutils literal"><span class="pre">mouseMove</span></code> to uninterested morphs would be inefficient. Futhermore, some morphs need to get events even when the cursor is no longer over the morph. For example, a click-to-type editor should continue to get keyDown events until another editor is clicked. In short, Morphic supports both spatial and subscription-based event dispatching because both are useful.</p>
<p>The events generated by a particular user are dispatched from the <code class="docutils literal"><span class="pre">handMorph</span></code> associated with that user. Each <code class="docutils literal"><span class="pre">handMorph</span></code> keeps a list of subscribers interested in various kinds of events. A morph asks the appropriate <code class="docutils literal"><span class="pre">handMorph</span></code> to start or stop its subscription to a particular kind of event. Every event has a reference to the hand that generated that event. Thus, a morph that wishes to track the mouse until the button is released (e.g., <code class="docutils literal"><span class="pre">sliderMorph</span></code>) would do the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>on <code class="docutils literal"><span class="pre">leftMouseDown</span></code>, execute <code class="docutils literal"><span class="pre">evt</span> <span class="pre">sourceHand</span> <span class="pre">subscribeUntilAllUp:</span> <span class="pre">self</span></code></li>
<li>on <code class="docutils literal"><span class="pre">mouseMove</span></code>, update the slider position from the current mouse position (which is in global coordinates)</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="mapping-special-characters-to-actions">
<h4>7.5.2. Mapping special characters to actions<a class="headerlink" href="#mapping-special-characters-to-actions" title="Permalink to this headline">¶</a></h4>
<p>When a morph receives the <code class="docutils literal"><span class="pre">keyDown:</span></code> message, the next step is the interpretation of any control-, meta- or command- keystrokes. For example, on the Macintosh, a command-X should perform a cut operation. A morph wishing to respect these conventions should do two things: it should inherit from <code class="docutils literal"><span class="pre">traits</span> <span class="pre">ui2Event</span> <span class="pre">ignoreSpecialCharactersMixin</span></code>, and it should, upon receiving the <code class="docutils literal"><span class="pre">keyDown:</span></code> message, send <code class="docutils literal"><span class="pre">sendMessageToHandleKeyboardEventTo:</span></code> the event, passing itself as the argument. The latter message tells the event to decode any special characters and send an apprpropriate message back to its argument. The mixin provides default behavior.</p>
</div>
</div>
<div class="section" id="drag-and-drop">
<h3>7.6. Drag and Drop<a class="headerlink" href="#drag-and-drop" title="Permalink to this headline">¶</a></h3>
<p>A morph can perform some action when another morph is dropped onto it and can decide which dropped morphs it will accept. In addition, the dropped morph can perform some action in response to being dropped.</p>
<p>To accept dropped morphs, a morph must respond affirmatively to the message:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wantsMorph</span><span class="p">:</span> <span class="n">m</span> <span class="n">Event</span><span class="p">:</span> <span class="n">evt</span>
</pre></div>
</div>
<p>The morph to be dropped is supplied as an argument to allow the receiving morph to decide if it wishes to accept the drop. For example, a printer icon morph might accept only document morphs. If the target morph agrees to accept the dropped morph, the target is then sent the message:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">addDroppingMorph</span><span class="p">:</span> <span class="n">m</span> <span class="n">Event</span><span class="p">:</span> <span class="n">evt</span>
</pre></div>
</div>
<p>to actually perform the drop action. Part of this action should be to put the dropping morph somewhere or delete it. For example, the printer icon morph might queue a print request, then add the document morph to a folder morph representing the printed documents.</p>
<p>Finally, the dropped morph is informed of the drop (post facto) by sending it the message:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">justDroppedInto</span><span class="p">:</span> <span class="n">m</span> <span class="n">Event</span><span class="p">:</span> <span class="n">evt</span>
</pre></div>
</div>
<p>The event is provided in these messages to allow the morph to examine the state of the mouse buttons or modifier keys at the time of the drop.</p>
</div>
<div class="section" id="automatic-layout">
<h3>7.7. Automatic Layout<a class="headerlink" href="#automatic-layout" title="Permalink to this headline">¶</a></h3>
<div class="section" id="packing">
<h4>7.7.1. Packing<a class="headerlink" href="#packing" title="Permalink to this headline">¶</a></h4>
<p>Automatic layout relieves the programmer from much of the burden of laying out the components of a composite morph such as a dialog box. By allowing morphic to handle the details of placing and resizing the components, the programmer can focus on the <em>topology</em> of the layout, without worrying about the exact positions and sizes. Automatic layout also allows composite morphs to adapt gracefully to size changes, including font size changes.</p>
<p><em>Layout morphs</em> manage the placement and sizing of their submorphs. Layout morphs currently include <code class="docutils literal"><span class="pre">rowMorphs</span></code>, <code class="docutils literal"><span class="pre">columnMorphs</span></code>, <code class="docutils literal"><span class="pre">frameMorphs</span></code> and their descendents. All other morphs leave the size and placement of their submorphs alone. The current set of layout morphs all use the same layout strategy: linear, non-overlapping packing. Rows pack horizontally from left-to-right. Columns, frames, and their descendents pack vertically from top-to-bottom. This simple approach, while it does not handle every conceivable layout problem (e.g., tables whose rows and columns adjust to the size of their contents), is surprisingly powerful. All automatic layout in morphic is based on nested combinations of rows and columns.</p>
<p>Linear packing is best explained procedurally. Consider a <code class="docutils literal"><span class="pre">rowMorph</span></code>. Its task is to arrange its submorphs into a row such that the left edge of each morph just touches the right edge of the next morph. The submorphs are processed in order; that is, the first submorph will be placed at the left end of the row, then the next submorph will be placed to the right of the first, and so on. The last submorph will be placed at right-most end of the row. Notice that the order of the submorphs is not affected by the packing process. Also notice that the packing is done only in one primary dimension—the horizontal dimension in this case. The other dimension is also considered during packing, and is controlled by the <em>justification</em> parameter of the row. Depending on this parameter, the tops, bottoms, or centers of the submorphs can be aligned with the top, bottom, or center of the row.</p>
</div>
<div class="section" id="space-filling">
<h4>7.7.2. Space-filling<a class="headerlink" href="#space-filling" title="Permalink to this headline">¶</a></h4>
<p>For simplicity, the packing strategy was described as if the submorphs to be packed were all rigid. In order to support &#8220;stretchy&#8221; layouts, morphs can be designated as <em>space-filling</em>. (Note: The source code uses the older term, <em>flexible</em>.) When there is extra space, a space-filling morph expands to fill this space. If there is no extra space, a space-filling morph shrinks to its minimum size. When there are several space-filling morphs in a single row or column, any extra space is divided evenly among them.</p>
<p>Space-filling morphs can be used to control the placement of submorphs within the primary dimension when a row or column is stretched. For example, suppose one wanted a row with three buttons, one at the left end, one at the right end, and one in the middle. This can be accomplished by inserting space-filling morphs between the buttons:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">button1</span><span class="o">&gt;&lt;</span><span class="n">spacer</span><span class="o">&gt;&lt;</span><span class="n">button2</span><span class="o">&gt;&lt;</span><span class="n">spacer</span><span class="o">&gt;&lt;</span><span class="n">button3</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>When the row is stretched, the extra space is divided evenly between the two spacers, <em>button2</em> stays in the center, and <em>button3</em> stays at the far right. By making the color of the spacers match that of the underlying row, they become effectively invisible. This is a common technique.</p>
<div class="figure" id="id16">
<img alt="_images/Figure14.png" src="_images/Figure14.png" />
<p class="caption"><span class="caption-number">Fig. 7.14 </span><span class="caption-text">Using flexible spacer morphs to space buttons evenly within a row. Normally these spacers would be made the same color as the row, making them effectively invisible</span></p>
</div>
</div>
<div class="section" id="shrink-wrapping">
<h4>7.7.3. Shrink-Wrapping<a class="headerlink" href="#shrink-wrapping" title="Permalink to this headline">¶</a></h4>
<p>It is sometimes desirable for the size of a morph to depend on the sizes of its submorphs. For example, the size of a button should depend on the size of its label. (It would be annoying if it didn&#8217;t; the programmer would have to manually resize the button after changing the label.) A morph designated as <em>shrink-wrap</em> shrinks (or grows) to the smallest size that accommodates the size requirements of its submorphs.</p>
</div>
<div class="section" id="minimum-sizes">
<h4>7.7.4. Minimum Sizes<a class="headerlink" href="#minimum-sizes" title="Permalink to this headline">¶</a></h4>
<p>Morphs have a minimum size in each dimension (<code class="docutils literal"><span class="pre">minWidth</span></code> and <code class="docutils literal"><span class="pre">minHeight</span></code>). These sizes determine the minimum amount of space that will be allocated to a morph during layout. The minimum size of a morph takes into account the minimum sizes of its submorphs. For example, the minimum width of a row is the sum of the minimum widths of its submorphs (plus a little bit for a border, if it has one).</p>
<p>The absolute minimum width and height of a morph, even when it has no submorphs, is specified by its <code class="docutils literal"><span class="pre">baseMinWidth</span></code> and <code class="docutils literal"><span class="pre">baseMinHeight</span></code>. For some kinds of morph, these values are stored in assignable slots in the morph. For others, these values are defined by inherited constant slots to save space. One can use these attributes to give a space-filling morph a minimum size.</p>
</div>
<div class="section" id="resize-attribute-summary">
<span id="id1"></span><h4>7.7.5. Resize Attribute Summary<a class="headerlink" href="#resize-attribute-summary" title="Permalink to this headline">¶</a></h4>
<p>The resizing behavior of a morph in one dimension is completely independent of its behavior in the other dimension; that is, a morph actually has two independent resizing attributes, one for the horizontal dimension and one for the vertical dimension.</p>
<p>To summarize, the resizing behavior of a morph along a given dimension is controlled by its resizing attribute, which has one of three values:</p>
<blockquote>
<div><p><strong>rigid</strong> The morph is not resized.</p>
<p><strong>space-filling</strong> In a row or column, the size of the morph adapts to fill the available space. Extra space is shared evenly with any other space-filling morphs in that row or column.</p>
<p><strong>shrink-wrap</strong> The morph is shrunk to just fit around its submorphs, or to its minimum size, whichever is smaller. Enclosed space-filling morphs are shrunk if necessary.</p>
</div></blockquote>
<p>A morph&#8217;s minimum size in a given dimension determines the smallest amount of space that should be allocated to it during layout. The core sampler and/or properties sheet can be used to change these attributes.</p>
</div>
</div>
<div class="section" id="animation">
<h3>7.8. Animation<a class="headerlink" href="#animation" title="Permalink to this headline">¶</a></h3>
<p>Animation can be used to make an interactive application seem more alive and can convey valuable information. However, animation can become annoying if the user has to wait until the animation completes before doing anything else. In Morphic, animation and user actions are concurrent, and multiple animations can be active while multiple users interact with the system.</p>
<div class="figure" id="id17">
<img alt="_images/Figure15.png" src="_images/Figure15.png" />
<p class="caption"><span class="caption-number">Fig. 7.15 </span><span class="caption-text">Three simultaneously active morphs: an ideal gas simulation, a digital clock, and an outliner on the Self object underlying one of the atoms in the simulation. The clock updates every second, the simulation runs continuously, and the outliner periodically updates its center and velocity slot values as the underlying atom moves. A morph continues to operate while it is being moved (the clock is being moved here) or while an external animation is applied to it. Note that multiple users can be active simultaneously; this example shows the cursors of two users.</span></p>
</div>
<p>There are two ways to achieve animation. First, a morph can have lightweight autonomous behavior which typically, although not necessarily, appears as animation. For example, a clock might advance the time or a discrete simulation might compute simulation steps. Second, Morphic includes a kit of external animation behaviors that can be applied to any morph, including motion, scaling, and color change animations.</p>
<p>Although autonomous behavior and external animations are implemented using the same underlying mechanism, they have different purposes and are specified in different ways. The autonomous behavior of a morph is an intrinsic property of that morph. For example, updating the time is central to being a clock morph. Autonomous behavior is defined in the morph itself. External animation behaviors, on the other hand, are typically transient and imposed from outside. For example, the Self programming environment gives feedback for certain actions by &#8220;wiggling&#8221; the relevant morph. An external animation is specified by creating a separate animation activity object and applying it to the morph to be animated. Animation is orthogonal to autonomous behavior; for example, a clock morph would continue to run even while a motion animation whisked it across the screen.</p>
<div class="section" id="stepping">
<h4>7.8.1. Stepping<a class="headerlink" href="#stepping" title="Permalink to this headline">¶</a></h4>
<p>The autonomous behavior of a morph is defined by its <code class="docutils literal"><span class="pre">step</span></code> method. For example, to make a simple digital clock, one could add the following slot to a copy of <code class="docutils literal"><span class="pre">labelMorph</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">step</span> <span class="o">=</span> <span class="p">(</span> <span class="n">label</span><span class="p">:</span> <span class="n">time</span> <span class="n">current</span> <span class="n">timeString</span> <span class="p">)</span>
</pre></div>
</div>
<p>The clock is activated by asking the system to send the &#8220;<code class="docutils literal"><span class="pre">step&quot;</span></code> message to it either continuously (every display update cycle) or at periodic intervals (e.g., once per second). Make sure the <code class="docutils literal"><span class="pre">labelMorph</span></code> is visible in the world (use the <em>&#8220;Show Morph&#8221;</em> menu command if necessary), then, in an evaluator on its outliner, evaluate:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">getSteppedEveryMSecs</span><span class="p">:</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>This will cause the <code class="docutils literal"><span class="pre">step</span></code> message to be sent to the morph once per second (i.e., every 1000 milliseconds), causing it to display a formatted string representing the current time. <code class="docutils literal"><span class="pre">step</span></code> messages are sent synchronously during the display update cycle. This has the advantage of simplifying synchronization but requires that <code class="docutils literal"><span class="pre">step</span></code> methods complete quickly to avoid delaying user interactions.</p>
<p>The message <code class="docutils literal"><span class="pre">stopGettingStepped</span></code> can be sent to the morph to turn off stepping for that morph. Morphic automatically stops stepping when the target morph is removed from the world. To make the clock morph reactivate itself when dropped back into the world, add the following slot:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">justDroppedInto</span><span class="p">:</span> <span class="n">m</span> <span class="n">Event</span><span class="p">:</span> <span class="n">evt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">isInWorld</span> <span class="n">ifTrue</span><span class="p">:</span> <span class="p">[</span> <span class="n">getSteppedEveryMSecs</span><span class="p">:</span> <span class="mi">1000</span> <span class="p">])</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="external-animation">
<h4>7.8.2. External Animation<a class="headerlink" href="#external-animation" title="Permalink to this headline">¶</a></h4>
<p>External animation of a morph is achieved by scheduling an <em>animation activity</em> with that morph as its target. An animation activity changes some property of its target gradually over the course of a number of display cycles (frames). For example, a <code class="docutils literal"><span class="pre">positionAnimator</span></code> animates a change in its target morph&#8217;s location. The programmer specifies the initial and final values of the property to be changed (e.g., the starting and ending position) and the duration over which the change should occur. The duration can be defined in two ways. <em>Frame-based</em> animation lets the programmer control animation smoothness by specifying that the animation should take a given number of frames regardless of the time per frame. <em>Time-based</em> animation lets the programmer specify the desired amount of time the animation should take, but the number of intermediate frames depends on the time per frame, which may vary with system load, scene complexity, and other factors. Animations can be paced linearly or slow-in-slow-out. A slow-in-slow-out animation starts slowly, builds to a maximum pace, then decelerates. There are activities that animate the position, size, and color of morphs, activities that send arbitrary messages, and compound activities that combine a set of other activities either sequentially or concurrently. In fact, this activity architecture is the basis of all animation in Morphic: an activity called a <code class="docutils literal"><span class="pre">periodicStepActivity</span></code> is used to implement the stepping facility.</p>
</div>
</div>
<div class="section" id="other-issues">
<h3>7.9. Other Issues<a class="headerlink" href="#other-issues" title="Permalink to this headline">¶</a></h3>
<div class="section" id="local-versus-global-coordinates">
<h4>7.9.1. Local versus Global Coordinates<a class="headerlink" href="#local-versus-global-coordinates" title="Permalink to this headline">¶</a></h4>
<p>The position of a morph is defined relative to the position of its owner. This makes it unnecessary to update the positions of all the submorphs when moving a composite morph. However, it also means that morphs with different owners have positions in different coordinate systems. In order to compare the positions of morphs having different owners, it is necessary to use their positions in the world&#8217;s coordinate system, which are computed by sending the <code class="docutils literal"><span class="pre">globalPosition</span></code> message to each morph.</p>
</div>
<div class="section" id="synchronization">
<h4>7.9.2. Synchronization<a class="headerlink" href="#synchronization" title="Permalink to this headline">¶</a></h4>
<p>Animation, stepping, and other activities are handled synchronously, as part of the basic user interface loop. Thus, a sequence of actions done by an activity or a <code class="docutils literal"><span class="pre">step</span></code> method appear to happen atomically; the user never sees the morph in an intermediate state in which some but not all of the actions have taken place. For example, if a morph is removed from one morph and added to another, the user never sees the transient state in which the morph is not in the world at all. Likewise, any layout modifications resulting from user actions—such as adding a new morph to a row—appear to happen atomically; one never sees a partially complete layout.</p>
<p>Often, however, an independent Self thread wishes to manipulate morphs in the user interface. In order to make such actions appear atomic, they should be done under the protection of the UI synchronization semaphore. The preferred way to do this is to wrap the action or actions in a block to be executed between display cycles of the morph&#8217;s world:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">aMorph</span> <span class="n">safelyDo</span><span class="p">:</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span>
</pre></div>
</div>
<p>Synchronization errors usually appear as intermittent graphical glitches, although in rare cases the submorph structure may be corrupted (e.g., a morph appearing in the submorph lists of multiple morphs).</p>
</div>
<div class="section" id="display-updating">
<h4>7.9.3. Display Updating<a class="headerlink" href="#display-updating" title="Permalink to this headline">¶</a></h4>
<p>Morphic uses a double-buffered, incremental algorithm to keep the screen updated. This algorithm is efficient (it tries to do as little work as possible to update the screen after a change) and high-quality (the user does not see the screen being repainted). It is also mostly automatic; many applications can be built without the programmer ever being aware of how the display is maintained. The description here is mostly for the benefit of those curious about how the system works.</p>
<p>Each morphic screen window displays the contents of some <code class="docutils literal"><span class="pre">worldMorph</span></code>. A <code class="docutils literal"><span class="pre">worldMorph</span></code> keeps a list of rectangular &#8220;damaged&#8221; regions of the screen. Every morph can compute a rectangle that encloses its entire visible representation. When a morph changes its appearance (for example, its color), it sends itself the <strong>message</strong> <code class="docutils literal"><span class="pre">changed</span></code>. This causes its bounding rectangle to be translated into global coordinates and added to the damage list of the <code class="docutils literal"><span class="pre">worldMorph</span></code> that contains it. (This <code class="docutils literal"><span class="pre">worldMorph</span></code> is found by starting at the morph and following the <strong>owner</strong> chain; the <code class="docutils literal"><span class="pre">worldMorph</span></code> is the last morph in this chain.) On the next display update cycle, the <code class="docutils literal"><span class="pre">worldMorph</span></code> redraws the portions of all morphs that intersect rectangles in the damage list (via an off-screen buffer), including the morph that was changed. The <code class="docutils literal"><span class="pre">worldMorph</span></code> then clears its damage list to prepare for future damage reports.</p>
<p>When a morph changes size or position, damage is reported both before and after the change. This causes the screen to be updated at both the old and new size or position.</p>
<p>Typically, the implementor of a morph writes code to send the changed message automatically after updating any slot that affects the morph&#8217;s appearance. For example, the <code class="docutils literal"><span class="pre">color:</span></code> message defined in traits morph sends changed automatically. Likewise, external animation activities report appropriate changes. Thus, the client of a morph usually need not send <code class="docutils literal"><span class="pre">changed</span></code> explicitly.</p>
</div>
<div class="section" id="layout-updating">
<h4>7.9.4. Layout Updating<a class="headerlink" href="#layout-updating" title="Permalink to this headline">¶</a></h4>
<p>Morphic also maintains morph layout incrementally. When a morph is changed in a way that could influence layout (e.g., when a new submorph is added to it), the message <code class="docutils literal"><span class="pre">layoutChanged</span></code> is sent to the morph. This triggers a chain of activity. First, the layout of the changed morph is updated. This may change the amount of space apportioned to some of its sub morphs, causing their layouts to be updated. Then, if the space requirements of the changed morph have changed (e.g., if it needs more space to accommodate the newly added submorph), the layout of its owner is updated, and possibly its owner&#8217;s owner, and so on. In some cases, the layout of every submorph in a deeply-nested composite morph may need to be updated. Fortunately, there are many cases where the layout updates can be localized. Morphic detects these cases, thus saving a great deal of unnecessary work.</p>
<p>As with <code class="docutils literal"><span class="pre">changed</span></code> messages, morph clients usually need not send <code class="docutils literal"><span class="pre">layoutChanged</span></code> explicitly since the most common operations that affect the layout of a morph—such as adding and removing submorphs or changing its size—take care of this already.</p>
<p>Normally, layout is performed incrementally after every morph add or remove operation. However, when a large composite morph is to be constructed, the cost of the repeated layout operations can be significant. The programmer can ameliorate this problem by using the batch operation <code class="docutils literal"><span class="pre">addAllMorphs:</span></code> rather than a sequence of individual <code class="docutils literal"><span class="pre">addMorph:</span></code> operations.</p>
<p>If a morph is not in a <code class="docutils literal"><span class="pre">worldMorph</span></code>, however, all layout is deferred. This is done partly to optimize creating large composite morphs (which are often constructed &#8220;off-line&#8221; and then added to the world) and partly because the exact size of labelMorphs depends on font metrics that may vary from one X server to another. Thus, the layout of a morph containing labels would have to be recomputed in the context of a particular world anyway. Occasionally, one needs to know the exact size of a newly created morph (for example, to ensure that a menu does not pop up partially off the edge of the screen). In such cases it may be necessary to temporarily add the morph to the world in some remote location (such as <code class="docutils literal"><span class="pre">-1000000</span> <span class="pre">&#64;</span> <span class="pre">-1000000</span></code>) to force it to be laid out.</p>
</div>
<div class="section" id="morph-copying">
<h4>7.9.5. Morph Copying<a class="headerlink" href="#morph-copying" title="Permalink to this headline">¶</a></h4>
<p>When a composite morph is copied, its entire submorph tree is traversed and copied to produce a duplicate with the same structure. However, simply copying the structure is not quite enough because some of the morphs within a composite morph may refer to other morphs within the composite. For example, the buttons of a <code class="docutils literal"><span class="pre">radarView</span></code> refer to the <code class="docutils literal"><span class="pre">radarDisplay</span></code> morph. When a <code class="docutils literal"><span class="pre">radarView</span></code> morph is copied, the buttons of the copy must be updated to point to the radarDisplay morph in the copy, not that in the original <code class="docutils literal"><span class="pre">radarView</span></code>. A simplified diagram of this process is shown in <a class="reference internal" href="#figcopyingcomposite16"><span class="std std-numref">Fig. 7.16</span></a>.</p>
<p>Sometimes a morph may need to do something special when it is copied. In this case, the message <code class="docutils literal"><span class="pre">baseCopy</span></code> should be overridden rather than <code class="docutils literal"><span class="pre">copy</span></code>. See <code class="docutils literal"><span class="pre">traits</span> <span class="pre">ui2Button</span></code> for an example of how this is done.</p>
<div class="figure" id="id18">
<span id="figcopyingcomposite16"></span><img alt="_images/Figure16.png" src="_images/Figure16.png" />
<p class="caption"><span class="caption-number">Fig. 7.16 </span><span class="caption-text">Copying a composite morph. First, the submorph structure of the original morph is copied (a). Then, references among the submorphs of the composite updated to mirror those of the original (b).</span></p>
</div>
</div>
</div>
<div class="section" id="morph-responsibilities">
<h3>7.10. Morph Responsibilities<a class="headerlink" href="#morph-responsibilities" title="Permalink to this headline">¶</a></h3>
<p>There are two messages that each type of morph is expected to implement: <code class="docutils literal"><span class="pre">morphTypeName</span></code> and <code class="docutils literal"><span class="pre">prototype</span></code>. The first returns a string used to show the type of a morph in the user interface (e.g., in the core sampler) while the second, which should return the prototype for the morph, is used by the morph filing out code.</p>
<p>Two other messages may need to be overridden. These are:</p>
<blockquote>
<div><p><strong>isRectangular</strong> This message is used to optimize the drawing of shadows for morphs whose display completely fills their bounding rectangle. The default implementation returns <code class="docutils literal"><span class="pre">true</span></code>, so non-rectangular morphs such as circleMorphs must provide an implementation that returns <code class="docutils literal"><span class="pre">false</span></code>. (Hint: If a non-rectangular morph casts a rectangular shadow, someone probably forgot to override this message.)</p>
<p><strong>mapReferencesUsing</strong>: This message is sent during copying to update any references between the submorphs of a composite morph. Its argument is a dictionary mapping submorphs in the old composite morph to the corresponding submorphs in the copy. Morphs whose slots may contain references to other morphs within a composite should override this message to update these slots during copying. For example, a <code class="docutils literal"><span class="pre">ui2ButtonMorph</span></code> overrides this message in order to update its “target” slot. That way, if the button and its target are both embedded in some composite morph that is copied, the button in the copy will refer to the target in the copy. See <code class="docutils literal"><span class="pre">traits</span> <span class="pre">colorChangerMorph</span></code> for an example.</p>
</div></blockquote>
</div>
<div class="section" id="some-useful-morphs">
<h3>7.11. Some Useful Morphs<a class="headerlink" href="#some-useful-morphs" title="Permalink to this headline">¶</a></h3>
<p>The Self system comes with a large library of morphs. While some morphs exist solely to supporting the programming environment, many are general-purpose and can be reused to construct new applications. This section mentions some of the most useful and reusable morphs. To find out more about a given morph, use the programming environment to examine its prototype and traits objects. Useful comments are sometimes buried in the bodies of methods.</p>
<p><em>Widget morphs</em> are interactive, allowing the user to invoke an action or input some data.</p>
<blockquote>
<div><p><strong>sliderMorph</strong> Allows the user to specify a numerical value in some range. When the slider is manipulated, its target object is sent a user-specified message with the new slider value as an argument.</p>
<p><strong>ui2Button</strong> Executes a user-specified script when the button is pressed. The script can refer to the button&#8217;s target. The target of a button or slider morph can be set by using the middle-mouse menu <em>“Set Target”</em> command. This sets the target slot of the button or slider to the morph directly below it. Buttons are often decorated with a textual label, but a button can contain arbitrary morphs instead of, or in addition to, this label.</p>
<p><strong>ui2Menu</strong> A column full of buttons. A menu can be “pinned down” using the unlabeled button at its top. It can then be manipulated or disassembled like any other morph. Menus support a rich set of messages for adding normal or grayed out buttons and for inserting dividing lines.</p>
</div></blockquote>
<p><em>Structural morphs</em> are typically used to bind morphs together and arrange them into a pleasing layout.</p>
<blockquote>
<div><p><strong>rowMorph</strong> and <strong>columnMorph</strong>  Pack their submorphs into a row or column. These morphs offer several justification options and can also provide a border of empty space around their contents.</p>
<p><strong>frameMorph</strong>  Like a <code class="docutils literal"><span class="pre">columnMorph</span></code>, except that it can display various kinds of borders around its contents. Bezeled <code class="docutils literal"><span class="pre">frameMorphs</span></code> are used heavily in the programming environment to provide a three-dimensional look.</p>
<p><strong>spacerMorph</strong> While many types of morph (such as an empty <code class="docutils literal"><span class="pre">rowMorph</span></code>) could be used to fill a space between morphs, it is preferable to use a <code class="docutils literal"><span class="pre">spacerMorph</span></code> to make it clear that the only purpose of the morph is to control spacing. (Morphic allows users to customize the user interface by directly manipulating morphs. Thus, just as is it important to write readable programs, it is important to build composite morphs with “readable structure.”) Often, a <code class="docutils literal"><span class="pre">spacerMorph</span></code> is used to provide a fixed amount of space between submorphs in a <code class="docutils literal"><span class="pre">rowMorph</span></code> (or <code class="docutils literal"><span class="pre">columnMorph</span></code>). To accomplish this, the <code class="docutils literal"><span class="pre">spacerMorph</span></code> should be of the desired width, be rigid horizontally and space-filling vertically, and be the same color as the <code class="docutils literal"><span class="pre">rowMorph</span></code>. The message <strong>copyH:Color:</strong> (or <strong>copyV:Color:</strong> to creating a vertical spacer for use in a column) can be sent to <code class="docutils literal"><span class="pre">spacerMorph</span></code> to create a new <code class="docutils literal"><span class="pre">spacerMorph</span></code> with these properties. The other common use of <code class="docutils literal"><span class="pre">spacerMorphs</span></code> is to provide a stretchy space between morphs; the expression “<code class="docutils literal"><span class="pre">spacerMorph</span> <span class="pre">copy</span> <span class="pre">beFlexible</span></code>” makes a <code class="docutils literal"><span class="pre">spacerMorph</span></code> that does the job. Setting the <strong>baseMinWidth:</strong> or <strong>baseMinHeight:</strong> of such a spacer ensures that at least the given amount of space will be provided.</p>
</div></blockquote>
<p>Other morphs supply decorative or information content for user interfaces.</p>
<blockquote>
<div><p><strong>labelMorph</strong> displays a single-line string in a single font style, size, and color.</p>
<p><strong>circleMorph</strong> displays a filled circle.</p>
<p><strong>pixmapMorph</strong> displays an image (currently, at most 8 bits deep).</p>
<p><strong>movieMorph</strong> cycles through a sequence of images as it is stepped.</p>
</div></blockquote>
<p>The library includes two kinds of text editors.</p>
<blockquote>
<div><p><strong>editorMorph</strong> a general editor that allows arbitrary morphs to be embedding in the text.</p>
<p><strong>uglyTextEditor</strong> a simple, text-only editor that is a bit faster for editing larger amounts of text.</p>
</div></blockquote>
<p>Many applications implement specialized content morphs. For example, the Self programming environment defines morphs that represent Self objects, slots, and categories.</p>
</div>
<div class="section" id="the-graphical-environment">
<h3>7.12. The Graphical Environment<a class="headerlink" href="#the-graphical-environment" title="Permalink to this headline">¶</a></h3>
<p>Morphic hides many details of the underlying graphics system. This both simplifies programming and provides portability: the layer of abstraction between the programmer and the underlying graphics system allows the implementation of the low-level graphics to be changed without affecting programs written by clients. While the current version of the system is built on the X window system, it could be ported to other window systems fairly easily (although the target window system should support color or grayscale for good results). One might even create a Postscript implementation of the morphic graphics interface to allow morphs to render themselves on paper.</p>
<p>The graphics interface is implemented by canvas objects. There may eventually be many kinds of canvases for rendering onto displays of differing resolutions, color properties, or bit-depths. The current system provides four types of canvas. <code class="docutils literal"><span class="pre">windowCanvas</span></code> and <code class="docutils literal"><span class="pre">pixmapCanvas</span></code> draw onto a window or an offscreen buffer via the X protocol. A <code class="docutils literal"><span class="pre">nullCanvas</span></code> has the same interface but does not actually draw anything; it can be used to factor out the cost of graphics during performance analysis. <code class="docutils literal"><span class="pre">colorRecordingCanvas</span></code> is used internally by the colormap manager. All canvases implement the following messages for drawing geometric shapes:</p>
<blockquote>
<div><p>Draw a single pixel:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">point</span><span class="p">:</span> <span class="n">p</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
</pre></div>
</div>
<p>Outline or fill a rectangle or fill the entire canvas:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rectangle</span><span class="p">:</span> <span class="n">r</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">rectangle</span><span class="p">:</span> <span class="n">r</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">fillRectangle</span><span class="p">:</span> <span class="n">r</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">fillColor</span><span class="p">:</span> <span class="n">c</span>
</pre></div>
</div>
<p>Draw a solid or dashed line or a connected sequence of line segments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">line</span><span class="p">:</span> <span class="n">pt1</span> <span class="n">To</span><span class="p">:</span> <span class="n">pt2</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">line</span><span class="p">:</span> <span class="n">pt1</span> <span class="n">To</span><span class="p">:</span> <span class="n">pt2</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">dashedLine</span><span class="p">:</span> <span class="n">pt1</span> <span class="n">To</span><span class="p">:</span> <span class="n">pt2</span> <span class="n">DashSize</span><span class="p">:</span> <span class="n">d</span> <span class="n">Offset</span><span class="p">:</span> <span class="n">o</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">dashedLine</span><span class="p">:</span> <span class="n">pt1</span> <span class="n">To</span><span class="p">:</span> <span class="n">pt2</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">DashSize</span><span class="p">:</span> <span class="n">d</span> <span class="n">Offset</span><span class="p">:</span> <span class="n">o</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">lines</span><span class="p">:</span> <span class="n">pointList</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">lines</span><span class="p">:</span> <span class="n">pointList</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
</pre></div>
</div>
<p>Outline or fill a polygon:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">polygon</span><span class="p">:</span> <span class="n">pointList</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">polygon</span><span class="p">:</span> <span class="n">pointList</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">fillPolygon</span><span class="p">:</span> <span class="n">pointList</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
</pre></div>
</div>
<p>Outline or fill a circle:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">circleCenteredAt</span><span class="p">:</span> <span class="n">pt</span> <span class="n">Diameter</span><span class="p">:</span> <span class="n">d</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">circleCenteredAt</span><span class="p">:</span> <span class="n">pt</span> <span class="n">Diameter</span><span class="p">:</span> <span class="n">d</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">fillCircleCenteredAt</span><span class="p">:</span> <span class="n">pt</span> <span class="n">Diameter</span><span class="p">:</span> <span class="n">d</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
</pre></div>
</div>
<p>Outline or fill a wedge cut by the given angles from an ellipse bounded by the given rectangle:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">arcWithin</span><span class="p">:</span> <span class="n">r</span> <span class="n">From</span><span class="p">:</span> <span class="n">startAngle</span> <span class="n">Spanning</span><span class="p">:</span> <span class="n">spanAngle</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">arcWithin</span><span class="p">:</span> <span class="n">r</span> <span class="n">From</span><span class="p">:</span> <span class="n">startAngle</span> <span class="n">Spanning</span><span class="p">:</span> <span class="n">spanAngle</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">fillArcWithin</span><span class="p">:</span> <span class="n">r</span> <span class="n">From</span><span class="p">:</span> <span class="n">startAngle</span> <span class="n">Spanning</span><span class="p">:</span> <span class="n">spanAngle</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
</pre></div>
</div>
<p>Draw a simple or compound curve:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bezier</span><span class="p">:</span> <span class="n">pt1</span> <span class="n">Control</span><span class="p">:</span> <span class="n">c1</span> <span class="n">Control</span><span class="p">:</span> <span class="n">c2</span> <span class="n">To</span><span class="p">:</span> <span class="n">pt2</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">bSpline</span><span class="p">:</span> <span class="n">controlPoints</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
<span class="n">catmullRomSpline</span><span class="p">:</span> <span class="n">controlPoints</span> <span class="n">Width</span><span class="p">:</span> <span class="n">w</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
</pre></div>
</div>
<p>Draw text in the given font and size:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">text</span><span class="p">:</span> <span class="n">s</span> <span class="n">At</span><span class="p">:</span> <span class="n">pt</span> <span class="n">Font</span><span class="p">:</span> <span class="n">fName</span> <span class="n">Size</span><span class="p">:</span> <span class="n">fSize</span> <span class="n">Color</span><span class="p">:</span> <span class="n">c</span>
</pre></div>
</div>
<p>Display a portable pixel-based image (a <code class="docutils literal"><span class="pre">ui2Image</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">image</span><span class="p">:</span> <span class="n">i</span> <span class="n">At</span><span class="p">:</span> <span class="n">pt</span>
</pre></div>
</div>
</div></blockquote>
<p>Canvases maintain an offset, allowing graphic operations to be automatically translated. (Canvases also maintain a scale factor, but scaling is not currently used and is probably buggy. Furthermore, image scaling is not implemented.)</p>
<p>In morphic, unlike many graphics packages, the graphics context is hidden from the programmer; all the common parameters that control the behavior of a given drawing command—such as color and line width—are passed as explicit parameters. A few infrequently changed parameters, such as the fill pattern and the clipping rectangle, can be changed temporarily via messages such as <code class="docutils literal"><span class="pre">withPattern:Do:</span></code> and <code class="docutils literal"><span class="pre">withClip:Do:</span></code>. The canvas handles these messages by changing the state of the underlying graphics context, executing the block provided (which presumably issues some drawing commands to that canvas), and restoring the original state of the graphics context. Nested invocations of <code class="docutils literal"><span class="pre">withClip:Do:</span></code> are handled sensibly: a stack of clipping rectangles is maintained and drawing operations are clipped to the intersection of all rectangles currently on the stack.</p>
<div class="section" id="specifying-colors">
<h4>7.12.1. Specifying Colors<a class="headerlink" href="#specifying-colors" title="Permalink to this headline">¶</a></h4>
<p>Colors in morphic are represented by <em>paint</em> objects. A paint can be manipulated as either a red-green-blue triplet or as a hue-saturation-brightness triplet. Red, green, blue, saturation, and brightness are specified as numbers in the range [0.0 .. 1.0], where zero means black or unsaturated and one means full-brightness or saturated. Hue, which corresponds to the angular location of the hue on the color-wheel, is specified as a number in the range [0.0 .. 360.0], where zero corresponds to red. Colors with zero saturation (i.e., black, white, and shades of gray) have no hue; if you increase the saturation of such an achromatic color, its hue is arbitrarily chosen to be zero (red).</p>
<p>Paints provide transformations to:</p>
<blockquote>
<div>change the red, green, or blue component,
change the hue, saturation, or brightness component, and
interpolate between two colors.</div></blockquote>
<p>Since paint objects are immutable, all these transformations are <em>functional</em>. That is, they return a new paint object, leaving the original paint object unchanged.</p>
<p>Paint objects describe colors in a device-independent and persistent manner. They can be saved in snapshots and filed out, and used with any kind of display (or printer, if printing were supported). The details of color map management are handled by each kind of canvas in a way appropriate for the underlying medium. For example, a canvas for a gray-scale display might map colors to shades of gray according to brightness.</p>
</div>
<div class="section" id="specifying-fonts">
<h4>7.12.2. Specifying Fonts<a class="headerlink" href="#specifying-fonts" title="Permalink to this headline">¶</a></h4>
<p>When drawing text in morphic, the font&#8217;s name and size are specified independently. The size parameter specifies the font height in pixels, and typically ranges from 6 to 72 or more. (The capital letters of a 72 pixel font are about an inch high on a typical display.) This interface suggests that the underlying graphics system fonts can be scaled arbitrarily and, indeed, many modern X servers do support scalable fonts.</p>
<p>The scheme that was implemented for Self 4.0 has not survived the Macintosh port <a class="footnote-reference" href="#f1" id="id2"><sup>1</sup></a>. In order to allow portable specification of fonts, we have introduced a <code class="docutils literal"><span class="pre">fontSpec</span></code> prototype that holds a font&#8217;s family name (e.g. <code class="docutils literal"><span class="pre">times</span></code>), a font style (e.g. <code class="docutils literal"><span class="pre">bold</span></code>), and a font size (e.g. <code class="docutils literal"><span class="pre">12</span></code>). This object uses an immutable public protocol; it responds to <code class="docutils literal"><span class="pre">copy-Name:</span></code>, <code class="docutils literal"><span class="pre">copyName:Style:</span></code>, <code class="docutils literal"><span class="pre">copyName:Style:Size</span></code>, etc. Once you have created a <code class="docutils literal"><span class="pre">fontSpec</span></code> object you can then pass it to, for example, a label morph:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myLabel</span> <span class="n">fontSpec</span><span class="p">:</span>
    <span class="n">fontSpec</span> <span class="n">copyName</span><span class="p">:</span> <span class="s1">&#39;helvetica&#39;</span> <span class="n">Style</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span> <span class="n">Size</span><span class="p">:</span> <span class="mi">14</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">fontSpec</span></code>&#8216;s encapsulate some attributes of a font and in the future should perhaps encapsulate the color as well.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>The rest of this section has been written in 1999 under time pressure to get Self 4.1 out so I can get back to other things. John bears no responsibility for its shortcomings. You can send questions about this to me, David Ungar, at <a class="reference external" href="mailto:david&#46;ungar&#37;&#52;&#48;sun&#46;com">david<span>&#46;</span>ungar<span>&#64;</span>sun<span>&#46;</span>com</a>.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-vmref"></span><div class="section" id="virtual-machine-reference">
<span id="pp-vmref"></span><h2>8. Virtual Machine Reference<a class="headerlink" href="#virtual-machine-reference" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-buildvm"></span><div class="section" id="building-a-vm">
<span id="id1"></span><h3>8.1. Building a VM<a class="headerlink" href="#building-a-vm" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Last updated 3 February 2014 for Self 4.5.0</div></blockquote>
<p>The sources for the Self VM are on the <a class="reference external" href="https://github.com/russellallen/self">GitHub repository</a>.</p>
<div class="section" id="requirements">
<h4>8.1.1. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h4>
<p>On Mac OS X you will need XCode, version 4 or higher, with the command line tools installed and <a class="reference external" href="http://www.cmake.org/">CMake</a> in at least version 2.8. <a class="reference external" href="http://www.cmake.org/">CMake</a> can be easily installed using the <a class="reference external" href="http://brew.sh">Brew</a> package manager.</p>
<p>On Linux you will generally need the appropriate libraries for Git, CMake, a GCC or Clang toolchain, X and Ncurses. Self is a 32bit program at the moment, so you will need all libraries in 32bit versions.</p>
<p>On Fedora 19 you will need: git cmake gcc gcc-c++ glibc-devel.i686 libstdc++-devel libstdc++-devel.i686 libX11-devel.i686 libXt-devel.i686 libXext-devel.i686 libXrender-devel.i686 libXau-devel.i686 libxcb-devel.i686 ncurses-devel.i686 ncurses-libs.i686</p>
<p>On Ubuntu 16.04 you will need: git cmake g++ gcc-multilib g++-multilib libx11-dev:i386 libxext-dev:i386 libncurses-dev:i386 libtinfo-dev:i386</p>
<p>Self builds with <a class="reference external" href="http://gcc.gnu.org/">GCC</a> ≥ 4.2 or <a class="reference external" href="http://clang.llvm.org/">Clang</a> ≥ 2.0.</p>
</div>
<div class="section" id="building">
<h4>8.1.2. Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h4>
<p>You can do an in-tree build with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">.</span>
<span class="n">cmake</span> <span class="o">--</span><span class="n">build</span> <span class="o">.</span>
</pre></div>
</div>
<p>or an out-of-tree build with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mkdir -p $YOU_BUILD_DIRECTORY; cd $YOU_BUILD_DIRECTORY
cmake $DIRECTORY_OF_SELF_CHECKOUT
cmake --build $YOU_BUILD_DIRECTORY
</pre></div>
</div>
<p>CMake respects your environment variables, so to build Self with Clang, configure it like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>CC=clang CXX=clang++ cmake $DIRECTORY_OF_SELF_CHECKOUT
</pre></div>
</div>
<p>On Mac OS X with Xcode, you can use the Xcode generator of CMake like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cmake -GXcode $DIRECTORY_OF_SELF_CHECKOUT
</pre></div>
</div>
<p>On 64bit Linux, you may want to explicitly use 32bit compilation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>CC=&quot;gcc -m32&quot; CXX=&quot;g++ -m32&quot; cmake $DIRECTORY_OF_SELF_CHECKOUT
</pre></div>
</div>
<p>The same holds for Clang.</p>
<p>You may wish to use <code class="docutils literal"><span class="pre">ccmake</span></code> or the CMake GUI (<code class="docutils literal"><span class="pre">cmake-gui</span></code> or the CMake.app on OS X) to configure available features like Release/Debug/Profiled builds or to enable experimental features.</p>
</div>
</div>
</div>
<div class="section" id="startup-options">
<h3>8.2. Startup options<a class="headerlink" href="#startup-options" title="Permalink to this headline">¶</a></h3>
<p>The following command-line options are recognised by the Virtual Machine:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">-f</span> <span class="pre">filename</span></code></td>
<td>Reads filename (which should contain Self source) immediately after startup (after reading the snapshot) and evaluates the contents. Useful for setting options, installing personal shortcuts, etc.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">-h</span></code></td>
<td>Prints a message describing the options.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">-p</span></code></td>
<td>Suppresses execution of the expression <code class="docutils literal"><span class="pre">snapshotAction</span> <span class="pre">postRead</span></code> after reading a snapshot. Useful if something in the startup sequence causes the system to break.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">-s</span> <span class="pre">snapshot</span></code></td>
<td>Reads initial world from snapshot. A snapshot begins with the line <code class="docutils literal"><span class="pre">exec</span> <span class="pre">Self</span> <span class="pre">-s</span> <span class="pre">$0</span> <span class="pre">$&#64;</span></code> which causes the Virtual Machine to begin execution with the snapshot.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">-w</span></code></td>
<td>Don’t print warnings about object code.</td>
</tr>
</tbody>
</table>
<p>These options are provided for use by Self VM implementors:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">-F</span></code></td>
<td>Discards any machine code saved in the snapshot. If the code in a snapshot is for some reason corrupted, but the objects are not, this option can be used to recover the snapshot.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">-l</span> <span class="pre">logfile</span></code></td>
<td>Writes a log of events generated by the spy to logfile.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">-r</span></code></td>
<td>Disables real timer interrupts.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">-t</span></code></td>
<td>Disables all timers.</td>
</tr>
</tbody>
</table>
<p>Other command-line options are ignored by the Virtual Machine but are available at Self level via
the primitive <code class="docutils literal"><span class="pre">_CommandLine</span></code>.</p>
<p>The standard set of Self objects (built by the <code class="docutils literal"><span class="pre">worldBuilder.self</span></code> script) also defines <code class="docutils literal"><span class="pre">-b</span></code> (where the <code class="docutils literal"><span class="pre">objects</span></code> director is) and <code class="docutils literal"><span class="pre">-o</span></code> (for specifying build options)</p>
</div>
<div class="section" id="system-triggered-messages">
<h3>8.3. System-triggered messages<a class="headerlink" href="#system-triggered-messages" title="Permalink to this headline">¶</a></h3>
<p>Certain events cause the system to automatically send a message to the lobby. After reading a snapshot
the expression <code class="docutils literal"><span class="pre">snapshotAction</span> <span class="pre">postRead</span></code> is evaluated. This allows the Self world to
reinitialize itself — for example, to reopen windows.</p>
<p>There are other situations in which the system sends messages; see <a class="reference internal" href="#run-time-message-lookup-errors">Run-time message lookup errors</a>.</p>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><span class="target" id="index-5"></span></div>
<div class="section" id="run-time-message-lookup-errors">
<span id="index-6"></span><h3>8.4. Run-time message lookup errors<a class="headerlink" href="#run-time-message-lookup-errors" title="Permalink to this headline">¶</a></h3>
<p>If an error occurs during a message send, the system sends a message to the receiver of the message.
Any object can handle these errors by defining (or inheriting) a slot with the corresponding
selector. All messages sent by the system in response to a message lookup error have the same arguments.
The first argument is the offending message’s selector; the additional arguments specify
the message send type (one of ’<code class="docutils literal"><span class="pre">normal</span></code>’, ’<code class="docutils literal"><span class="pre">implicitSelf</span></code>’, ’<code class="docutils literal"><span class="pre">undirectedResend</span></code>’, ’<code class="docutils literal"><span class="pre">directedResend</span></code>’,
or ’<code class="docutils literal"><span class="pre">delegated</span></code>’), the directed resend parent name or the delegatee (0 if not
applicable), the sending method holder, and a vector containing the arguments to the message, if
any.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">undefinedSelector:Type:Delegatee:MethodHolder:Arguments</span></code></dt>
<dd><div class="first last line-block">
<div class="line">The receiver does not understand the <code class="docutils literal"><span class="pre">message:</span></code> no slot matching the selector can be found in the receiver or its ancestors.</div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">ambiguousSelector:Type:Delegatee:MethodHolder:Arguments</span></code></dt>
<dd><div class="first last line-block">
<div class="line">There is more than one slot matching the selector.</div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">missingParentSelector:Type:Delegatee:MethodHolder:Arguments</span></code></dt>
<dd><div class="first last line-block">
<div class="line">The parent slot through which the resend should have been directed was not found in the sending method holder.</div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">mismatchedArgumentCountSelector:Type:Delegatee:MethodHolder:Arguments</span></code></dt>
<dd><div class="first last line-block">
<div class="line">The number of arguments supplied to the <code class="docutils literal"><span class="pre">_Perform</span></code> primitive does not match the number of arguments required by the selector.</div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">performTypeErrorSelector:Type:Delegatee:MethodHolder:Arguments</span></code></dt>
<dd><div class="first last line-block">
<div class="line">The first argument to the <code class="docutils literal"><span class="pre">_Perform</span></code> primitive (the selector) wasn’t a canonical string.</div>
</div>
</dd>
</dl>
<p>These error messages are just like any other message. Therefore, it is possible that the object P
causing the error (which is being sent the appropriate error message) does not understand the error
message <em>M</em> either. If this happens, the system sends the first message (<code class="docutils literal"><span class="pre">undefinedSelector:</span></code>) to
the current process, with the error message M as argument. If this is not understood, then the system
suspends the process. If the scheduler is running, it is notified of the failure.</p>
<p>The system will also suspend a process if it runs out of stack space (too much recursion) or if a
block is evaluated whose lexically-enclosing scope has already returned. Since these errors are
nonrecoverable they cannot be caught by the same Self process; the scheduler, if running, is notified.</p>
</div>
<div class="section" id="low-level-error-messages">
<h3>8.5. Low-level error messages<a class="headerlink" href="#low-level-error-messages" title="Permalink to this headline">¶</a></h3>
<p>Five kinds of errors can occur during the execution of a Self program: lookup errors, primitive errors,
programmer defined errors, non-recoverable errors, and fatal VM errors. All but the last of
these are usually caught and handled by mechanisms in the programming environment, resulting
in a debugger being presented to the user. However, if programs are run without the programming
environment, or the error-handling mechanisms themselves are broken, low-level error facilities
are used.</p>
<p>This section describes the various error messages presented by the low-level facilities. For each
category or error, the general layout of error messages in that category will be explained along with
the format of the stack trace. Then a “rogue’s gallery” of the errors in that category will be shown.</p>
<p>By default, errors are handled by a set of methods defined in module <code class="docutils literal"><span class="pre">errorHandling</span></code>. For all errors
except nonrecoverable and fatal VM errors, an object can handle errors in its own way by defining
its own error handling methods. If the object in which an error occurs neither inherits nor
defines error handling behavior, the VM prints out a low-level error message and a stack trace. The
system will also resort to this low-level message and trace if an error is encountered while trying
to handle an error.</p>
</div>
<div class="section" id="an-example">
<h3>8.6. An example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h3>
<p>Here is an expression that produces an error in the current system:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>“Self 7” 100000 factorial
The stack has grown too big.
(Self limits stack sizes, and cannot resume processes with stack overflows.)
To debug type “attach” or to show stack type “zombies first printError”.
</pre></div>
</div>
<p>The error arose because the recursive method factorial exceeded the size allocated for the process
stack which resulted in a stack overflow.</p>
<p>The virtual machine currently allocates a fixed-size stack to each process and does not extend the stack on demand.</p>
</div>
<div class="section" id="lookup-errors">
<h3>8.7. Lookup errors<a class="headerlink" href="#lookup-errors" title="Permalink to this headline">¶</a></h3>
<p>Lookup errors occur when an object does not understand a message that is sent to it. How the actual
message lookup is done is described in the <a class="reference internal" href="index.html#document-langref"><span class="doc">Language Reference</span></a> chapter.</p>
<dl class="docutils">
<dt><strong>No ’foo’ slot found in shell &lt;0&gt;.</strong></dt>
<dd><div class="first last line-block">
<div class="line">The lookup found no slot matching the selector <code class="docutils literal"><span class="pre">foo</span></code>.</div>
</div>
</dd>
<dt><strong>No ’fish’ delegatee slot was found in &lt;a child of lobby&gt; &lt;12&gt;.</strong></dt>
<dd><div class="first last line-block">
<div class="line">The lookup found no parent slot <code class="docutils literal"><span class="pre">fish</span></code>, which was explicitly specified as the delegatee of the message.</div>
</div>
</dd>
</dl>
<div class="line-block">
<div class="line"><strong>More than one ’system’ slot was found in shell &lt;0&gt;.</strong></div>
<div class="line"><strong>The matching slots are: oddballs &lt;6&gt; and prototypes &lt;7&gt;.</strong></div>
</div>
<blockquote>
<div><div class="line-block">
<div class="line">The lookup found two matching <code class="docutils literal"><span class="pre">system</span></code> slots which means the message is ambiguous. The error message also says where the matching slots were found.</div>
</div>
</div></blockquote>
</div>
<div class="section" id="programmer-defined-errors">
<h3>8.8. Programmer defined errors<a class="headerlink" href="#programmer-defined-errors" title="Permalink to this headline">¶</a></h3>
<p>These are explicitly raised in the Self program to report errors, e.g. sending the message <code class="docutils literal"><span class="pre">first</span></code>
to an empty list will cause such an error.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">first</span> <span class="ow">is</span> <span class="n">absent</span><span class="o">.</span>
<span class="n">Receiver</span> <span class="ow">is</span><span class="p">:</span> <span class="nb">list</span> <span class="o">&lt;</span><span class="mi">7</span><span class="o">&gt;.</span>
</pre></div>
</div>
<p>Use the selectors <code class="docutils literal"><span class="pre">error:</span></code> and <code class="docutils literal"><span class="pre">error:Arguments:</span></code> to raise a programmer defined error.</p>
</div>
<div class="section" id="primitive-errors">
<h3>8.9. Primitive errors<a class="headerlink" href="#primitive-errors" title="Permalink to this headline">¶</a></h3>
<p>Primitive failures occur when a primitive cannot perform the requested operation, for example, because
of a missing or invalid argument.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>badTypeError: the ’_IntAdd:’ primitive failed.
Its receiver was shell &lt;6&gt;.
</pre></div>
</div>
<blockquote>
<div>The primitive failed with <code class="docutils literal"><span class="pre">badTypeError</span></code> because the shell in not an integer.</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">selector</span> <span class="mi">12</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">sent</span> <span class="n">to</span> <span class="n">shell</span> <span class="n">because</span> <span class="n">it</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">string</span><span class="o">.</span>
</pre></div>
</div>
<blockquote>
<div>The primitive <code class="docutils literal"><span class="pre">_Perform</span></code> expects a string as its first argument.</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span>The selector ’add:’ could not be sent to shell &lt;0&gt; because it does not take 2 arguments.
</pre></div>
</div>
<blockquote>
<div>The primitive <code class="docutils literal"><span class="pre">_Perform</span></code> received the wrong number of arguments.</div></blockquote>
<p>There are many other kinds of possible primitive errors.</p>
</div>
<div class="section" id="nonrecoverable-process-errors">
<h3>8.10. Nonrecoverable process errors<a class="headerlink" href="#nonrecoverable-process-errors" title="Permalink to this headline">¶</a></h3>
<p>Errors that stop a process from continuing execution are referred to as nonrecoverable errors.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">stack</span> <span class="n">has</span> <span class="n">grown</span> <span class="n">too</span> <span class="n">big</span><span class="o">.</span>
<span class="p">(</span><span class="n">Self</span> <span class="mf">4.0</span> <span class="n">limits</span> <span class="n">stack</span> <span class="n">sizes</span><span class="p">,</span> <span class="ow">and</span> <span class="n">cannot</span> <span class="n">resume</span> <span class="n">processes</span> <span class="k">with</span> <span class="n">stack</span>
<span class="n">overflows</span><span class="o">.</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>A stack overflow error occurs because the current version of Self allocates a fixed size stack for each process, and the stack cannot be expanded.</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Self</span> <span class="mf">4.0</span> <span class="n">cannot</span> <span class="n">run</span> <span class="n">a</span> <span class="n">block</span> <span class="n">after</span> <span class="n">its</span> <span class="n">enclosing</span> <span class="n">method</span> <span class="n">has</span> <span class="n">returned</span><span class="o">.</span>
<span class="p">(</span><span class="n">Self</span> <span class="n">cannot</span> <span class="n">resume</span> <span class="n">this</span> <span class="n">process</span><span class="p">,</span> <span class="n">either</span><span class="o">.</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>This error occurs if a block is executed after its lexically enclosing method has returned.
This is called a “non-LIFO” block. Non-LIFO blocks are not supported by
the current version of Self.</div></blockquote>
</div>
<div class="section" id="fatal-errors">
<span id="index-7"></span><h3>8.11. Fatal errors<a class="headerlink" href="#fatal-errors" title="Permalink to this headline">¶</a></h3>
<p>In rare cases, the virtual machine may encounter a fatal error (e.g., a resource limit is exceeded or
an internal error is discovered). When this happens, a short menu is displayed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">VM</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">4.0</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">Tue</span> <span class="mi">27</span> <span class="n">Jun</span> <span class="mi">95</span> <span class="mi">13</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">49</span> <span class="n">Solaris</span> <span class="mf">2.</span><span class="n">x</span> <span class="p">(</span><span class="n">svr4</span><span class="p">)</span>
<span class="n">Internal</span> <span class="n">error</span><span class="p">:</span> <span class="n">signal</span> <span class="mi">11</span> <span class="n">code</span> <span class="mi">3</span> <span class="n">addr</span> <span class="mi">4</span> <span class="n">pc</span> <span class="mh">0x1ac768</span><span class="o">.</span>
<span class="n">Do</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span><span class="p">:</span>
<span class="mi">1</span><span class="p">)</span> <span class="n">Quit</span> <span class="n">Self</span> <span class="p">(</span><span class="n">optionally</span> <span class="n">attempting</span> <span class="n">to</span> <span class="n">write</span> <span class="n">a</span> <span class="n">snapshot</span><span class="p">)</span>
<span class="mi">2</span><span class="p">)</span> <span class="n">Try</span> <span class="n">to</span> <span class="nb">print</span> <span class="n">the</span> <span class="n">Self</span> <span class="n">stack</span>
<span class="mi">3</span><span class="p">)</span> <span class="n">Try</span> <span class="n">to</span> <span class="k">return</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Self</span> <span class="n">prompt</span>
<span class="mi">4</span><span class="p">)</span> <span class="n">Force</span> <span class="n">a</span> <span class="n">core</span> <span class="n">dump</span>
<span class="n">Your</span> <span class="n">choice</span><span class="p">:</span>
</pre></div>
</div>
<p>The first two lines help the Self implementors locate the problem. Printing the Self stack may
provide more information about the problem but does not always work. Returning to the Self
prompt may be successful, but the system integrity may have been compromised as a result of the
error. The safest course is to attempt to write a snapshot (if there are unsaved changes), and then
check the integrity of the snapshot by executing the primitive <code class="docutils literal"><span class="pre">_Verify</span></code> after starting it. If there are
any error messages from the primitive, do not attempt to continue using the snapshot.</p>
<p>Since fatal errors usually arise from a bug in the virtual machine, please send the Self group a bug
report, and include a copy of the error message if possible. If the error is reproducible please describe
how to reproduce it (including a snapshot or source files may be helpful).</p>
<span class="target" id="index-8"></span><span class="target" id="index-9"></span><span class="target" id="index-10"></span><span class="target" id="index-11"></span><span class="target" id="index-12"></span><span class="target" id="index-13"></span><span class="target" id="index-14"></span><span class="target" id="index-15"></span><span class="target" id="index-16"></span><span class="target" id="index-17"></span><span class="target" id="index-18"></span><span class="target" id="index-19"></span><span class="target" id="index-20"></span><span class="target" id="index-21"></span><span class="target" id="index-22"></span><span class="target" id="index-23"></span><span class="target" id="index-24"></span><span class="target" id="index-25"></span><span class="target" id="index-26"></span><span class="target" id="index-27"></span><span class="target" id="index-28"></span><span class="target" id="index-29"></span><span class="target" id="index-30"></span><span class="target" id="index-31"></span></div>
<div class="section" id="the-initial-self-world">
<h3>8.12. The initial Self world<a class="headerlink" href="#the-initial-self-world" title="Permalink to this headline">¶</a></h3>
<p>The diagram on the following pages shows all objects in the “bare” Self world. In addition, literals
like integers, floats, and strings are conceptually part of the initial Self world; block and object
literals are created by the programmer as needed. All the objects in the system are created by adding
slots to these objects or by cloning them. <a class="reference internal" href="#tableobjinworld"><span class="std std-numref">Table 8.1</span></a> lists all the initial objects and provides a short
description for each. Reading in the world rearranges the structure of the “bare” Self world (see <a class="reference internal" href="index.html#document-selfwrld"><span class="doc">The Self World</span></a>).</p>
<div class="figure" id="id4">
<span id="initialselfworld"></span><img alt="_images/Chapter_5_Figure_3.png" src="_images/Chapter_5_Figure_3.png" />
<p class="caption"><span class="caption-number">Fig. 8.1 </span><span class="caption-text">The initial Self world (part 1)</span></p>
</div>
<div class="figure" id="id5">
<a class="reference internal image-reference" href="_images/Chapter_5_Figure_4.png"><img alt="_images/Chapter_5_Figure_4.png" src="_images/Chapter_5_Figure_4.png" style="width: 695.0px; height: 451.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 8.2 </span><span class="caption-text">The initial Self world (part 2)</span></p>
</div>
<table border="1" class="colwidths-given docutils" id="id6">
<span id="tableobjinworld"></span><caption><span class="caption-number">Table 8.1 </span><span class="caption-text">Objects in the initial Self world</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Object</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">lobby</span></code></td>
<td>The center of the Self object hierarchy, and the context in which expressions typed in at the VM prompt, read in via <code class="docutils literal"><span class="pre">_RunScript</span></code>, or used as the initializers of slots, are evaluated.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-given docutils" id="id7">
<caption><span class="caption-number">Table 8.2 </span><span class="caption-text">Objects in the lobby</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Object</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">shell</span></code></td>
<td>After reading in the world, shell is the context in which expressions typed in at the prompt are evaluated.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">snapshotAction</span></code></td>
<td>An object with slot for the startup action (see <a class="reference internal" href="#system-triggered-messages">System-triggered messages</a>), <code class="docutils literal"><span class="pre">postRead</span></code>. This slot initially contains nil.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">systemObjects</span></code></td>
<td>This object contains slots containing the general system objects, including nil, true, false, and the prototypical vectors and mirrors.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-given docutils" id="id8">
<caption><span class="caption-number">Table 8.3 </span><span class="caption-text">Objects in systemObjects</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Object</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">nil</span></code></td>
<td>The initializer for slots that are not explicitly initialized. Indicates “not a useful object.”</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">true</span></code></td>
<td>Boolean <code class="docutils literal"><span class="pre">true</span></code>. Argument to and returned by some primitives.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">false</span></code></td>
<td>Boolean <code class="docutils literal"><span class="pre">false</span></code>. Argument to and returned by some primitives.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">vector</span></code></td>
<td>The prototype for (normal) vectors.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">byteVector</span></code></td>
<td>The prototype for byte vectors.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">proxy</span></code></td>
<td>The prototype for proxy objects.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">fctProxy</span></code></td>
<td>The prototype for fctProxy objects.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">vector</span> <span class="pre">parent</span></code></td>
<td>The object that vector inherits from. Since all object vectors will inherit from this object (because they are cloned from vector), this object will be the repository for shared behavior (a traits object) for vectors.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">byteVector</span> <span class="pre">parent</span></code></td>
<td>Similar to vector parent: the byteVector traits object.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">slotAnnotation</span></code></td>
<td>The default slot annotation object.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">objectAnnotation</span></code></td>
<td>The default object annotation object</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">profiler</span></code></td>
<td>The prototype for profilers.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">mirrors</span></code></td>
<td>See below.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-given docutils" id="id9">
<caption><span class="caption-number">Table 8.4 </span><span class="caption-text">Literals and their parents</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Literal</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">integers</span></code></td>
<td>Integers have one slot, a parent slot called parent. All integers have the same parent: see 0 parent, below.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">0</span> <span class="pre">parent</span></code></td>
<td>All integers share this parent, the integer traits object.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">floats</span></code></td>
<td>Floats have one slot, a parent slot called parent. All floats have the same parent: see <code class="docutils literal"><span class="pre">0.0</span> <span class="pre">parent</span></code>, below.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">0.0</span> <span class="pre">parent</span></code></td>
<td>All floats share this parent, the float traits object.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">canonical</span> <span class="pre">strings</span></code></td>
<td>In addition to a byte vector part, a canonical string has one slot, parent, a parent slot containing the same object for all canonical strings (see <code class="docutils literal"><span class="pre">’’</span> <span class="pre">parent</span></code> below).</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">''</span> <span class="pre">parent</span></code></td>
<td>All canonical strings share this parent, the string traits object.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">blocks</span></code></td>
<td>Blocks have two slots: <code class="docutils literal"><span class="pre">parent</span></code>, a parent slot containing the same object for all blocks (see <code class="docutils literal"><span class="pre">[</span> <span class="pre">]</span> <span class="pre">parent</span></code>, below), and <code class="docutils literal"><span class="pre">value</span></code> (or <code class="docutils literal"><span class="pre">value:</span></code>, or <code class="docutils literal"><span class="pre">value:With:</span></code>, etc., depending on the number of arguments the block takes) which contains the block’s deferred method.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[</span> <span class="pre">]</span> <span class="pre">parent</span></code></td>
<td>All blocks share this parent, the block traits object.</td>
</tr>
</tbody>
</table>
<span class="target" id="index-35"></span><span class="target" id="index-36"></span><span class="target" id="index-37"></span><span class="target" id="index-38"></span><span class="target" id="index-39"></span><table border="1" class="colwidths-given docutils" id="id10">
<caption><span class="caption-number">Table 8.5 </span><span class="caption-text">Prototypical mirrors</span><a class="headerlink" href="#id10" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mirror</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">smiMirror</span></code></td>
<td>Prototypical mirror on a small integer; the reflectee is 0.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">floatMirror</span></code></td>
<td>Prototypical mirror on a float; the reflectee is 0.0.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">stringMirror</span></code></td>
<td>Prototypical mirror on a canonical string; the reflectee is the empty canonical string (<code class="docutils literal"><span class="pre">’’</span></code>).</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">processMirror</span></code></td>
<td>Prototypical mirror on a process; the reflectee is the initial process.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">byteVectorMirror</span></code></td>
<td>Prototypical mirror on a byte vector; the reflectee is the prototypical byte vector.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">objVectorMirror</span></code></td>
<td>Prototypical mirror on object vectors; the reflectee is the prototypical object vector.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">assignmentMirror</span></code></td>
<td>Mirror on the assignment primitive; the actual reflectee is an empty object.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">mirrorMirror</span></code></td>
<td>Prototypical mirror on a mirror; the reflectee is <code class="docutils literal"><span class="pre">slotsMirror</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">slotsMirror</span></code></td>
<td>Prototypical mirror on a plain object without code; the reflectee is an empty object.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">blockMirror</span></code></td>
<td>Prototypical mirror on a block.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">methodMirror</span></code></td>
<td>Prototypical mirror on a normal method.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">blockMethodMirror</span></code></td>
<td>Prototypical mirror on a block method.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">methodActivationMirror</span></code></td>
<td>Prototypical mirror on a method activation.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">blockMethodActivationMirror</span></code></td>
<td>Prototypical mirror on a block activation.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">proxyMirror</span></code></td>
<td>Prototypical mirror on a proxy.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">fctProxyMirror</span></code></td>
<td>Prototypical mirror on a fctProxy.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">profilerMirror</span></code></td>
<td>Prototypical mirror on a profiler.</td>
</tr>
</tbody>
</table>
<p>All of the prototypical mirrors consist of one slot, a parent slot named parent. Each of
these parent slots points to an empty object (denoted in <a class="reference internal" href="#initialselfworld"><span class="std std-numref">Fig. 8.1</span></a> by “<code class="docutils literal"><span class="pre">(</span> <span class="pre">)</span></code>”).</p>
<span class="target" id="index-41"></span><span class="target" id="index-42"></span></div>
<div class="section" id="option-primitives">
<h3>8.13. Option Primitives<a class="headerlink" href="#option-primitives" title="Permalink to this headline">¶</a></h3>
<p><strong>This section has not been updated to include all options present in Self 4.0.</strong></p>
<p>Option primitives control various aspects of the Self system and its inner workings. Many of
them are used to debug or instrument the Self system and are probably of little interest to users.
The options most useful for users are listed in <a class="reference internal" href="#tableoptionprimitives"><span class="std std-numref">Table 8.6</span></a>; other option primitives can be found in Appendix
<a class="reference internal" href="index.html#pp-primitives"><span class="std std-ref">10.8</span></a> <a class="reference internal" href="index.html#document-primitives"><span class="doc">Primitives</span></a>, and a list of all option primitives and their current settings can be printed with the
primitive <code class="docutils literal"><span class="pre">_PrintOptionPrimitives.</span></code></p>
<span class="target" id="index-44"></span><span class="target" id="index-45"></span><span class="target" id="index-46"></span><table border="1" class="docutils" id="id11">
<span id="tableoptionprimitives"></span><caption><span class="caption-number">Table 8.6 </span><span class="caption-text">Some useful option primitives</span><a class="headerlink" href="#id11" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">_PrintPeriod[:]</span></code></td>
<td>Print a period when reading a script file with <code class="docutils literal"><span class="pre">_RunScript</span></code>. Default: <code class="docutils literal"><span class="pre">false</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">_PrintScriptName[:]</span></code></td>
<td>Print the file name when reading a script file. Default: <code class="docutils literal"><span class="pre">false</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">_Spy[:]</span></code></td>
<td>Start the system monitor (see Appendix <a class="reference internal" href="index.html#pp-the-system-monitor"><span class="std std-ref">10.7</span></a> for details). Default: <code class="docutils literal"><span class="pre">false</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">_StackPrintLimit[:]</span></code></td>
<td>Controls the number of stack frames printed by <code class="docutils literal"><span class="pre">_PrintProcessStack</span></code>. Default: <code class="docutils literal"><span class="pre">20</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">_DirPath[:]</span></code></td>
<td>The default directory path for script files.</td>
</tr>
</tbody>
</table>
<p>Each option primitive controls a variable within the virtual machine containing a boolean, integer,
or string (in fact, the option primitives can be thought of as “primitive variables”). Invoking the
version of the primitive that doesn’t take an argument <a class="footnote-reference" href="#f1" id="id1"><sup>1</sup></a> returns the current setting; invoking it with
an argument sets the variable to the new value and returns the old value.</p>
<p>Try running the system monitor with <code class="docutils literal"><span class="pre">_Spy:</span> <span class="pre">true</span></code>. The system monitor will continuously display
various information about the system’s activities and your memory usage.</p>
<span class="target" id="index-48"></span><span class="target" id="index-49"></span><span class="target" id="index-50"></span><span class="target" id="index-51"></span><span class="target" id="index-52"></span><span class="target" id="index-53"></span><span class="target" id="index-54"></span><span class="target" id="index-55"></span></div>
<div class="section" id="interfacing-with-other-languages">
<h3>8.14. Interfacing with other languages<a class="headerlink" href="#interfacing-with-other-languages" title="Permalink to this headline">¶</a></h3>
<p>This chapter describes how to access objects and call routines that are written in other languages
than Self. We will refer to such entities as <em>foreign objects</em> and <em>foreign routines</em>. A typical use
would be to make a function found in a C library accessible in Self. Three steps are necessary to
accomplish this:</p>
<blockquote>
<div><ul class="simple">
<li>Write and compile a piece of “glue” code that specifies argument and result types for the foreign routine and how to convert between these types and Self objects.</li>
<li>Link the resulting object code to the Self virtual machine.</li>
<li>Create a function proxy object (actually a <code class="docutils literal"><span class="pre">foreignFct</span></code> object) that represents the routine in the Self world.</li>
</ul>
</div></blockquote>
<p>Each of these steps is described in detail in the following sections.</p>
<span class="target" id="index-57"></span><span class="target" id="index-58"></span><div class="section" id="proxy-and-fctproxy-objects">
<span id="index-59"></span><h4>8.14.1. <code class="docutils literal"><span class="pre">proxy</span></code> and <code class="docutils literal"><span class="pre">fctProxy</span></code> objects<a class="headerlink" href="#proxy-and-fctproxy-objects" title="Permalink to this headline">¶</a></h4>
<p>A foreign object is represented by a proxy object in the Self world. A <em>proxy</em> object is an object
that encapsulates a pointer to the foreign object it represents. In addition to the pointer to the foreign
object, the proxy object contains a type seal. A type seal is an immutable value that is assigned
to the proxy object, when it is created. The <em>type seal</em> is intended to capture type information about
the pointer encapsulated in the proxy. For example, proxies representing window objects should
have a different type seal than proxies representing event objects. By checking the type seal against
an expected value whenever a proxy is “opened”, many type errors can be caught. The last property
of proxy objects is that they can be <em>dead</em> or <em>live</em>. If an attempt is made to use the pointer in a dead
proxy object, an error results (<code class="docutils literal"><span class="pre">deadProxyError</span></code>). Proxy objects may be explicitly killed, by
sending the primitive message <code class="docutils literal"><span class="pre">_Kill</span></code> to them. Furthermore, they are automatically killed after
reading in a snapshot. This way problems with dangling references to foreign objects that were not
included in the snapshot are avoided.</p>
<p><code class="docutils literal"><span class="pre">fctProxy</span></code> objects are similar to proxy objects: they have a type seal and are either live or dead.
However, they represent a foreign routine, rather than a foreign object. A foreign routine can be invoked
by sending the primitive messages <code class="docutils literal"><span class="pre">_Call</span></code>, <code class="docutils literal"><span class="pre">_Call:{With:}</span></code>,
<code class="docutils literal"><span class="pre">_CallAndConvert{With:And:}</span></code> to the <code class="docutils literal"><span class="pre">fctProxy</span></code> representing it. Note that <code class="docutils literal"><span class="pre">fctProxy</span></code> objects
are low-level. Most, if not all, uses of foreign routines should use the interface provided by <code class="docutils literal"><span class="pre">foreignFct</span></code>
objects.</p>
<p>Proxies (and fctProxies) can be freely cloned. However a cloned proxy will be dead. A dead
proxy is revived when it is used by a foreign function to, e.g., return a pointer. The return value of
the foreign function together with a type seal is stored into the dead proxy, which is then revived
and returned as the result of the foreign routine call. The motivation for this somewhat complicated
approach is that there will be several different kinds of proxies in a typical Self system. Different
kinds of proxies may have different slots added, so rather than having the foreign routine figure out
which kind of proxy to clone for the result, the Self code calling the foreign routine must construct
and pass down an “empty” (dead) proxy to hold the result. This proxy is called a <em>result proxy</em>
and it is the last argument supplied to the foreign function.</p>
<span class="target" id="index-60"></span><span class="target" id="index-61"></span></div>
<div class="section" id="glue-code">
<span id="index-62"></span><h4>8.14.2. Glue code<a class="headerlink" href="#glue-code" title="Permalink to this headline">¶</a></h4>
<p>Glue code is responsible for the transition from Self to foreign routines. It forms wrappers around
foreign routines. There is one wrapper per foreign routine. A wrapper takes a number of arguments
of type <code class="docutils literal"><span class="pre">oop</span></code>, and returns an <code class="docutils literal"><span class="pre">oop</span></code> (<code class="docutils literal"><span class="pre">oop</span></code> is the C++ type for “reference to Self object”). When a
wrapper is executed, it performs the following steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Check that the arguments supplied have the correct types.</li>
<li>Convert the arguments from Self representation to the representation that the foreign routine needs.</li>
<li>Invoke the foreign routine on the converted arguments.</li>
<li>Convert the return value of the foreign routine to a Self object and return this as the Self level result.</li>
</ol>
</div></blockquote>
<p>To make it easier to write glue code, a special purpose language has been designed for this. The
result is that glue for a foreign routine will often consist of only a single line. The glue language is
implemented as a set of C++ preprocessor macros. Therefore, glue code is just a (rather peculiar)
kind of C++. Glue code can be in a file of its own, or – if it is glue for calling C++ routines – it can
be in the same file as the foreign routines, and compiled with them.</p>
<p>To make the definition of the glue language available, the file containing glue code must contain:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># include &quot;_glueDefs.c.incl&quot;</span>
</pre></div>
</div>
<p>The file “<code class="docutils literal"><span class="pre">_glueDefs.c.incl</span></code>” includes a bunch of C++ header files that contain all the definitions
necessary for the glue. Of the included files, “<code class="docutils literal"><span class="pre">glueDefs.h</span></code>” is probably the most interesting in this
context. It defines the glue language and also contains some comments explaining it.</p>
<p>Since different foreign languages have different type systems and calling conventions the glue language
is actually not a single language, but one for each supported foreign language. Presently C
and C++ are supported. See sections <a class="reference internal" href="#c-glue">C glue</a> and <a class="reference internal" href="#id2">C++ glue</a> for details.</p>
<span class="target" id="index-63"></span><span class="target" id="index-64"></span></div>
<div class="section" id="compiling-and-linking-glue-code">
<span id="index-65"></span><h4>8.14.3. Compiling and linking glue code<a class="headerlink" href="#compiling-and-linking-glue-code" title="Permalink to this headline">¶</a></h4>
<p>Since glue code is a special form of C++ code, a C++ compiler is needed to translate it. The way
this is done may depend on the computer system and the available C++ compiler. The following
description applies to Sun SPARCstations using the GNU g++ compiler.</p>
<p>A specific example of how to compile glue code can be found in the directory containing the <em>toself</em>
demo (see <a class="reference internal" href="#a-complete-application-using-foreign-functions">A complete application using foreign functions</a> for further details). The makefile in that directory describes how to
translate a <code class="docutils literal"><span class="pre">.c</span></code> file containing glue into something that can be invoked from Self. This is a two
stage process: first the <code class="docutils literal"><span class="pre">.c</span></code> file is compiled into a <code class="docutils literal"><span class="pre">.o</span></code> file which is then linked (perhaps with other
<code class="docutils literal"><span class="pre">.o</span></code> files and libraries that the glue code depends on) into a <code class="docutils literal"><span class="pre">.so</span></code> file (a so-called dynamic library).
While the compilation is straightforward, several issues concerning the linking must be explained.</p>
<dl class="docutils">
<dt><strong>Linking</strong></dt>
<dd>Before a foreign routine can be called it must be linked to the Self virtual machine. The
linking can be done either statically, i.e. before Self is started, or dynamically, i.e. while Self is
running. The Self system employs both dynamic and static linking, but users should only use dynamic
linking, as static linking requires more understanding of the structure of the Virtual Machine.
The choice between dynamic and static linking involves a trade-off between safety and
flexibility as outlined in the following.</dd>
<dt><strong>Dynamic linking</strong></dt>
<dd>Dynamic linking has the advantage that it is done on demand, so only foreign routines that are actually
used in a particular session will be loaded and take up space. Debugging foreign routines is
also easier, especially if the dynamic linker supports unlinking. The main disadvantages with dynamic
linking is that more things can go wrong at run time. For example, if an object file containing
a foreign routine can not be found, a run time error occurs. The Sun OS dynamic linker, <code class="docutils literal"><span class="pre">ld.so</span></code>,
only handles dynamic libraries which explains why the second stage of glue translation is necessary.</dd>
<dt><strong>Static linking</strong></dt>
<dd>Static linking, the alternative that was not chosen for Self, has the advantage that it needs to be
done only once. The statically linked-in files will then be available for ever after. The main disadvantages
are that the linked-in files will always take up space whether used or not in a given Self
session, that the VM must be completely relinked every time new code is added, and that debugging
is harder because there is no way to unlink code with bugs in. For these reasons the following
examples all use dynamic linking.</dd>
</dl>
</div>
<div class="section" id="a-simple-glue-example-calling-a-c-function">
<span id="index-66"></span><h4>8.14.4. A simple glue example: calling a C function<a class="headerlink" href="#a-simple-glue-example-calling-a-c-function" title="Permalink to this headline">¶</a></h4>
<p>Suppose we have a C function that encrypts text strings in some fancy way. It takes two arguments,
a string to encrypt and a key, and returns a string which is the result of the encryption. To use this
function from Self, we write a line of C glue. Here is the entire file, “<code class="docutils literal"><span class="pre">encrypt.c</span></code>”, containing both
the encryption function and the glue:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>/* Make glue available by including it. */
# include &quot;incls/_glueDefs.c.incl&quot;
/* Naive encryption function. */
char *encrypt(char *str, int key) {
    static char res[1000];
    int i;
    for (i = 0; str[i]; ++i)
        res[i] = str[i] + key;
    res[i] = ’\0’;
    return res;
}

/* Make glue expand to full functions, not just prototypes. */
# define WHAT_GLUE FUNCTIONS
    C_func_2(string,, encrypt, encrypt_glue,, string,, int,)
# undef WHAT_GLUE
</pre></div>
</div>
<p>A few words of explanation: the last three lines of this file contain the glue code. First defining
<code class="docutils literal"><span class="pre">WHAT_GLUE</span></code> to be <code class="docutils literal"><span class="pre">FUNCTIONS</span></code>, makes the following line expand into a full wrapper function (defining
<code class="docutils literal"><span class="pre">WHAT_GLUE</span></code> to be <code class="docutils literal"><span class="pre">PROTOTYPES</span></code> instead, will cause the <code class="docutils literal"><span class="pre">C_func_2</span></code> line to produce a function
prototype only). The line containing the macro <code class="docutils literal"><span class="pre">C_func_2</span></code> is the actual wrapper for <code class="docutils literal"><span class="pre">encrypt</span></code>.
The “2” designates that <code class="docutils literal"><span class="pre">encrypt</span></code> takes 2 arguments. The meaning of the arguments, from left to
right are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">string,</span></code>: specifies that encrypt returns a string argument.</li>
<li><code class="docutils literal"><span class="pre">encrypt</span></code>: name of function we are constructing wrapper for.</li>
<li><code class="docutils literal"><span class="pre">encrypt_glue</span></code>: name that we want the wrapper function to have.</li>
<li>An empty argument signifying that encrypt is not to be passed a failure handle (explained later).</li>
<li><code class="docutils literal"><span class="pre">string,</span></code>: specifies that the first argument to encrypt is a string.</li>
<li><code class="docutils literal"><span class="pre">int,</span></code>: specifies that the second argument to encrypt is an int.</li>
</ul>
</div></blockquote>
<p>Having written this file, we now prepare a makefile to compile and link it. To do this, we can extend
the makefile in <code class="docutils literal"><span class="pre">objects/glue/{sun4,svr4}</span></code> (depending on OS in use) and then run make.
This results in the shared library file <code class="docutils literal"><span class="pre">encrypt.so</span></code>. Finally, to try it out, we can type these commands
(at the Self prompt or in the UI):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; _AddSlotsIfAbsent: ( | encrypt | )
lobby

&gt; encrypt: ( foreignFct copyName: ’encrypt_glue’ Path: ’encrypt.so’ )
lobby

&gt; encrypt
&lt;C++ function(encrypt_glue)&gt;

&gt; encrypt value: ’Hello Self’ With: 3
’Khoor#Vhoi’

&gt; encrypt value: ’Khoor#Vhoi’ With: -3
’Hello Self’
</pre></div>
</div>
<p>Comparing the signature for the function encrypt with the arguments to the <code class="docutils literal"><span class="pre">C_func_2</span></code> macro it
is clear that there is a straightforward mapping between the two. One day we hope to find the time
to write a Self program that can parse a C or C++ header file and generate glue code corresponding
to the definitions in it. In the meantime, glue code must be handwritten.</p>
<span class="target" id="index-67"></span></div>
<div class="section" id="c-glue">
<span id="index-68"></span><h4>8.14.5. C glue<a class="headerlink" href="#c-glue" title="Permalink to this headline">¶</a></h4>
<p>C glue supports accessing C functions and data from Self. There are three main parts of C glue:</p>
<blockquote>
<div><ul class="simple">
<li>Calling functions.</li>
<li>Reading/assigning global variables.</li>
<li>Reading/assigning a component in a struct that is represented by a proxy object in Self.</li>
</ul>
</div></blockquote>
<p>In addition, C++ glue for creating objects can be used to create C structs (see section <a class="reference internal" href="#id2">C++ glue</a>). The
following sections describe each of these parts of C glue.</p>
<span class="target" id="index-69"></span><span class="target" id="index-70"></span></div>
<div class="section" id="calling-c-functions">
<span id="index-71"></span><h4>8.14.6. Calling C functions<a class="headerlink" href="#calling-c-functions" title="Permalink to this headline">¶</a></h4>
<p>The macro <code class="docutils literal"><span class="pre">C_func_N</span></code> where N is 0, 1, 2, ... is used to “glue in” a C function. The number N denotes
the number of arguments that should be given <em>at the Self level</em>, when calling the function. This
number may be different from the number of arguments that the C function takes since, e.g., some
argument conversions (see below) produce two C arguments from one Self object. Here is the
general syntax for <code class="docutils literal"><span class="pre">C_func_N</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C_func_N</span><span class="p">(</span><span class="n">res_cnv</span><span class="p">,</span><span class="n">res_aux</span><span class="p">,</span> <span class="n">fexp</span><span class="p">,</span> <span class="n">gfname</span><span class="p">,</span> <span class="n">fail_opt</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span> <span class="o">...</span> <span class="n">cN</span><span class="p">,</span><span class="n">aN</span><span class="p">)</span>
</pre></div>
</div>
<p>Compare this with the glue that was used in the encrypt example in section <a class="reference internal" href="#a-simple-glue-example-calling-a-c-function">A simple glue example: calling a C function</a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C_func_2</span><span class="p">(</span><span class="n">string</span><span class="p">,,</span> <span class="n">encrypt</span><span class="p">,</span> <span class="n">encrypt_glue</span><span class="p">,,</span> <span class="n">string</span><span class="p">,,</span> <span class="nb">int</span><span class="p">,)</span>
</pre></div>
</div>
<p>The meaning of each argument to <code class="docutils literal"><span class="pre">C_func_N</span></code> is as follows:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">res_cnv,res_aux</span></code>: these two arguments form a “conversion pair” that specifies how the result that the function returns is converted to a Self object. In the <code class="docutils literal"><span class="pre">encrypt</span></code> example, where the function returns a null terminated string, <code class="docutils literal"><span class="pre">res_cnv</span></code> has the value <code class="docutils literal"><span class="pre">string</span></code>, and <code class="docutils literal"><span class="pre">res_aux</span></code> is empty. <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a> lists all the possible values for the <code class="docutils literal"><span class="pre">res_cnv,res_aux</span> <span class="pre">pair</span></code>.</li>
<li><code class="docutils literal"><span class="pre">fexp</span></code> is a C expression which evaluates to the function that is being glued in. In the simplest case, such as in the <code class="docutils literal"><span class="pre">encrypt</span></code> example, the expression is the name of a function, but in general it may be any C expression, involving function pointers etc., which in a global context evaluates to a function.</li>
<li><code class="docutils literal"><span class="pre">gfname</span></code>: the name of the function which the <code class="docutils literal"><span class="pre">C_func_N</span></code> macro expands into. In the <code class="docutils literal"><span class="pre">encrypt</span></code> example, the convention of appending <code class="docutils literal"><span class="pre">_glue</span></code> to the C function’s name was used. When accessing a glued-in function from Self, the value of <code class="docutils literal"><span class="pre">gfname</span></code> is the name that must be used.</li>
<li><code class="docutils literal"><span class="pre">fail_opt</span></code>: there are two possible values for this argument. It can be empty (as in the example) or it can be <code class="docutils literal"><span class="pre">fail</span></code>. In the latter case, the C function being called is passed an additional argument that will be the last argument and have type <code class="docutils literal"><span class="pre">“void</span> <span class="pre">*”</span></code>. Using this argument, the C function may abort its execution and raise an exception. The result is that the “IfFail block” in Self will be invoked.</li>
<li><code class="docutils literal"><span class="pre">ci,ai</span></code>: each of these pairs describes how to convert a Self level argument to one or more C level arguments. For example, in the glue for <code class="docutils literal"><span class="pre">encrypt</span></code>, <code class="docutils literal"><span class="pre">c0</span></code>,``a0`` specifies that the first argument to <code class="docutils literal"><span class="pre">encrypt</span></code> is a string. Likewise <code class="docutils literal"><span class="pre">c1</span></code>,``a1`` specifies that the second argument is an integer. Note that in both these cases, the a-part of the conversion is empty. <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a> lists all the possible values for the <code class="docutils literal"><span class="pre">ci</span></code>,``ai`` pair.</li>
</ul>
</div></blockquote>
<p><em>Handling failures</em>. Here is a slight modification of the encryption example to illustrate how the C function can raise an exception that causes the “IfFail block” to be invoked at the Self level:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>/* Make glue available by including it. */
# include &quot;incls/_glueDefs.c.incl&quot;
/* Naive encryption function. */
char *encrypt(char *str, int key, void *FH) {
    static char res[1000];
    int i;
    if (key == 0) {
            failure(FH, &quot;key == 0 is identity map&quot;);
            return NULL;
    }
    for (i = 0; str[i]; i++)
            res[i] = str[i] + key;
    res[i] = ’\0’;
    return res;
}
/* Make glue expand to full functions, not just prototypes. */
# define WHAT_GLUE FUNCTIONS
    C_func_2(string,, encrypt, encrypt_glue, fail, string,, int,)
# undef WHAT_GLUE
</pre></div>
</div>
<p>Observe that the <code class="docutils literal"><span class="pre">fail_opt</span></code> argument now has the value <code class="docutils literal"><span class="pre">fail</span></code> and that the <code class="docutils literal"><span class="pre">encrypt</span></code> function
raises an exception, using <code class="docutils literal"><span class="pre">failure</span></code>, if the key is 0. There are two ways to raise exceptions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="n">void</span> <span class="n">failure</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">FH</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">msg</span><span class="p">);</span>
<span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="n">void</span> <span class="n">unix_failure</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">FH</span><span class="p">,</span> <span class="nb">int</span> <span class="n">err</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>In both cases, the <code class="docutils literal"><span class="pre">FH</span></code> argument is the “failure handle” that was passed by the <code class="docutils literal"><span class="pre">C_func_N</span></code> macro.
The second argument to <code class="docutils literal"><span class="pre">failure</span></code> is a string. It will be passed to the “IfFail block” in Self.
<code class="docutils literal"><span class="pre">unix_failure</span></code> takes an optional integer as its second argument. If this integer has the value -1,
or is missing, the value of <code class="docutils literal"><span class="pre">errno</span></code> is used instead. The integer is interpreted as a UNIX error number,
from which a corresponding string is constructed. The string is then, as for <code class="docutils literal"><span class="pre">failure</span></code>, passed
to the “IfFail block” at the call site in Self.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">After calling <code class="docutils literal"><span class="pre">failure</span></code> or <code class="docutils literal"><span class="pre">unix_failure</span></code> a normal <code class="docutils literal"><span class="pre">return</span></code> must be done. The value returned (in the example <code class="docutils literal"><span class="pre">NULL</span></code>) is ignored.</p>
</div>
<span class="target" id="index-72"></span></div>
<div class="section" id="reading-and-assigning-global-variables">
<span id="index-73"></span><h4>8.14.7. Reading and assigning global variables<a class="headerlink" href="#reading-and-assigning-global-variables" title="Permalink to this headline">¶</a></h4>
<p>Reading the value of a global variable is done using the <code class="docutils literal"><span class="pre">C_get_var</span></code> macro. Assigning a value to
a global variable is done using <code class="docutils literal"><span class="pre">C_set_var</span></code>. Both macros expand into a C++ function that converts
between Self and C representation, and reads or assigns the variable. Here is the general syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C_get_var</span><span class="p">(</span><span class="n">cnvt_res</span><span class="p">,</span><span class="n">aux_res</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">gfname</span><span class="p">)</span>
<span class="n">C_set_var</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">expr_c0</span><span class="p">,</span><span class="n">expr_a0</span><span class="p">,</span> <span class="n">gfname</span><span class="p">)</span>
</pre></div>
</div>
<p>A concrete example is reading the value of the variable <code class="docutils literal"><span class="pre">errno</span></code>, which can be done using:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C_get_var</span><span class="p">(</span><span class="nb">int</span><span class="p">,,</span> <span class="n">errno</span><span class="p">,</span> <span class="n">get_errno_glue</span><span class="p">)</span>
</pre></div>
</div>
<p>The meaning of the each argument is:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">cnvt_res</span></code>,``aux_res``: how to convert the value of the global variable that is being read to a Self object. In the <code class="docutils literal"><span class="pre">errno</span></code> example, <code class="docutils literal"><span class="pre">cnvt_res</span></code> is <code class="docutils literal"><span class="pre">int</span></code> and <code class="docutils literal"><span class="pre">aux_res</span></code> is empty, since the type of <code class="docutils literal"><span class="pre">errno</span></code> is <code class="docutils literal"><span class="pre">int</span></code>. The <code class="docutils literal"><span class="pre">cnvt_res</span></code>,``aux_res`` can be any one of the result conversions found in <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a>.</li>
<li><code class="docutils literal"><span class="pre">expr</span></code> is the variable whose value is being read. In the <code class="docutils literal"><span class="pre">errno</span></code> example, it is simply <code class="docutils literal"><span class="pre">errno</span></code>, but in general, it may actually be any expression that is valid in a global context, even an expression involving function calls.</li>
<li><code class="docutils literal"><span class="pre">gfname</span></code>: the name of the C++ function that <code class="docutils literal"><span class="pre">C_get_var</span></code> or <code class="docutils literal"><span class="pre">C_set_var</span></code> expands into.</li>
<li><code class="docutils literal"><span class="pre">var</span></code> is the name of a global variable that a value is assigned to. In general, <code class="docutils literal"><span class="pre">var</span></code>, may be any expression that in a global context evaluates to an l-value.</li>
<li><code class="docutils literal"><span class="pre">expr_c0</span></code>,``expr_a0``: when assigning to a variable, the value it is assigned is obtained by converting a Self object to a C value. The <code class="docutils literal"><span class="pre">expr_c0</span></code>,``expr_a0`` pair, which can be any one of the argument conversions listed in <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a>, specifies how to do this conversion.</li>
</ul>
</div></blockquote>
<span class="target" id="index-74"></span><span class="target" id="index-75"></span></div>
<div class="section" id="reading-and-assigning-struct-components">
<span id="index-76"></span><h4>8.14.8. Reading and assigning struct components<a class="headerlink" href="#reading-and-assigning-struct-components" title="Permalink to this headline">¶</a></h4>
<p>Reading the value of a struct component or assigning a value to it is similar to doing the same operations
on a global variable. The difference is that the struct must somehow be specified. This is
taken care of by the macros <code class="docutils literal"><span class="pre">C_get_comp</span></code> and <code class="docutils literal"><span class="pre">C_set_comp</span></code>. The general syntax is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C_get_comp</span><span class="p">(</span><span class="n">cnvt_res</span><span class="p">,</span><span class="n">aux_res</span><span class="p">,</span> <span class="n">cnvt_strc</span><span class="p">,</span><span class="n">aux_strc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">gfname</span><span class="p">)</span>
<span class="n">C_set_comp</span><span class="p">(</span><span class="n">cnvt_strc</span><span class="p">,</span><span class="n">aux_strc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">expr_c0</span><span class="p">,</span><span class="n">expr_a0</span><span class="p">,</span> <span class="n">gfname</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is an example, assigning to the sin_port field of a struct sockaddr_in (this struct is defined
in <code class="docutils literal"><span class="pre">/usr/include/netinet/in.h</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">sockaddr_in</span> <span class="p">{</span>
    <span class="n">short</span>           <span class="n">sin_family</span><span class="p">;</span>
    <span class="n">u_short</span>         <span class="n">sin_port</span><span class="p">;</span>
    <span class="n">struct</span> <span class="n">in_addr</span>  <span class="n">sin_addr</span><span class="p">;</span>
    <span class="n">char</span>            <span class="n">sin_zero</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The struct is represented by a proxy object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">char</span> <span class="o">*</span><span class="n">socks</span> <span class="o">=</span> <span class="s2">&quot;type seal for sockaddr_in proxies&quot;</span><span class="p">;</span>
<span class="n">C_set_comp</span><span class="p">(</span><span class="n">proxy</span><span class="p">,(</span><span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">,</span><span class="n">socks</span><span class="p">),</span> <span class="o">.</span><span class="n">sin_port</span><span class="p">,</span> <span class="n">short</span><span class="p">,,</span><span class="n">set_sin_port_glue</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">sockaddr_in</span></code> example defines a function, <code class="docutils literal"><span class="pre">set_sin_port_glue</span></code>, which can be called from
Self. The function takes two arguments, the first being a proxy representing a <code class="docutils literal"><span class="pre">sockaddr_in</span></code>
struct, the second being a short integer. After converting types, <code class="docutils literal"><span class="pre">set_sin_port_glue</span></code> performs
the assignment:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">*</span><span class="n">first_converted_arg</span><span class="p">)</span><span class="o">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">second_converted_arg</span><span class="o">.</span>
</pre></div>
</div>
<p>In general the meaning of the <code class="docutils literal"><span class="pre">C_get_comp</span></code> and <code class="docutils literal"><span class="pre">C_set_comp</span></code> arguments is:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">cnvt_res</span></code>, <code class="docutils literal"><span class="pre">aux_res</span></code>: how to convert the value of the component that is being read to a
Self object. Any of the result conversions found in <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a> may be applied.</li>
<li><code class="docutils literal"><span class="pre">cnvt_strc</span></code>, <code class="docutils literal"><span class="pre">aux_strc</span></code>: the conversion that is applied to produce a struct upon which the
operation is performed. In the <code class="docutils literal"><span class="pre">sin_port</span></code> example, this conversion is a proxy conversion,
implying that in Self, the struct whose <code class="docutils literal"><span class="pre">sin_port</span></code> component is assigned is represented by
a proxy object. In general, any of the argument conversions from <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a> that results in a
pointer, may be used.</li>
<li><code class="docutils literal"><span class="pre">comp</span></code> is the name of the component to be read or assigned. In the sin_port example, this
name is <code class="docutils literal"><span class="pre">“.sin_port”</span></code>. Note that it includes a “.”. This, e.g., allows handling pointers to
int’s by pretending that it is a pointer to a struct and operating on a component with an
empty name.</li>
<li><code class="docutils literal"><span class="pre">gfname</span></code>: the name of the C++ function that <code class="docutils literal"><span class="pre">C_get_comp</span></code> or <code class="docutils literal"><span class="pre">C_set_comp</span></code> expands into.</li>
<li><code class="docutils literal"><span class="pre">expr_co</span></code>, <code class="docutils literal"><span class="pre">expr_a0</span></code>: when assigning to a component, the value it is assigned is obtained by
converting a Self object to a C value. The <code class="docutils literal"><span class="pre">expr_co</span></code>, <code class="docutils literal"><span class="pre">expr_a0</span></code> pair, which can be any one
of the argument conversions listed in <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a>, specifies how to do this conversion.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id2">
<h4>8.14.9. C++ glue<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>Since C++ is a superset of C, all of C glue can be used with C++. In addition, C++ glue provides
support for:</p>
<blockquote>
<div><ul class="simple">
<li>Constructing objects using the new operator.</li>
<li>Deleting objects using the delete operator.</li>
<li>Calling member functions on objects.</li>
</ul>
</div></blockquote>
<p>Each of these parts will be explained in the following sections.</p>
<span class="target" id="index-78"></span></div>
<div class="section" id="constructing-objects">
<span id="index-79"></span><h4>8.14.10. Constructing objects<a class="headerlink" href="#constructing-objects" title="Permalink to this headline">¶</a></h4>
<p>In C++, objects are constructed using the new operator. Constructors may take arguments. The
macros <code class="docutils literal"><span class="pre">CC_new_N</span></code> where N is a small integer, support calling constructors with or without arguments.
Calling a constructor is similar to calling a function, so for additional explanation, please
refer to section <a class="reference internal" href="#calling-c-functions">Calling C functions</a>. Here is the general syntax for constructing objects using C++ glue:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CC_new_N</span><span class="p">(</span><span class="n">cnvt_res</span><span class="p">,</span><span class="n">aux_res</span><span class="p">,</span> <span class="n">class</span><span class="p">,</span> <span class="n">gfname</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span> <span class="o">...</span> <span class="n">cN</span><span class="p">,</span><span class="n">aN</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, to construct a <code class="docutils literal"><span class="pre">sockaddr_in</span></code> object, the following glue statement could be used:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CC_new_0</span><span class="p">(</span><span class="n">proxy</span><span class="p">,(</span><span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">,</span><span class="n">socks</span><span class="p">),</span> <span class="n">sockaddr_in</span><span class="p">,</span> <span class="n">new_sockaddr_in</span><span class="p">)</span>
</pre></div>
</div>
<p>The meanings of the <code class="docutils literal"><span class="pre">CC_new_N</span></code> arguments are as follows:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">cnvt_res</span></code>, <code class="docutils literal"><span class="pre">aux_res:</span></code> the result of calling the constructor is an object pointer. The result
conversion pair <code class="docutils literal"><span class="pre">cnvt_res</span></code>, <code class="docutils literal"><span class="pre">aux_res</span></code> (see <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a>), specifies how this pointer is converted
to a Self object before being returned. In the <code class="docutils literal"><span class="pre">sockaddr</span></code> example, the proxy result conversion
is used.</li>
<li><code class="docutils literal"><span class="pre">class</span></code> is the name of the class (or struct) that is being instantiated.</li>
<li><code class="docutils literal"><span class="pre">gfname</span></code>: the name of the C++ function that the <code class="docutils literal"><span class="pre">CC_new_N</span></code> macro expands into.</li>
<li><code class="docutils literal"><span class="pre">ci</span></code>, <code class="docutils literal"><span class="pre">ai</span></code>: if the constructor takes arguments, these arguments must be converted from Self
representation to C++ representation. The arguments conversion pairs <code class="docutils literal"><span class="pre">ci</span></code>, <code class="docutils literal"><span class="pre">ai</span></code> specify how
each argument is converted. See <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a> for a description of all argument conversions. In
the sockaddr example, there are no arguments.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="deleting-objects">
<h4>8.14.11. Deleting objects<a class="headerlink" href="#deleting-objects" title="Permalink to this headline">¶</a></h4>
<p>C++ objects can have destructors that are executed when the objects are deleted. To ensure that the
destructor is called properly, the <code class="docutils literal"><span class="pre">delete</span></code> operator must know the type of the object being deleted.
This is ensured by using the <code class="docutils literal"><span class="pre">CC_delete</span></code> macro, which has the following form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CC_delete</span><span class="p">(</span><span class="n">cnvt_obj</span><span class="p">,</span><span class="n">aux_obj</span><span class="p">,</span> <span class="n">gfname</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, to delete <code class="docutils literal"><span class="pre">sockaddr_in</span></code> objects (constructed as in the previous section), the
<code class="docutils literal"><span class="pre">CC_delete</span></code> macro should be used in this manner:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CC_delete</span><span class="p">(</span><span class="n">proxy</span><span class="p">,(</span><span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">,</span><span class="n">socks</span><span class="p">),</span> <span class="n">delete_sockaddr_in</span><span class="p">)</span>
</pre></div>
</div>
<p>In general, the meaning of the arguments given to <code class="docutils literal"><span class="pre">CC_delete</span></code> is:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">cnvt_obj,aux_obj</span></code>: this pair can be any of the argument conversions found in <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a>
that produces a pointer to the object that will be deleted.</li>
<li><code class="docutils literal"><span class="pre">gfname</span></code>: the name of the C++ function that this invocation of <code class="docutils literal"><span class="pre">CC_delete</span></code> expands into.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="calling-member-functions">
<h4>8.14.12. Calling member functions<a class="headerlink" href="#calling-member-functions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a> lists all the available argument conversions. Each row represents one conversion, with the
first two columns designating the conversion pair. The third column lists the types of Self objects
that the conversion pair accepts. The fourth column lists the C types that it produces. The fifth column
lists the kind of errors that can occur during the conversion. Finally, the sixth column contains
references to numbered notes. The notes are found in the paragraphs following the table.</p>
<p>Calling member functions is similar to calling “plain” functions, so please also refer to section
<a class="reference internal" href="#calling-c-functions">Calling C functions</a>. The difference is that an additional object must be specified: the object upon which the
member function is invoked (the receiver in Self terms). Calling a member function is accomplished
using one of the macros:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CC_mber_N</span><span class="p">(</span><span class="n">cnvt_res</span><span class="p">,</span><span class="n">aux_res</span><span class="p">,</span> <span class="n">cnvt_rec</span><span class="p">,</span><span class="n">aux_rec</span><span class="p">,</span> <span class="n">mname</span><span class="p">,</span> <span class="n">gfname</span><span class="p">,</span>
          <span class="n">fail_opt</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">cN</span><span class="p">,</span><span class="n">aN</span><span class="p">)</span>
</pre></div>
</div>
<p>For example here is how to call the member function zock on a <code class="docutils literal"><span class="pre">sockaddr_in</span></code> object given by a
proxy:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CC_mber_0</span><span class="p">(</span><span class="nb">bool</span><span class="p">,,</span> <span class="n">proxy</span><span class="p">,(</span><span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">,</span><span class="n">socks</span><span class="p">),</span> <span class="n">zock</span><span class="p">,</span> <span class="n">zock_glue</span><span class="p">,)</span>
</pre></div>
</div>
<p>The arguments to <code class="docutils literal"><span class="pre">CC_mber_N</span></code> are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">cnvt_res</span></code>, <code class="docutils literal"><span class="pre">aux_res</span></code>: this pair, which can be any of the result conversions from <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a>,
specifies how to convert the result of the member function before returning it to Self. For
example, the zock member function returns a boolean.</li>
<li><code class="docutils literal"><span class="pre">cnvt_rec</span></code>, <code class="docutils literal"><span class="pre">aux_rec</span></code>: the object on which the member function is invoked. Often this will
be a proxy conversion as in the <code class="docutils literal"><span class="pre">zock</span></code> example.</li>
<li><code class="docutils literal"><span class="pre">mname</span></code> is the name of the member function. In general, it may be any expression, such that
<code class="docutils literal"><span class="pre">receiver-&gt;mname</span></code> evaluates to a function.</li>
<li><code class="docutils literal"><span class="pre">gfname</span></code> is the name of the C++ function that the <code class="docutils literal"><span class="pre">CC_mber_N</span></code> macro expands into.</li>
<li><code class="docutils literal"><span class="pre">fail_opt</span></code>: whether or not to pass a failure handle to the member function (refer to section
<a class="reference internal" href="#calling-c-functions">Calling C functions</a> for details).</li>
<li><code class="docutils literal"><span class="pre">ci</span></code>, <code class="docutils literal"><span class="pre">ai</span></code>: these are argument conversion pairs specifying how to obtain the arguments for the
member function. Any conversion pair found in <a class="reference internal" href="#tableargumentconversions"><span class="std std-numref">Table 8.7</span></a> may be used.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="conversion-pairs">
<span id="index-80"></span><h4>8.14.13. Conversion pairs<a class="headerlink" href="#conversion-pairs" title="Permalink to this headline">¶</a></h4>
<p>A major function of glue code is to convert between Self objects and C/C++ values. This conversion
is guarded by so-called conversion pairs. A <em>conversion pair</em> is a pair of arguments given to a
glue macro. It handles converting one or at most a few types of objects/values. There are different
conversion pairs for converting from Self objects to C/C++ values (called argument conversion
pairs) and for converting from C/C++ values to Self objects (called result conversion pairs).</p>
<span class="target" id="index-81"></span></div>
<div class="section" id="argument-conversions-from-self-to-c-c">
<span id="index-82"></span><h4>8.14.14. Argument conversions – from Self to C/C++<a class="headerlink" href="#argument-conversions-from-self-to-c-c" title="Permalink to this headline">¶</a></h4>
<p>An argument conversion is given a Self object and performs these actions to produce a corresponding
C or C++ value:</p>
<blockquote>
<div><ul class="simple">
<li>check that the Self object it has been given is among the allowed types. If not, report
<code class="docutils literal"><span class="pre">badTypeError</span></code> (invoke the failure block (if present) with the argument <code class="docutils literal"><span class="pre">’badTypeError’</span></code>).</li>
<li>check that the object can be converted to a C/C++ value without overflow or any other error.
If not, report the relevant error.</li>
<li>do the conversion, i.e., construct the C/C++ value corresponding to the given Self object.</li>
</ul>
</div></blockquote>
<span class="target" id="index-83"></span><span class="target" id="index-84"></span><span class="target" id="index-85"></span><span class="target" id="index-86"></span><table border="1" class="docutils" id="id12">
<span id="tableargumentconversions"></span><caption><span class="caption-number">Table 8.7 </span><span class="caption-text">Argument conversions - from Self to C/C++</span><a class="headerlink" href="#id12" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="11%" />
<col width="14%" />
<col width="21%" />
<col width="11%" />
<col width="39%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Conversion</th>
<th class="head">Second part</th>
<th class="head">Self type</th>
<th class="head">C/C++ type</th>
<th class="head">Errors</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>bool</td>
<td>&#160;</td>
<td>boolean</td>
<td>int (0 or 1)</td>
<td>badTypeError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>char</td>
<td>&#160;</td>
<td>smallInt</td>
<td>char</td>
<td>badTypeError overflowError</td>
<td>1</td>
</tr>
<tr class="row-even"><td>signed_char</td>
<td>&#160;</td>
<td>smallInt</td>
<td>signed char</td>
<td>badTypeError overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>unsigned_char</td>
<td>&#160;</td>
<td>smallInt</td>
<td>unsigned char</td>
<td>badSignError badTypeError overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>short</td>
<td>&#160;</td>
<td>smallInt</td>
<td>short</td>
<td>badTypeError overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>signed_short</td>
<td>&#160;</td>
<td>smallInt</td>
<td>signed short</td>
<td>badTypeError overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>unsigned_short</td>
<td>&#160;</td>
<td>smallInt</td>
<td>unsigned short</td>
<td>badSignError badTypeError overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>int</td>
<td>&#160;</td>
<td>smallInt</td>
<td>int</td>
<td>badTypeError</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>signed_int</td>
<td>&#160;</td>
<td>smallInt</td>
<td>signed int</td>
<td>badTypeError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>unsigned_int</td>
<td>&#160;</td>
<td>smallInt</td>
<td>unsigned int</td>
<td>badSignError badTypeError</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>long</td>
<td>&#160;</td>
<td>smallInt</td>
<td>long</td>
<td>badTypeError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>signed_long</td>
<td>&#160;</td>
<td>smallInt</td>
<td>signed long</td>
<td>badTypeError</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>unsigned_long</td>
<td>&#160;</td>
<td>smallInt</td>
<td>unsigned long</td>
<td>badSignError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>smi</td>
<td>&#160;</td>
<td>smallInt</td>
<td>smi</td>
<td>badTypeError</td>
<td>2</td>
</tr>
<tr class="row-even"><td>unsigned_smi</td>
<td>&#160;</td>
<td>smallInt</td>
<td>smi</td>
<td>badSignError badTypeError</td>
<td>2</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="14%" />
<col width="21%" />
<col width="11%" />
<col width="39%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Conversion</th>
<th class="head">Second part</th>
<th class="head">Self type</th>
<th class="head">C/C++ type</th>
<th class="head">Errors</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>float</td>
<td>&#160;</td>
<td>float</td>
<td>float</td>
<td>badTypeError</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>double</td>
<td>&#160;</td>
<td>float</td>
<td>double</td>
<td>badTypeError</td>
<td>3</td>
</tr>
<tr class="row-even"><td>long_double</td>
<td>&#160;</td>
<td>float</td>
<td>long double</td>
<td>badTypeError</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>bv</td>
<td>ptr_type</td>
<td>byte vector</td>
<td>ptr_type</td>
<td>badTypeError</td>
<td>4</td>
</tr>
<tr class="row-even"><td>bv_len</td>
<td>ptr_type</td>
<td>byte vector</td>
<td>ptr_type, int</td>
<td>badSizeError badTypeError</td>
<td>4, 5</td>
</tr>
<tr class="row-odd"><td>bv_null</td>
<td>ptr_type</td>
<td>byte vector/0</td>
<td>ptr_type</td>
<td>badTypeError</td>
<td>4, 6</td>
</tr>
<tr class="row-even"><td>bv_len_null</td>
<td>ptr_type</td>
<td>byte vector/0</td>
<td>ptr_type, int</td>
<td>badSizeError badTypeError</td>
<td>4, 5, 6</td>
</tr>
<tr class="row-odd"><td>cbv</td>
<td>ptr_type</td>
<td>byte vector</td>
<td>ptr_type</td>
<td>badTypeError</td>
<td>7</td>
</tr>
<tr class="row-even"><td>cbv_len</td>
<td>ptr_type</td>
<td>byte vector</td>
<td>ptr_type, int</td>
<td>badSizeError badTypeError</td>
<td>7</td>
</tr>
<tr class="row-odd"><td>cbv_null</td>
<td>ptr_type</td>
<td>byte vector/0</td>
<td>ptr_type</td>
<td>badTypeError</td>
<td>7</td>
</tr>
<tr class="row-even"><td>cbv_len_null</td>
<td>ptr_type</td>
<td>byte vector/0</td>
<td>ptr_type, int</td>
<td>badSizeError badTypeError</td>
<td>7</td>
</tr>
<tr class="row-odd"><td>string</td>
<td>&#160;</td>
<td>byte vector</td>
<td>char *</td>
<td>badTypeError nullCharError</td>
<td>8</td>
</tr>
<tr class="row-even"><td>string_len</td>
<td>&#160;</td>
<td>byte vector</td>
<td>char *, int</td>
<td>badTypeError nullCharError</td>
<td>5, 8</td>
</tr>
<tr class="row-odd"><td>string_null</td>
<td>&#160;</td>
<td>byte vector/0</td>
<td>char *</td>
<td>badTypeError nullCharError</td>
<td>6, 8</td>
</tr>
<tr class="row-even"><td>string_len_null</td>
<td>&#160;</td>
<td>byte vector/0</td>
<td>char *, int</td>
<td>badTypeError nullCharError</td>
<td>5, 6, 8</td>
</tr>
<tr class="row-odd"><td>proxy</td>
<td>(ptr_type, type_seal)</td>
<td>proxy</td>
<td>ptr_type, != NULL</td>
<td>badTypeError badTypeSealError, deadProxyError,nullPointerError</td>
<td>9</td>
</tr>
<tr class="row-even"><td>proxy_null</td>
<td>(ptr_type, type_seal)</td>
<td>proxy</td>
<td>ptr_type</td>
<td>badTypeError badTypeSealError deadProxyError</td>
<td>9</td>
</tr>
<tr class="row-odd"><td>any_oop</td>
<td>&#160;</td>
<td>any object</td>
<td>oop</td>
<td>&#160;</td>
<td>10</td>
</tr>
<tr class="row-even"><td>oop</td>
<td>oop subtype</td>
<td>corresponding object</td>
<td>oop (subtype)</td>
<td>badTypeError</td>
<td>11</td>
</tr>
<tr class="row-odd"><td>any</td>
<td>C/C++ type</td>
<td>int/float/proxy/byte-vector, int</td>
<td>int/float/ptr/ptr</td>
<td>badIndexError badTypeError deadProxyError</td>
<td>12</td>
</tr>
</tbody>
</table>
<div class="section" id="notes">
<h5>8.14.14.1. Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic simple">
<li>The C type <code class="docutils literal"><span class="pre">char</span></code> has a system dependent range. Either 0..255 or -128..127.</li>
<li>The type <code class="docutils literal"><span class="pre">smi</span></code> is used internally in the virtual machine (a 30 bit integer).</li>
<li>Precision may be lost in the conversion.</li>
<li>The second part of the conversion is a C pointer type. The address of the first byte in the byte
vector, cast to this pointer type, is passed to the foreign routine. It is the responsibility of
the foreign routine not to go past the end of the byte vector. The foreign routine should not retain
pointers into the byte vector after the call has terminated. Note: canonical strings can not be passed
through a bv conversion (<code class="docutils literal"><span class="pre">badTypeError</span></code> will result). This is to ensure that they are not accidentally
modified by a foreign function.</li>
<li>This conversion passes two values to the foreign routine: a pointer to the first byte in the byte
vector, and an integer which is the length of the byte vector divided by <code class="docutils literal"><span class="pre">sizeof(*ptr_type)</span></code>. If
the size of the byte vector is not a multiple of <code class="docutils literal"><span class="pre">sizeof(*ptr_type)</span></code>, <code class="docutils literal"><span class="pre">badSizeError</span></code> results.</li>
<li>In addition to accepting a byte vector, this conversion accepts the integer 0, in which case a <code class="docutils literal"><span class="pre">NULL</span></code>
pointer is passed to the foreign routine.</li>
<li>The <code class="docutils literal"><span class="pre">cbv</span></code> conversions are like the bv conversions except that canonical strings are allowed as actual
arguments. A <code class="docutils literal"><span class="pre">cbv</span></code> conversion should only be used if it is guaranteed that the foreign routine
does not modify the bytes it gets a pointer to.</li>
<li>All the string conversions take an incoming byte vector, copy the bytes part, add a trailing null
char, and pass a pointer to this copy to the foreign routine. After the call has terminated, the copy
is discarded. If the byte vector contains a null char, <code class="docutils literal"><span class="pre">nullCharError</span></code> results.</li>
<li>The <code class="docutils literal"><span class="pre">type_seal</span></code> is an <code class="docutils literal"><span class="pre">int</span></code> or <code class="docutils literal"><span class="pre">char</span></code> * expression that is tested against the type seal value in the
proxy. If the two are different, <code class="docutils literal"><span class="pre">badTypeSealError</span></code> results. The special value <code class="docutils literal"><span class="pre">ANY_SEAL</span></code> will
match the type seal in any proxy. Note that the <code class="docutils literal"><span class="pre">proxy</span></code> conversion will fail with <code class="docutils literal"><span class="pre">nullPointerError</span></code>
if the proxy object it is given encapsulates a NULL pointer.</li>
<li>The <code class="docutils literal"><span class="pre">any_oop</span></code> conversion is an escape: it passes the Self object unchanged to the foreign routine.</li>
<li>The <code class="docutils literal"><span class="pre">oop</span></code> conversion is mainly intended for internal use. The second argument is the name of
an oop subtype. After checking that the incoming argument points to an instance of the subtype,
the pointer is cast to the subtype.</li>
<li>The <code class="docutils literal"><span class="pre">any</span></code> conversion is different from all other conversions in that it expects two incoming
Self objects. The actions of the conversion depends on the type of the first object in the following
way. If the first object is an integer, the second argument must also be an integer; the two integers
are converted to C <code class="docutils literal"><span class="pre">int</span></code>’s, the second is shifted 16 bits to the left and they are or’ed together to produce
the result. If the first object is a float, it is converted to a C <code class="docutils literal"><span class="pre">float</span></code> and the second object is
ignored. If the first object is a proxy, the result is the pointer represented by the proxy, and the second
argument is ignored. If the first object is a byte vector, the second object must be an integer
which is interpreted as an index into the byte vector; the result is a pointer to the indexed byte.</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="result-conversions-from-c-c-to-self">
<span id="index-88"></span><h4>8.14.15. Result conversions - from C/C++ to Self<a class="headerlink" href="#result-conversions-from-c-c-to-self" title="Permalink to this headline">¶</a></h4>
<p>A result conversion is given a C or C++ value of a certain type and performs these actions to produce
a corresponding Self object:</p>
<blockquote>
<div><ul class="simple">
<li>check that the C/C++ value can be converted to a Self object with no overflow or other error
occurring. If not, report the error.</li>
<li>do the conversion, i.e., construct the Self object corresponding to the given C/C++ value.</li>
</ul>
</div></blockquote>
<p><a class="reference internal" href="#tableresultconversions"><span class="std std-numref">Table 8.8</span></a> lists all the available result conversions. Each row represents one conversion, with the first
two columns designating the conversion pair. The third column lists the type of C or C++ value that
the conversion pair accepts. The fourth column lists the type of Self object the conversion produces.
The fifth column lists the kind of errors that can occur during the conversion. Finally, the sixth
column contains references to numbered notes. The notes are found in the paragraphs following
the table.</p>
<table border="1" class="docutils" id="id13">
<span id="tableresultconversions"></span><caption><span class="caption-number">Table 8.8 </span><span class="caption-text">Result conversions - from C/C++ to Self</span><a class="headerlink" href="#id13" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="19%" />
<col width="28%" />
<col width="14%" />
<col width="14%" />
<col width="16%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Conversion</th>
<th class="head">Second part</th>
<th class="head">C/C++ type</th>
<th class="head">Self type</th>
<th class="head">Errors</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>void</td>
<td>&#160;</td>
<td>void</td>
<td>smallInt (0)</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>bool</td>
<td>&#160;</td>
<td>int</td>
<td>boolean</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>char</td>
<td>&#160;</td>
<td>char</td>
<td>smallInt</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>signed_char</td>
<td>&#160;</td>
<td>signed char</td>
<td>smallInt</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>unsigned_char</td>
<td>&#160;</td>
<td>unsigned char</td>
<td>smallInt</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>short</td>
<td>&#160;</td>
<td>short</td>
<td>smallInt</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>signed_short</td>
<td>&#160;</td>
<td>signed short</td>
<td>smallInt</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>unsigned_short</td>
<td>&#160;</td>
<td>unsigned short</td>
<td>smallInt</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>int</td>
<td>&#160;</td>
<td>int</td>
<td>smallInt</td>
<td>overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>signed_int</td>
<td>&#160;</td>
<td>signed int</td>
<td>smallInt</td>
<td>overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>unsigned_int</td>
<td>&#160;</td>
<td>unsigned int</td>
<td>smallInt</td>
<td>overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>long</td>
<td>&#160;</td>
<td>long</td>
<td>smallInt</td>
<td>overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>signed_long</td>
<td>&#160;</td>
<td>signed long</td>
<td>smallInt</td>
<td>overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>unsigned_long</td>
<td>&#160;</td>
<td>unsigned long</td>
<td>smallInt</td>
<td>overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>smi</td>
<td>&#160;</td>
<td>smi</td>
<td>smallInt</td>
<td>overflowError</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>int_or_errno</td>
<td>n</td>
<td>int</td>
<td>int</td>
<td>a UNIX error</td>
<td>1</td>
</tr>
<tr class="row-even"><td>float</td>
<td>&#160;</td>
<td>float</td>
<td>float</td>
<td>&#160;</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>double</td>
<td>&#160;</td>
<td>double</td>
<td>float</td>
<td>&#160;</td>
<td>2</td>
</tr>
<tr class="row-even"><td>long_double</td>
<td>&#160;</td>
<td>long double</td>
<td>float</td>
<td>&#160;</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>string</td>
<td>&#160;</td>
<td>char *</td>
<td>byte vector</td>
<td>nullPointerError</td>
<td>3</td>
</tr>
<tr class="row-even"><td>proxy</td>
<td>(ptr_type, type_seal)</td>
<td>ptr_type</td>
<td>proxy</td>
<td>nullPointerError</td>
<td>3, 4, 8</td>
</tr>
<tr class="row-odd"><td>proxy_null</td>
<td>(ptr_type, type_seal)</td>
<td>ptr_type</td>
<td>proxy</td>
<td>&#160;</td>
<td>4, 8</td>
</tr>
<tr class="row-even"><td>proxy_or_errno</td>
<td>(ptr_type, type_seal, n)</td>
<td>ptr_type</td>
<td>proxy</td>
<td>a UNIX error</td>
<td>4, 5, 8</td>
</tr>
<tr class="row-odd"><td>fct_proxy</td>
<td>(ptr_type, type_seal, arg_count)</td>
<td>ptr_type</td>
<td>fctProxy</td>
<td>nullPointerError</td>
<td>3, 6, 8</td>
</tr>
<tr class="row-even"><td>fct_proxy_null</td>
<td>(ptr_type, type_seal, arg_count)</td>
<td>ptr_type</td>
<td>fctProxy</td>
<td>&#160;</td>
<td>6, 8</td>
</tr>
<tr class="row-odd"><td>oop</td>
<td>&#160;</td>
<td>oop</td>
<td>corresponding
object</td>
<td>&#160;</td>
<td>7, 8</td>
</tr>
</tbody>
</table>
<div class="section" id="id3">
<h5>8.14.15.1. Notes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic simple">
<li>This conversion returns an integer value, unless the integer has the value n (the second part of
the conversion; often -1). If the integer is n, the conversion interprets the return value as a UNIX
error indicator. It then constructs a string describing the error (by looking at <code class="docutils literal"><span class="pre">errno</span></code>) and invokes
the “IfFail block” with this string.</li>
<li>Precision may be lost.</li>
<li>This conversion fails with <code class="docutils literal"><span class="pre">nullPointerError</span></code> if attempting to convert a NULL pointer.</li>
<li>The <code class="docutils literal"><span class="pre">ptr_type</span></code> is the C/C++ type of the pointer. The <code class="docutils literal"><span class="pre">type_seal</span></code> is an expression of type int
or <code class="docutils literal"><span class="pre">char</span> <span class="pre">*</span></code>.The conversion constructs a new proxy object, stores the C/C++ pointer in it and sets
its type seal to be the value of <code class="docutils literal"><span class="pre">type_seal</span></code>.</li>
<li>If the pointer is <code class="docutils literal"><span class="pre">n</span></code> (often <code class="docutils literal"><span class="pre">n</span></code> is <code class="docutils literal"><span class="pre">NULL</span></code>), the conversion fails with a UNIX error, similar to the way
<code class="docutils literal"><span class="pre">int_or_errno</span></code> may fail.</li>
<li>The <code class="docutils literal"><span class="pre">fct_proxy</span></code>, <code class="docutils literal"><span class="pre">fct_proxy_null</span></code> and <code class="docutils literal"><span class="pre">fct_proxy_or_errno</span></code> conversions are similar to
the corresponding proxy conversions. The difference is that they produce a <code class="docutils literal"><span class="pre">fctProxy</span></code> object rather
than a proxy object. Also, their second part is a triple rather than a pair. The extra component
specifies how many arguments the function takes, if called. The special keyword <code class="docutils literal"><span class="pre">unknownNoOfArgs</span></code>
or any nonnegative integer expression can be used here.</li>
<li>This conversion is an escape: it passes the C value unchanged to Self. It is an error to use it if
the C value is not an <code class="docutils literal"><span class="pre">oop</span></code>.</li>
<li>The <code class="docutils literal"><span class="pre">proxy</span></code> (<code class="docutils literal"><span class="pre">fctProxy</span></code>) object that is returned by these conversions is <em>not</em> being created by the
glue code. Rather a <code class="docutils literal"><span class="pre">proxy</span></code> (<code class="docutils literal"><span class="pre">fctProxy</span></code>) must be passed down from the Self level. This <code class="docutils literal"><span class="pre">proxy</span></code>
(<code class="docutils literal"><span class="pre">fctProxy</span></code>), a <em>result proxy</em>, will then be side effected by the glue: the value that the foreign function
returns will be stored in the result proxy together with the requested type seal. It is required
that the result proxy is dead when passed down (else a <code class="docutils literal"><span class="pre">liveProxyError</span></code> results). After being
side-effected and returned, the result proxy is live. The result proxy is the last argument of the
function that the glue macro expands to.</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="a-complete-application-using-foreign-functions">
<h4>8.14.16. A complete application using foreign functions<a class="headerlink" href="#a-complete-application-using-foreign-functions" title="Permalink to this headline">¶</a></h4>
<p>This section gives a description of a complete application which uses foreign functions. The aim is
to present a realistic and complete example of how foreign functions may be used. The complete
source for the example is found in the directory <code class="docutils literal"><span class="pre">objects/applications/serverDemo</span></code> in the
Self distribution.</p>
<p>The example used is an application that allows Self expressions to be easily evaluated by non-
Self processes. Having this, it then becomes possible to start Self processes from a UNIX
prompt (shell) or to specify pipe lines in which some of the processes are Self processes. For example
in</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">proto</span><span class="o">%</span> <span class="n">cat</span> <span class="n">someFile</span> <span class="o">|</span> <span class="n">tokenize</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">r</span> <span class="o">|</span> <span class="n">capitalize</span> <span class="o">|</span> <span class="n">tee</span> <span class="n">lst</span>
</pre></div>
</div>
<p>it may be the case that the filters tokenize and capitalize perform most of their work in Self.
Likewise, the command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">proto</span><span class="o">%</span> <span class="n">mail</span>
</pre></div>
</div>
<p>may invoke some fancy mail reader written in Self rather than the standard UNIX mail reader.</p>
<p>To see how the above can be accomplished, please refer to <a class="reference internal" href="#figsingleunixproc"><span class="std std-numref">Fig. 8.3</span></a> below. The left side of the figure
shows the external view of a typical UNIX process. It has two files: stdin and stdout (for simplicity
we ignore stderr). Stdin is often connected to the keyboard so that characters typed here can
be read from the file stdin. Likewise, stdout is typically connected to the console so that the process
can display output by writing it to the file stdout. Stdin and stdout can also be connected to “regular”
files, if the process was started with redirection. The right side of <a class="reference internal" href="#figsingleunixproc"><span class="std std-numref">Fig. 8.3</span></a> shows a two stage
pipe line. Here stdout of the first process is connected to stdin of the second process.</p>
<div class="figure align-left" id="id14">
<span id="figsingleunixproc"></span><a class="reference internal image-reference" href="_images/Chapter_5_Figure_5.png"><img alt="_images/Chapter_5_Figure_5.png" src="_images/Chapter_5_Figure_5.png" style="width: 718.2px; height: 91.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 8.3 </span><span class="caption-text">A single UNIX process and an pipe line.</span></p>
</div>
<p><a class="reference internal" href="#figsingleunixproc"><span class="std std-numref">Fig. 8.3</span></a> illustrates a simple trick that in many situations allows Self processes to behave as if they
are full-fledged UNIX processes. A Self process is represented by a “real” UNIX process which
transparently communicates with the Self process over a pair of connected sockets. The communication
is bidirectional: input to the UNIX process is relayed to the Self process over the socket
connection, and output produced by the Self process is sent over the same socket connection to
the UNIX process which relays it to stdout. The right part of <a class="reference internal" href="#figsingleunixproc"><span class="std std-numref">Fig. 8.3</span></a> shows how the UNIX/Self
process pair can fit seamlessly into a pipe line.</p>
<div class="figure" id="id15">
<img alt="_images/Chapter_5_Figure_6.png" src="_images/Chapter_5_Figure_6.png" />
<p class="caption"><span class="caption-number">Fig. 8.4 </span><span class="caption-text">A Self process and how it fits into a pipe line.</span></p>
</div>
<p>Source code that facilitates setting up such UNIX/Self process pairs is included in the Self distribution.
The source consists of two parts: one being a Self program (called <em>server</em>), the other being
a C++ program (called <em>toself</em>). When the server is started, it creates a socket, binds a name to it
and then listens for connections on it. <code class="docutils literal"><span class="pre">toself</span></code> establishes connections to the server program. The
first line that is transmitted when a connection has been set up goes from <code class="docutils literal"><span class="pre">toself</span></code> to the server. The
line contains a Self expression. Upon receiving it, the server forks a new process to evaluate the
expression in the context of the lobby augmented with a slot, stdio, that contains a <code class="docutils literal"><span class="pre">unixFile</span></code>-like
object that represents the socket connection. When the forked process terminates, the socket connection
is shut down. The <code class="docutils literal"><span class="pre">toself</span></code> UNIX process then terminates.</p>
<p>The Self expression that forms the Self process is specified on the command line when <code class="docutils literal"><span class="pre">toself</span></code>
is started. For example, if the server has been started, the following can be typed at the UNIX
prompt:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">proto</span><span class="o">%</span> <span class="n">toself</span> <span class="n">stdio</span> <span class="n">writeLine</span><span class="p">:</span> <span class="mi">5</span> <span class="n">factorial</span> <span class="n">printString</span>
<span class="mi">120</span>

<span class="n">proto</span><span class="o">%</span> <span class="n">echo</span> <span class="n">something</span> <span class="o">|</span> <span class="n">toself</span> <span class="n">capitalize</span><span class="p">:</span> <span class="n">stdio</span>
<span class="n">SOMETHING</span>

<span class="n">proto</span><span class="o">%</span> <span class="n">toself</span> <span class="n">capitalize</span><span class="p">:</span> <span class="n">stdio</span>
<span class="n">Write</span> <span class="n">some</span> <span class="n">text</span> <span class="n">that</span> <span class="n">goes</span> <span class="n">to</span> <span class="n">stdin</span> <span class="n">of</span> <span class="n">the</span> <span class="n">toself</span> <span class="n">program</span>
<span class="n">WRITE</span> <span class="n">SOME</span> <span class="n">TEXT</span> <span class="n">THAT</span> <span class="n">GOES</span> <span class="n">TO</span> <span class="n">STDIN</span> <span class="n">OF</span> <span class="n">THE</span> <span class="n">TOSelf</span> <span class="n">PROGRAM</span>
<span class="n">More</span> <span class="n">text</span>
<span class="n">MORE</span> <span class="n">TEXT</span>
<span class="o">^</span><span class="n">D</span>

<span class="n">proto</span><span class="o">%</span>
</pre></div>
</div>
<p>If you want to try out these examples, locate the files <code class="docutils literal"><span class="pre">server.self</span></code>, <code class="docutils literal"><span class="pre">socks.so</span></code> and <code class="docutils literal"><span class="pre">toself</span></code>. The
path name of the file <code class="docutils literal"><span class="pre">socks.so</span></code> is hardwired in the file <code class="docutils literal"><span class="pre">server.self</span></code> so please make sure that it
has been set correctly for your system. Then file in the world and type [<code class="docutils literal"><span class="pre">server</span> <span class="pre">start</span></code>] <code class="docutils literal"><span class="pre">fork</span></code> at
the Self prompt. Now you can go back to the UNIX prompt and try out the examples shown
above.</p>
</div>
<div class="section" id="outline-of-toself">
<h4>8.14.17. Outline of <code class="docutils literal"><span class="pre">toself</span></code><a class="headerlink" href="#outline-of-toself" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">toself</span></code> is a small C++ program found in the file <code class="docutils literal"><span class="pre">toself.c</span></code>. It operates in the three phases outlined
above:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Try to connect to a well-known port number on a given machine (the function <code class="docutils literal"><span class="pre">establishConnection</span></code>
does this).</li>
<li>Send the command line arguments over the connection established in 1 (the <code class="docutils literal"><span class="pre">safeWrite</span></code>
call in <code class="docutils literal"><span class="pre">main</span></code> does this).</li>
<li>While there is more input and the Self process has not shut down the socket connection,
relay from stdin to the socket connection and from the socket connection to stdout (the function
<code class="docutils literal"><span class="pre">relay</span></code> does this).</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="outline-of-server">
<h4>8.14.18. Outline of server<a class="headerlink" href="#outline-of-server" title="Permalink to this headline">¶</a></h4>
<p>The server is a Self program. It is found in the file <code class="docutils literal"><span class="pre">server.self</span></code>. When the server is started, the
following happens:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Create a socket, bind a name to it and start listening.</li>
<li><dl class="first docutils">
<dt>Loop: accept a connection and fork a new process (both step 1 and 2 are performed by the method <code class="docutils literal"><span class="pre">server</span> <span class="pre">start</span></code>). The forked process executes the method <code class="docutils literal"><span class="pre">server</span> <span class="pre">handleRequest</span></code> which:</dt>
<dd><ol class="first last loweralpha">
<li>Reads a line from the connection.</li>
<li>Sets up a context with a slot <code class="docutils literal"><span class="pre">stdio</span></code> referring to the connection.</li>
<li>Evaluates the line read in step (a) in this context.</li>
<li>Closes the connection.</li>
</ol>
</dd>
</dl>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="foreign-functions-and-glue-needed-to-implement-server">
<h4>8.14.19. Foreign functions and glue needed to implement server<a class="headerlink" href="#foreign-functions-and-glue-needed-to-implement-server" title="Permalink to this headline">¶</a></h4>
<p>The server program needs to do a number of UNIX calls to create sockets and bind names to them
etc. The calls needed are <code class="docutils literal"><span class="pre">socket</span></code>, <code class="docutils literal"><span class="pre">bind</span></code>, <code class="docutils literal"><span class="pre">listen</span></code>, <code class="docutils literal"><span class="pre">accept</span></code> and <code class="docutils literal"><span class="pre">shutdown</span></code>. The first three of these
are only called in a fixed sequence, so to make things easier, a small C++ function
<code class="docutils literal"><span class="pre">socket_bind_listen</span></code>, that bundles them up in the right sequence, has been written. The <code class="docutils literal"><span class="pre">accept</span></code>
function is more general than what is needed for this application, so a wrapper function,
<code class="docutils literal"><span class="pre">simple_accept</span></code>, has been written. The result is that the server needs to call only three foreign
functions: <code class="docutils literal"><span class="pre">socket_bind_listen</span></code>, <code class="docutils literal"><span class="pre">simple_accept</span></code> and <code class="docutils literal"><span class="pre">shutdown</span></code>. Glue for these three functions
and the source for the first two is found in the file <code class="docutils literal"><span class="pre">socks.c</span></code>. This file is compiled and linked
using the <code class="docutils literal"><span class="pre">Makefile</span></code>. The result is a shared object file, <code class="docutils literal"><span class="pre">socks.so</span></code>.</p>
</div>
<div class="section" id="use-of-foreign-functions-in-server-self">
<h4>8.14.20. Use of foreign functions in server.self<a class="headerlink" href="#use-of-foreign-functions-in-server-self" title="Permalink to this headline">¶</a></h4>
<p>The server program is implemented using <code class="docutils literal"><span class="pre">foreignFct</span></code> objects. There is only a few lines of code
directly involved in setting this up. First the <code class="docutils literal"><span class="pre">foreignFct</span></code> prototype is cloned to obtain a “local
prototype”, called <code class="docutils literal"><span class="pre">socksFct</span></code>, which contains the path for the <code class="docutils literal"><span class="pre">socks.so</span></code> file. <code class="docutils literal"><span class="pre">socksFct</span></code> is then
cloned each time a <code class="docutils literal"><span class="pre">foreignFct</span></code> object for a function defined in <code class="docutils literal"><span class="pre">socks.so</span></code> is needed. For example,
in <code class="docutils literal"><span class="pre">traits</span> <span class="pre">socket</span></code>, the following method is found:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>copyPort: portNumber = ( &quot;Create a socket, do bind, then listen.&quot;
        | sbl = socksFct copyName: ’socket_bind_listen_glue’. |
        sbl value: portNumber With: deadCopy.
    ).
</pre></div>
</div>
<p>This method copies a <code class="docutils literal"><span class="pre">socket</span></code> object and returns the copy. The local slot <code class="docutils literal"><span class="pre">sbl</span></code> is initialized to a
<code class="docutils literal"><span class="pre">foreignFct</span></code> object. The body of the method simply sends <code class="docutils literal"><span class="pre">value:With:</span></code> to the <code class="docutils literal"><span class="pre">foreignFct</span></code>
object. The first argument is the port number to request for the socket, the second argument is a
<code class="docutils literal"><span class="pre">deadCopy</span></code> of self (socket objects are proxies and <code class="docutils literal"><span class="pre">socket_bind_listen</span></code> returns a proxy, so it
must be passed a dead proxy to revive and store the result in; see section <a class="reference internal" href="#proxy-and-fctproxy-objects">Proxy and fctProxy objects</a>).</p>
<p>There are only three uses of <code class="docutils literal"><span class="pre">foreignFct</span></code> objects in the server and in all three cases, the <code class="docutils literal"><span class="pre">foreignFct</span></code>
object is encapsulated in a method as illustrated above.</p>
<p>In general the design of <code class="docutils literal"><span class="pre">foreignFct</span></code> objects has been aimed at making the use of them light
weight. When cloning them, it is only necessary to specify the minimal information: the name of
the foreign function. They can be encapsulated in a method thus localizing the impact of redesigns.
The complications of dynamic loading and linking are handled automatically, as is the recovery of
dead <code class="docutils literal"><span class="pre">fctProxies</span></code>.</p>
<p class="rubric" id="index-89">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>The bracketed colon indicates that the argument is optional (i.e., there are two versions of the primitive, one taking an argument and one not taking an argument). The bracket is not part of the primitive name. See text for details.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-ref"></span><div class="section" id="references">
<span id="citations"></span><h2>9. References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>[APS93]</dt>
<dd>Ole Agesen, Jens Palsberg and Michael I. Schwartzbach. Type Inference of SELF. In ECOOP ‘93 Conference Proceedings, Kaiserslautern, Germany, July 1993. Published as Springer-Verlag LNCS 707, 1993.</dd>
<dt>[Age94a]</dt>
<dd>Ole Agesen. Mango: A Parser Generator for SELF. Sun Microsystems Labs TR SMLI TR-94-27, 1994.</dd>
<dt>[Age94b]</dt>
<dd>Ole Agesen. Constraint Based Type Inference and Parametric Polymorphism. In Proc. International Static Analysis Symposium, Sep 28-30, 1994.</dd>
<dt>[CU89]</dt>
<dd>Craig Chambers and David Ungar. Customization: Optimizing Compiler Technology for SELF, a Dynamically-Typed Object-Oriented Programming Language. In Proceedings of the SIGPLAN ’89 Conference on Programming Language Design and Implementation, Portland, OR, June, 1989. Published as SIGPLAN Notices 24(7), July, 1989.</dd>
<dt>[CU90]</dt>
<dd>Craig Chambers and David Ungar. Iterative Type Analysis and Extended Message Splitting: Optimizing Dynamically-Typed Object-Oriented Programs. In Proceedings of the SIGPLAN ’90 Conference on Programming Language Design and Implementation, White Plains, NY, June, 1990. Published as SIGPLAN Notices 25(6), June, 1990. Also published in Lisp and Symbolic Computation 4(3), June, 1991.</dd>
<dt>[CU91]</dt>
<dd>Craig Chambers and David Ungar. Making Pure Object-Oriented Languages Practical. In OOPSLA ’91 Conference Proceedings, Phoenix, AZ, October, 1991. Published as SIGPLAN Notices 26(11), November, 1991.</dd>
<dt>[CUC91]</dt>
<dd>Craig Chambers, David Ungar, Bay-Wei Chang, and Urs Hölzle. Parents are Shared Parts of Objects: Inheritance and Encapsulation in SELF. In Lisp and Symbolic Computation 4(3), June, 1991.</dd>
<dt>[CUL89]</dt>
<dd>Craig Chambers, David Ungar, and Elgin Lee. An Efficient Implementation of SELF, a Dynamically-Typed Object-Oriented Language Based on Prototypes. In OOPSLA ’89 Conference Proceedings, New Orleans, LA, October, 1989. Published as SIGPLAN Notices 24(10), October, 1989. Also published in Lisp and Symbolic Computation 4(3), June, 1991.</dd>
<dt>[Cha92]</dt>
<dd>Craig Chambers. The Design and Implementation of the SELF Compiler, an Optimizing Compiler for Object-Oriented Programming Languages. Ph. D. dissertation, Computer Science Department, Stanford University, March 1992.</dd>
<dt>[CU93]</dt>
<dd>Bay-Wei Chang and David Ungar. Animation: From Cartoons to the User Interface. In UIST ‘93 Conference Proceedings, 1993.</dd>
<dt>[DS84]</dt>
<dd>L Peter Deutsch and Allan M. Schiffman. Efficient Implementation of the Smalltalk-80 System. In Proceedings of the 11th Annual ACM Symposium on the Principles of Programming Languages, Salt Lake City, UT, 1984.</dd>
<dt>[GR83]</dt>
<dd>Adele Goldberg and David Robson. Smalltalk-80: The Language and Its Implementation. Addison-Wesley, Reading, MA, 1983.</dd>
<dt>[HCU91]</dt>
<dd>Urs Hölzle, Craig Chambers, and David Ungar. Optimizing Dynamically-Typed Object-Oriented Programming Languages with Polymorphic Inline Caches. In ECOOP ’91 Conference Proceedings, Geneva, Switzerland, July, 1991. Published as Springer-Verlag LNCS 512, 1991.</dd>
<dt>[HCU92]</dt>
<dd>Urs Hölzle, Craig Chambers, and David Ungar. Debugging Optimized Code with Dynamic Deoptimization. In Proceedings of the ACM SIGPLAN ‘92 Conference on Programming Language Design and Implementation, San Francisco, June 1992. Published as SIGPLAN Notices 27(7), July, 1992.</dd>
<dt>[Hoe94]</dt>
<dd>Urs Hölzle. Adaptive Optimization for SELF: Reconciling High Performance with Exploratory Programming. Ph.D. Thesis, Stanford University, August 1994.</dd>
<dt>[HU94]</dt>
<dd>Urs Hölzle and David Ungar. A Third-Generation SELF Implementation: Reconciling Responsiveness with Performance. In Proceedings of OOPSLA ‘94, October 1994.</dd>
<dt>[Lee88]</dt>
<dd>Elgin Lee. Object Storage and Inheritance for SELF. Engineer’s thesis, Stanford University, 1988.</dd>
<dt>[Ung84]</dt>
<dd>David Ungar. Generation Scavenging: A Non-Disruptive High Performance Storage Reclamation Algorithm. In Proceedings of the ACM SIGSOFT/SIGPLAN Software Engineering Symposium on Practical Software Development Environments, Pittsburgh, PA, April, 1984. Published as SIGPLAN Notices 19(5), May, 1984 and Software Engineering Notes 9(3), May, 1984.</dd>
<dt>[Ung86]</dt>
<dd>David Ungar. The Design and Evaluation of a High Performance Smalltalk System. MIT Press, Cambridge, MA, 1987.</dd>
<dt>[UCC91]</dt>
<dd>David Ungar, Craig Chambers, Bay-Wei Chang, and Urs Hölzle. Organizing Programs without Classes. In Lisp and Symbolic Computation 4(3), June, 1991.</dd>
<dt>[US87]</dt>
<dd>David Ungar and Randall B. Smith. SELF: The Power of Simplicity. In OOPSLA ’87 Conference Proceedings, Orlando, FL, 1987. Published as SIGPLAN Notices 22(12), December, 1987. Also published in Lisp and Symbolic Computation 4(3), June, 1991, and as Sun Microsystems Labs TR SMLI 94-0320.</dd>
</dl>
</div>
<span id="document-appendices"></span><div class="section" id="appendices">
<h2>10. Appendices<a class="headerlink" href="#appendices" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-glossary"></span><div class="section" id="glossary">
<span id="id1"></span><h3>10.1. Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A <em>slot</em> is a name-value pair. The value of a slot is often called its <em>contents</em>.</li>
<li>An <em>object</em> is composed of a (possibly empty) set of slots and, optionally, a series of expressions called <em>code</em>. The Self implementation provides objects with indexable slots (vectors) via a set of primitives.</li>
<li>A <em>data object</em> is an object without code.</li>
<li>A <em>data slot</em> is a slot holding a data object. An <em>assignment slot</em> is a slot containing the <em>assignment primitive</em>. An <em>assignable data slot</em> is a data slot for which there is a corresponding assignment slot whose name consists of the data slot’s name followed by a colon. When an assignment slot is evaluated its argument is stored in the corresponding data slot.</li>
<li>An <em>ordinary method</em> (or simply <em>method</em>) is an object with code and is stored as the contents of a slot. The method’s name (also called its <em>selector</em>) is the name of the slot in which it is stored.</li>
<li>A <em>block</em> is an object representing a lexically-scoped closure (similar to a Smalltalk block).</li>
<li>A <em>block method</em> is the method that is executed when a block is evaluated by sending it <code class="docutils literal"><span class="pre">value</span></code>, <code class="docutils literal"><span class="pre">value:</span></code>, <code class="docutils literal"><span class="pre">value:With:</span></code>, etc. A block method is a special kind of method that is evaluated within the scope of its method and any lexically enclosing blocks.</li>
<li>An <code class="docutils literal"><span class="pre">activation</span> <span class="pre">object</span></code> records the state of an executing method or block method. It is a clone of the method prototype used to store the method’s arguments and local slots during execution. There are two kinds of activation objects: <code class="docutils literal"><span class="pre">ordinary</span> <span class="pre">method</span> <span class="pre">activation</span></code> objects (or simply <code class="docutils literal"><span class="pre">method</span> <span class="pre">activation</span></code> objects) and <code class="docutils literal"><span class="pre">block</span> <span class="pre">method</span> <span class="pre">activation</span></code> objects.</li>
<li>A <code class="docutils literal"><span class="pre">non-lifo</span> <span class="pre">block</span></code> is a block that is evaluated after the activation of its lexically enclosing block or method has returned. This results in an error in the current implementation.</li>
<li>A <code class="docutils literal"><span class="pre">non-local</span> <span class="pre">return</span></code> is a return from a method activation resulting from performing a return (i.e., evaluating an expression preceded by the ‘^’ operator) from within a lexically enclosed block. A non-local return forces returns from all activations between the method activation and the activation of the block performing the return.</li>
<li>The <code class="docutils literal"><span class="pre">method</span> <span class="pre">holder</span></code> of a method is the object containing the slot holding that method.</li>
<li>The <code class="docutils literal"><span class="pre">sending</span> <span class="pre">method</span> <span class="pre">holder</span></code> of a message is the method holder of the method that sent it.</li>
<li>A <code class="docutils literal"><span class="pre">message</span></code> is a request to an object to perform some operation. The object to which the request is sent is called the <code class="docutils literal"><span class="pre">receiver</span></code>. A <code class="docutils literal"><span class="pre">message</span> <span class="pre">send</span></code> is the action of sending a message to a receiver.</li>
<li>A <em>primitive send</em> is a message handled by invoking a <em>primitive</em>, a predefined function provided by the Self implementation.</li>
<li>Messages that do not have an explicit receiver are known as <em>implicit-receiver messages</em>. The receiver is bound to <code class="docutils literal"><span class="pre">self</span></code>.</li>
<li>A <em>unary message</em> is a message consisting of a single identifier sent to a receiver. A <em>binary message</em> is a message consisting of an operator and a single argument sent to a receiver. A <em>keyword message</em> is a message consisting of one or more identifiers with trailing colons, each followed by an argument, sent to a receiver.</li>
<li><em>Unary</em>, <em>binary</em>, and <em>keyword slots</em> are slots with selectors that match unary, binary, and keyword messages, respectively.</li>
<li>An <em>argument slot</em> is a slot in a method filled in with a value when the method is invoked.</li>
<li><em>Message lookup</em> is the process by which objects determine how to respond to a message (which slot to evaluate), by searching objects for slots matching the message.</li>
<li><em>Inheritance</em> is the mechanism by which message lookup searches objects for slots when the receiver’s slots are exhausted. An object’s <em>parent slots</em> contain objects that it inherits from.</li>
<li><em>Dynamic inheritance</em> is the modification of object behavior by setting an assignable parent slot.</li>
<li>A <em>resend</em> allows a method to invoke the method that the first method (the one that invokes the resend) is overriding. A <em>directed resend</em> constrains the lookup to search a single parent slot.</li>
<li><em>Cloning</em> is the primitive operation returning an exact shallow copy (a <em>clone</em>) of an object, i.e. a new object containing exactly the same slots and code as the original object.</li>
<li>A <em>prototype</em> is an object that is used as a template from which new objects are cloned.</li>
<li>A <em>traits object</em> is a parent object containing shared behavior, playing a role somewhat similar to a class in a class-based system. Any Self implementation is required to provide traits objects for integers, floats, strings, and blocks (i.e. one object which is the parent of all integers, another object for floats, etc.).</li>
<li>The <em>root context</em> is the object that provides the context (i.e., set of bindings) in which slot initializers are evaluated. This object is known as the <em>lobby</em>. During slot initialization, self is bound to the lobby. The lobby is also the sending method holder for any sends in the initializing expression.</li>
<li><em>nil</em> is the object used to initialize slots without explicit initializers. It is intended to indicate “not a useful object.” This object is provided by the Self implementation.</li>
</ul>
</div>
<span id="document-lexicaloverview"></span><div class="section" id="lexical-overview">
<h3>10.2. Lexical overview<a class="headerlink" href="#lexical-overview" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="5%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>small-letter</td>
<td>→</td>
<td>‘a’ | ‘b’ | ... | ‘z’</td>
</tr>
<tr class="row-even"><td>cap-letter</td>
<td>→</td>
<td>‘A’ | ‘B’ | ... | ‘Z’</td>
</tr>
<tr class="row-odd"><td>letter</td>
<td>→</td>
<td>small-letter | cap-letter</td>
</tr>
<tr class="row-even"><td>identifier</td>
<td>→</td>
<td>(small-letter | ‘_’) {letter | digit | ‘_’}</td>
</tr>
<tr class="row-odd"><td>small-keyword</td>
<td>→</td>
<td>identifier ‘:’</td>
</tr>
<tr class="row-even"><td>cap-keyword</td>
<td>→</td>
<td>cap-letter {letter | digit | ‘_’} ‘:’</td>
</tr>
<tr class="row-odd"><td>argument-name</td>
<td>→</td>
<td>‘:’ identifier</td>
</tr>
<tr class="row-even"><td>op-char</td>
<td>→</td>
<td>‘!’ | ‘&#64;’ | ‘#’ | ‘$’ | ‘%’ | ‘^’ | ‘&amp;’ | ‘*’ | ‘-’ | ‘+’ | ‘=’ | ‘~’ | ‘/’ | ‘?’ | ‘&lt;’ | ‘&gt;’ | ‘,’ | ‘;’ | ‘|’ | ‘‘’ | ‘\’</td>
</tr>
<tr class="row-odd"><td>operator</td>
<td>→</td>
<td>op-char {op-char}</td>
</tr>
<tr class="row-even"><td>number</td>
<td>→</td>
<td>[ ‘-’ ] (integer | real)</td>
</tr>
<tr class="row-odd"><td>integer</td>
<td>→</td>
<td>[base] general-digit {general-digit}</td>
</tr>
<tr class="row-even"><td>real</td>
<td>→</td>
<td>fixed-point | float</td>
</tr>
<tr class="row-odd"><td>fixed-point</td>
<td>→</td>
<td>decimal ‘.’ decimal</td>
</tr>
<tr class="row-even"><td>float</td>
<td>→</td>
<td>decimal [ ‘.’ decimal ] (‘e’ | ‘E’) [ ‘+’ | ‘-’ ] decimal</td>
</tr>
<tr class="row-odd"><td>general-digit</td>
<td>→</td>
<td>digit | letter</td>
</tr>
<tr class="row-even"><td>decimal</td>
<td>→</td>
<td>digit {digit}</td>
</tr>
<tr class="row-odd"><td>base</td>
<td>→</td>
<td>decimal (‘r’ | ‘R’)</td>
</tr>
<tr class="row-even"><td>string</td>
<td>→</td>
<td>‘’’ { normal-char | escape-char } ‘’’</td>
</tr>
<tr class="row-odd"><td>normal-char</td>
<td>→</td>
<td>any character except ‘\’ and ‘’’</td>
</tr>
<tr class="row-even"><td>escape-char</td>
<td>→</td>
<td>‘\t’ | ‘\b’ | ‘\n’ | ‘\f’ | ‘\r’ | ‘\v’ | ‘\a’ | ‘\0’ | ‘\\’ | ‘\’’ | ‘\&#8221;’ | ‘\?’ | numeric-escape</td>
</tr>
<tr class="row-odd"><td>numeric-escape</td>
<td>→</td>
<td>‘\x’ general-digit general-digit | ( ‘\d’ | ‘\o’ ) digit digit digit</td>
</tr>
<tr class="row-even"><td>comment</td>
<td>→</td>
<td>‘&#8221;’ { comment-char } ‘&#8221;’</td>
</tr>
<tr class="row-odd"><td>comment-char</td>
<td>→</td>
<td>any character but ‘&#8221;’</td>
</tr>
</tbody>
</table>
</div>
<span id="document-syntaxoverview"></span><div class="section" id="syntax-overview">
<h3>10.3. Syntax overview<a class="headerlink" href="#syntax-overview" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="5%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>expression</td>
<td>→</td>
<td>constant | unary-message | binary-message | keyword-message | ‘(’ expression ‘)’</td>
</tr>
<tr class="row-even"><td>constant</td>
<td>→</td>
<td>self | number | string | object</td>
</tr>
<tr class="row-odd"><td>unary-message</td>
<td>→</td>
<td>receiver unary-send | resend ‘.’ unary-send</td>
</tr>
<tr class="row-even"><td>unary-send</td>
<td>→</td>
<td>identifier</td>
</tr>
<tr class="row-odd"><td>binary-message</td>
<td>→</td>
<td>receiver binary-send | resend ‘.’ binary-send</td>
</tr>
<tr class="row-even"><td>binary-send</td>
<td>→</td>
<td>operator expression</td>
</tr>
<tr class="row-odd"><td>keyword-message</td>
<td>→</td>
<td>receiver keyword-send | resend ‘.’ keyword-send</td>
</tr>
<tr class="row-even"><td>keyword-send</td>
<td>→</td>
<td>small-keyword expression { cap-keyword expression }</td>
</tr>
<tr class="row-odd"><td>receiver</td>
<td>→</td>
<td>[ expression ]</td>
</tr>
<tr class="row-even"><td>resend</td>
<td>→</td>
<td>resend | identifier</td>
</tr>
<tr class="row-odd"><td>object</td>
<td>→</td>
<td>regular-object | block</td>
</tr>
<tr class="row-even"><td>regular-object</td>
<td>→</td>
<td>‘(’ [ ‘|’ [ ‘{’ ‘}’ ‘=’ string ] slot-list ‘|’ ] [ code ] ‘)’</td>
</tr>
<tr class="row-odd"><td>block</td>
<td>→</td>
<td>‘[’ [ ‘|’ slot-list    ‘|’ ] [ code ] ‘]’</td>
</tr>
<tr class="row-even"><td>slot-list</td>
<td>→</td>
<td>{ unannotated-slot-list | annotated-slot-list }</td>
</tr>
<tr class="row-odd"><td>annotated-slot-list</td>
<td>→</td>
<td>‘{’ string slot-list ‘}’</td>
</tr>
<tr class="row-even"><td>unannotated-slot-list</td>
<td>→</td>
<td>{ slot ‘.’} slot [ ‘.’ ]</td>
</tr>
<tr class="row-odd"><td>code</td>
<td>→</td>
<td>{ expression ‘.’} [ ‘^’ ] expression [ ‘.’ ]</td>
</tr>
<tr class="row-even"><td>slot</td>
<td>→</td>
<td>arg-slot | data-slot | binary-slot | keyword-slot</td>
</tr>
<tr class="row-odd"><td>arg-slot</td>
<td>→</td>
<td>argument-name</td>
</tr>
<tr class="row-even"><td>data-slot</td>
<td>→</td>
<td>slot-name | slot-name ‘&lt;-’ expression | slot-name ‘=’ expression</td>
</tr>
<tr class="row-odd"><td>unary-slot</td>
<td>→</td>
<td>slot-name ‘=’ regular-object</td>
</tr>
<tr class="row-even"><td>binary-slot</td>
<td>→</td>
<td>operator ‘=’ regular-object | operator [identifier] ‘=’ regular-object</td>
</tr>
<tr class="row-odd"><td>keyword-slot</td>
<td>→</td>
<td>small-keyword {cap-keyword} ‘=’ regular-object | small-keyword identifier {cap-keyword identifier} ‘=’ regular-object</td>
</tr>
<tr class="row-even"><td>slot-name</td>
<td>→</td>
<td>identifier | parent-name</td>
</tr>
<tr class="row-odd"><td>parent-name</td>
<td>→</td>
<td>identifier ‘*’</td>
</tr>
</tbody>
</table>
</div>
<span id="document-builtintypes"></span><div class="section" id="built-in-types">
<h3>10.4. Built-in types<a class="headerlink" href="#built-in-types" title="Permalink to this headline">¶</a></h3>
<p>There are a small number of built-in types that are directly supported through primitives and syntax:</p>
<blockquote>
<div><p><em>Integers</em> and <em>floats</em> are provided with primitives for performing arithmetic operations, comparisons etc.</p>
<p><em>Strings</em> have a <em>byte vector</em> part for storing the characters. Special string primitives are provided.</p>
<p><em>Blocks</em> are objects which combine code with an environment link. Used for control structures, they are described in section <span class="xref std std-ref">langref-blocks</span>.</p>
</div></blockquote>
<p>In addition, there are a number of VM-supported types described in the sections on the Self World
and the VM reference manual, such as <em>mirrors</em>, <em>processes</em>, <em>vectors</em>, <em>proxies</em> and <em>profilers</em>.</p>
</div>
<span id="document-usefulselectors"></span><div class="section" id="useful-selectors">
<h3>10.5. Useful Selectors<a class="headerlink" href="#useful-selectors" title="Permalink to this headline">¶</a></h3>
<p>This is a list of selectors which Selfers should find useful as a starting point.</p>
<div class="section" id="copying">
<h4>10.5.1. Copying<a class="headerlink" href="#copying" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>clone</td>
<td>shallow copy (for use within an object; clients should use copy)</td>
</tr>
<tr class="row-even"><td>copy</td>
<td>copy the receiver, possibly with embedded copies or initialization</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="comparing">
<h4>10.5.2. Comparing<a class="headerlink" href="#comparing" title="Permalink to this headline">¶</a></h4>
<div class="section" id="equality">
<h5>10.5.2.1. Equality<a class="headerlink" href="#equality" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>=</td>
<td>equal</td>
</tr>
<tr class="row-even"><td>!=</td>
<td>not equal</td>
</tr>
<tr class="row-odd"><td>hash</td>
<td>hash value</td>
</tr>
<tr class="row-even"><td>==</td>
<td>identical (the same object; this is reflective and should be avoided)</td>
</tr>
<tr class="row-odd"><td>!==</td>
<td>not identical</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ordered">
<h5>10.5.2.2. Ordered<a class="headerlink" href="#ordered" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&lt;</td>
<td>less than</td>
</tr>
<tr class="row-even"><td>&gt;</td>
<td>greater than</td>
</tr>
<tr class="row-odd"><td>&lt;=</td>
<td>less than or equal</td>
</tr>
<tr class="row-even"><td>&gt;=</td>
<td>greater than or equal</td>
</tr>
<tr class="row-odd"><td>compare: IfLess: Equal: Greater:</td>
<td>three way comparison</td>
</tr>
<tr class="row-even"><td>compare: IfLess: Equal: Greater: Incomparable:</td>
<td>three way comparison with failure</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="numeric-operations">
<h4>10.5.3. Numeric operations<a class="headerlink" href="#numeric-operations" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>+</td>
<td>add</td>
</tr>
<tr class="row-even"><td>-</td>
<td>subtract</td>
</tr>
<tr class="row-odd"><td>*</td>
<td>multiply</td>
</tr>
<tr class="row-even"><td>/</td>
<td>divide</td>
</tr>
<tr class="row-odd"><td>/=</td>
<td>divide exactly (returns float)</td>
</tr>
<tr class="row-even"><td>/~</td>
<td>divide and round to integer (tends to round up)</td>
</tr>
<tr class="row-odd"><td>/+</td>
<td>divide and round up to integer</td>
</tr>
<tr class="row-even"><td>/-%</td>
<td>divide and round down to integer modulus</td>
</tr>
<tr class="row-odd"><td>absoluteValue</td>
<td>absolute value</td>
</tr>
<tr class="row-even"><td>inverse</td>
<td>multiplicative inverse</td>
</tr>
<tr class="row-odd"><td>negate</td>
<td>additive inverse</td>
</tr>
<tr class="row-even"><td>ceil</td>
<td>round towards positive infinity</td>
</tr>
<tr class="row-odd"><td>floor</td>
<td>round towards negative infinity</td>
</tr>
<tr class="row-even"><td>truncate</td>
<td>truncate towards zero</td>
</tr>
<tr class="row-odd"><td>round</td>
<td>round</td>
</tr>
<tr class="row-even"><td>asFloat</td>
<td>coerce to float</td>
</tr>
<tr class="row-odd"><td>asInteger</td>
<td>coerce to integer</td>
</tr>
<tr class="row-even"><td>double</td>
<td>multiply by two</td>
</tr>
<tr class="row-odd"><td>quadruple</td>
<td>multiply by four</td>
</tr>
<tr class="row-even"><td>half</td>
<td>divide by two</td>
</tr>
<tr class="row-odd"><td>quarter</td>
<td>divide by four</td>
</tr>
<tr class="row-even"><td>min:</td>
<td>minimum of receiver and argument</td>
</tr>
<tr class="row-odd"><td>max:</td>
<td>maximum of receiver and argument</td>
</tr>
<tr class="row-even"><td>mean:</td>
<td>mean of receiver and argument</td>
</tr>
<tr class="row-odd"><td>pred</td>
<td>predecessor</td>
</tr>
<tr class="row-even"><td>predecessor</td>
<td>predecessor</td>
</tr>
<tr class="row-odd"><td>succ</td>
<td>successor</td>
</tr>
<tr class="row-even"><td>successor</td>
<td>successor</td>
</tr>
<tr class="row-odd"><td>power:</td>
<td>raise receiver to integer power</td>
</tr>
<tr class="row-even"><td>log:</td>
<td>logarithm of argument base receiver, rounded down to integer</td>
</tr>
<tr class="row-odd"><td>square</td>
<td>square</td>
</tr>
<tr class="row-even"><td>squareRoot</td>
<td>square root</td>
</tr>
<tr class="row-odd"><td>factorial</td>
<td>factorial</td>
</tr>
<tr class="row-even"><td>fibonacci</td>
<td>fibonacci</td>
</tr>
<tr class="row-odd"><td>sign</td>
<td>signum (-1, 0, 1)</td>
</tr>
<tr class="row-even"><td>even</td>
<td>true if receiver is even</td>
</tr>
<tr class="row-odd"><td>odd</td>
<td>true if receiver is odd</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="bitwise-operations-integers">
<h4>10.5.4. Bitwise operations (integers)<a class="headerlink" href="#bitwise-operations-integers" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&amp;&amp;</td>
<td>and</td>
</tr>
<tr class="row-even"><td>||</td>
<td>or</td>
</tr>
<tr class="row-odd"><td>^^</td>
<td>xor</td>
</tr>
<tr class="row-even"><td>complement</td>
<td>bitwise complement</td>
</tr>
<tr class="row-odd"><td>&lt;&lt;</td>
<td>logical left shift</td>
</tr>
<tr class="row-even"><td>&gt;&gt;</td>
<td>logical right shift</td>
</tr>
<tr class="row-odd"><td>&lt;+</td>
<td>arithmetic left shift</td>
</tr>
<tr class="row-even"><td>+&gt;</td>
<td>arithmetic right shift</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="logical-operations-booleans">
<h4>10.5.5. Logical operations (booleans)<a class="headerlink" href="#logical-operations-booleans" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&amp;&amp;</td>
<td>and</td>
</tr>
<tr class="row-even"><td>||</td>
<td>or</td>
</tr>
<tr class="row-odd"><td>^^</td>
<td>xor</td>
</tr>
<tr class="row-even"><td>not</td>
<td>logical complement</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="constructing">
<h4>10.5.6. Constructing<a class="headerlink" href="#constructing" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#64;</td>
<td>point construction (receiver and argument are integers)</td>
</tr>
<tr class="row-even"><td>#</td>
<td>rectangle construction (receiver and argument are points)</td>
</tr>
<tr class="row-odd"><td>##</td>
<td>rectangle construction (receiver is a point, argument is an extent)</td>
</tr>
<tr class="row-even"><td>&amp;</td>
<td>collection construction (result can be converted into collection)</td>
</tr>
<tr class="row-odd"><td>,</td>
<td>concatenation</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="printing">
<h4>10.5.7. Printing<a class="headerlink" href="#printing" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>print</td>
<td>print object on stdout</td>
</tr>
<tr class="row-even"><td>printLine</td>
<td>print object on stdout with trailing newline</td>
</tr>
<tr class="row-odd"><td>printString</td>
<td>return a string label</td>
</tr>
<tr class="row-even"><td>printStringDepth:</td>
<td>return a string label with depth limitation request</td>
</tr>
<tr class="row-odd"><td>printStringSize:</td>
<td>return a string label with number of characters limitation request</td>
</tr>
<tr class="row-even"><td>printStringSize: Depth:</td>
<td>return a string label with depth and size limitation request</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="control">
<h4>10.5.8. Control<a class="headerlink" href="#control" title="Permalink to this headline">¶</a></h4>
<div class="section" id="block-evaluation">
<h5>10.5.8.1. Block evaluation<a class="headerlink" href="#block-evaluation" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>value[: {With: }]</td>
<td>evaluate a block, passing arguments</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="selection">
<h5>10.5.8.2. Selection<a class="headerlink" href="#selection" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ifTrue:</td>
<td>evaluate argument if receiver is true</td>
</tr>
<tr class="row-even"><td>ifFalse:</td>
<td>evaluate argument if receiver is false</td>
</tr>
<tr class="row-odd"><td>ifTrue: False:</td>
<td>evaluate first arg if true, second arg if false</td>
</tr>
<tr class="row-even"><td>ifFalse: True:</td>
<td>evaluate first arg if false, second arg if true</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="local-exiting">
<h5>10.5.8.3. Local exiting<a class="headerlink" href="#local-exiting" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>exit</td>
<td>exit block and return nil if block’s argument is evaluated</td>
</tr>
<tr class="row-even"><td>exitValue</td>
<td>exit block and return a value if block’s argument is evaluated</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="basic-looping">
<h5>10.5.8.4. Basic looping<a class="headerlink" href="#basic-looping" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>loop</td>
<td>repeat the block forever</td>
</tr>
<tr class="row-even"><td>loopExit</td>
<td>repeat the block until argument is evaluated; then exit and return nil</td>
</tr>
<tr class="row-odd"><td>loopExitValue</td>
<td>repeat the block until argument is evaluated; then exit and return a value</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pre-test-looping">
<h5>10.5.8.5. Pre-test looping<a class="headerlink" href="#pre-test-looping" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>whileTrue</td>
<td>repeat the receiver until it evaluates to true</td>
</tr>
<tr class="row-even"><td>whileFalse</td>
<td>repeat the receiver until it evaluates to false</td>
</tr>
<tr class="row-odd"><td>whileTrue:</td>
<td>repeat the receiver and argument until receiver evaluates to true</td>
</tr>
<tr class="row-even"><td>whileFalse:</td>
<td>repeat the receiver and argument until receiver evaluates to false</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="post-test-looping">
<h5>10.5.8.6. Post-test looping<a class="headerlink" href="#post-test-looping" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>untilTrue:</td>
<td>repeat the receiver and argument until argument evaluates to true</td>
</tr>
<tr class="row-even"><td>untilFalse:</td>
<td>repeat the receiver and argument until argument evaluates to false</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="iterators">
<h5>10.5.8.7. Iterators<a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>do:</td>
<td>iterate, passing each element to the argument block</td>
</tr>
<tr class="row-even"><td>to: By: Do:</td>
<td>iterate, with stepping</td>
</tr>
<tr class="row-odd"><td>to: Do:</td>
<td>iterate forward</td>
</tr>
<tr class="row-even"><td>upTo: By: Do:</td>
<td>iterate forward, without last element, with stepping</td>
</tr>
<tr class="row-odd"><td>upTo: Do:</td>
<td>iterate forward, without last element</td>
</tr>
<tr class="row-even"><td>downTo: By: Do:</td>
<td>reverse iterate, with stepping</td>
</tr>
<tr class="row-odd"><td>downTo: Do:</td>
<td>reverse iterate</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="collections">
<h4>10.5.9. Collections<a class="headerlink" href="#collections" title="Permalink to this headline">¶</a></h4>
<div class="section" id="sizing">
<h5>10.5.9.1. Sizing<a class="headerlink" href="#sizing" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>isEmpty</td>
<td>test if collection is empty</td>
</tr>
<tr class="row-even"><td>size</td>
<td>return number of elements in collection</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="adding">
<h5>10.5.9.2. Adding<a class="headerlink" href="#adding" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>add:</td>
<td>add argument element to collection receiver</td>
</tr>
<tr class="row-even"><td>addAll:</td>
<td>add all elements of argument to receiver</td>
</tr>
<tr class="row-odd"><td>at: Put:</td>
<td>add key-value pair</td>
</tr>
<tr class="row-even"><td>at: Put: IfAbsent:</td>
<td>add key-value pair, evaluating block if key is absent</td>
</tr>
<tr class="row-odd"><td>addFirst:</td>
<td>add element to head of list</td>
</tr>
<tr class="row-even"><td>addLast:</td>
<td>add element to tail of list</td>
</tr>
<tr class="row-odd"><td>copyAddAll:</td>
<td>return a copy containing the elements of both receiver and argument</td>
</tr>
<tr class="row-even"><td>copyContaining:</td>
<td>return a copy containing only the elements of the argument</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="removing">
<h5>10.5.9.3. Removing<a class="headerlink" href="#removing" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>remove:</td>
<td>remove the given element</td>
</tr>
<tr class="row-even"><td>remove: IfAbsent:</td>
<td>remove the given element, evaluating block if absent</td>
</tr>
<tr class="row-odd"><td>removeAll</td>
<td>remove all elements</td>
</tr>
<tr class="row-even"><td>removeFirst</td>
<td>remove first element from list</td>
</tr>
<tr class="row-odd"><td>removeLast</td>
<td>remove last element from list</td>
</tr>
<tr class="row-even"><td>removeAllOccurences:</td>
<td>remove all occurrences of this element from list</td>
</tr>
<tr class="row-odd"><td>removeKey:</td>
<td>remove element at the given key</td>
</tr>
<tr class="row-even"><td>removeKey: IfAbsent:</td>
<td>remove element at the given key, evaluating block if absent</td>
</tr>
<tr class="row-odd"><td>copyRemoveAll</td>
<td>return an empty copy</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="accessing">
<h5>10.5.9.4. Accessing<a class="headerlink" href="#accessing" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>first</td>
<td>return the first element</td>
</tr>
<tr class="row-even"><td>last</td>
<td>return the last element</td>
</tr>
<tr class="row-odd"><td>includes:</td>
<td>test if element is member of the collection</td>
</tr>
<tr class="row-even"><td>occurrencesOf:</td>
<td>return number of occurences of element in collection</td>
</tr>
<tr class="row-odd"><td>findFirst: IfPresent: IfAbsent:</td>
<td>evaluate present block on first element found satisfying criteria, absent block if no such element</td>
</tr>
<tr class="row-even"><td>at:</td>
<td>return element at the given key</td>
</tr>
<tr class="row-odd"><td>at: IfAbsent:</td>
<td>return element at the given key, evaluating block if absent</td>
</tr>
<tr class="row-even"><td>includesKey:</td>
<td>test if collection contains a given key</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="iterating">
<h5>10.5.9.5. Iterating<a class="headerlink" href="#iterating" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>do:</td>
<td>iterate, passing each element to argument block</td>
</tr>
<tr class="row-even"><td>doFirst: Middle: Last: IfEmpty:</td>
<td>iterate, with special behavior for first and last</td>
</tr>
<tr class="row-odd"><td>doFirst: MiddleLast: IfEmpty:</td>
<td>iterate, with special behavior for first</td>
</tr>
<tr class="row-even"><td>doFirstLast: Middle: IfEmpty:</td>
<td>iterate, with special behavior for ends</td>
</tr>
<tr class="row-odd"><td>doFirstMiddle: Last: IfEmpty:</td>
<td>iterate, with special behavior for last</td>
</tr>
<tr class="row-even"><td>reverseDo:</td>
<td>iterate backwards through list</td>
</tr>
<tr class="row-odd"><td>with: Do:</td>
<td>co-iterate, passing corresponding elements to block</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="reducing">
<h5>10.5.9.6. Reducing<a class="headerlink" href="#reducing" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>max</td>
<td>return maximum element</td>
</tr>
<tr class="row-even"><td>mean</td>
<td>return mean of elements</td>
</tr>
<tr class="row-odd"><td>min</td>
<td>return minimum element</td>
</tr>
<tr class="row-even"><td>sum</td>
<td>return sum of elements</td>
</tr>
<tr class="row-odd"><td>product</td>
<td>return product of elements</td>
</tr>
<tr class="row-even"><td>reduceWith:</td>
<td>evaluate reduction block with elements</td>
</tr>
<tr class="row-odd"><td>reduceWith: IfEmpty:</td>
<td>evaluate reduction block with elements, evaluating block if empty</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="transforming">
<h5>10.5.9.7. Transforming<a class="headerlink" href="#transforming" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>asByteVector</td>
<td>return a byte vector with same elements</td>
</tr>
<tr class="row-even"><td>asString</td>
<td>return a string with same elements</td>
</tr>
<tr class="row-odd"><td>asVector</td>
<td>return a vector with same elements</td>
</tr>
<tr class="row-even"><td>asList</td>
<td>return a list with the same elements</td>
</tr>
<tr class="row-odd"><td>filterBy: Into:</td>
<td>add elements that satisfy filter block to a collection</td>
</tr>
<tr class="row-even"><td>mapBy:</td>
<td>add result of evaluating map block with each element to this collection</td>
</tr>
<tr class="row-odd"><td>mapBy: Into:</td>
<td>add result of evaluating map block with each element to a collection</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="sorting">
<h5>10.5.9.8. Sorting<a class="headerlink" href="#sorting" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>sort</td>
<td>sort receiver in place</td>
</tr>
<tr class="row-even"><td>copySorted</td>
<td>copy sorted in ascending order</td>
</tr>
<tr class="row-odd"><td>copyReverseSorted</td>
<td>copy sorted in descending order</td>
</tr>
<tr class="row-even"><td>copySortedBy:</td>
<td>copy sorted by custom sort criteria</td>
</tr>
<tr class="row-odd"><td>sortedDo:</td>
<td>iterate in ascending order</td>
</tr>
<tr class="row-even"><td>reverseSortedDo:</td>
<td>iterate in descending order</td>
</tr>
<tr class="row-odd"><td>sortedBy: Do:</td>
<td>iterate in order of custom sort criteria</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="indexable-specific">
<h5>10.5.9.9. Indexable-specific<a class="headerlink" href="#indexable-specific" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>firstKey</td>
<td>return the first key</td>
</tr>
<tr class="row-even"><td>lastKey</td>
<td>return the last key</td>
</tr>
<tr class="row-odd"><td>loopFrom: Do:</td>
<td>circularly iterate, starting from element n</td>
</tr>
<tr class="row-even"><td>copyAddFirst:</td>
<td>return a copy of this collection with element added to beginning</td>
</tr>
<tr class="row-odd"><td>copyAddLast:</td>
<td>return a copy of this collection with element added to end</td>
</tr>
<tr class="row-even"><td>copyFrom:</td>
<td>return a copy of this collection from element n</td>
</tr>
<tr class="row-odd"><td>copyFrom: UpTo:</td>
<td>return a copy of this collection from element n up to element m</td>
</tr>
<tr class="row-even"><td>copyWithoutLast</td>
<td>return a copy of this collection without the last element</td>
</tr>
<tr class="row-odd"><td>copySize:</td>
<td>copy with size n</td>
</tr>
<tr class="row-even"><td>copySize: FillingWith:</td>
<td>copy with size n, filling in any extra elements with second arg</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="timing">
<h4>10.5.10. Timing<a class="headerlink" href="#timing" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>realTime</td>
<td>elapsed real time to execute a block</td>
</tr>
<tr class="row-even"><td>cpuTime</td>
<td>CPU time to execute a block</td>
</tr>
<tr class="row-odd"><td>userTime</td>
<td>CPU time in user process to execute a block</td>
</tr>
<tr class="row-even"><td>systemTime</td>
<td>CPU time in system kernel to execute a block</td>
</tr>
<tr class="row-odd"><td>totalTime</td>
<td>system + user time to execute a block</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="message-sending">
<h4>10.5.11. Message Sending<a class="headerlink" href="#message-sending" title="Permalink to this headline">¶</a></h4>
<div class="section" id="sending">
<h5>10.5.11.1. Sending<a class="headerlink" href="#sending" title="Permalink to this headline">¶</a></h5>
<p>Like Smalltalk <code class="docutils literal"><span class="pre">perform</span></code>; receiver is a string.</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>sendTo: {With: }</td>
<td>send receiver string as a message</td>
</tr>
<tr class="row-even"><td>sendTo: WithArguments:</td>
<td>indirect send with arguments in a vector</td>
</tr>
<tr class="row-odd"><td>sendTo: DelegatingTo: {With: }</td>
<td>indirect delegated send</td>
</tr>
<tr class="row-even"><td>sendTo: DelegatingTo: WithArguments:</td>
<td>indirect delegated send with arg vector</td>
</tr>
<tr class="row-odd"><td>resendTo: {With: }</td>
<td>indirect resend</td>
</tr>
<tr class="row-even"><td>resendTo: WithArguments:</td>
<td>indirect resend with arguments in a vector</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="message-object-protocol">
<h5>10.5.11.2. Message object protocol<a class="headerlink" href="#message-object-protocol" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>send</td>
<td>perform the send described by a message object</td>
</tr>
<tr class="row-even"><td>fork</td>
<td>start a new process; the new process performs the message</td>
</tr>
<tr class="row-odd"><td>receiver:</td>
<td>set receiver</td>
</tr>
<tr class="row-even"><td>selector:</td>
<td>set selector</td>
</tr>
<tr class="row-odd"><td>methodHolder:</td>
<td>set method holder</td>
</tr>
<tr class="row-even"><td>delegatee:</td>
<td>set delegatee of the message object</td>
</tr>
<tr class="row-odd"><td>arguments:</td>
<td>set arguments (packaged in a vector)</td>
</tr>
<tr class="row-even"><td>receiver: Selector:</td>
<td>set receiver and selector</td>
</tr>
<tr class="row-odd"><td>receiver: Selector: Arguments:</td>
<td>set receiver, selector, and arguments</td>
</tr>
<tr class="row-even"><td>receiver: Selector: Type: Delegatee: MethodHolder: Arguments:</td>
<td>set all components</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="reflection-mirrors">
<h4>10.5.12. Reflection (mirrors)<a class="headerlink" href="#reflection-mirrors" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>reflect:</td>
<td>returns a mirror on the argument</td>
</tr>
<tr class="row-even"><td>reflectee</td>
<td>returns the object the mirror receiver reflects</td>
</tr>
<tr class="row-odd"><td>contentsAt:</td>
<td>returns a mirror on the contents of slot n</td>
</tr>
<tr class="row-even"><td>isAssignableAt:</td>
<td>tests if slot n is an assignable slot</td>
</tr>
<tr class="row-odd"><td>isParentAt:</td>
<td>tests if slot n is a parent slot</td>
</tr>
<tr class="row-even"><td>isArgumentAt:</td>
<td>tests if slot n is an argument slot</td>
</tr>
<tr class="row-odd"><td>parentPriorityAt:</td>
<td>returns the parent priority of slot n</td>
</tr>
<tr class="row-even"><td>slotAt:</td>
<td>returns a slot object representing slot n</td>
</tr>
<tr class="row-odd"><td>contentsAt:</td>
<td>returns the contents of the slot named n</td>
</tr>
<tr class="row-even"><td>visibilityAt:</td>
<td>returns a visibility object representing visibility of slot n</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="system-wide-enumerations">
<h4>10.5.13. System-wide Enumerations<a class="headerlink" href="#system-wide-enumerations" title="Permalink to this headline">¶</a></h4>
<p>Messages sent to the oddball object browse.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>all[Limit: ]</td>
<td>returns a vector of mirrors on all objects in the system (up to the limit)</td>
</tr>
<tr class="row-even"><td>referencesOf: [Limit: ]</td>
<td>returns a vector of mirrors on all objects referring to arg (up to the limit)</td>
</tr>
<tr class="row-odd"><td>referencesOfReflectee: [Limit: ]</td>
<td>returns a vector of mirrors on all objects referring to argument’s reflectee (up to the limit); allows one to find references to a method</td>
</tr>
<tr class="row-even"><td>childrenOf: [Limit: ]</td>
<td>returns a vector of mirrors on all objects with a parent slot referring to the given object (up to the limit)</td>
</tr>
<tr class="row-odd"><td>implementorsOf: [Limit: ]</td>
<td>returns a vector of mirrors on objects with slots whose names match the given selector (up to the limit)</td>
</tr>
<tr class="row-even"><td>sendersOf: [Limit: ]</td>
<td>returns a vector of mirrors on methods whose selectors match the given selector (up to the limit)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="debugging">
<h4>10.5.14. Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>halt</td>
<td>halt the current process</td>
</tr>
<tr class="row-even"><td>halt:</td>
<td>halt and print a message string</td>
</tr>
<tr class="row-odd"><td>error:</td>
<td>halt, print an error message, and display the stack</td>
</tr>
<tr class="row-even"><td>warning:</td>
<td>beep, print a warning message, and continue</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="virtual-machine-generated">
<h4>10.5.15. Virtual Machine-Generated<a class="headerlink" href="#virtual-machine-generated" title="Permalink to this headline">¶</a></h4>
<div class="section" id="errors">
<h5>10.5.15.1. Errors<a class="headerlink" href="#errors" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>undefinedSelector: Type: Delegatee: MethodHolder: Arguments:</td>
<td>lookup found no matching slot</td>
</tr>
<tr class="row-even"><td>ambiguousSelector: Type: Delegatee: MethodHolder: Arguments:</td>
<td>lookup found more than one matching slot</td>
</tr>
<tr class="row-odd"><td>missingParentSelector: Type: Delegatee: MethodHolder: Arguments:</td>
<td>parent slot through which resend was delegated was not found</td>
</tr>
<tr class="row-even"><td>performTypeErrorSelector: Type: Delegatee: MethodHolder: Arguments:</td>
<td>first argument to the _Perform primitive was not a canonical string</td>
</tr>
<tr class="row-odd"><td>mismatchedArgumentCountSelector: Type: Delegatee: MethodHolder: Arguments:</td>
<td>number of args supplied to _Perform primitive does not match selector</td>
</tr>
<tr class="row-even"><td>primitiveFailedError: Name:</td>
<td>the named primitive failed with given error string</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="other-system-triggered-messages">
<h5>10.5.15.2. Other system-triggered messages<a class="headerlink" href="#other-system-triggered-messages" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>postRead</td>
<td>slot to evaluate after reading a snapshot</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-menus"></span><div class="section" id="every-menu-item-in-the-programming-environment">
<h3>10.6. Every Menu Item in the Programming Environment<a class="headerlink" href="#every-menu-item-in-the-programming-environment" title="Permalink to this headline">¶</a></h3>
<p>This table only covers the middle-button menus, the right-button (morph) menu is described elsewhere.
It merges items from several menus: the background menu, the outliner whole-object
menu, the outliner category menu, the outliner slot menu, the text editor menu, the debugger stack
menu, the iterator object menus, and the changed module morph menu.</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-number">Table 10.1 </span><span class="caption-text">Menu Items</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Label</th>
<th class="head">Function</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Add Category</td>
<td>Adds a category to an object or category.</td>
</tr>
<tr class="row-odd"><td>Add Slot</td>
<td>Adds a slot to an object or category.</td>
</tr>
<tr class="row-even"><td>Added or Changed Slots</td>
<td>On a module morph, enumerates slots added/changed since last save.</td>
</tr>
<tr class="row-odd"><td>All Modules</td>
<td>Summons a hierarchical list of all modules from the changed modules morph.</td>
</tr>
<tr class="row-even"><td>All Slots</td>
<td>On a module morph, enumerates its slots.</td>
</tr>
<tr class="row-odd"><td>Changed Modules</td>
<td>Summons a list of changed modules.</td>
</tr>
<tr class="row-even"><td>Children</td>
<td>Enumerate an object’s children.</td>
</tr>
<tr class="row-odd"><td>Clean Up</td>
<td>Clean up the screen: collapse outliners and stack them on the left of the window.</td>
</tr>
<tr class="row-even"><td>Clean Up Memory</td>
<td>Manually initiate a garbage collection. Can help when you know you have just freed up a bunch of space. Self also does this automatically.</td>
</tr>
<tr class="row-odd"><td>Collapse All</td>
<td>Collapses all outliners, or all categories within an outliner or category.</td>
</tr>
<tr class="row-even"><td>Copy Down Children</td>
<td>Enumerate an object’s copy-down children.</td>
</tr>
<tr class="row-odd"><td>Copy Down Parent</td>
<td>Show an object’s copy-down parent.</td>
</tr>
<tr class="row-even"><td>Copy</td>
<td>Copies slots, categories or text.</td>
</tr>
<tr class="row-odd"><td>Core Sampler</td>
<td>Summons an object for manipulating morphs.</td>
</tr>
<tr class="row-even"><td>Create Button</td>
<td>For a slot, create a button to send the message to the object. The receiver may be set by carrying the button on top of the receiver and using the middle-button on the button. (The button is grabbed with either the car-pet-morph or with the grab right-menu item. Bug: buttons do not mani-fest their results.)</td>
</tr>
<tr class="row-odd"><td>Cut</td>
<td>Copies text to the text buffer.</td>
</tr>
<tr class="row-even"><td>Do Selection</td>
<td>Evaluate the selected text, do not show the result.</td>
</tr>
<tr class="row-odd"><td>Do it</td>
<td>Evaluate the text in the editor, do not show the result.</td>
</tr>
<tr class="row-even"><td>Edit</td>
<td>On a slot, open an editor to change its name, slot type, or contents.</td>
</tr>
<tr class="row-odd"><td>Evaluator</td>
<td>Adds an evaluator window to an object outliner.</td>
</tr>
<tr class="row-even"><td>Expand All</td>
<td>Expand all subcategories.</td>
</tr>
<tr class="row-odd"><td>Expatriate Slots</td>
<td>On the changed module morph; shows a list of slots not included in any module.</td>
</tr>
<tr class="row-even"><td>(Don’t) Filter Frames</td>
<td>On a debugger stack, enable (or disable) filtering.</td>
</tr>
<tr class="row-odd"><td>Find Slot</td>
<td>Searches an object and its ancestors for slot names matching a pattern.</td>
</tr>
<tr class="row-even"><td>Find Slot of :</td>
<td>For an assignable slot x, show all slots named x: in the object and its ancestors.</td>
</tr>
<tr class="row-odd"><td>Flush</td>
<td>Discards cached state, e.g. the result of an enumeration.</td>
</tr>
<tr class="row-even"><td>Forget I was changed</td>
<td>On a module morph, removes it from the list of changed modules and clears out its record of added, changed &amp; removed slots.</td>
</tr>
<tr class="row-odd"><td>Get Module Object</td>
<td>On a module morph summons the object outliner for the module. Useful for editing its postFileIn method, or its revision.</td>
</tr>
<tr class="row-even"><td>Get Selection</td>
<td>Evaluate the selected text &amp; show the result.</td>
</tr>
<tr class="row-odd"><td>Get it</td>
<td>Evaluate the text in the editor, show the result.</td>
</tr>
<tr class="row-even"><td>Hide Annotation</td>
<td>Hides the object or slot annotation.</td>
</tr>
<tr class="row-odd"><td>Hide Comment</td>
<td>Hides the object or slot comment.</td>
</tr>
<tr class="row-even"><td>Implementors</td>
<td>Searches for slots of a given name.</td>
</tr>
<tr class="row-odd"><td>Implementors of :</td>
<td>For an assignable slot x, show all implementors of x:.</td>
</tr>
<tr class="row-even"><td>Load Morph From File</td>
<td>Reads in a file created with the right-menu item “Save Morph to File”</td>
</tr>
<tr class="row-odd"><td>Make Creator</td>
<td>On a slot, set the creator annotation of its contents to be the slot.</td>
</tr>
<tr class="row-even"><td>Make Private</td>
<td>Change the style of the slot to show that it is intended to be private (not enforced).</td>
</tr>
<tr class="row-odd"><td>Make Public</td>
<td>Change the style of the slot to show that it is intended to be public (not enforced). Adds a comment for posterity.</td>
</tr>
<tr class="row-even"><td>Make Undeclared</td>
<td>Change the style of the slot to show that no clear intention exists as to its visibility. (A Self exclusive!)</td>
</tr>
<tr class="row-odd"><td>Methods Containing</td>
<td>Searches for all methods containing a string.</td>
</tr>
<tr class="row-even"><td>Move</td>
<td>Moves slots or categories.</td>
</tr>
<tr class="row-odd"><td>New Shell</td>
<td>Summon a new shell object.</td>
</tr>
<tr class="row-even"><td>Open Factory Win-dow</td>
<td>Open a new window containing handy morphs (such as a radar-view) you can tear-off and drag to other Self windows.</td>
</tr>
<tr class="row-odd"><td>Palette</td>
<td>Summons an object for obtaining morphs for building.</td>
</tr>
<tr class="row-even"><td>Paste</td>
<td>Pastes text from the buffer.</td>
</tr>
<tr class="row-odd"><td>Quit</td>
<td>Leave job and ride boxcars.</td>
</tr>
<tr class="row-even"><td>Radar View</td>
<td>Summons an object for moving the current viewport around in space.</td>
</tr>
<tr class="row-odd"><td>Read Module</td>
<td>On a module morph, rereads the source file.</td>
</tr>
<tr class="row-even"><td>References</td>
<td>Enumerate references to an object.</td>
</tr>
<tr class="row-odd"><td>Removed Slots</td>
<td>On a module morph, lists removed slot paths.</td>
</tr>
<tr class="row-even"><td>Restore Window State</td>
<td>Restores the saved state of the screen.</td>
</tr>
<tr class="row-odd"><td>Save snapshot</td>
<td>Saves an image of all objects in a snapshot file. Overwrites the snapshot file that was opened originally. Saves the previous version with a &#8221;.old&#8221; suffix.</td>
</tr>
<tr class="row-even"><td>Save snapshot as ...</td>
<td>Lets you set the file name and other parameters of the saved snapshot. For example, if you have a lot of memory, you can increase the code cache size.</td>
</tr>
<tr class="row-odd"><td>Save Window State</td>
<td>Saves the state of the screen.</td>
</tr>
<tr class="row-even"><td>Send</td>
<td>For a method in a concrete object, send the message to the object.</td>
</tr>
<tr class="row-odd"><td>Senders</td>
<td>Searches for methods sending a given message.</td>
</tr>
<tr class="row-even"><td>Senders of :</td>
<td>For an assignable slot x, show all senders of x:, i.e. methods that might assign to x.</td>
</tr>
<tr class="row-odd"><td>Senders in family</td>
<td>Searches for methods sending a given message in the selected object, its ancestors, and it descendants.</td>
</tr>
<tr class="row-even"><td>Senders of : in family</td>
<td>For an assignable slot x, show all senders of x:, i.e. methods that might assign to x in the selected object, its ancestors, and it descendants.</td>
</tr>
<tr class="row-odd"><td>Set Module</td>
<td>Sets the module of a slot or group of slots.</td>
</tr>
<tr class="row-even"><td>Shell</td>
<td>Summons an outliner on the shell. Used for evaluating expressions.</td>
</tr>
<tr class="row-odd"><td>Show All Frame</td>
<td>On a debugger stack, disable filtering.</td>
</tr>
<tr class="row-even"><td>Show Annotation</td>
<td>Shows the object or slot annotation.</td>
</tr>
<tr class="row-odd"><td>Show Comment</td>
<td>Shows the object or slot comment.</td>
</tr>
<tr class="row-even"><td>Show Morph</td>
<td>For morph object outliners, summons the morph that the object imple-ments.</td>
</tr>
<tr class="row-odd"><td>“Subclass” Me</td>
<td>Appears on the object menu. Automates several steps equivalent to sub-classing in Smalltalk: Creates a copy-down child of the selected object and makes a new parent object for the new child that inherits from the selected object’s parents. It also sets some of the annotations for transport.</td>
</tr>
<tr class="row-even"><td>The box at the top.</td>
<td>Pins up the menu.</td>
</tr>
<tr class="row-odd"><td>Toggle Spy</td>
<td>Toggles an X Window spying on the Virtual Machine. A nice source of reassurance.</td>
</tr>
<tr class="row-even"><td>Traits Family</td>
<td>Show an inheritance hierarchy textually. Only works on certain objects on alternate Thursdays.</td>
</tr>
<tr class="row-odd"><td>Write Snapshot</td>
<td>Saves all the objects in the Self world to a (fairly large) file.</td>
</tr>
</tbody>
</table>
</div>
<span id="document-monitor"></span><div class="section" id="the-system-monitor">
<span id="pp-the-system-monitor"></span><h3>10.7. The system monitor<a class="headerlink" href="#the-system-monitor" title="Permalink to this headline">¶</a></h3>
<p>The Self system contains a system monitor to display information about the internal workings of
the system such as memory management and compilation. It is invoked with <code class="docutils literal"><span class="pre">_Spy:</span></code> <code class="docutils literal"><span class="pre">true</span></code> (there
is are shortcuts in the shell, <code class="docutils literal"><span class="pre">spyOn</span></code> and <code class="docutils literal"><span class="pre">spyOff</span></code>). When it is active, the system monitor takes over
a portion of your screen with a window that looks like this:</p>
<div class="figure">
<img alt="_images/Chapter_5_Figure_7.png" src="_images/Chapter_5_Figure_7.png" />
</div>
<p>The indicators in the left part of the display correspond to various internal activities and events. On
the very left are the CPU bars which show how much CPU is used in various parts of the system.
The following table lists the individual indicators:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-number">Table 10.2 </span><span class="caption-text">The system monitor display: indicators</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">CPU</th>
<th class="head">Bar What It Means</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>VM</td>
<td>CPU time spent executing in the VM, i.e. for primitives, garbage collection etc.</td>
</tr>
<tr class="row-odd"><td>Lkup</td>
<td>CPU time used by compile-time and run-time lookups.</td>
</tr>
<tr class="row-even"><td>Comp</td>
<td>CPU time spent by the Self compilers. The black part stands for time consumed by the non-inling
compiler (NIC), the gray part for the simple inlining compiler (SIC).</td>
</tr>
<tr class="row-odd"><td>Self</td>
<td>CPU time spent executing compiled Self code. The black part stands for time consumed by
unoptimized (NIC) code, the gray part for optimized (SIC) code.</td>
</tr>
<tr class="row-even"><td>CPU</td>
<td>This bar displays the percentage of the CPU that the Self process is getting (a completely filled
bar equals 100% CPU utilization by Self). Black stands for user time, gray for system time.</td>
</tr>
<tr class="row-odd"><td>Dot</td>
<td>Below the CPU bar is a small dot which moves whenever a process switch takes place.</td>
</tr>
</tbody>
</table>
<p></p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Indicator</th>
<th class="head">What It Means</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>X-compiling Y</td>
<td>The X compiler (where X is either “nic” or “sic”) is compiling the method named Y into machine
code.</td>
</tr>
<tr class="row-odd"><td>scavenge</td>
<td>The Self object memory is being scavenged. A scavenge is a fast, partial garbage collection (see
<a class="reference internal" href="index.html#citations"><span class="std std-ref">[Ung84]</span></a> , <a class="reference internal" href="index.html#citations"><span class="std std-ref">[Ung86]</span></a> , <a class="reference internal" href="index.html#citations"><span class="std std-ref">[Lee88]</span></a> ).</td>
</tr>
<tr class="row-even"><td>GC</td>
<td>The Self object memory is being fully garbage-collected.</td>
</tr>
<tr class="row-odd"><td>flushing</td>
<td>Self is flushing the code cache.</td>
</tr>
<tr class="row-even"><td>compacting</td>
<td>Self is compacting the code cache.</td>
</tr>
<tr class="row-odd"><td>reclaiming</td>
<td>Self is reclaiming space in the code cache to make room for a new method.</td>
</tr>
<tr class="row-even"><td>sec reclaim</td>
<td>Self is flushing some methods in the code cache because there is not enough room in one of the
secondary caches (the caches holding the debugging and dependency information).</td>
</tr>
<tr class="row-odd"><td>ic flush</td>
<td>Self is flushing all inline caches.</td>
</tr>
<tr class="row-even"><td>LRU sweep</td>
<td>Self is examining methods in the code cache to determine whether they have been used recently.</td>
</tr>
<tr class="row-odd"><td>page N N</td>
<td>page faults occurred during the last time interval (N is not displayed if N=1). The time interval
currently is 1/25 of a second.</td>
</tr>
<tr class="row-even"><td>read</td>
<td>Self is blocked reading from a “slow” device, e.g., the keyboard or mouse.</td>
</tr>
<tr class="row-odd"><td>write</td>
<td>Self is blocked writing to a “slow” device, e.g., the screen.</td>
</tr>
<tr class="row-even"><td>disk in/out</td>
<td>Self is doing disk I/O.</td>
</tr>
<tr class="row-odd"><td>UNIX</td>
<td>Self is blocked in some UNIX system call other than read or write.</td>
</tr>
<tr class="row-even"><td>idle</td>
<td>Self has nothing to do. (shows up only when using processes.)</td>
</tr>
</tbody>
</table>
<p>The middle part of the display contains some information on VM memory usage displayed in textual
form, as described below:</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-number">Table 10.3 </span><span class="caption-text">VM memory status information</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>RSRC</td>
<td>Size and utilization of the resource area (an area of memory used for temporary storage by the
compiler and by primitives).</td>
</tr>
<tr class="row-odd"><td>C-Heap</td>
<td>Number of bytes allocated on the C heap by Self (excluding the memory and code spaces and the
resource area).</td>
</tr>
</tbody>
</table>
<p>The memory status portion of the system monitor consists of bars representing memory spaces and
their utilization; all bars are drawn to scale relative to one another, their areas being proportional
to the actual sizes of the memory spaces. The next table explains the details of this part of the system
monitor’s display.</p>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-number">Table 10.4 </span><span class="caption-text">The system monitor display: memory status</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Space</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>object memory</td>
<td>The four (or more) bars represent (from top to bottom) eden, the two survivor spaces, and subsequent
bars are segments of old space. The left and right parts of each bar represent the space used
by “plain” objects and byte vectors, respectively. The above picture shows a situation in which
about half of old space is filled with plain objects and about 25% is filled with byte vectors. A fraction
of old space’s used portions is currently paged out (gray areas).
Below the old space is a ruler, marked in 1Mb intervals, showing the total allocated in old space
(extending line at the left). To the right is a red bar representing how much of old space is reserved
for use by the Virtual Machine, and a yellow bar representing the low space threshold (when
crossed, the scheduler is notified and a garbage colelction may take place).</td>
</tr>
<tr class="row-odd"><td>code cache</td>
<td>These four bars represent the cache holding compiled methods with their associated debugging and
dependency information. The bar labelled ‘code’ represents the cache containing the actual
machine code for methods (including some headers and relocation information); it is divided into
code generated by the primary (non-inlining) compiler, or NIC, and code generated by the
secondary, smarter compiler (SIC). The cache represented by the bar labelled ‘deps’ contains
dependency information for the compiled methods, and the cache represented by the bar labelled
‘debug’ contains the debugging information. The three-way split reduces the working set size of the
code cache. The cache represented by the bar labelled ‘PICs’ contains polymorphic inline caches.</td>
</tr>
</tbody>
</table>
<p></p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Color</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>black</td>
<td>Allocated, residing in real memory.</td>
</tr>
<tr class="row-odd"><td>gray</td>
<td>Allocated, paged out.</td>
</tr>
<tr class="row-even"><td>white</td>
<td>Unallocated memory.</td>
</tr>
</tbody>
</table>
</div>
<span id="document-primitives"></span><div class="section" id="primitives">
<span id="pp-primitives"></span><span id="id1"></span><h3>10.8. Primitives<a class="headerlink" href="#primitives" title="Permalink to this headline">¶</a></h3>
<p>Primitives are Self methods implemented by the virtual machine. The first character of a primitive’s
selector is an underscore (‘_’). You cannot define primitives yourself (unless you modify the
Virtual Machine), nor can you define slots beginning with an underscore.</p>
<div class="section" id="primitive-failures">
<h4>10.8.1. Primitive failures<a class="headerlink" href="#primitive-failures" title="Permalink to this headline">¶</a></h4>
<p>Every primitive call can take an optional argument defining how errors should be handled for this
call. To do this, the primitive is extended with an <code class="docutils literal"><span class="pre">IfFail</span></code>: argument. For example, <code class="docutils literal"><span class="pre">_AsObject</span></code>
becomes <code class="docutils literal"><span class="pre">_AsObjectIfFail</span></code>:, and <code class="docutils literal"><span class="pre">_IntAdd</span></code>: becomes <code class="docutils literal"><span class="pre">_IntAdd:IfFail:</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; 3 _IntAdd: ’a’ IfFail: [ | :error. :name |
(name, ’ failed with ’, error, ’.’) printLine. 0 ]
_IntAdd: failed with badTypeError.
0        &quot;The primitive returns the result of evaluating the failure block.&quot;
&gt;
</pre></div>
</div>
<p>When a primitive fails, if the primitive call has an <code class="docutils literal"><span class="pre">IfFail</span></code>: part, the message <code class="docutils literal"><span class="pre">value:With:</span></code> is
sent to the <code class="docutils literal"><span class="pre">IfFail:</span></code> argument, passing two strings: the name of the primitive and an error string
indicating the reason for failure. If the failing primitive call <em>does not</em> have an <code class="docutils literal"><span class="pre">IfFail:</span></code> part, the
message <code class="docutils literal"><span class="pre">primitive:FailedWith:</span></code> is sent to the receiver of the primitive call with the same two
strings as arguments.</p>
<p>The result returned by the error handler becomes the result of the primitive operation (0 in our example);
execution then continues normally. If you want the program to be aborted, you have to do
this explicitly within the error handler, for example by calling the standard <code class="docutils literal"><span class="pre">error:</span></code> method defined
in the default world.</p>
<p>The following table lists the error string prefixes passed by the VM to indicate the reason of the
primitive failure. If the error string consists of more than the prefix it will reveal more details about
the error.</p>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><span class="target" id="index-5"></span><span class="target" id="index-6"></span><span class="target" id="index-7"></span><span class="target" id="index-8"></span><span class="target" id="index-9"></span><span class="target" id="index-10"></span><span class="target" id="index-11"></span><span class="target" id="index-12"></span><span class="target" id="index-13"></span><span class="target" id="index-14"></span><span class="target" id="index-15"></span><span class="target" id="index-16"></span><span class="target" id="index-17"></span><span class="target" id="index-18"></span><span class="target" id="index-19"></span><span class="target" id="index-20"></span><span class="target" id="index-21"></span><span class="target" id="index-22"></span><span class="target" id="index-23"></span><span class="target" id="index-24"></span><span class="target" id="index-25"></span><span class="target" id="index-26"></span><span class="target" id="index-27"></span><span class="target" id="index-28"></span><table border="1" class="colwidths-given docutils" id="id2">
<caption><span class="caption-number">Table 10.5 </span><span class="caption-text">Primitive failures</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prefix</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>primitiveNotDefinedError</td>
<td>Primitive not defined.</td>
</tr>
<tr class="row-odd"><td>primitiveFailedError</td>
<td>General primitive failure (for example, an argument has an invalid value).</td>
</tr>
<tr class="row-even"><td>badTypeError</td>
<td>The receiver or an argument has the wrong type.</td>
</tr>
<tr class="row-odd"><td>badTypeSealError</td>
<td>Proxy’s type seal did not match expected type seal.</td>
</tr>
<tr class="row-even"><td>divisionByZeroError</td>
<td>Division by zero.</td>
</tr>
<tr class="row-odd"><td>overflowError</td>
<td>Integer overflow. This can occur in integer arithmetic primitives or in UNIX (when the result is too large to be represented as an integer).</td>
</tr>
<tr class="row-even"><td>badSignError</td>
<td>Integer receiver or argument has wrong sign.</td>
</tr>
<tr class="row-odd"><td>alignmentError</td>
<td>Bad word alignment in memory.</td>
</tr>
<tr class="row-even"><td>badIndexError</td>
<td>The vector index (e.g. in <code class="docutils literal"><span class="pre">_At:</span></code>) is out of bounds (too large or negative).</td>
</tr>
<tr class="row-odd"><td>badSizeError</td>
<td>An invalid size of a vector was specified, e.g. attempting to clone a vector with a negative size (see <code class="docutils literal"><span class="pre">_Clone:Filler:</span></code> and <code class="docutils literal"><span class="pre">_CloneBytes:Filler:</span></code> below).</td>
</tr>
<tr class="row-even"><td>reflectTypeError</td>
<td>A mirror primitive was applied to the wrong kind of slot, e.g. <code class="docutils literal"><span class="pre">_MirrorParentGroupAt:</span></code> to a slot that isn’t a parent slot.</td>
</tr>
<tr class="row-odd"><td>outOfMemoryError</td>
<td>A primitive could not complete because its results would not fit in the existing space.</td>
</tr>
<tr class="row-even"><td>stackOverflowError</td>
<td>The stack overflowed during execution of the primitive or program.</td>
</tr>
<tr class="row-odd"><td>slotNameError</td>
<td>Illegal slot name.</td>
</tr>
<tr class="row-even"><td>argumentCountError</td>
<td>Wrong number of arguments.</td>
</tr>
<tr class="row-odd"><td>unassignableSlotError</td>
<td>This slot is not assignable.</td>
</tr>
<tr class="row-even"><td>lonelyAssignmentSlotError</td>
<td>Assignment slot must have a corresponding data slot.</td>
</tr>
<tr class="row-odd"><td>parallelTWAINSError</td>
<td>Can not invoke TWAINS primitive (another process is already using it).</td>
</tr>
<tr class="row-even"><td>noProcessError</td>
<td>This process does not exist.</td>
</tr>
<tr class="row-odd"><td>noActivationError</td>
<td>This method activation does not exist.</td>
</tr>
<tr class="row-even"><td>noReceiverError</td>
<td>This activation has no receiver.</td>
</tr>
<tr class="row-odd"><td>noParentSlot</td>
<td>This activation has no lexical parent.</td>
</tr>
<tr class="row-even"><td>noSenderSlot</td>
<td>This activation has no sender slot.</td>
</tr>
<tr class="row-odd"><td>deadProxyError</td>
<td>This proxy is dead and can not be used.</td>
</tr>
<tr class="row-even"><td>liveProxyError</td>
<td>This proxy is live and can not be used to hold a proxy result.</td>
</tr>
<tr class="row-odd"><td>wrongNoOfArgsError</td>
<td>Wrong number of arguments was supplied with call of foreign function.</td>
</tr>
<tr class="row-even"><td>nullPointerError</td>
<td>Foreign function returned null pointer.</td>
</tr>
<tr class="row-odd"><td>nullCharError</td>
<td>Can not pass byte vector containing null char to foreign function expecting a string.</td>
</tr>
<tr class="row-even"><td>prematureEndOfInputError</td>
<td>Premature end of input during parsing.</td>
</tr>
<tr class="row-odd"><td>noDynamicLinkerError</td>
<td>Primitive depends on dynamic linker which is not available in this system.</td>
</tr>
<tr class="row-even"><td>EPERM, ENOENT, ...</td>
<td>These errors are returned by a UNIX primitive if a UNIX system call executed by the primitive fails. The UNIX error codes are defined in <code class="docutils literal"><span class="pre">/usr/include/sys/errno.h</span></code>; see this file for details on the roughly 90 different UNIX error codes.</td>
</tr>
</tbody>
</table>
<p id="index-30">The <code class="docutils literal"><span class="pre">_ErrorMessage</span></code> primitive, sent to an error string returned by any primitive, returns a more
descriptive version of the error message; this is especially useful for UNIX errors.</p>
</div>
<div class="section" id="available-primitives">
<h4>10.8.2. Available primitives<a class="headerlink" href="#available-primitives" title="Permalink to this headline">¶</a></h4>
<p>A complete list of primitives can be obtained by sending <code class="docutils literal"><span class="pre">primitiveList</span></code> to <code class="docutils literal"><span class="pre">primitives</span></code>. Documentation
for a primitive (such as <code class="docutils literal"><span class="pre">_Clone</span></code>), can be obtained using at:, thus:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>primitives at: ’_Clone’
</pre></div>
</div>
<p>A list of primitive names matching a pattern can be obtained thus:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>primitives match: ’_Memory*’
</pre></div>
</div>
<p>Some points to note when browsing primitives:</p>
<blockquote>
<div><ul class="simple">
<li>Since strings are special kinds of byte vectors, primitives taking byte vectors as arguments
can usually take strings. The exception is that canonical strings cannot be passed to primitives
that modify the object.</li>
<li>Integer arithmetic primitives take integer receivers and arguments; floating-point arithmetic
primitives take floating-point receivers and arguments.</li>
<li>All comparison primitives return either true or false. Integer comparison primitives take integer
receivers and arguments; floating-point comparison primitives take floating-point receivers
and arguments.</li>
<li>The receiver of a mirror primitive must be a mirror (unless otherwise noted)</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
</div>
<span id="document-extras"></span><div class="section" id="extras">
<h2>11. Extras<a class="headerlink" href="#extras" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Last updated 4 February 2014 for Self 4.5.0</div></blockquote>
<p>The default Self source code tree comes with a number of extra objects and features which aren&#8217;t included in the default Self World. These can in general be loaded by doing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s1">&#39;path/to/file.self&#39;</span> <span class="n">runScript</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bootstrap</span> <span class="n">load</span><span class="p">:</span> <span class="s1">&#39;file&#39;</span> <span class="n">From</span><span class="p">:</span> <span class="s1">&#39;path/to&#39;</span>
</pre></div>
</div>
<p>where the current working directory is the <cite>objects</cite> directory of the source code tree.</p>
<p>These extra features include:</p>
<div class="toctree-wrapper compound">
<span id="document-ui1"></span><div class="section" id="the-original-self-ui">
<h3>11.1. The Original Self UI<a class="headerlink" href="#the-original-self-ui" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Last updated 4 February 2014 for Self 4.5.0</div></blockquote>
<p>Before Self used the current <cite>morphic</cite> user interface (also known as <cite>UI2</cite>) it used another, nameless, user interface framework which has been retrospectively dubbed <cite>ui1</cite>.</p>
<div class="section" id="x11-with-256-colors">
<h4>11.1.1. X11 with 256 Colors<a class="headerlink" href="#x11-with-256-colors" title="Permalink to this headline">¶</a></h4>
<p>UI1 only runs on 8 bit X11 systems. There are a number of suggested ways to get a 8 bit X11 window on modern systems detailed at <a class="reference external" href="http://wiki.winehq.org/256ColorMode">WineHQ</a>.</p>
<p>On OS X systems, you will need to install XQuartz if you are running Mountain Lion (10.8) or later.  You will need to set the color depth to 256 colors in the Preferences, then restart XQuartz.</p>
</div>
<div class="section" id="vm-with-x11-support">
<h4>11.1.2. VM with X11 support<a class="headerlink" href="#vm-with-x11-support" title="Permalink to this headline">¶</a></h4>
<p>The standard Linux VM already has X11 primitives. However the standard Mac VM doesn&#8217;t, so that users can run Self on Macs without requiring X11 to be installed. You can either build a OS X VM which includes X11 support yourself as described <a class="reference internal" href="index.html#document-buildvm"><span class="doc">the section on building the VM</span></a> or download one from the Self fileserver.</p>
</div>
<div class="section" id="preparing-a-snapshot">
<h4>11.1.3. Preparing a snapshot<a class="headerlink" href="#preparing-a-snapshot" title="Permalink to this headline">¶</a></h4>
<p>The first step in using UI1 is to build a new World including it. Assuming you are in the <cite>objects</cite> directory in the Self source tree, and that the Self vm is in your path, do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Self</span> <span class="o">-</span><span class="n">f</span> <span class="n">worldBuilder</span><span class="o">.</span><span class="n">self</span>
</pre></div>
</div>
<p>and when it asks you:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Load UI1 (X11 only)? (y/N)
&gt;
</pre></div>
</div>
<p>answer <cite>y</cite>. When the World has built, save it at the prompt by doing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">save</span>
<span class="n">quitNoSave</span>
</pre></div>
</div>
<p>This will save a snapshot of the world in the file &#8216;<code class="docutils literal"><span class="pre">Snapshot.snap</span></code>&#8216;.</p>
</div>
<div class="section" id="starting-the-ui">
<h4>11.1.4. Starting the UI<a class="headerlink" href="#starting-the-ui" title="Permalink to this headline">¶</a></h4>
<p>Once you have a 256 colour X11 desktop running, you can start your Self world and start using UI1 by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">preferences</span> <span class="n">xDisplay</span><span class="p">:</span> <span class="s1">&#39;:1&#39;</span>  <span class="s2">&quot;Only if necessary&quot;</span>
<span class="n">ui</span> <span class="n">demo</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html#document-index">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#history">1.1. History</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#system-overview">1.2. System Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-gettingstarted">2. Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#downloading-prebuilt-vm-and-snapshot">2.1. Downloading Prebuilt VM and snapshot</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-on-os-x">2.2. Running on OS X</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-on-linux">2.3. Running on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#building-your-own-system">2.4. Building your own system</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-langref">3. Language Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#objects">3.1. Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#slot-descriptors">3.2. Slot descriptors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#expressions">3.3. Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#lexical-elements">3.4. Lexical elements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-selfwrld">4. The Self World</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-worldorg">4.1. World Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-roots">4.2. The Roots of Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-blocks">4.3. Blocks, Booleans, and Control Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-numbers">4.4. Numbers and Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-collections">4.5. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-pairs">4.6. Pairs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-mirrors">4.7. Mirrors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-messages">4.8. Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-processes">4.9. Processes and the Prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-foreign">4.10. Foreign Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-unix">4.11. I/O and Unix</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-oddball">4.12. Other Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-buildworld">4.13. How to build the world</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-lowlevel">4.14. How to use the low-level interrupt facilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-textdebug">4.15. Using the textual debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-logging">4.16. Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-progguid">5. A Guide to Programming Style</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#behaviorism-versus-reflection">5.1. Behaviorism versus Reflection</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#objects-have-many-roles">5.2. Objects Have Many Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#naming-and-printing">5.3. Naming and Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-to-return-multiple-values">5.4. How to Return Multiple Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#substituting-values-for-blocks">5.5. Substituting Values for Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#nil-considered-naughty">5.6. <code class="docutils literal"><span class="pre">nil</span></code> Considered Naughty</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hash-and">5.7. Hash and =</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#equality-identity-and-indistinguishability">5.8. Equality, Identity, and Indistinguishability</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-howtoprg">6. How to Program in Self</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#introduction">6.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#browsing-concepts">6.2. Browsing Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hacking-objects">6.3. Hacking Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-transporter">6.4. The Transporter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-morphic">7. Morphic: The Self User Interface Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#overview">7.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#composite-morphs">7.2. Composite Morphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#morph-traits-and-prototypes">7.3. Morph Traits and Prototypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#saving-a-composite-morph">7.4. Saving a Composite Morph</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#handling-user-input">7.5. Handling User Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#drag-and-drop">7.6. Drag and Drop</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#automatic-layout">7.7. Automatic Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#animation">7.8. Animation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#other-issues">7.9. Other Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#morph-responsibilities">7.10. Morph Responsibilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#some-useful-morphs">7.11. Some Useful Morphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-graphical-environment">7.12. The Graphical Environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-vmref">8. Virtual Machine Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-buildvm">8.1. Building a VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#startup-options">8.2. Startup options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#system-triggered-messages">8.3. System-triggered messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#run-time-message-lookup-errors">8.4. Run-time message lookup errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#low-level-error-messages">8.5. Low-level error messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#an-example">8.6. An example</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#lookup-errors">8.7. Lookup errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#programmer-defined-errors">8.8. Programmer defined errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#primitive-errors">8.9. Primitive errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#nonrecoverable-process-errors">8.10. Nonrecoverable process errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#fatal-errors">8.11. Fatal errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-initial-self-world">8.12. The initial Self world</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#option-primitives">8.13. Option Primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#interfacing-with-other-languages">8.14. Interfacing with other languages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-ref">9. References</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-appendices">10. Appendices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-glossary">10.1. Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-lexicaloverview">10.2. Lexical overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-syntaxoverview">10.3. Syntax overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-builtintypes">10.4. Built-in types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-usefulselectors">10.5. Useful Selectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-menus">10.6. Every Menu Item in the Programming Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-monitor">10.7. The system monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-primitives">10.8. Primitives</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-extras">11. Extras</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-ui1">11.1. The Original Self UI</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html#document-index">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Russell Allen (Ed.).
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>